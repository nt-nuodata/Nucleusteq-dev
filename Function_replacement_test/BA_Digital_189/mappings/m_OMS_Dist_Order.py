# Databricks notebook source
# MAGIC %run "./udf_informatica"

# COMMAND ----------


from pyspark.sql.types import *

spark.sql("use DELTA_TRAINING")
spark.sql("set spark.sql.legacy.timeParserPolicy = LEGACY")

# COMMAND ----------
%run ../WorkflowUtility

# COMMAND ----------
mainWorkflowId = dbutils.widgets.get("mainWorkflowId")
mainWorkflowRunId = dbutils.widgets.get("mainWorkflowRunId")
parentName = dbutils.widgets.get("parentName")
preVariableAssignment = dbutils.widgets.get("preVariableAssignment")
postVariableAssignment = dbutils.widgets.get("postVariableAssignment")
truncTargetTableOptions = dbutils.widgets.get("truncTargetTableOptions")
variablesTableName = dbutils.widgets.get("variablesTableName")

# COMMAND ----------
#Truncate Target Tables
truncateTargetTables(truncTargetTableOptions)

# COMMAND ----------
#Pre presession variable updation
updateVariable(preVariableAssignment, variablesTableName, mainWorkflowId, parentName, "m_OMS_Dist_Order")

# COMMAND ----------
fetchAndCreateVariables(parentName,"m_OMS_Dist_Order", variablesTableName, mainWorkflowId)

# COMMAND ----------
# DBTITLE 1, Lkp_CURRENCY_DAY


spark.sql(
  """CREATE OR REPLACE FUNCTION Lkp_CURRENCY_DAY (in_DAY_DT DATE)
RETURNS STRING
READS SQL DATA SQL SECURITY DEFINER
RETURN SELECT FIRST(EXCHANGE_RATE_PCNT) FROM CURRENCY_DAY WHERE DAY_DT = in_DAY_DT"""
)

# COMMAND ----------
# DBTITLE 1, Lkp_Site_Profile


spark.sql(
  """CREATE OR REPLACE FUNCTION Lkp_Site_Profile (in_FACILITY_ALIAS_ID STRING, in_FACILITY_TYPE_ID INT)
RETURNS INT
READS SQL DATA SQL SECURITY DEFINER
RETURN SELECT FIRST(LOCATION_ID) FROM (SELECT 
MAX(SITE_PROFILE.LOCATION_ID) as LOCATION_ID, 
CASE 
	WHEN SITE_PROFILE.LOCATION_TYPE_ID = 19 
       THEN LTRIM(SITE_PROFILE.LOCATION_NBR, '0')
	ELSE SITE_PROFILE.LOCATION_NBR
END  as LOCATION_NBR, 
SITE_PROFILE.LOCATION_TYPE_ID as LOCATION_TYPE_ID 
FROM SITE_PROFILE
GROUP BY
SITE_PROFILE.LOCATION_TYPE_ID,
CASE 
	WHEN SITE_PROFILE.LOCATION_TYPE_ID = 19 
       THEN LTRIM(SITE_PROFILE.LOCATION_NBR, '0')
	ELSE SITE_PROFILE.LOCATION_NBR
END) WHERE LOCATION_NBR = in_FACILITY_ALIAS_ID AND LOCATION_TYPE_ID = in_FACILITY_TYPE_ID"""
)

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_FACILITY1_2


query_2 = f"""SELECT
  OMS_FACILITY_ID AS OMS_FACILITY_ID,
  FACILITY_TYPE_BITS AS FACILITY_TYPE_BITS,
  MARK_FOR_DELETION_FLAG AS MARK_FOR_DELETION_FLAG,
  OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_FACILITY"""

df_2 = spark.sql(query_2)

df_2.createOrReplaceTempView("Shortcut_to_OMS_FACILITY1_2")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_FACILITY1_3


query_3 = f"""SELECT
  OMS_FACILITY_ID AS OMS_FACILITY_ID,
  FACILITY_TYPE_BITS AS FACILITY_TYPE_BITS,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_FACILITY1_2"""

df_3 = spark.sql(query_3)

df_3.createOrReplaceTempView("SQ_Shortcut_to_OMS_FACILITY1_3")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_FACILITY_4


query_4 = f"""SELECT
  OMS_FACILITY_ID AS OMS_FACILITY_ID,
  FACILITY_TYPE_BITS AS FACILITY_TYPE_BITS,
  MARK_FOR_DELETION_FLAG AS MARK_FOR_DELETION_FLAG,
  OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_FACILITY"""

df_4 = spark.sql(query_4)

df_4.createOrReplaceTempView("Shortcut_to_OMS_FACILITY_4")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_FACILITY_5


query_5 = f"""SELECT
  OMS_FACILITY_ID AS OMS_FACILITY_ID,
  FACILITY_TYPE_BITS AS FACILITY_TYPE_BITS,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_FACILITY_4"""

df_5 = spark.sql(query_5)

df_5.createOrReplaceTempView("SQ_Shortcut_to_OMS_FACILITY_5")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_EDW_LOAD_CTRL_PRE_6


query_6 = f"""SELECT
  OMS_PURCHASE_ORDERS_ID AS OMS_PURCHASE_ORDERS_ID,
  OMS_PURCHASE_ORDERS_LINE_ITEM_ID AS OMS_PURCHASE_ORDERS_LINE_ITEM_ID,
  OMS_TC_COMPANY_ID AS OMS_TC_COMPANY_ID,
  ORDER_NBR AS ORDER_NBR,
  OMS_TC_PURCHASE_ORDERS_ID AS OMS_TC_PURCHASE_ORDERS_ID,
  OMS_TC_PO_LINE_ID AS OMS_TC_PO_LINE_ID,
  OMS_ORDER_FULFILLMENT_OPTION AS OMS_ORDER_FULFILLMENT_OPTION,
  ORDER_FULFILLMENT_CHANNEL AS ORDER_FULFILLMENT_CHANNEL,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  ORDER_CHANNEL AS ORDER_CHANNEL,
  OMS_CREATED_SOURCE AS OMS_CREATED_SOURCE,
  OMS_ENTERED_BY AS OMS_ENTERED_BY,
  OMS_ROLE_NAME AS OMS_ROLE_NAME,
  PO_OMS_CREATED_TSTMP AS PO_OMS_CREATED_TSTMP,
  PO_OMS_LAST_UPDATED_DTTM AS PO_OMS_LAST_UPDATED_DTTM,
  POL_OMS_CREATED_TSTMP AS POL_OMS_CREATED_TSTMP,
  POL_OMS_LAST_UPDATED_TSTMP AS POL_OMS_LAST_UPDATED_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_EDW_LOAD_CTRL_PRE"""

df_6 = spark.sql(query_6)

df_6.createOrReplaceTempView("Shortcut_to_OMS_EDW_LOAD_CTRL_PRE_6")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_EDW_LOAD_CTRL_PRE_7


query_7 = f"""SELECT
  OMS_PURCHASE_ORDERS_ID AS OMS_PURCHASE_ORDERS_ID,
  OMS_PURCHASE_ORDERS_LINE_ITEM_ID AS OMS_PURCHASE_ORDERS_LINE_ITEM_ID,
  ORDER_NBR AS ORDER_NBR,
  OMS_TC_PURCHASE_ORDERS_ID AS OMS_TC_PURCHASE_ORDERS_ID,
  ORDER_FULFILLMENT_CHANNEL AS ORDER_FULFILLMENT_CHANNEL,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  ORDER_CHANNEL AS ORDER_CHANNEL,
  PO_OMS_CREATED_TSTMP AS PO_OMS_CREATED_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_EDW_LOAD_CTRL_PRE_6"""

df_7 = spark.sql(query_7)

df_7.createOrReplaceTempView("SQ_Shortcut_to_OMS_EDW_LOAD_CTRL_PRE_7")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_ORDERS_NEW_8


query_8 = f"""SELECT
  OMS_ORDER_ID AS OMS_ORDER_ID,
  OMS_TC_COMPANY_ID AS OMS_TC_COMPANY_ID,
  OMS_TC_ORDER_ID AS OMS_TC_ORDER_ID,
  OMS_PURCHASE_ORDER_ID AS OMS_PURCHASE_ORDER_ID,
  OMS_PURCHASE_ORDER_NBR AS OMS_PURCHASE_ORDER_NBR,
  OMS_EXT_PURCHASE_ORDER AS OMS_EXT_PURCHASE_ORDER,
  OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  OMS_ORDER_STATUS_ID AS OMS_ORDER_STATUS_ID,
  OMS_DO_TYPE_ID AS OMS_DO_TYPE_ID,
  OMS_DO_STATUS_ID AS OMS_DO_STATUS_ID,
  OMS_SHIPMENT_ID AS OMS_SHIPMENT_ID,
  OMS_CREATION_TYPE_ID AS OMS_CREATION_TYPE_ID,
  OMS_BILLING_METHOD_ID AS OMS_BILLING_METHOD_ID,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  OMS_DELIVERY_OPTIONS_ID AS OMS_DELIVERY_OPTIONS_ID,
  CUSTOMER_PICKUP_FLAG AS CUSTOMER_PICKUP_FLAG,
  PARTIALLY_PLANNED_FLAG AS PARTIALLY_PLANNED_FLAG,
  PARTIAL_SHIP_CONFIRMATION_FLAG AS PARTIAL_SHIP_CONFIRMATION_FLAG,
  PARTIAL_SHIP_CONFIRMATION_STATUS AS PARTIAL_SHIP_CONFIRMATION_STATUS,
  HAS_ALERTS_FLAG AS HAS_ALERTS_FLAG,
  HAS_SPLIT_FLAG AS HAS_SPLIT_FLAG,
  CANCELLED_FLAG AS CANCELLED_FLAG,
  BACK_ORDERED_FLAG AS BACK_ORDERED_FLAG,
  OMS_INBOUND_REGION_ID AS OMS_INBOUND_REGION_ID,
  OMS_OUTBOUND_REGION_ID AS OMS_OUTBOUND_REGION_ID,
  OMS_O_FACILITY_ALIAS_ID AS OMS_O_FACILITY_ALIAS_ID,
  OMS_O_FACILITY_ID AS OMS_O_FACILITY_ID,
  OMS_D_FACILITY_ALIAS_ID AS OMS_D_FACILITY_ALIAS_ID,
  OMS_D_FACILITY_ID AS OMS_D_FACILITY_ID,
  OMS_BILL_FACILITY_ALIAS_ID AS OMS_BILL_FACILITY_ALIAS_ID,
  OMS_BILL_FACILITY_ID AS OMS_BILL_FACILITY_ID,
  OMS_CUSTOMER_ID AS OMS_CUSTOMER_ID,
  ADDR_VALID_FLAG AS ADDR_VALID_FLAG,
  OMS_PICKUP_START_TSTMP AS OMS_PICKUP_START_TSTMP,
  OMS_PICKUP_END_TSTMP AS OMS_PICKUP_END_TSTMP,
  OMS_PICKUP_TZ_ID AS OMS_PICKUP_TZ_ID,
  OMS_DELIVERY_TZ_ID AS OMS_DELIVERY_TZ_ID,
  OMS_DELIVERY_START_TSTMP AS OMS_DELIVERY_START_TSTMP,
  OMS_DELIVERY_END_TSTMP AS OMS_DELIVERY_END_TSTMP,
  OMS_ORDER_DT_TSTMP AS OMS_ORDER_DT_TSTMP,
  OMS_ORDER_RECON_TSTMP AS OMS_ORDER_RECON_TSTMP,
  OMS_SCHED_PICKUP_TSTMP AS OMS_SCHED_PICKUP_TSTMP,
  OMS_SCHED_DELIVERY_TSTMP AS OMS_SCHED_DELIVERY_TSTMP,
  OMS_ACTUAL_SHIPPED_TSTMP AS OMS_ACTUAL_SHIPPED_TSTMP,
  TOTAL_NBR_OF_UNITS AS TOTAL_NBR_OF_UNITS,
  BASELINE_COST AS BASELINE_COST,
  ACTUAL_COST AS ACTUAL_COST,
  MONETARY_VALUE AS MONETARY_VALUE,
  MV_CURRENCY_CD AS MV_CURRENCY_CD,
  REF_NUM1 AS REF_NUM1,
  OMS_CREATED_SOURCE_TYPE_ID AS OMS_CREATED_SOURCE_TYPE_ID,
  OMS_CREATED_SOURCE AS OMS_CREATED_SOURCE,
  OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_ORDERS"""

df_8 = spark.sql(query_8)

df_8.createOrReplaceTempView("Shortcut_to_OMS_ORDERS_NEW_8")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_ORDERS_NEW_9


query_9 = f"""SELECT
  OMS_ORDER_ID AS OMS_ORDER_ID,
  OMS_TC_COMPANY_ID AS OMS_TC_COMPANY_ID,
  OMS_TC_ORDER_ID AS OMS_TC_ORDER_ID,
  OMS_PURCHASE_ORDER_ID AS OMS_PURCHASE_ORDER_ID,
  OMS_PURCHASE_ORDER_NBR AS OMS_PURCHASE_ORDER_NBR,
  OMS_EXT_PURCHASE_ORDER AS OMS_EXT_PURCHASE_ORDER,
  OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  OMS_ORDER_STATUS_ID AS OMS_ORDER_STATUS_ID,
  OMS_DO_TYPE_ID AS OMS_DO_TYPE_ID,
  OMS_DO_STATUS_ID AS OMS_DO_STATUS_ID,
  OMS_SHIPMENT_ID AS OMS_SHIPMENT_ID,
  OMS_CREATION_TYPE_ID AS OMS_CREATION_TYPE_ID,
  OMS_BILLING_METHOD_ID AS OMS_BILLING_METHOD_ID,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  OMS_DELIVERY_OPTIONS_ID AS OMS_DELIVERY_OPTIONS_ID,
  CUSTOMER_PICKUP_FLAG AS CUSTOMER_PICKUP_FLAG,
  PARTIALLY_PLANNED_FLAG AS PARTIALLY_PLANNED_FLAG,
  PARTIAL_SHIP_CONFIRMATION_FLAG AS PARTIAL_SHIP_CONFIRMATION_FLAG,
  PARTIAL_SHIP_CONFIRMATION_STATUS AS PARTIAL_SHIP_CONFIRMATION_STATUS,
  HAS_ALERTS_FLAG AS HAS_ALERTS_FLAG,
  HAS_SPLIT_FLAG AS HAS_SPLIT_FLAG,
  CANCELLED_FLAG AS CANCELLED_FLAG,
  BACK_ORDERED_FLAG AS BACK_ORDERED_FLAG,
  OMS_INBOUND_REGION_ID AS OMS_INBOUND_REGION_ID,
  OMS_OUTBOUND_REGION_ID AS OMS_OUTBOUND_REGION_ID,
  OMS_O_FACILITY_ALIAS_ID AS OMS_O_FACILITY_ALIAS_ID,
  OMS_O_FACILITY_ID AS OMS_O_FACILITY_ID,
  OMS_D_FACILITY_ALIAS_ID AS OMS_D_FACILITY_ALIAS_ID,
  OMS_D_FACILITY_ID AS OMS_D_FACILITY_ID,
  OMS_BILL_FACILITY_ALIAS_ID AS OMS_BILL_FACILITY_ALIAS_ID,
  OMS_BILL_FACILITY_ID AS OMS_BILL_FACILITY_ID,
  OMS_CUSTOMER_ID AS OMS_CUSTOMER_ID,
  ADDR_VALID_FLAG AS ADDR_VALID_FLAG,
  OMS_PICKUP_START_TSTMP AS OMS_PICKUP_START_TSTMP,
  OMS_PICKUP_END_TSTMP AS OMS_PICKUP_END_TSTMP,
  OMS_PICKUP_TZ_ID AS OMS_PICKUP_TZ_ID,
  OMS_DELIVERY_TZ_ID AS OMS_DELIVERY_TZ_ID,
  OMS_DELIVERY_START_TSTMP AS OMS_DELIVERY_START_TSTMP,
  OMS_DELIVERY_END_TSTMP AS OMS_DELIVERY_END_TSTMP,
  OMS_ORDER_DT_TSTMP AS OMS_ORDER_DT_TSTMP,
  OMS_ORDER_RECON_TSTMP AS OMS_ORDER_RECON_TSTMP,
  OMS_SCHED_PICKUP_TSTMP AS OMS_SCHED_PICKUP_TSTMP,
  OMS_SCHED_DELIVERY_TSTMP AS OMS_SCHED_DELIVERY_TSTMP,
  OMS_ACTUAL_SHIPPED_TSTMP AS OMS_ACTUAL_SHIPPED_TSTMP,
  TOTAL_NBR_OF_UNITS AS TOTAL_NBR_OF_UNITS,
  BASELINE_COST AS BASELINE_COST,
  ACTUAL_COST AS ACTUAL_COST,
  MONETARY_VALUE AS MONETARY_VALUE,
  MV_CURRENCY_CD AS MV_CURRENCY_CD,
  REF_NUM1 AS REF_NUM1,
  OMS_CREATED_SOURCE_TYPE_ID AS OMS_CREATED_SOURCE_TYPE_ID,
  OMS_CREATED_SOURCE AS OMS_CREATED_SOURCE,
  OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_ORDERS_NEW_8"""

df_9 = spark.sql(query_9)

df_9.createOrReplaceTempView("SQ_Shortcut_to_OMS_ORDERS_NEW_9")

# COMMAND ----------
# DBTITLE 1, JNR_FACILITY_O_10


query_10 = f"""SELECT
  DETAIL.OMS_ORDER_ID AS OMS_ORDER_ID,
  DETAIL.OMS_TC_COMPANY_ID AS OMS_TC_COMPANY_ID,
  DETAIL.OMS_TC_ORDER_ID AS OMS_TC_ORDER_ID,
  DETAIL.OMS_PURCHASE_ORDER_ID AS OMS_PURCHASE_ORDER_ID,
  DETAIL.OMS_PURCHASE_ORDER_NBR AS OMS_PURCHASE_ORDER_NBR,
  DETAIL.OMS_EXT_PURCHASE_ORDER AS OMS_EXT_PURCHASE_ORDER,
  DETAIL.OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  DETAIL.OMS_ORDER_STATUS_ID AS OMS_ORDER_STATUS_ID,
  DETAIL.OMS_DO_TYPE_ID AS OMS_DO_TYPE_ID,
  DETAIL.OMS_DO_STATUS_ID AS OMS_DO_STATUS_ID,
  DETAIL.OMS_SHIPMENT_ID AS OMS_SHIPMENT_ID,
  DETAIL.OMS_CREATION_TYPE_ID AS OMS_CREATION_TYPE_ID,
  DETAIL.OMS_BILLING_METHOD_ID AS OMS_BILLING_METHOD_ID,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.OMS_DELIVERY_OPTIONS_ID AS OMS_DELIVERY_OPTIONS_ID,
  DETAIL.CUSTOMER_PICKUP_FLAG AS CUSTOMER_PICKUP_FLAG,
  DETAIL.PARTIALLY_PLANNED_FLAG AS PARTIALLY_PLANNED_FLAG,
  DETAIL.PARTIAL_SHIP_CONFIRMATION_FLAG AS PARTIAL_SHIP_CONFIRMATION_FLAG,
  DETAIL.PARTIAL_SHIP_CONFIRMATION_STATUS AS PARTIAL_SHIP_CONFIRMATION_STATUS,
  DETAIL.HAS_ALERTS_FLAG AS HAS_ALERTS_FLAG,
  DETAIL.HAS_SPLIT_FLAG AS HAS_SPLIT_FLAG,
  DETAIL.CANCELLED_FLAG AS CANCELLED_FLAG,
  DETAIL.BACK_ORDERED_FLAG AS BACK_ORDERED_FLAG,
  DETAIL.OMS_INBOUND_REGION_ID AS OMS_INBOUND_REGION_ID,
  DETAIL.OMS_OUTBOUND_REGION_ID AS OMS_OUTBOUND_REGION_ID,
  DETAIL.OMS_O_FACILITY_ALIAS_ID AS OMS_O_FACILITY_ALIAS_ID,
  DETAIL.OMS_O_FACILITY_ID AS OMS_O_FACILITY_ID,
  DETAIL.OMS_D_FACILITY_ALIAS_ID AS OMS_D_FACILITY_ALIAS_ID,
  DETAIL.OMS_D_FACILITY_ID AS OMS_D_FACILITY_ID,
  DETAIL.OMS_BILL_FACILITY_ALIAS_ID AS OMS_BILL_FACILITY_ALIAS_ID,
  DETAIL.OMS_BILL_FACILITY_ID AS OMS_BILL_FACILITY_ID,
  DETAIL.OMS_CUSTOMER_ID AS OMS_CUSTOMER_ID,
  DETAIL.ADDR_VALID_FLAG AS ADDR_VALID_FLAG,
  DETAIL.OMS_PICKUP_START_TSTMP AS OMS_PICKUP_START_TSTMP,
  DETAIL.OMS_PICKUP_END_TSTMP AS OMS_PICKUP_END_TSTMP,
  DETAIL.OMS_PICKUP_TZ_ID AS OMS_PICKUP_TZ_ID,
  DETAIL.OMS_DELIVERY_TZ_ID AS OMS_DELIVERY_TZ_ID,
  DETAIL.OMS_DELIVERY_START_TSTMP AS OMS_DELIVERY_START_TSTMP,
  DETAIL.OMS_DELIVERY_END_TSTMP AS OMS_DELIVERY_END_TSTMP,
  DETAIL.OMS_ORDER_DT_TSTMP AS OMS_ORDER_DT_TSTMP,
  DETAIL.OMS_ORDER_RECON_TSTMP AS OMS_ORDER_RECON_TSTMP,
  DETAIL.OMS_SCHED_PICKUP_TSTMP AS OMS_SCHED_PICKUP_TSTMP,
  DETAIL.OMS_SCHED_DELIVERY_TSTMP AS OMS_SCHED_DELIVERY_TSTMP,
  DETAIL.OMS_ACTUAL_SHIPPED_TSTMP AS OMS_ACTUAL_SHIPPED_TSTMP,
  DETAIL.TOTAL_NBR_OF_UNITS AS TOTAL_NBR_OF_UNITS,
  DETAIL.BASELINE_COST AS BASELINE_COST,
  DETAIL.ACTUAL_COST AS ACTUAL_COST,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.MV_CURRENCY_CD AS MV_CURRENCY_CD,
  DETAIL.REF_NUM1 AS REF_NUM1,
  DETAIL.OMS_CREATED_SOURCE_TYPE_ID AS OMS_CREATED_SOURCE_TYPE_ID,
  DETAIL.OMS_CREATED_SOURCE AS OMS_CREATED_SOURCE,
  DETAIL.OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  DETAIL.OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  DETAIL.UPDATE_TSTMP AS o_UPDATE_TSTMP,
  MASTER.OMS_FACILITY_ID AS OMS_FACILITY_ID,
  MASTER.FACILITY_TYPE_BITS AS FACILITY_TYPE_BITS,
  MASTER.UPDATE_TSTMP AS f1_UPDATE_TSTMP,
  DETAIL.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_FACILITY_5 MASTER
  RIGHT JOIN SQ_Shortcut_to_OMS_ORDERS_NEW_9 DETAIL ON MASTER.OMS_FACILITY_ID = DETAIL.OMS_O_FACILITY_ID"""

df_10 = spark.sql(query_10)

df_10.createOrReplaceTempView("JNR_FACILITY_O_10")

# COMMAND ----------
# DBTITLE 1, JNR_FACILITY_D_11


query_11 = f"""SELECT
  DETAIL.OMS_ORDER_ID AS OMS_ORDER_ID,
  DETAIL.OMS_TC_COMPANY_ID AS OMS_TC_COMPANY_ID,
  DETAIL.OMS_TC_ORDER_ID AS OMS_TC_ORDER_ID,
  DETAIL.OMS_PURCHASE_ORDER_ID AS OMS_PURCHASE_ORDER_ID,
  DETAIL.OMS_PURCHASE_ORDER_NBR AS OMS_PURCHASE_ORDER_NBR,
  DETAIL.OMS_EXT_PURCHASE_ORDER AS OMS_EXT_PURCHASE_ORDER,
  DETAIL.OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  DETAIL.OMS_ORDER_STATUS_ID AS OMS_ORDER_STATUS_ID,
  DETAIL.OMS_DO_TYPE_ID AS OMS_DO_TYPE_ID,
  DETAIL.OMS_DO_STATUS_ID AS OMS_DO_STATUS_ID,
  DETAIL.OMS_SHIPMENT_ID AS OMS_SHIPMENT_ID,
  DETAIL.OMS_CREATION_TYPE_ID AS OMS_CREATION_TYPE_ID,
  DETAIL.OMS_BILLING_METHOD_ID AS OMS_BILLING_METHOD_ID,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.OMS_DELIVERY_OPTIONS_ID AS OMS_DELIVERY_OPTIONS_ID,
  DETAIL.CUSTOMER_PICKUP_FLAG AS CUSTOMER_PICKUP_FLAG,
  DETAIL.PARTIALLY_PLANNED_FLAG AS PARTIALLY_PLANNED_FLAG,
  DETAIL.PARTIAL_SHIP_CONFIRMATION_FLAG AS PARTIAL_SHIP_CONFIRMATION_FLAG,
  DETAIL.PARTIAL_SHIP_CONFIRMATION_STATUS AS PARTIAL_SHIP_CONFIRMATION_STATUS,
  DETAIL.HAS_ALERTS_FLAG AS HAS_ALERTS_FLAG,
  DETAIL.HAS_SPLIT_FLAG AS HAS_SPLIT_FLAG,
  DETAIL.CANCELLED_FLAG AS CANCELLED_FLAG,
  DETAIL.BACK_ORDERED_FLAG AS BACK_ORDERED_FLAG,
  DETAIL.OMS_INBOUND_REGION_ID AS OMS_INBOUND_REGION_ID,
  DETAIL.OMS_OUTBOUND_REGION_ID AS OMS_OUTBOUND_REGION_ID,
  DETAIL.OMS_O_FACILITY_ALIAS_ID AS OMS_O_FACILITY_ALIAS_ID,
  DETAIL.OMS_D_FACILITY_ALIAS_ID AS OMS_D_FACILITY_ALIAS_ID,
  DETAIL.OMS_D_FACILITY_ID AS OMS_D_FACILITY_ID,
  DETAIL.OMS_BILL_FACILITY_ALIAS_ID AS OMS_BILL_FACILITY_ALIAS_ID,
  DETAIL.OMS_BILL_FACILITY_ID AS OMS_BILL_FACILITY_ID,
  DETAIL.OMS_CUSTOMER_ID AS OMS_CUSTOMER_ID,
  DETAIL.ADDR_VALID_FLAG AS ADDR_VALID_FLAG,
  DETAIL.OMS_PICKUP_START_TSTMP AS OMS_PICKUP_START_TSTMP,
  DETAIL.OMS_PICKUP_END_TSTMP AS OMS_PICKUP_END_TSTMP,
  DETAIL.OMS_PICKUP_TZ_ID AS OMS_PICKUP_TZ_ID,
  DETAIL.OMS_DELIVERY_TZ_ID AS OMS_DELIVERY_TZ_ID,
  DETAIL.OMS_DELIVERY_START_TSTMP AS OMS_DELIVERY_START_TSTMP,
  DETAIL.OMS_DELIVERY_END_TSTMP AS OMS_DELIVERY_END_TSTMP,
  DETAIL.OMS_ORDER_DT_TSTMP AS OMS_ORDER_DT_TSTMP,
  DETAIL.OMS_ORDER_RECON_TSTMP AS OMS_ORDER_RECON_TSTMP,
  DETAIL.OMS_SCHED_PICKUP_TSTMP AS OMS_SCHED_PICKUP_TSTMP,
  DETAIL.OMS_SCHED_DELIVERY_TSTMP AS OMS_SCHED_DELIVERY_TSTMP,
  DETAIL.OMS_ACTUAL_SHIPPED_TSTMP AS OMS_ACTUAL_SHIPPED_TSTMP,
  DETAIL.TOTAL_NBR_OF_UNITS AS TOTAL_NBR_OF_UNITS,
  DETAIL.BASELINE_COST AS BASELINE_COST,
  DETAIL.ACTUAL_COST AS ACTUAL_COST,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.MV_CURRENCY_CD AS MV_CURRENCY_CD,
  DETAIL.REF_NUM1 AS REF_NUM1,
  DETAIL.OMS_CREATED_SOURCE_TYPE_ID AS OMS_CREATED_SOURCE_TYPE_ID,
  DETAIL.OMS_CREATED_SOURCE AS OMS_CREATED_SOURCE,
  DETAIL.OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  DETAIL.OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  DETAIL.FACILITY_TYPE_BITS AS f1_FACILITY_TYPE_BITS,
  DETAIL.o_UPDATE_TSTMP AS o_UPDATE_TSTMP,
  DETAIL.f1_UPDATE_TSTMP AS f1_UPDATE_TSTMP,
  MASTER.OMS_FACILITY_ID AS OMS_FACILITY_ID,
  MASTER.FACILITY_TYPE_BITS AS FACILITY_TYPE_BITS,
  MASTER.UPDATE_TSTMP AS f2_UPDATE_TSTMP,
  DETAIL.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_FACILITY1_3 MASTER
  RIGHT JOIN JNR_FACILITY_O_10 DETAIL ON MASTER.OMS_FACILITY_ID = DETAIL.OMS_D_FACILITY_ID"""

df_11 = spark.sql(query_11)

df_11.createOrReplaceTempView("JNR_FACILITY_D_11")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_PO_LINE_ITEM_REF_FIELDS_12


query_12 = f"""SELECT
  OMS_PURCHASE_ORDERS_LINE_ITEM_ID AS OMS_PURCHASE_ORDERS_LINE_ITEM_ID,
  OMS_PURCHASE_ORDERS_ID AS OMS_PURCHASE_ORDERS_ID,
  REF_FIELD1 AS REF_FIELD1,
  REF_FIELD2 AS REF_FIELD2,
  REF_FIELD3 AS REF_FIELD3,
  REF_FIELD4 AS REF_FIELD4,
  REF_FIELD5 AS REF_FIELD5,
  REF_FIELD6 AS REF_FIELD6,
  REF_FIELD7 AS REF_FIELD7,
  REF_FIELD8 AS REF_FIELD8,
  REF_FIELD9 AS REF_FIELD9,
  REF_FIELD10 AS REF_FIELD10,
  REF_NUM1 AS REF_NUM1,
  REF_NUM2 AS REF_NUM2,
  REF_NUM3 AS REF_NUM3,
  REF_NUM4 AS REF_NUM4,
  REF_NUM5 AS REF_NUM5,
  RX_STATUS AS RX_STATUS,
  RX_ASSIGNED_TO AS RX_ASSIGNED_TO,
  RX_ASSIGNED_TSTMP AS RX_ASSIGNED_TSTMP,
  RX_VET_INQUIRY AS RX_VET_INQUIRY,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_PO_LINE_ITEM_REF_FIELDS"""

df_12 = spark.sql(query_12)

df_12.createOrReplaceTempView("Shortcut_to_OMS_PO_LINE_ITEM_REF_FIELDS_12")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_PO_LINE_ITEM_REF_FIELDS_13


query_13 = f"""SELECT
  OMS_PURCHASE_ORDERS_LINE_ITEM_ID AS OMS_PURCHASE_ORDERS_LINE_ITEM_ID,
  OMS_PURCHASE_ORDERS_ID AS OMS_PURCHASE_ORDERS_ID,
  REF_FIELD1 AS REF_FIELD1,
  REF_FIELD3 AS REF_FIELD3,
  REF_FIELD4 AS REF_FIELD4,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_PO_LINE_ITEM_REF_FIELDS_12"""

df_13 = spark.sql(query_13)

df_13.createOrReplaceTempView("SQ_Shortcut_to_OMS_PO_LINE_ITEM_REF_FIELDS_13")

# COMMAND ----------
# DBTITLE 1, Exp_POLR_14


query_14 = f"""SELECT
  OMS_PURCHASE_ORDERS_LINE_ITEM_ID AS PURCHASE_ORDERS_ID,
  OMS_PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_LINE_ITEM_ID,
  IFF(
    ISNULL(REF_FIELD3)
    or UPPER(REF_FIELD3) = 'FALSE',
    0,
    1
  ) AS SUBSCRIPTION_ORDER_FLG,
  IFF(
    ISNULL(REF_FIELD1)
    or UPPER(REF_FIELD1) = 'FALSE',
    0,
    1
  ) AS SCHED_DELIVERY_FLG,
  IFF(NOT ISNULL(REF_FIELD4), 1, 0) AS RX_ORDER_FLG,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_PO_LINE_ITEM_REF_FIELDS_13"""

df_14 = spark.sql(query_14)

df_14.createOrReplaceTempView("Exp_POLR_14")

# COMMAND ----------
# DBTITLE 1, Srt_POLR_15


query_15 = f"""SELECT
  PURCHASE_ORDERS_LINE_ITEM_ID AS PURCHASE_ORDERS_ID,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  RX_ORDER_FLG AS RX_ORDER_FLG,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  Exp_POLR_14
ORDER BY
  PURCHASE_ORDERS_ID ASC"""

df_15 = spark.sql(query_15)

df_15.createOrReplaceTempView("Srt_POLR_15")

# COMMAND ----------
# DBTITLE 1, Agg_POLR_16


query_16 = f"""SELECT
  PURCHASE_ORDERS_ID AS polr_PURCHASE_ORDERS_ID,
  MAX(SUBSCRIPTION_ORDER_FLG) AS SUBSCRIPTION_ORDER_FLG,
  MAX(SCHED_DELIVERY_FLG) AS SCHED_DELIVERY_FLG,
  MAX(RX_ORDER_FLG) AS RX_ORDER_FLG1,
  last(Monotonically_Increasing_Id) AS Monotonically_Increasing_Id
FROM
  Srt_POLR_15
GROUP BY
  PURCHASE_ORDERS_ID"""

df_16 = spark.sql(query_16)

df_16.createOrReplaceTempView("Agg_POLR_16")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_ORDER_ATTRIBUTE_17


query_17 = f"""SELECT
  OMS_ORDER_ID AS OMS_ORDER_ID,
  ATTRIBUTE_NAME AS ATTRIBUTE_NAME,
  ATTRIBUTE_SEQ AS ATTRIBUTE_SEQ,
  ATTRIBUTE_VALUE AS ATTRIBUTE_VALUE,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_ORDER_ATTRIBUTE"""

df_17 = spark.sql(query_17)

df_17.createOrReplaceTempView("Shortcut_to_OMS_ORDER_ATTRIBUTE_17")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_ORDER_ATTRIBUTE_18


query_18 = f"""SELECT
  OMS_ORDER_ID AS OMS_ORDER_ID,
  ATTRIBUTE_NAME AS ATTRIBUTE_NAME,
  ATTRIBUTE_VALUE AS ATTRIBUTE_VALUE,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_ORDER_ATTRIBUTE_17
WHERE
  ATTRIBUTE_NAME IN (
    'Proxy_FirstName',
    'Proxy_LastName',
    'Proxy_Add_Line1',
    'Proxy_Add_Line2',
    'Proxy_Add_Line3',
    'Proxy_Add_City',
    'Proxy_Add_StateProv',
    'Proxy_Add_PostalCode',
    'Proxy_Add_Country',
    'Proxy_Email',
    'Proxy_Phone'
  )
  AND ATTRIBUTE_VALUE IS NOT NULL"""

df_18 = spark.sql(query_18)

df_18.createOrReplaceTempView("SQ_Shortcut_to_OMS_ORDER_ATTRIBUTE_18")

# COMMAND ----------
# DBTITLE 1, Exp_Proxy_Flags_19


query_19 = f"""SELECT
  OMS_ORDER_ID AS oa_ORDER_ID,
  IFF(
    ATTRIBUTE_NAME = 'Proxy_FirstName',
    ATTRIBUTE_VALUE,
    NULL
  ) AS ISPU_PXY_FIRST_NAME,
  IFF(
    ATTRIBUTE_NAME = 'Proxy_LastName',
    ATTRIBUTE_VALUE,
    NULL
  ) AS ISPU_PXY_LAST_NAME,
  IFF(
    ATTRIBUTE_NAME = 'Proxy_Add_Line1',
    ATTRIBUTE_VALUE,
    NULL
  ) AS ISPU_PXY_ADD_LINE1,
  IFF(
    ATTRIBUTE_NAME = 'Proxy_Add_Line2',
    ATTRIBUTE_VALUE,
    NULL
  ) AS ISPU_PXY_ADD_LINE2,
  IFF(
    ATTRIBUTE_NAME = 'Proxy_Add_Line3',
    ATTRIBUTE_VALUE,
    NULL
  ) AS ISPU_PXY_ADD_LINE3,
  IFF(ATTRIBUTE_NAME = 'Proxy_City', ATTRIBUTE_VALUE, NULL) AS ISPU_PXY_CITY,
  IFF(
    ATTRIBUTE_NAME = 'Proxy_State',
    ATTRIBUTE_VALUE,
    NULL
  ) AS ISPU_PXY_STATE,
  IFF(
    ATTRIBUTE_NAME = 'Proxy_PostalCd',
    ATTRIBUTE_VALUE,
    NULL
  ) AS ISPU_PXY_POSTAL_CD,
  IFF(
    ATTRIBUTE_NAME = 'Proxy_Country',
    ATTRIBUTE_VALUE,
    NULL
  ) AS ISPU_PXY_COUNTRY,
  IFF(
    ATTRIBUTE_NAME = 'Proxy_Email',
    ATTRIBUTE_VALUE,
    NULL
  ) AS ISPU_PXY_EMAIL,
  IFF(
    ATTRIBUTE_NAME = 'Proxy_Phone',
    ATTRIBUTE_VALUE,
    NULL
  ) AS ISPU_PXY_PHONE,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_ORDER_ATTRIBUTE_18"""

df_19 = spark.sql(query_19)

df_19.createOrReplaceTempView("Exp_Proxy_Flags_19")

# COMMAND ----------
# DBTITLE 1, Srt_OATT_20


query_20 = f"""SELECT
  oa_ORDER_ID AS oa_ORDER_ID,
  ISPU_PXY_FIRST_NAME AS ISPU_PXY_FIRST_NAME,
  ISPU_PXY_LAST_NAME AS ISPU_PXY_LAST_NAME,
  ISPU_PXY_ADD_LINE1 AS ISPU_PXY_ADD_LINE1,
  ISPU_PXY_ADD_LINE2 AS ISPU_PXY_ADD_LINE2,
  ISPU_PXY_ADD_LINE3 AS ISPU_PXY_ADD_LINE3,
  ISPU_PXY_CITY AS ISPU_PXY_CITY,
  ISPU_PXY_STATE AS ISPU_PXY_STATE,
  ISPU_PXY_POSTAL_CD AS ISPU_PXY_POSTAL_CD,
  ISPU_PXY_COUNTRY AS ISPU_PXY_COUNTRY,
  ISPU_PXY_EMAIL AS ISPU_PXY_EMAIL,
  ISPU_PXY_PHONE AS ISPU_PXY_PHONE,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  Exp_Proxy_Flags_19
ORDER BY
  oa_ORDER_ID ASC"""

df_20 = spark.sql(query_20)

df_20.createOrReplaceTempView("Srt_OATT_20")

# COMMAND ----------
# DBTITLE 1, Agg_OATT_21


query_21 = f"""SELECT
  oa_ORDER_ID AS oa_ORDER_ID,
  MAX(ISPU_PXY_FIRST_NAME) AS ISPU_PXY_FIRST_NAME,
  MAX(ISPU_PXY_LAST_NAME) AS ISPU_PXY_LAST_NAME,
  MAX(ISPU_PXY_ADD_LINE1) AS ISPU_PXY_ADD_LINE1,
  MAX(ISPU_PXY_ADD_LINE2) AS ISPU_PXY_ADD_LINE2,
  MAX(ISPU_PXY_ADD_LINE3) AS ISPU_PXY_ADD_LINE3,
  MAX(ISPU_PXY_CITY) AS ISPU_PXY_CITY,
  MAX(ISPU_PXY_STATE) AS ISPU_PXY_STATE,
  MAX(ISPU_PXY_POSTAL_CD) AS ISPU_PXY_POSTAL_CD,
  MAX(ISPU_PXY_COUNTRY) AS ISPU_PXY_COUNTRY,
  MAX(ISPU_PXY_EMAIL) AS ISPU_PXY_EMAIL,
  MAX(ISPU_PXY_PHONE) AS ISPU_PXY_PHONE,
  last(Monotonically_Increasing_Id) AS Monotonically_Increasing_Id
FROM
  Srt_OATT_20
GROUP BY
  oa_ORDER_ID"""

df_21 = spark.sql(query_21)

df_21.createOrReplaceTempView("Agg_OATT_21")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_ORDER_LINE_ITEM_22


query_22 = f"""SELECT
  OMS_ORDER_ID AS OMS_ORDER_ID,
  OMS_LINE_ITEM_ID AS OMS_LINE_ITEM_ID,
  OMS_TC_COMPANY_ID AS OMS_TC_COMPANY_ID,
  OMS_MASTER_ORDER_ID AS OMS_MASTER_ORDER_ID,
  OMS_MO_LINE_ITEM_ID AS OMS_MO_LINE_ITEM_ID,
  OMS_TC_ORDER_LINE_ID AS OMS_TC_ORDER_LINE_ID,
  OMS_PURCHASE_ORDER_NBR AS OMS_PURCHASE_ORDER_NBR,
  OMS_PURCHASE_ORDER_LINE_NBR AS OMS_PURCHASE_ORDER_LINE_NBR,
  OMS_ITEM_ID AS OMS_ITEM_ID,
  OMS_ITEM_NAME AS OMS_ITEM_NAME,
  OMS_PICKUP_START_TSTMP AS OMS_PICKUP_START_TSTMP,
  OMS_PICKUP_END_TSTMP AS OMS_PICKUP_END_TSTMP,
  OMS_DELIVERY_START_TSTMP AS OMS_DELIVERY_START_TSTMP,
  OMS_DELIVERY_END_TSTMP AS OMS_DELIVERY_END_TSTMP,
  OMS_ACTUAL_SHIPPED_TSTMP AS OMS_ACTUAL_SHIPPED_TSTMP,
  OMS_DO_DTL_STATUS_ID AS OMS_DO_DTL_STATUS_ID,
  CANCELLED_FLAG AS CANCELLED_FLAG,
  OMS_EVENT_CD AS OMS_EVENT_CD,
  OMS_REASON_CD AS OMS_REASON_CD,
  OMS_EXP_INFO_CD AS OMS_EXP_INFO_CD,
  PARTIAL_FILL_FLAG AS PARTIAL_FILL_FLAG,
  ORIG_ORDER_QTY AS ORIG_ORDER_QTY,
  ADJUSTED_ORDER_QTY AS ADJUSTED_ORDER_QTY,
  USER_CANCELED_QTY AS USER_CANCELED_QTY,
  ORDER_QTY AS ORDER_QTY,
  RECEIVED_QTY AS RECEIVED_QTY,
  ALLOCATED_QTY AS ALLOCATED_QTY,
  SHIPPED_QTY AS SHIPPED_QTY,
  RETAIL_PRICE_AMT AS RETAIL_PRICE_AMT,
  UNIT_PRICE_AMT AS UNIT_PRICE_AMT,
  UNIT_COST_AMT AS UNIT_COST_AMT,
  UNIT_TAX_AMT AS UNIT_TAX_AMT,
  UNIT_MONETARY_VALUE AS UNIT_MONETARY_VALUE,
  TOTAL_MONETARY_VALUE AS TOTAL_MONETARY_VALUE,
  FREIGHT_REVENUE_AMT AS FREIGHT_REVENUE_AMT,
  FREIGHT_REVENUE_CURRENCY_CD AS FREIGHT_REVENUE_CURRENCY_CD,
  OMS_CREATED_SOURCE AS OMS_CREATED_SOURCE,
  OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_ORDER_LINE_ITEM"""

df_22 = spark.sql(query_22)

df_22.createOrReplaceTempView("Shortcut_to_OMS_ORDER_LINE_ITEM_22")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_ORDER_LINE_ITEM_23


query_23 = f"""SELECT
  OMS_ORDER_ID AS OMS_ORDER_ID,
  OMS_MASTER_ORDER_ID AS OMS_MASTER_ORDER_ID,
  OMS_MO_LINE_ITEM_ID AS OMS_MO_LINE_ITEM_ID,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_ORDER_LINE_ITEM_22"""

df_23 = spark.sql(query_23)

df_23.createOrReplaceTempView("SQ_Shortcut_to_OMS_ORDER_LINE_ITEM_23")

# COMMAND ----------
# DBTITLE 1, JNR_ORDER_LINE_ITEM_24


query_24 = f"""SELECT
  DETAIL.OMS_ORDER_ID AS OMS_ORDER_ID,
  DETAIL.OMS_TC_COMPANY_ID AS OMS_TC_COMPANY_ID,
  DETAIL.OMS_TC_ORDER_ID AS OMS_TC_ORDER_ID,
  DETAIL.OMS_PURCHASE_ORDER_ID AS OMS_PURCHASE_ORDER_ID,
  DETAIL.OMS_PURCHASE_ORDER_NBR AS OMS_PURCHASE_ORDER_NBR,
  DETAIL.OMS_EXT_PURCHASE_ORDER AS OMS_EXT_PURCHASE_ORDER,
  DETAIL.OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  DETAIL.OMS_ORDER_STATUS_ID AS OMS_ORDER_STATUS_ID,
  DETAIL.OMS_DO_TYPE_ID AS OMS_DO_TYPE_ID,
  DETAIL.OMS_DO_STATUS_ID AS OMS_DO_STATUS_ID,
  DETAIL.OMS_SHIPMENT_ID AS OMS_SHIPMENT_ID,
  DETAIL.OMS_CREATION_TYPE_ID AS OMS_CREATION_TYPE_ID,
  DETAIL.OMS_BILLING_METHOD_ID AS OMS_BILLING_METHOD_ID,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.OMS_DELIVERY_OPTIONS_ID AS OMS_DELIVERY_OPTIONS_ID,
  DETAIL.CUSTOMER_PICKUP_FLAG AS CUSTOMER_PICKUP_FLAG,
  DETAIL.PARTIALLY_PLANNED_FLAG AS PARTIALLY_PLANNED_FLAG,
  DETAIL.PARTIAL_SHIP_CONFIRMATION_FLAG AS PARTIAL_SHIP_CONFIRMATION_FLAG,
  DETAIL.PARTIAL_SHIP_CONFIRMATION_STATUS AS PARTIAL_SHIP_CONFIRMATION_STATUS,
  DETAIL.HAS_ALERTS_FLAG AS HAS_ALERTS_FLAG,
  DETAIL.HAS_SPLIT_FLAG AS HAS_SPLIT_FLAG,
  DETAIL.CANCELLED_FLAG AS CANCELLED_FLAG,
  DETAIL.BACK_ORDERED_FLAG AS BACK_ORDERED_FLAG,
  DETAIL.OMS_INBOUND_REGION_ID AS OMS_INBOUND_REGION_ID,
  DETAIL.OMS_OUTBOUND_REGION_ID AS OMS_OUTBOUND_REGION_ID,
  DETAIL.OMS_O_FACILITY_ALIAS_ID AS OMS_O_FACILITY_ALIAS_ID,
  DETAIL.OMS_D_FACILITY_ALIAS_ID AS OMS_D_FACILITY_ALIAS_ID,
  DETAIL.OMS_BILL_FACILITY_ALIAS_ID AS OMS_BILL_FACILITY_ALIAS_ID,
  DETAIL.OMS_BILL_FACILITY_ID AS OMS_BILL_FACILITY_ID,
  DETAIL.OMS_CUSTOMER_ID AS OMS_CUSTOMER_ID,
  DETAIL.ADDR_VALID_FLAG AS ADDR_VALID_FLAG,
  DETAIL.OMS_PICKUP_START_TSTMP AS OMS_PICKUP_START_TSTMP,
  DETAIL.OMS_PICKUP_END_TSTMP AS OMS_PICKUP_END_TSTMP,
  DETAIL.OMS_PICKUP_TZ_ID AS OMS_PICKUP_TZ_ID,
  DETAIL.OMS_DELIVERY_TZ_ID AS OMS_DELIVERY_TZ_ID,
  DETAIL.OMS_DELIVERY_START_TSTMP AS OMS_DELIVERY_START_TSTMP,
  DETAIL.OMS_DELIVERY_END_TSTMP AS OMS_DELIVERY_END_TSTMP,
  DETAIL.OMS_ORDER_DT_TSTMP AS OMS_ORDER_DT_TSTMP,
  DETAIL.OMS_ORDER_RECON_TSTMP AS OMS_ORDER_RECON_TSTMP,
  DETAIL.OMS_SCHED_PICKUP_TSTMP AS OMS_SCHED_PICKUP_TSTMP,
  DETAIL.OMS_SCHED_DELIVERY_TSTMP AS OMS_SCHED_DELIVERY_TSTMP,
  DETAIL.OMS_ACTUAL_SHIPPED_TSTMP AS OMS_ACTUAL_SHIPPED_TSTMP,
  DETAIL.TOTAL_NBR_OF_UNITS AS TOTAL_NBR_OF_UNITS,
  DETAIL.BASELINE_COST AS BASELINE_COST,
  DETAIL.ACTUAL_COST AS ACTUAL_COST,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.MV_CURRENCY_CD AS MV_CURRENCY_CD,
  DETAIL.REF_NUM1 AS REF_NUM1,
  DETAIL.OMS_CREATED_SOURCE_TYPE_ID AS OMS_CREATED_SOURCE_TYPE_ID,
  DETAIL.OMS_CREATED_SOURCE AS OMS_CREATED_SOURCE,
  DETAIL.OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  DETAIL.OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  DETAIL.f1_FACILITY_TYPE_BITS AS f1_FACILITY_TYPE_BITS,
  DETAIL.FACILITY_TYPE_BITS AS f2_FACILITY_TYPE_BITS,
  DETAIL.o_UPDATE_TSTMP AS o_UPDATE_TSTMP,
  DETAIL.f1_UPDATE_TSTMP AS f1_UPDATE_TSTMP,
  DETAIL.f2_UPDATE_TSTMP AS f2_UPDATE_TSTMP,
  MASTER.OMS_ORDER_ID AS ol_OMS_ORDER_ID,
  MASTER.OMS_MASTER_ORDER_ID AS ol_OMS_MASTER_ORDER_ID,
  MASTER.OMS_MO_LINE_ITEM_ID AS ol_OMS_MO_LINE_ITEM_ID,
  MASTER.UPDATE_TSTMP AS ol_UPDATE_TSTMP,
  MASTER.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_ORDER_LINE_ITEM_23 MASTER
  INNER JOIN JNR_FACILITY_D_11 DETAIL ON MASTER.OMS_ORDER_ID = DETAIL.OMS_ORDER_ID"""

df_24 = spark.sql(query_24)

df_24.createOrReplaceTempView("JNR_ORDER_LINE_ITEM_24")

# COMMAND ----------
# DBTITLE 1, JNR_PO_LINE_ITEM_REF_FIELDS_25


query_25 = f"""SELECT
  DETAIL.OMS_ORDER_ID AS OMS_ORDER_ID,
  DETAIL.OMS_TC_COMPANY_ID AS OMS_TC_COMPANY_ID,
  DETAIL.OMS_TC_ORDER_ID AS OMS_TC_ORDER_ID,
  DETAIL.OMS_PURCHASE_ORDER_ID AS OMS_PURCHASE_ORDER_ID,
  DETAIL.OMS_PURCHASE_ORDER_NBR AS OMS_PURCHASE_ORDER_NBR,
  DETAIL.OMS_EXT_PURCHASE_ORDER AS OMS_EXT_PURCHASE_ORDER,
  DETAIL.OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  DETAIL.OMS_ORDER_STATUS_ID AS OMS_ORDER_STATUS_ID,
  DETAIL.OMS_DO_TYPE_ID AS OMS_DO_TYPE_ID,
  DETAIL.OMS_DO_STATUS_ID AS OMS_DO_STATUS_ID,
  DETAIL.OMS_SHIPMENT_ID AS OMS_SHIPMENT_ID,
  DETAIL.OMS_CREATION_TYPE_ID AS OMS_CREATION_TYPE_ID,
  DETAIL.OMS_BILLING_METHOD_ID AS OMS_BILLING_METHOD_ID,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.OMS_DELIVERY_OPTIONS_ID AS OMS_DELIVERY_OPTIONS_ID,
  DETAIL.CUSTOMER_PICKUP_FLAG AS CUSTOMER_PICKUP_FLAG,
  DETAIL.PARTIALLY_PLANNED_FLAG AS PARTIALLY_PLANNED_FLAG,
  DETAIL.PARTIAL_SHIP_CONFIRMATION_FLAG AS PARTIAL_SHIP_CONFIRMATION_FLAG,
  DETAIL.PARTIAL_SHIP_CONFIRMATION_STATUS AS PARTIAL_SHIP_CONFIRMATION_STATUS,
  DETAIL.HAS_ALERTS_FLAG AS HAS_ALERTS_FLAG,
  DETAIL.HAS_SPLIT_FLAG AS HAS_SPLIT_FLAG,
  DETAIL.CANCELLED_FLAG AS CANCELLED_FLAG,
  DETAIL.BACK_ORDERED_FLAG AS BACK_ORDERED_FLAG,
  DETAIL.OMS_INBOUND_REGION_ID AS OMS_INBOUND_REGION_ID,
  DETAIL.OMS_OUTBOUND_REGION_ID AS OMS_OUTBOUND_REGION_ID,
  DETAIL.OMS_O_FACILITY_ALIAS_ID AS OMS_O_FACILITY_ALIAS_ID,
  DETAIL.OMS_D_FACILITY_ALIAS_ID AS OMS_D_FACILITY_ALIAS_ID,
  DETAIL.OMS_BILL_FACILITY_ALIAS_ID AS OMS_BILL_FACILITY_ALIAS_ID,
  DETAIL.OMS_BILL_FACILITY_ID AS OMS_BILL_FACILITY_ID,
  DETAIL.OMS_CUSTOMER_ID AS OMS_CUSTOMER_ID,
  DETAIL.ADDR_VALID_FLAG AS ADDR_VALID_FLAG,
  DETAIL.OMS_PICKUP_START_TSTMP AS OMS_PICKUP_START_TSTMP,
  DETAIL.OMS_PICKUP_END_TSTMP AS OMS_PICKUP_END_TSTMP,
  DETAIL.OMS_PICKUP_TZ_ID AS OMS_PICKUP_TZ_ID,
  DETAIL.OMS_DELIVERY_TZ_ID AS OMS_DELIVERY_TZ_ID,
  DETAIL.OMS_DELIVERY_START_TSTMP AS OMS_DELIVERY_START_TSTMP,
  DETAIL.OMS_DELIVERY_END_TSTMP AS OMS_DELIVERY_END_TSTMP,
  DETAIL.OMS_ORDER_DT_TSTMP AS OMS_ORDER_DT_TSTMP,
  DETAIL.OMS_ORDER_RECON_TSTMP AS OMS_ORDER_RECON_TSTMP,
  DETAIL.OMS_SCHED_PICKUP_TSTMP AS OMS_SCHED_PICKUP_TSTMP,
  DETAIL.OMS_SCHED_DELIVERY_TSTMP AS OMS_SCHED_DELIVERY_TSTMP,
  DETAIL.OMS_ACTUAL_SHIPPED_TSTMP AS OMS_ACTUAL_SHIPPED_TSTMP,
  DETAIL.TOTAL_NBR_OF_UNITS AS TOTAL_NBR_OF_UNITS,
  DETAIL.BASELINE_COST AS BASELINE_COST,
  DETAIL.ACTUAL_COST AS ACTUAL_COST,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.MV_CURRENCY_CD AS MV_CURRENCY_CD,
  DETAIL.REF_NUM1 AS REF_NUM1,
  DETAIL.OMS_CREATED_SOURCE_TYPE_ID AS OMS_CREATED_SOURCE_TYPE_ID,
  DETAIL.OMS_CREATED_SOURCE AS OMS_CREATED_SOURCE,
  DETAIL.OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  DETAIL.OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  DETAIL.f1_FACILITY_TYPE_BITS AS f1_FACILITY_TYPE_BITS,
  DETAIL.f2_FACILITY_TYPE_BITS AS f2_FACILITY_TYPE_BITS,
  DETAIL.ol_OMS_ORDER_ID AS ol_OMS_ORDER_ID,
  DETAIL.ol_OMS_MASTER_ORDER_ID AS ol_OMS_MASTER_ORDER_ID,
  DETAIL.ol_OMS_MO_LINE_ITEM_ID AS ol_OMS_MO_LINE_ITEM_ID,
  MASTER.polr_PURCHASE_ORDERS_ID AS polr_PURCHASE_ORDERS_ID,
  MASTER.SUBSCRIPTION_ORDER_FLG AS polr_SUBSCRIPTION_ORDER_FLG,
  MASTER.SCHED_DELIVERY_FLG AS polr_SCHED_DELIVERY_FLG,
  MASTER.RX_ORDER_FLG1 AS polr_RX_ORDER_FLG1,
  DETAIL.o_UPDATE_TSTMP AS o_UPDATE_TSTMP,
  DETAIL.f1_UPDATE_TSTMP AS f1_UPDATE_TSTMP,
  DETAIL.f2_UPDATE_TSTMP AS f2_UPDATE_TSTMP,
  DETAIL.ol_UPDATE_TSTMP AS ol_UPDATE_TSTMP,
  MASTER.null AS polr_UPDATE_TSTMP,
  DETAIL.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  Agg_POLR_16 MASTER
  RIGHT JOIN JNR_ORDER_LINE_ITEM_24 DETAIL ON MASTER.polr_PURCHASE_ORDERS_ID = DETAIL.ol_OMS_MASTER_ORDER_ID"""

df_25 = spark.sql(query_25)

df_25.createOrReplaceTempView("JNR_PO_LINE_ITEM_REF_FIELDS_25")

# COMMAND ----------
# DBTITLE 1, JNR_MASTER_ORDER_26


query_26 = f"""SELECT
  DETAIL.OMS_ORDER_ID AS OMS_ORDER_ID,
  DETAIL.OMS_TC_COMPANY_ID AS OMS_TC_COMPANY_ID,
  DETAIL.OMS_TC_ORDER_ID AS OMS_TC_ORDER_ID,
  DETAIL.OMS_PURCHASE_ORDER_ID AS OMS_PURCHASE_ORDER_ID,
  DETAIL.OMS_PURCHASE_ORDER_NBR AS OMS_PURCHASE_ORDER_NBR,
  DETAIL.OMS_EXT_PURCHASE_ORDER AS OMS_EXT_PURCHASE_ORDER,
  DETAIL.OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  DETAIL.OMS_ORDER_STATUS_ID AS OMS_ORDER_STATUS_ID,
  DETAIL.OMS_DO_TYPE_ID AS OMS_DO_TYPE_ID,
  DETAIL.OMS_DO_STATUS_ID AS OMS_DO_STATUS_ID,
  DETAIL.OMS_SHIPMENT_ID AS OMS_SHIPMENT_ID,
  DETAIL.OMS_CREATION_TYPE_ID AS OMS_CREATION_TYPE_ID,
  DETAIL.OMS_BILLING_METHOD_ID AS OMS_BILLING_METHOD_ID,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.OMS_DELIVERY_OPTIONS_ID AS OMS_DELIVERY_OPTIONS_ID,
  DETAIL.CUSTOMER_PICKUP_FLAG AS CUSTOMER_PICKUP_FLAG,
  DETAIL.PARTIALLY_PLANNED_FLAG AS PARTIALLY_PLANNED_FLAG,
  DETAIL.PARTIAL_SHIP_CONFIRMATION_FLAG AS PARTIAL_SHIP_CONFIRMATION_FLAG,
  DETAIL.PARTIAL_SHIP_CONFIRMATION_STATUS AS PARTIAL_SHIP_CONFIRMATION_STATUS,
  DETAIL.HAS_ALERTS_FLAG AS HAS_ALERTS_FLAG,
  DETAIL.HAS_SPLIT_FLAG AS HAS_SPLIT_FLAG,
  DETAIL.CANCELLED_FLAG AS CANCELLED_FLAG,
  DETAIL.BACK_ORDERED_FLAG AS BACK_ORDERED_FLAG,
  DETAIL.OMS_INBOUND_REGION_ID AS OMS_INBOUND_REGION_ID,
  DETAIL.OMS_OUTBOUND_REGION_ID AS OMS_OUTBOUND_REGION_ID,
  DETAIL.OMS_O_FACILITY_ALIAS_ID AS OMS_O_FACILITY_ALIAS_ID,
  DETAIL.OMS_D_FACILITY_ALIAS_ID AS OMS_D_FACILITY_ALIAS_ID,
  DETAIL.OMS_BILL_FACILITY_ALIAS_ID AS OMS_BILL_FACILITY_ALIAS_ID,
  DETAIL.OMS_BILL_FACILITY_ID AS OMS_BILL_FACILITY_ID,
  DETAIL.OMS_CUSTOMER_ID AS OMS_CUSTOMER_ID,
  DETAIL.ADDR_VALID_FLAG AS ADDR_VALID_FLAG,
  DETAIL.OMS_PICKUP_START_TSTMP AS OMS_PICKUP_START_TSTMP,
  DETAIL.OMS_PICKUP_END_TSTMP AS OMS_PICKUP_END_TSTMP,
  DETAIL.OMS_PICKUP_TZ_ID AS OMS_PICKUP_TZ_ID,
  DETAIL.OMS_DELIVERY_TZ_ID AS OMS_DELIVERY_TZ_ID,
  DETAIL.OMS_DELIVERY_START_TSTMP AS OMS_DELIVERY_START_TSTMP,
  DETAIL.OMS_DELIVERY_END_TSTMP AS OMS_DELIVERY_END_TSTMP,
  DETAIL.OMS_ORDER_DT_TSTMP AS OMS_ORDER_DT_TSTMP,
  DETAIL.OMS_ORDER_RECON_TSTMP AS OMS_ORDER_RECON_TSTMP,
  DETAIL.OMS_SCHED_PICKUP_TSTMP AS OMS_SCHED_PICKUP_TSTMP,
  DETAIL.OMS_SCHED_DELIVERY_TSTMP AS OMS_SCHED_DELIVERY_TSTMP,
  DETAIL.OMS_ACTUAL_SHIPPED_TSTMP AS OMS_ACTUAL_SHIPPED_TSTMP,
  DETAIL.TOTAL_NBR_OF_UNITS AS TOTAL_NBR_OF_UNITS,
  DETAIL.BASELINE_COST AS BASELINE_COST,
  DETAIL.ACTUAL_COST AS ACTUAL_COST,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.MV_CURRENCY_CD AS MV_CURRENCY_CD,
  DETAIL.REF_NUM1 AS REF_NUM1,
  DETAIL.OMS_CREATED_SOURCE_TYPE_ID AS OMS_CREATED_SOURCE_TYPE_ID,
  DETAIL.OMS_CREATED_SOURCE AS OMS_CREATED_SOURCE,
  DETAIL.OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  DETAIL.OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  DETAIL.f1_FACILITY_TYPE_BITS AS f1_FACILITY_TYPE_BITS,
  DETAIL.f2_FACILITY_TYPE_BITS AS f2_FACILITY_TYPE_BITS,
  DETAIL.ol_OMS_ORDER_ID AS ol_OMS_ORDER_ID,
  DETAIL.ol_OMS_MASTER_ORDER_ID AS ol_OMS_MASTER_ORDER_ID,
  DETAIL.ol_OMS_MO_LINE_ITEM_ID AS ol_OMS_MO_LINE_ITEM_ID,
  DETAIL.polr_SUBSCRIPTION_ORDER_FLG AS polr_SUBSCRIPTION_ORDER_FLG,
  DETAIL.polr_SCHED_DELIVERY_FLG AS polr_SCHED_DELIVERY_FLG,
  DETAIL.polr_RX_ORDER_FLG1 AS polr_RX_ORDER_FLG1,
  MASTER.OMS_PURCHASE_ORDERS_ID AS mo_OMS_PURCHASE_ORDERS_ID,
  MASTER.OMS_PURCHASE_ORDERS_LINE_ITEM_ID AS mo_OMS_PURCHASE_ORDERS_LINE_ITEM_ID,
  MASTER.ORDER_NBR AS mo_ORDER_NBR,
  MASTER.OMS_TC_PURCHASE_ORDERS_ID AS mo_OMS_TC_PURCHASE_ORDERS_ID,
  MASTER.ORDER_FULFILLMENT_CHANNEL AS mo_ORDER_FULFILLMENT_CHANNEL,
  MASTER.ORDER_CREATION_CHANNEL AS mo_ORDER_CREATION_CHANNEL,
  MASTER.ORDER_CHANNEL AS mo_ORDER_CHANNEL,
  MASTER.PO_OMS_CREATED_TSTMP AS mo_PO_OMS_CREATED_TSTMP,
  DETAIL.o_UPDATE_TSTMP AS o_UPDATE_TSTMP,
  DETAIL.f1_UPDATE_TSTMP AS f1_UPDATE_TSTMP,
  DETAIL.f2_UPDATE_TSTMP AS f2_UPDATE_TSTMP,
  DETAIL.ol_UPDATE_TSTMP AS ol_UPDATE_TSTMP,
  DETAIL.polr_UPDATE_TSTMP AS polr_UPDATE_TSTMP,
  MASTER.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_EDW_LOAD_CTRL_PRE_7 MASTER
  INNER JOIN JNR_PO_LINE_ITEM_REF_FIELDS_25 DETAIL ON MASTER.OMS_PURCHASE_ORDERS_ID = DETAIL.ol_OMS_MASTER_ORDER_ID
  AND MASTER.OMS_PURCHASE_ORDERS_LINE_ITEM_ID = DETAIL.ol_OMS_MO_LINE_ITEM_ID"""

df_26 = spark.sql(query_26)

df_26.createOrReplaceTempView("JNR_MASTER_ORDER_26")

# COMMAND ----------
# DBTITLE 1, JNR_ORDER_ATTRIBUTE_27


query_27 = f"""SELECT
  DETAIL.OMS_ORDER_ID AS OMS_ORDER_ID,
  DETAIL.OMS_TC_COMPANY_ID AS OMS_TC_COMPANY_ID,
  DETAIL.OMS_TC_ORDER_ID AS OMS_TC_ORDER_ID,
  DETAIL.OMS_PURCHASE_ORDER_ID AS OMS_PURCHASE_ORDER_ID,
  DETAIL.OMS_PURCHASE_ORDER_NBR AS OMS_PURCHASE_ORDER_NBR,
  DETAIL.OMS_EXT_PURCHASE_ORDER AS OMS_EXT_PURCHASE_ORDER,
  DETAIL.OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  DETAIL.OMS_ORDER_STATUS_ID AS OMS_ORDER_STATUS_ID,
  DETAIL.OMS_DO_TYPE_ID AS OMS_DO_TYPE_ID,
  DETAIL.OMS_DO_STATUS_ID AS OMS_DO_STATUS_ID,
  DETAIL.OMS_SHIPMENT_ID AS OMS_SHIPMENT_ID,
  DETAIL.OMS_CREATION_TYPE_ID AS OMS_CREATION_TYPE_ID,
  DETAIL.OMS_BILLING_METHOD_ID AS OMS_BILLING_METHOD_ID,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.OMS_DELIVERY_OPTIONS_ID AS OMS_DELIVERY_OPTIONS_ID,
  DETAIL.CUSTOMER_PICKUP_FLAG AS CUSTOMER_PICKUP_FLAG,
  DETAIL.PARTIALLY_PLANNED_FLAG AS PARTIALLY_PLANNED_FLAG,
  DETAIL.PARTIAL_SHIP_CONFIRMATION_FLAG AS PARTIAL_SHIP_CONFIRMATION_FLAG,
  DETAIL.PARTIAL_SHIP_CONFIRMATION_STATUS AS PARTIAL_SHIP_CONFIRMATION_STATUS,
  DETAIL.HAS_ALERTS_FLAG AS HAS_ALERTS_FLAG,
  DETAIL.HAS_SPLIT_FLAG AS HAS_SPLIT_FLAG,
  DETAIL.CANCELLED_FLAG AS CANCELLED_FLAG,
  DETAIL.BACK_ORDERED_FLAG AS BACK_ORDERED_FLAG,
  DETAIL.OMS_INBOUND_REGION_ID AS OMS_INBOUND_REGION_ID,
  DETAIL.OMS_OUTBOUND_REGION_ID AS OMS_OUTBOUND_REGION_ID,
  DETAIL.OMS_O_FACILITY_ALIAS_ID AS OMS_O_FACILITY_ALIAS_ID,
  DETAIL.OMS_D_FACILITY_ALIAS_ID AS OMS_D_FACILITY_ALIAS_ID,
  DETAIL.OMS_BILL_FACILITY_ALIAS_ID AS OMS_BILL_FACILITY_ALIAS_ID,
  DETAIL.OMS_BILL_FACILITY_ID AS OMS_BILL_FACILITY_ID,
  DETAIL.OMS_CUSTOMER_ID AS OMS_CUSTOMER_ID,
  DETAIL.ADDR_VALID_FLAG AS ADDR_VALID_FLAG,
  DETAIL.OMS_PICKUP_START_TSTMP AS OMS_PICKUP_START_TSTMP,
  DETAIL.OMS_PICKUP_END_TSTMP AS OMS_PICKUP_END_TSTMP,
  DETAIL.OMS_PICKUP_TZ_ID AS OMS_PICKUP_TZ_ID,
  DETAIL.OMS_DELIVERY_TZ_ID AS OMS_DELIVERY_TZ_ID,
  DETAIL.OMS_DELIVERY_START_TSTMP AS OMS_DELIVERY_START_TSTMP,
  DETAIL.OMS_DELIVERY_END_TSTMP AS OMS_DELIVERY_END_TSTMP,
  DETAIL.OMS_ORDER_DT_TSTMP AS OMS_ORDER_DT_TSTMP,
  DETAIL.OMS_ORDER_RECON_TSTMP AS OMS_ORDER_RECON_TSTMP,
  DETAIL.OMS_SCHED_PICKUP_TSTMP AS OMS_SCHED_PICKUP_TSTMP,
  DETAIL.OMS_SCHED_DELIVERY_TSTMP AS OMS_SCHED_DELIVERY_TSTMP,
  DETAIL.OMS_ACTUAL_SHIPPED_TSTMP AS OMS_ACTUAL_SHIPPED_TSTMP,
  DETAIL.TOTAL_NBR_OF_UNITS AS TOTAL_NBR_OF_UNITS,
  DETAIL.BASELINE_COST AS BASELINE_COST,
  DETAIL.ACTUAL_COST AS ACTUAL_COST,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.MV_CURRENCY_CD AS MV_CURRENCY_CD,
  DETAIL.REF_NUM1 AS REF_NUM1,
  DETAIL.OMS_CREATED_SOURCE_TYPE_ID AS OMS_CREATED_SOURCE_TYPE_ID,
  DETAIL.OMS_CREATED_SOURCE AS OMS_CREATED_SOURCE,
  DETAIL.OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  DETAIL.OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  DETAIL.f1_FACILITY_TYPE_BITS AS f1_FACILITY_TYPE_BITS,
  DETAIL.f2_FACILITY_TYPE_BITS AS f2_FACILITY_TYPE_BITS,
  DETAIL.ol_OMS_ORDER_ID AS ol_OMS_ORDER_ID,
  DETAIL.ol_OMS_MASTER_ORDER_ID AS ol_OMS_MASTER_ORDER_ID,
  DETAIL.ol_OMS_MO_LINE_ITEM_ID AS ol_OMS_MO_LINE_ITEM_ID,
  DETAIL.polr_SUBSCRIPTION_ORDER_FLG AS polr_SUBSCRIPTION_ORDER_FLG,
  DETAIL.polr_SCHED_DELIVERY_FLG AS polr_SCHED_DELIVERY_FLG,
  DETAIL.polr_RX_ORDER_FLG1 AS polr_RX_ORDER_FLG1,
  DETAIL.mo_ORDER_NBR AS mo_ORDER_NBR,
  DETAIL.mo_OMS_TC_PURCHASE_ORDERS_ID AS mo_OMS_TC_PURCHASE_ORDERS_ID,
  DETAIL.mo_ORDER_FULFILLMENT_CHANNEL AS mo_ORDER_FULFILLMENT_CHANNEL,
  DETAIL.mo_ORDER_CREATION_CHANNEL AS mo_ORDER_CREATION_CHANNEL,
  DETAIL.mo_ORDER_CHANNEL AS mo_ORDER_CHANNEL,
  DETAIL.mo_PO_OMS_CREATED_TSTMP AS mo_PO_OMS_CREATED_TSTMP,
  MASTER.oa_ORDER_ID AS oa_ORDER_ID,
  MASTER.ISPU_PXY_FIRST_NAME AS oa_ISPU_PXY_FIRST_NAME,
  MASTER.ISPU_PXY_LAST_NAME AS oa_ISPU_PXY_LAST_NAME,
  MASTER.ISPU_PXY_ADD_LINE1 AS oa_ISPU_PXY_ADD_LINE1,
  MASTER.ISPU_PXY_ADD_LINE2 AS oa_ISPU_PXY_ADD_LINE2,
  MASTER.ISPU_PXY_ADD_LINE3 AS oa_ISPU_PXY_ADD_LINE3,
  MASTER.ISPU_PXY_CITY AS oa_ISPU_PXY_CITY,
  MASTER.ISPU_PXY_STATE AS oa_ISPU_PXY_STATE,
  MASTER.ISPU_PXY_POSTAL_CD AS oa_ISPU_PXY_POSTAL_CD,
  MASTER.ISPU_PXY_COUNTRY AS oa_ISPU_PXY_COUNTRY,
  MASTER.ISPU_PXY_EMAIL AS oa_ISPU_PXY_EMAIL,
  MASTER.ISPU_PXY_PHONE AS oa_ISPU_PXY_PHONE,
  MASTER.ISPU_PXY_POSTAL_CD AS oa_ISPU_PXY_POSTAL_CD1,
  MASTER.ISPU_PXY_COUNTRY AS oa_ISPU_PXY_COUNTRY1,
  MASTER.ISPU_PXY_EMAIL AS oa_ISPU_PXY_EMAIL1,
  MASTER.ISPU_PXY_PHONE AS oa_ISPU_PXY_PHONE1,
  DETAIL.o_UPDATE_TSTMP AS o_UPDATE_TSTMP,
  DETAIL.f1_UPDATE_TSTMP AS f1_UPDATE_TSTMP,
  DETAIL.f2_UPDATE_TSTMP AS f2_UPDATE_TSTMP,
  DETAIL.ol_UPDATE_TSTMP AS ol_UPDATE_TSTMP,
  DETAIL.polr_UPDATE_TSTMP AS polr_UPDATE_TSTMP,
  MASTER.null AS oa_UPDATE_TSTMP,
  DETAIL.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  Agg_OATT_21 MASTER
  RIGHT JOIN JNR_MASTER_ORDER_26 DETAIL ON MASTER.oa_ORDER_ID = DETAIL.OMS_ORDER_ID"""

df_27 = spark.sql(query_27)

df_27.createOrReplaceTempView("JNR_ORDER_ATTRIBUTE_27")

# COMMAND ----------
# DBTITLE 1, Exp_Fields_28


query_28 = f"""SELECT
  OMS_ORDER_ID AS ORDER_ID,
  OMS_TC_ORDER_ID AS TC_ORDER_ID,
  OMS_CREATION_TYPE_ID AS CREATION_TYPE,
  OMS_O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  OMS_D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  OMS_BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  OMS_PICKUP_TZ_ID AS PICKUP_TZ,
  OMS_DELIVERY_TZ_ID AS DELIVERY_TZ,
  OMS_PICKUP_START_TSTMP AS PICKUP_START_DTTM,
  OMS_PICKUP_END_TSTMP AS PICKUP_END_DTTM,
  OMS_DELIVERY_START_TSTMP AS DELIVERY_START_DTTM,
  OMS_DELIVERY_END_TSTMP AS DELIVERY_END_DTTM,
  OMS_ORDER_DT_TSTMP AS ORDER_DATE_DTTM,
  OMS_ORDER_RECON_TSTMP AS ORDER_RECON_DTTM,
  OMS_INBOUND_REGION_ID AS INBOUND_REGION_ID,
  OMS_OUTBOUND_REGION_ID AS OUTBOUND_REGION_ID,
  HAS_ALERTS_FLAG AS HAS_ALERTS,
  HAS_SPLIT_FLAG AS HAS_SPLIT,
  CANCELLED_FLAG AS IS_CANCELLED,
  PARTIALLY_PLANNED_FLAG AS IS_PARTIALLY_PLANNED,
  PARTIAL_SHIP_CONFIRMATION_FLAG AS PARTIAL_SHIP_CONFIRMATION_FLAG,
  PARTIAL_SHIP_CONFIRMATION_STATUS AS PARTIAL_SHIP_CONFIRMATION_STATUS,
  ACTUAL_COST AS ACTUAL_COST,
  BASELINE_COST AS BASELINE_COST,
  OMS_BILLING_METHOD_ID AS BILLING_METHOD,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  MV_CURRENCY_CD AS MV_CURRENCY_CODE,
  MONETARY_VALUE AS MONETARY_VALUE,
  OMS_CREATED_SOURCE_TYPE_ID AS CREATED_SOURCE_TYPE,
  OMS_CREATED_SOURCE AS CREATED_SOURCE,
  OMS_CREATED_TSTMP AS CREATED_DTTM,
  OMS_LAST_UPDATED_TSTMP AS LAST_UPDATED_DTTM,
  OMS_SHIPMENT_ID AS SHIPMENT_ID,
  OMS_ORDER_STATUS_ID AS ORDER_STATUS,
  OMS_DO_STATUS_ID AS DO_STATUS,
  OMS_DO_TYPE_ID AS DO_TYPE,
  OMS_ACTUAL_SHIPPED_TSTMP AS ACTUAL_SHIPPED_DTTM,
  OMS_SCHED_PICKUP_TSTMP AS SCHED_PICKUP_DTTM,
  OMS_SCHED_DELIVERY_TSTMP AS SCHED_DELIVERY_DTTM,
  OMS_PURCHASE_ORDER_ID AS PURCHASE_ORDER_ID,
  OMS_ORDER_TYPE AS ORDER_TYPE,
  REF_NUM1 AS REF_NUM1,
  mo_ORDER_NBR AS ORDER_NBR,
  mo_OMS_TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  mo_ORDER_FULFILLMENT_CHANNEL AS ORDER_FULFILLMENT_CHANNEL,
  mo_ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  mo_ORDER_CHANNEL AS ORDER_CHANNEL,
  mo_PO_OMS_CREATED_TSTMP AS OMS_ORDER_CREATED_TSTMP,
  polr_SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  polr_SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  oa_ISPU_PXY_FIRST_NAME AS ISPU_PXY_FIRST_NAME,
  oa_ISPU_PXY_LAST_NAME AS ISPU_PXY_LAST_NAME,
  oa_ISPU_PXY_ADD_LINE1 AS ISPU_PXY_ADD_LINE1,
  oa_ISPU_PXY_ADD_LINE2 AS ISPU_PXY_ADD_LINE2,
  oa_ISPU_PXY_ADD_LINE3 AS ISPU_PXY_ADD_LINE3,
  oa_ISPU_PXY_CITY AS ISPU_PXY_CITY,
  oa_ISPU_PXY_STATE AS ISPU_PXY_STATE,
  oa_ISPU_PXY_POSTAL_CD AS ISPU_PXY_POSTAL_CD,
  oa_ISPU_PXY_COUNTRY AS ISPU_PXY_COUNTRY,
  oa_ISPU_PXY_EMAIL AS ISPU_PXY_EMAIL,
  oa_ISPU_PXY_PHONE AS ISUP_PXY_PHONE,
  IFF (OMS_DO_STATUS_ID = 200, OMS_LAST_UPDATED_TSTMP, NULL) AS CANCELED_DT,
  OMS_TC_COMPANY_ID AS TC_COMPANY_ID,
  f1_FACILITY_TYPE_BITS AS O_FACILITY_TYPE_BITS,
  f2_FACILITY_TYPE_BITS AS D_FACILITY_TYPE_BITS,
  polr_RX_ORDER_FLG1 AS RX_ORDER_FLG1,
  o_UPDATE_TSTMP AS o_UPDATE_TSTMP,
  f1_UPDATE_TSTMP AS f1_UPDATE_TSTMP,
  f2_UPDATE_TSTMP AS f2_UPDATE_TSTMP,
  ol_UPDATE_TSTMP AS ol_UPDATE_TSTMP,
  polr_UPDATE_TSTMP AS polr_UPDATE_TSTMP,
  oa_UPDATE_TSTMP AS oa_UPDATE_TSTMP,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  JNR_ORDER_ATTRIBUTE_27"""

df_28 = spark.sql(query_28)

df_28.createOrReplaceTempView("Exp_Fields_28")

# COMMAND ----------
# DBTITLE 1, FIL_UPDATE_TSTMP_29


query_29 = f"""SELECT
  ORDER_ID AS ORDER_ID,
  TC_ORDER_ID AS TC_ORDER_ID,
  CREATION_TYPE AS CREATION_TYPE,
  O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  PICKUP_TZ AS PICKUP_TZ,
  DELIVERY_TZ AS DELIVERY_TZ,
  PICKUP_START_DTTM AS PICKUP_START_DTTM,
  PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  ORDER_DATE_DTTM AS ORDER_DATE_DTTM,
  ORDER_RECON_DTTM AS ORDER_RECON_DTTM,
  INBOUND_REGION_ID AS INBOUND_REGION_ID,
  OUTBOUND_REGION_ID AS OUTBOUND_REGION_ID,
  HAS_ALERTS AS HAS_ALERTS,
  HAS_SPLIT AS HAS_SPLIT,
  IS_CANCELLED AS IS_CANCELLED,
  IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  PARTIAL_SHIP_CONFIRMATION_FLAG AS PARTIAL_SHIP_CONFIRMATION_FLAG,
  PARTIAL_SHIP_CONFIRMATION_STATUS AS PARTIAL_SHIP_CONFIRMATION_STATUS,
  ACTUAL_COST AS ACTUAL_COST,
  BASELINE_COST AS BASELINE_COST,
  BILLING_METHOD AS BILLING_METHOD,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  MONETARY_VALUE AS MONETARY_VALUE,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_DTTM AS CREATED_DTTM,
  LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  SHIPMENT_ID AS SHIPMENT_ID,
  ORDER_STATUS AS ORDER_STATUS,
  DO_STATUS AS DO_STATUS,
  DO_TYPE AS DO_TYPE,
  ACTUAL_SHIPPED_DTTM AS ACTUAL_SHIPPED_DTTM,
  SCHED_PICKUP_DTTM AS SCHED_PICKUP_DTTM,
  SCHED_DELIVERY_DTTM AS SCHED_DELIVERY_DTTM,
  PURCHASE_ORDER_ID AS PURCHASE_ORDER_ID,
  ORDER_TYPE AS ORDER_TYPE,
  REF_NUM1 AS REF_NUM1,
  ORDER_NBR AS ORDER_NBR,
  TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  ORDER_FULFILLMENT_CHANNEL AS ORDER_FULFILLMENT_CHANNEL,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  ORDER_CHANNEL AS ORDER_CHANNEL,
  OMS_ORDER_CREATED_TSTMP AS OMS_ORDER_CREATED_TSTMP,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  ISPU_PXY_FIRST_NAME AS ISPU_PXY_FIRST_NAME,
  ISPU_PXY_LAST_NAME AS ISPU_PXY_LAST_NAME,
  ISPU_PXY_ADD_LINE1 AS ISPU_PXY_ADD_LINE1,
  ISPU_PXY_ADD_LINE2 AS ISPU_PXY_ADD_LINE2,
  ISPU_PXY_ADD_LINE3 AS ISPU_PXY_ADD_LINE3,
  ISPU_PXY_CITY AS ISPU_PXY_CITY,
  ISPU_PXY_STATE AS ISPU_PXY_STATE,
  ISPU_PXY_POSTAL_CD AS ISPU_PXY_POSTAL_CD,
  ISPU_PXY_COUNTRY AS ISPU_PXY_COUNTRY,
  ISPU_PXY_EMAIL AS ISPU_PXY_EMAIL,
  ISUP_PXY_PHONE AS ISUP_PXY_PHONE,
  CANCELED_DT AS CANCELED_DT,
  TC_COMPANY_ID AS TC_COMPANY_ID,
  O_FACILITY_TYPE_BITS AS O_FACILITY_TYPE_BITS,
  D_FACILITY_TYPE_BITS AS D_FACILITY_TYPE_BITS,
  RX_ORDER_FLG1 AS RX_ORDER_FLG1,
  o_UPDATE_TSTMP AS o_UPDATE_TSTMP,
  f1_UPDATE_TSTMP AS f1_UPDATE_TSTMP,
  f2_UPDATE_TSTMP AS f2_UPDATE_TSTMP,
  ol_UPDATE_TSTMP AS ol_UPDATE_TSTMP,
  polr_UPDATE_TSTMP AS polr_UPDATE_TSTMP,
  oa_UPDATE_TSTMP AS oa_UPDATE_TSTMP,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  Exp_Fields_28
WHERE
  o_UPDATE_TSTMP > TRUNC(now())"""

df_29 = spark.sql(query_29)

df_29.createOrReplaceTempView("FIL_UPDATE_TSTMP_29")

# COMMAND ----------
# DBTITLE 1, Srt_OMS_Dist_Order_Pre_30


query_30 = f"""SELECT
  ORDER_ID AS ORDER_ID,
  TC_ORDER_ID AS TC_ORDER_ID,
  CREATION_TYPE AS CREATION_TYPE,
  O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  PICKUP_TZ AS PICKUP_TZ,
  DELIVERY_TZ AS DELIVERY_TZ,
  PICKUP_START_DTTM AS PICKUP_START_DTTM,
  PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  ORDER_DATE_DTTM AS ORDER_DATE_DTTM,
  ORDER_RECON_DTTM AS ORDER_RECON_DTTM,
  INBOUND_REGION_ID AS INBOUND_REGION_ID,
  OUTBOUND_REGION_ID AS OUTBOUND_REGION_ID,
  HAS_ALERTS AS HAS_ALERTS,
  HAS_SPLIT AS HAS_SPLIT,
  IS_CANCELLED AS IS_CANCELLED,
  IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  PARTIAL_SHIP_CONFIRMATION_FLAG AS PARTIAL_SHIP_CONFIRMATION_FLAG,
  PARTIAL_SHIP_CONFIRMATION_STATUS AS PARTIAL_SHIP_CONFIRMATION_STATUS,
  ACTUAL_COST AS ACTUAL_COST,
  BASELINE_COST AS BASELINE_COST,
  BILLING_METHOD AS BILLING_METHOD,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  MONETARY_VALUE AS MONETARY_VALUE,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_DTTM AS CREATED_DTTM,
  LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  SHIPMENT_ID AS SHIPMENT_ID,
  ORDER_STATUS AS ORDER_STATUS,
  DO_STATUS AS DO_STATUS,
  DO_TYPE AS DO_TYPE,
  ACTUAL_SHIPPED_DTTM AS ACTUAL_SHIPPED_DTTM,
  SCHED_PICKUP_DTTM AS SCHED_PICKUP_DTTM,
  SCHED_DELIVERY_DTTM AS SCHED_DELIVERY_DTTM,
  PURCHASE_ORDER_ID AS PURCHASE_ORDER_ID,
  ORDER_TYPE AS ORDER_TYPE,
  REF_NUM1 AS REF_NUM1,
  ORDER_NBR AS ORDER_NBR,
  TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  ORDER_FULFILLMENT_CHANNEL AS ORDER_FULFILLMENT_CHANNEL,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  ORDER_CHANNEL AS ORDER_CHANNEL,
  OMS_ORDER_CREATED_TSTMP AS OMS_ORDER_CREATED_TSTMP,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  ISPU_PXY_FIRST_NAME AS ISPU_PXY_FIRST_NAME,
  ISPU_PXY_LAST_NAME AS ISPU_PXY_LAST_NAME,
  ISPU_PXY_ADD_LINE1 AS ISPU_PXY_ADD_LINE1,
  ISPU_PXY_ADD_LINE2 AS ISPU_PXY_ADD_LINE2,
  ISPU_PXY_ADD_LINE3 AS ISPU_PXY_ADD_LINE3,
  ISPU_PXY_CITY AS ISPU_PXY_CITY,
  ISPU_PXY_STATE AS ISPU_PXY_STATE,
  ISPU_PXY_POSTAL_CD AS ISPU_PXY_POSTAL_CD,
  ISPU_PXY_COUNTRY AS ISPU_PXY_COUNTRY,
  ISPU_PXY_EMAIL AS ISPU_PXY_EMAIL,
  ISUP_PXY_PHONE AS ISUP_PXY_PHONE,
  CANCELED_DT AS CANCELED_DT,
  TC_COMPANY_ID AS TC_COMPANY_ID,
  O_FACILITY_TYPE_BITS AS O_FACILITY_TYPE_BITS,
  D_FACILITY_TYPE_BITS AS D_FACILITY_TYPE_BITS,
  RX_ORDER_FLG1 AS RX_ORDER_FLG1,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  FIL_UPDATE_TSTMP_29
ORDER BY
  ORDER_ID ASC,
  TC_ORDER_ID ASC,
  CREATION_TYPE ASC,
  O_FACILITY_ALIAS_ID ASC,
  D_FACILITY_ALIAS_ID ASC,
  BILL_FACILITY_ALIAS_ID ASC,
  PICKUP_TZ ASC,
  DELIVERY_TZ ASC,
  PICKUP_START_DTTM ASC,
  PICKUP_END_DTTM ASC,
  DELIVERY_START_DTTM ASC,
  DELIVERY_END_DTTM ASC,
  ORDER_DATE_DTTM ASC,
  ORDER_RECON_DTTM ASC,
  INBOUND_REGION_ID ASC,
  OUTBOUND_REGION_ID ASC,
  HAS_ALERTS ASC,
  HAS_SPLIT ASC,
  IS_CANCELLED ASC,
  IS_PARTIALLY_PLANNED ASC,
  PARTIAL_SHIP_CONFIRMATION_FLAG ASC,
  PARTIAL_SHIP_CONFIRMATION_STATUS ASC,
  ACTUAL_COST ASC,
  BASELINE_COST ASC,
  BILLING_METHOD ASC,
  DROPOFF_PICKUP ASC,
  MV_CURRENCY_CODE ASC,
  MONETARY_VALUE ASC,
  CREATED_SOURCE_TYPE ASC,
  CREATED_SOURCE ASC,
  CREATED_DTTM ASC,
  LAST_UPDATED_DTTM ASC,
  SHIPMENT_ID ASC,
  ORDER_STATUS ASC,
  DO_STATUS ASC,
  DO_TYPE ASC,
  ACTUAL_SHIPPED_DTTM ASC,
  SCHED_PICKUP_DTTM ASC,
  SCHED_DELIVERY_DTTM ASC,
  PURCHASE_ORDER_ID ASC,
  ORDER_TYPE ASC,
  REF_NUM1 ASC,
  ORDER_NBR ASC,
  TC_PURCHASE_ORDERS_ID ASC,
  ORDER_FULFILLMENT_CHANNEL ASC,
  ORDER_CREATION_CHANNEL ASC,
  ORDER_CHANNEL ASC,
  OMS_ORDER_CREATED_TSTMP ASC,
  SCHED_DELIVERY_FLG ASC,
  SUBSCRIPTION_ORDER_FLG ASC,
  ISPU_PXY_FIRST_NAME ASC,
  ISPU_PXY_LAST_NAME ASC,
  ISPU_PXY_ADD_LINE1 ASC,
  ISPU_PXY_ADD_LINE2 ASC,
  ISPU_PXY_ADD_LINE3 ASC,
  ISPU_PXY_CITY ASC,
  ISPU_PXY_STATE ASC,
  ISPU_PXY_POSTAL_CD ASC,
  ISPU_PXY_COUNTRY ASC,
  ISPU_PXY_EMAIL ASC,
  ISUP_PXY_PHONE ASC,
  CANCELED_DT ASC,
  TC_COMPANY_ID ASC,
  O_FACILITY_TYPE_BITS ASC,
  D_FACILITY_TYPE_BITS ASC,
  RX_ORDER_FLG1 ASC"""

df_30 = spark.sql(query_30)

df_30.createOrReplaceTempView("Srt_OMS_Dist_Order_Pre_30")

# COMMAND ----------
# DBTITLE 1, EXP_FLAGS_31


query_31 = f"""SELECT
  ORDER_ID AS src_ORDER_ID,
  TC_ORDER_ID AS src_TC_ORDER_ID,
  CREATION_TYPE AS src_CREATION_TYPE,
  O_FACILITY_ALIAS_ID AS src_O_FACILITY_ALIAS_ID,
  D_FACILITY_ALIAS_ID AS src_D_FACILITY_ALIAS_ID,
  BILL_FACILITY_ALIAS_ID AS src_BILL_FACILITY_ALIAS_ID,
  PICKUP_TZ AS src_PICKUP_TZ,
  DELIVERY_TZ AS src_DELIVERY_TZ,
  PICKUP_START_DTTM AS src_PICKUP_START_DTTM,
  PICKUP_END_DTTM AS src_PICKUP_END_DTTM,
  DELIVERY_START_DTTM AS src_DELIVERY_START_DTTM,
  DELIVERY_END_DTTM AS src_DELIVERY_END_DTTM,
  ORDER_DATE_DTTM AS src_ORDER_DATE_DTTM,
  ORDER_RECON_DTTM AS src_ORDER_RECON_DTTM,
  INBOUND_REGION_ID AS src_INBOUND_REGION_ID,
  OUTBOUND_REGION_ID AS src_OUTBOUND_REGION_ID,
  HAS_ALERTS AS src_HAS_ALERTS,
  HAS_SPLIT AS src_HAS_SPLIT,
  IS_CANCELLED AS src_IS_CANCELLED,
  IS_PARTIALLY_PLANNED AS src_IS_PARTIALLY_PLANNED,
  PARTIAL_SHIP_CONFIRMATION_FLAG AS src_PARTIAL_SHIP_CONFIRMATION_FLAG,
  PARTIAL_SHIP_CONFIRMATION_STATUS AS src_PARTIAL_SHIP_CONFIRMATION_STATUS,
  ACTUAL_COST AS src_ACTUAL_COST,
  BASELINE_COST AS src_BASELINE_COST,
  BILLING_METHOD AS src_BILLING_METHOD,
  DROPOFF_PICKUP AS src_DROPOFF_PICKUP,
  MV_CURRENCY_CODE AS src_MV_CURRENCY_CODE,
  MONETARY_VALUE AS src_MONETARY_VALUE,
  CREATED_SOURCE_TYPE AS src_CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS src_CREATED_SOURCE,
  CREATED_DTTM AS src_OMS_DO_CREATED_TSTMP,
  LAST_UPDATED_DTTM AS src_LAST_UPDATED_DTTM,
  SHIPMENT_ID AS src_SHIPMENT_ID,
  ORDER_STATUS AS src_ORDER_STATUS,
  DO_STATUS AS src_DO_STATUS,
  DO_TYPE AS src_DO_TYPE,
  ACTUAL_SHIPPED_DTTM AS src_ACTUAL_SHIPPED_DTTM,
  SCHED_PICKUP_DTTM AS src_SCHED_PICKUP_DTTM,
  SCHED_DELIVERY_DTTM AS src_SCHED_DELIVERY_DTTM,
  PURCHASE_ORDER_ID AS src_PURCHASE_ORDER_ID,
  ORDER_TYPE AS src_ORDER_TYPE,
  IFF(ISNULL(src_REF_NUM1), 0, src_REF_NUM1) AS v_REF_NUM1,
  IFF(ISNULL(REF_NUM1), 0, REF_NUM1) AS REF_NUM1,
  ISPU_PXY_FIRST_NAME AS src_ISPU_PXY_FIRST_NAME,
  ISPU_PXY_LAST_NAME AS src_ISPU_PXY_LAST_NAME,
  ISPU_PXY_ADD_LINE1 AS src_ISPU_PXY_ADD_LINE1,
  ISPU_PXY_ADD_LINE2 AS src_ISPU_PXY_ADD_LINE2,
  ISPU_PXY_ADD_LINE3 AS src_ISPU_PXY_ADD_LINE3,
  ISPU_PXY_CITY AS src_ISPU_PXY_CITY,
  ISPU_PXY_STATE AS src_ISPU_PXY_STATE,
  ISPU_PXY_POSTAL_CD AS src_ISPU_PXY_POSTAL_CD,
  ISPU_PXY_COUNTRY AS src_ISPU_PXY_COUNTRY,
  ISPU_PXY_EMAIL AS src_ISPU_PXY_EMAIL,
  ISUP_PXY_PHONE AS src_ISUP_PXY_PHONE,
  TC_PURCHASE_ORDERS_ID AS src_TC_PURCHASE_ORDERS_ID,
  ORDER_NBR AS src_ORDER_NBR,
  OMS_ORDER_CREATED_TSTMP AS src_OMS_ORDER_CREATED_TSTMP,
  ORDER_CREATION_CHANNEL AS src_ORDER_CREATION_CHANNEL,
  ORDER_FULFILLMENT_CHANNEL AS src_ORDER_FULFILLMENT_CHANNEL,
  ORDER_CHANNEL AS src_ORDER_CHANNEL,
  SCHED_DELIVERY_FLG AS src_SCHED_DELIVERY_FLG,
  IFF(
    ISNULL(SCHED_DELIVERY_FLG)
    OR SCHED_DELIVERY_FLG = 0,
    0,
    1
  ) AS o_SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS src_SUBSCRIPTION_ORDER_FLG,
  IFF(
    ISNULL(SUBSCRIPTION_ORDER_FLG)
    OR SUBSCRIPTION_ORDER_FLG = 0,
    0,
    1
  ) AS o_SUBSCRIPTION_ORDER_FLG,
  CANCELED_DT AS src_CANCELED_DT,
  TC_COMPANY_ID AS src_TC_COMPANY_ID,
  RX_ORDER_FLG1 AS src_RX_ORDER_FLG,
  IFF(
    ISNULL(RX_ORDER_FLG1)
    OR RX_ORDER_FLG1 = 0,
    0,
    1
  ) AS o_RX_ORDER_FLG,
  IFF(
    TC_COMPANY_ID = 8840,
    1,
    LKP_CURRENCY_DAY(TRUNC(OMS_ORDER_CREATED_TSTMP))
  ) AS EXCHANGE_RATE_PCNT,
  IFF(
    O_FACILITY_ALIAS_ID = '2956',
    LKP_SITE_PROFILE(O_FACILITY_ALIAS_ID, 6),
    IFF(
      NOT ISNULL(O_FACILITY_ALIAS_ID),
      LKP_SITE_PROFILE(
        IFF(
          O_FACILITY_TYPE_BITS = 9,
          LTRIM(O_FACILITY_ALIAS_ID, '0'),
          O_FACILITY_ALIAS_ID
        ),
        DECODE(O_FACILITY_TYPE_BITS, 64, 8, 545, 6, 33, 6, 9, 19, 8)
      ),
      NULL
    )
  ) AS ORIG_LOCATION_ID,
  IFF(
    NOT ISNULL(D_FACILITY_ALIAS_ID),
    LKP_SITE_PROFILE(
      IFF(
        D_FACILITY_TYPE_BITS = 9,
        LTRIM(D_FACILITY_ALIAS_ID, '0'),
        D_FACILITY_ALIAS_ID
      ),
      DECODE(D_FACILITY_TYPE_BITS, 64, 8, 545, 6, 33, 6, 9, 19, 8)
    ),
    NULL
  ) AS DEST_LOCATION_ID,
  IFF(
    NOT ISNULL(BILL_FACILITY_ALIAS_ID),
    LKP_SITE_PROFILE(BILL_FACILITY_ALIAS_ID, 8),
    NULL
  ) AS BILL_LOCATION_ID,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  Srt_OMS_Dist_Order_Pre_30"""

df_31 = spark.sql(query_31)

df_31.createOrReplaceTempView("EXP_FLAGS_31")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_DIST_ORDER_32


query_32 = f"""SELECT
  OMS_DIST_ORDER_ID AS OMS_DIST_ORDER_ID,
  OMS_DIST_ORDER_NBR AS OMS_DIST_ORDER_NBR,
  CREATION_TYPE_ID AS CREATION_TYPE_ID,
  ORIG_LOCATION_NBR AS ORIG_LOCATION_NBR,
  ORIG_LOCATION_ID AS ORIG_LOCATION_ID,
  DEST_LOCATION_NBR AS DEST_LOCATION_NBR,
  DEST_LOCATION_ID AS DEST_LOCATION_ID,
  BILL_LOCATION_NBR AS BILL_LOCATION_NBR,
  BILL_LOCATION_ID AS BILL_LOCATION_ID,
  PICKUP_TZ AS PICKUP_TZ,
  DELIVERY_TZ AS DELIVERY_TZ,
  PICKUP_START_DT AS PICKUP_START_DT,
  PICKUP_END_DT AS PICKUP_END_DT,
  DELIVERY_START_DT AS DELIVERY_START_DT,
  DELIVERY_END_DT AS DELIVERY_END_DT,
  ORDER_DATE_DT AS ORDER_DATE_DT,
  ORDER_RECON_DT AS ORDER_RECON_DT,
  INBOUND_REGION_ID AS INBOUND_REGION_ID,
  OUTBOUND_REGION_ID AS OUTBOUND_REGION_ID,
  ALERTS_FLG AS ALERTS_FLG,
  SPLIT_FLG AS SPLIT_FLG,
  CANCELED_FLG AS CANCELED_FLG,
  PARTIALLY_PLANNED_FLG AS PARTIALLY_PLANNED_FLG,
  ACTUAL_COST_AMT AS ACTUAL_COST_AMT,
  BASELINE_COST_AMT AS BASELINE_COST_AMT,
  BILLING_METHOD AS BILLING_METHOD,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  MV_CURRENCY_CD AS MV_CURRENCY_CD,
  MONETARY_VALUE_AMT AS MONETARY_VALUE_AMT,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  OMS_DO_CREATED_TSTMP AS OMS_DO_CREATED_TSTMP,
  LAST_UPDATED_TSTMP AS LAST_UPDATED_TSTMP,
  SHIPMENT_ID AS SHIPMENT_ID,
  OMS_DIST_ORDER_TRANS_STATUS_ID AS OMS_DIST_ORDER_TRANS_STATUS_ID,
  OMS_DIST_ORDER_STATUS_ID AS OMS_DIST_ORDER_STATUS_ID,
  OMS_DIST_ORDER_TYPE_ID AS OMS_DIST_ORDER_TYPE_ID,
  ACTUAL_SHIPPED_DT AS ACTUAL_SHIPPED_DT,
  SCHED_PICKUP_DT AS SCHED_PICKUP_DT,
  SCHED_DELIVERY_DT AS SCHED_DELIVERY_DT,
  OMS_ORDER_ID AS OMS_ORDER_ID,
  PRTL_SHIP_CONF_FLG AS PRTL_SHIP_CONF_FLG,
  PRTL_SHIP_CONF_STATUS_ID AS PRTL_SHIP_CONF_STATUS_ID,
  OMS_DO_TYPE_ID AS OMS_DO_TYPE_ID,
  COMPLETED_ORDER_FLG AS COMPLETED_ORDER_FLG,
  ISPU_PXY_FIRST_NAME AS ISPU_PXY_FIRST_NAME,
  ISPU_PXY_LAST_NAME AS ISPU_PXY_LAST_NAME,
  ISPU_PXY_ADD_LINE1 AS ISPU_PXY_ADD_LINE1,
  ISPU_PXY_ADD_LINE2 AS ISPU_PXY_ADD_LINE2,
  ISPU_PXY_ADD_LINE3 AS ISPU_PXY_ADD_LINE3,
  ISPU_PXY_CITY AS ISPU_PXY_CITY,
  ISPU_PXY_STATE AS ISPU_PXY_STATE,
  ISPU_PXY_POSTAL_CD AS ISPU_PXY_POSTAL_CD,
  ISPU_PXY_COUNTRY AS ISPU_PXY_COUNTRY,
  ISPU_PXY_EMAIL AS ISPU_PXY_EMAIL,
  ISUP_PXY_PHONE AS ISUP_PXY_PHONE,
  OMS_ORDER_NBR AS OMS_ORDER_NBR,
  ORDER_NBR AS ORDER_NBR,
  OMS_ORDER_CREATED_TSTMP AS OMS_ORDER_CREATED_TSTMP,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  ORDER_FULFILLMENT_CHANNEL AS ORDER_FULFILLMENT_CHANNEL,
  ORDER_CHANNEL AS ORDER_CHANNEL,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  CANCELED_DT AS CANCELED_DT,
  OMS_COMPANY_ID AS OMS_COMPANY_ID,
  EXCHANGE_RATE_PCNT AS EXCHANGE_RATE_PCNT,
  RX_ORDER_FLG AS RX_ORDER_FLG,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_DIST_ORDER"""

df_32 = spark.sql(query_32)

df_32.createOrReplaceTempView("Shortcut_to_OMS_DIST_ORDER_32")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_DIST_ORDER_33


query_33 = f"""SELECT
  OMS_DIST_ORDER_ID AS OMS_DIST_ORDER_ID,
  OMS_DIST_ORDER_NBR AS OMS_DIST_ORDER_NBR,
  CREATION_TYPE_ID AS CREATION_TYPE_ID,
  ORIG_LOCATION_NBR AS ORIG_LOCATION_NBR,
  ORIG_LOCATION_ID AS ORIG_LOCATION_ID,
  DEST_LOCATION_NBR AS DEST_LOCATION_NBR,
  DEST_LOCATION_ID AS DEST_LOCATION_ID,
  BILL_LOCATION_NBR AS BILL_LOCATION_NBR,
  BILL_LOCATION_ID AS BILL_LOCATION_ID,
  PICKUP_TZ AS PICKUP_TZ,
  DELIVERY_TZ AS DELIVERY_TZ,
  PICKUP_START_DT AS PICKUP_START_DT,
  PICKUP_END_DT AS PICKUP_END_DT,
  DELIVERY_START_DT AS DELIVERY_START_DT,
  DELIVERY_END_DT AS DELIVERY_END_DT,
  ORDER_DATE_DT AS ORDER_DATE_DT,
  ORDER_RECON_DT AS ORDER_RECON_DT,
  INBOUND_REGION_ID AS INBOUND_REGION_ID,
  OUTBOUND_REGION_ID AS OUTBOUND_REGION_ID,
  ALERTS_FLG AS ALERTS_FLG,
  SPLIT_FLG AS SPLIT_FLG,
  CANCELED_FLG AS CANCELED_FLG,
  PARTIALLY_PLANNED_FLG AS PARTIALLY_PLANNED_FLG,
  ACTUAL_COST_AMT AS ACTUAL_COST_AMT,
  BASELINE_COST_AMT AS BASELINE_COST_AMT,
  BILLING_METHOD AS BILLING_METHOD,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  MV_CURRENCY_CD AS MV_CURRENCY_CD,
  MONETARY_VALUE_AMT AS MONETARY_VALUE_AMT,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  OMS_DO_CREATED_TSTMP AS OMS_DO_CREATED_TSTMP,
  LAST_UPDATED_TSTMP AS LAST_UPDATED_TSTMP,
  SHIPMENT_ID AS SHIPMENT_ID,
  OMS_DIST_ORDER_TRANS_STATUS_ID AS OMS_DIST_ORDER_TRANS_STATUS_ID,
  OMS_DIST_ORDER_STATUS_ID AS OMS_DIST_ORDER_STATUS_ID,
  OMS_DIST_ORDER_TYPE_ID AS OMS_DIST_ORDER_TYPE_ID,
  ACTUAL_SHIPPED_DT AS ACTUAL_SHIPPED_DT,
  SCHED_PICKUP_DT AS SCHED_PICKUP_DT,
  SCHED_DELIVERY_DT AS SCHED_DELIVERY_DT,
  OMS_ORDER_ID AS OMS_ORDER_ID,
  PRTL_SHIP_CONF_FLG AS PRTL_SHIP_CONF_FLG,
  PRTL_SHIP_CONF_STATUS_ID AS PRTL_SHIP_CONF_STATUS_ID,
  OMS_DO_TYPE_ID AS OMS_DO_TYPE_ID,
  COMPLETED_ORDER_FLG AS COMPLETED_ORDER_FLG,
  ISPU_PXY_FIRST_NAME AS ISPU_PXY_FIRST_NAME,
  ISPU_PXY_LAST_NAME AS ISPU_PXY_LAST_NAME,
  ISPU_PXY_ADD_LINE1 AS ISPU_PXY_ADD_LINE1,
  ISPU_PXY_ADD_LINE2 AS ISPU_PXY_ADD_LINE2,
  ISPU_PXY_ADD_LINE3 AS ISPU_PXY_ADD_LINE3,
  ISPU_PXY_CITY AS ISPU_PXY_CITY,
  ISPU_PXY_STATE AS ISPU_PXY_STATE,
  ISPU_PXY_POSTAL_CD AS ISPU_PXY_POSTAL_CD,
  ISPU_PXY_COUNTRY AS ISPU_PXY_COUNTRY,
  ISPU_PXY_EMAIL AS ISPU_PXY_EMAIL,
  ISUP_PXY_PHONE AS ISUP_PXY_PHONE,
  OMS_ORDER_NBR AS OMS_ORDER_NBR,
  ORDER_NBR AS ORDER_NBR,
  OMS_ORDER_CREATED_TSTMP AS OMS_ORDER_CREATED_TSTMP,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  ORDER_FULFILLMENT_CHANNEL AS ORDER_FULFILLMENT_CHANNEL,
  ORDER_CHANNEL AS ORDER_CHANNEL,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  CANCELED_DT AS CANCELED_DT,
  OMS_COMPANY_ID AS OMS_COMPANY_ID,
  EXCHANGE_RATE_PCNT AS EXCHANGE_RATE_PCNT,
  RX_ORDER_FLG AS RX_ORDER_FLG,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_DIST_ORDER_32"""

df_33 = spark.sql(query_33)

df_33.createOrReplaceTempView("SQ_Shortcut_to_OMS_DIST_ORDER_33")

# COMMAND ----------
# DBTITLE 1, JNR_OMS_DIST_ORDER_34


query_34 = f"""SELECT
  DETAIL.src_ORDER_ID AS src_ORDER_ID,
  DETAIL.src_TC_ORDER_ID AS src_TC_ORDER_ID,
  DETAIL.src_CREATION_TYPE AS src_CREATION_TYPE,
  DETAIL.src_O_FACILITY_ALIAS_ID AS src_O_FACILITY_ALIAS_ID,
  DETAIL.src_D_FACILITY_ALIAS_ID AS src_D_FACILITY_ALIAS_ID,
  DETAIL.src_BILL_FACILITY_ALIAS_ID AS src_BILL_FACILITY_ALIAS_ID,
  DETAIL.src_PICKUP_TZ AS src_PICKUP_TZ,
  DETAIL.src_DELIVERY_TZ AS src_DELIVERY_TZ,
  DETAIL.src_PICKUP_START_DTTM AS src_PICKUP_START_DTTM,
  DETAIL.src_PICKUP_END_DTTM AS src_PICKUP_END_DTTM,
  DETAIL.src_DELIVERY_START_DTTM AS src_DELIVERY_START_DTTM,
  DETAIL.src_DELIVERY_END_DTTM AS src_DELIVERY_END_DTTM,
  DETAIL.src_ORDER_DATE_DTTM AS src_ORDER_DATE_DTTM,
  DETAIL.src_ORDER_RECON_DTTM AS src_ORDER_RECON_DTTM,
  DETAIL.src_INBOUND_REGION_ID AS src_INBOUND_REGION_ID,
  DETAIL.src_OUTBOUND_REGION_ID AS src_OUTBOUND_REGION_ID,
  DETAIL.src_HAS_ALERTS AS src_HAS_ALERTS,
  DETAIL.src_HAS_SPLIT AS src_HAS_SPLIT,
  DETAIL.src_IS_CANCELLED AS src_IS_CANCELLED,
  DETAIL.src_IS_PARTIALLY_PLANNED AS src_IS_PARTIALLY_PLANNED,
  DETAIL.src_PARTIAL_SHIP_CONFIRMATION_FLAG AS src_PARTIAL_SHIP_CONFIRMATION_FLAG,
  DETAIL.src_PARTIAL_SHIP_CONFIRMATION_STATUS AS src_PARTIAL_SHIP_CONFIRMATION_STATUS,
  DETAIL.src_ACTUAL_COST AS src_ACTUAL_COST,
  DETAIL.src_BASELINE_COST AS src_BASELINE_COST,
  DETAIL.src_BILLING_METHOD AS src_BILLING_METHOD,
  DETAIL.src_DROPOFF_PICKUP AS src_DROPOFF_PICKUP,
  DETAIL.src_MV_CURRENCY_CODE AS src_MV_CURRENCY_CODE,
  DETAIL.src_MONETARY_VALUE AS src_MONETARY_VALUE,
  DETAIL.src_CREATED_SOURCE_TYPE AS src_CREATED_SOURCE_TYPE,
  DETAIL.src_CREATED_SOURCE AS src_CREATED_SOURCE,
  DETAIL.src_OMS_DO_CREATED_TSTMP AS src_OMS_DO_CREATED_TSTMP,
  DETAIL.src_LAST_UPDATED_DTTM AS src_LAST_UPDATED_DTTM,
  DETAIL.src_SHIPMENT_ID AS src_SHIPMENT_ID,
  DETAIL.src_ORDER_STATUS AS src_ORDER_STATUS,
  DETAIL.src_DO_STATUS AS src_DO_STATUS,
  DETAIL.src_DO_TYPE AS src_DO_TYPE,
  DETAIL.src_ACTUAL_SHIPPED_DTTM AS src_ACTUAL_SHIPPED_DTTM,
  DETAIL.src_SCHED_PICKUP_DTTM AS src_SCHED_PICKUP_DTTM,
  DETAIL.src_SCHED_DELIVERY_DTTM AS src_SCHED_DELIVERY_DTTM,
  DETAIL.src_PURCHASE_ORDER_ID AS src_PURCHASE_ORDER_ID,
  DETAIL.src_ORDER_TYPE AS src_ORDER_TYPE,
  DETAIL.REF_NUM1 AS src_REF_NUM1,
  DETAIL.src_ISPU_PXY_FIRST_NAME AS src_ISPU_PXY_FIRST_NAME,
  DETAIL.src_ISPU_PXY_LAST_NAME AS src_ISPU_PXY_LAST_NAME,
  DETAIL.src_ISPU_PXY_ADD_LINE1 AS src_ISPU_PXY_ADD_LINE1,
  DETAIL.src_ISPU_PXY_ADD_LINE2 AS src_ISPU_PXY_ADD_LINE2,
  DETAIL.src_ISPU_PXY_ADD_LINE3 AS src_ISPU_PXY_ADD_LINE3,
  DETAIL.src_ISPU_PXY_CITY AS src_ISPU_PXY_CITY,
  DETAIL.src_ISPU_PXY_STATE AS src_ISPU_PXY_STATE,
  DETAIL.src_ISPU_PXY_POSTAL_CD AS src_ISPU_PXY_POSTAL_CD,
  DETAIL.src_ISPU_PXY_COUNTRY AS src_ISPU_PXY_COUNTRY,
  DETAIL.src_ISPU_PXY_EMAIL AS src_ISPU_PXY_EMAIL,
  DETAIL.src_ISUP_PXY_PHONE AS src_ISUP_PXY_PHONE,
  DETAIL.src_TC_PURCHASE_ORDERS_ID AS src_TC_PURCHASE_ORDERS_ID,
  DETAIL.src_ORDER_NBR AS src_ORDER_NBR,
  DETAIL.src_OMS_ORDER_CREATED_TSTMP AS src_OMS_ORDER_CREATED_TSTMP,
  DETAIL.src_ORDER_CREATION_CHANNEL AS src_ORDER_CREATION_CHANNEL,
  DETAIL.src_ORDER_FULFILLMENT_CHANNEL AS src_ORDER_FULFILLMENT_CHANNEL,
  DETAIL.src_ORDER_CHANNEL AS src_ORDER_CHANNEL,
  DETAIL.o_SCHED_DELIVERY_FLG AS src_SCHED_DELIVERY_FLG,
  DETAIL.o_SUBSCRIPTION_ORDER_FLG AS src_SUBSCRIPTION_ORDER_FLG,
  DETAIL.src_CANCELED_DT AS src_CANCELED_DT,
  DETAIL.src_TC_COMPANY_ID AS src_TC_COMPANY_ID,
  DETAIL.o_RX_ORDER_FLG AS src_RX_ORDER_FLG,
  DETAIL.EXCHANGE_RATE_PCNT AS src_EXCHANGE_RATE_PCNT,
  DETAIL.ORIG_LOCATION_ID AS src_ORIG_LOCATION_ID,
  DETAIL.DEST_LOCATION_ID AS src_DEST_LOCATION_ID,
  DETAIL.BILL_LOCATION_ID AS src_BILL_LOCATION_ID,
  MASTER.OMS_DIST_ORDER_ID AS lkp_OMS_DIST_ORDER_ID,
  MASTER.OMS_DIST_ORDER_NBR AS lkp_OMS_DIST_ORDER_NBR,
  MASTER.CREATION_TYPE_ID AS lkp_CREATION_TYPE_ID,
  MASTER.ORIG_LOCATION_NBR AS lkp_ORIG_LOCATION_NBR,
  MASTER.ORIG_LOCATION_ID AS lkp_ORIG_LOCATION_ID1,
  MASTER.DEST_LOCATION_NBR AS lkp_DEST_LOCATION_NBR,
  MASTER.DEST_LOCATION_ID AS lkp_DEST_LOCATION_ID1,
  MASTER.BILL_LOCATION_NBR AS lkp_BILL_LOCATION_NBR,
  MASTER.BILL_LOCATION_ID AS lkp_BILL_LOCATION_ID1,
  MASTER.PICKUP_TZ AS lkp_PICKUP_TZ,
  MASTER.DELIVERY_TZ AS lkp_DELIVERY_TZ,
  MASTER.PICKUP_START_DT AS lkp_PICKUP_START_DT,
  MASTER.PICKUP_END_DT AS lkp_PICKUP_END_DT,
  MASTER.DELIVERY_START_DT AS lkp_DELIVERY_START_DT,
  MASTER.DELIVERY_END_DT AS lkp_DELIVERY_END_DT,
  MASTER.ORDER_DATE_DT AS lkp_ORDER_DATE_DT,
  MASTER.ORDER_RECON_DT AS lkp_ORDER_RECON_DT,
  MASTER.INBOUND_REGION_ID AS lkp_INBOUND_REGION_ID,
  MASTER.OUTBOUND_REGION_ID AS lkp_OUTBOUND_REGION_ID,
  MASTER.ALERTS_FLG AS lkp_ALERTS_FLG,
  MASTER.SPLIT_FLG AS lkp_SPLIT_FLG,
  MASTER.CANCELED_FLG AS lkp_CANCELED_FLG,
  MASTER.PARTIALLY_PLANNED_FLG AS lkp_PARTIALLY_PLANNED_FLG,
  MASTER.ACTUAL_COST_AMT AS lkp_ACTUAL_COST_AMT,
  MASTER.BASELINE_COST_AMT AS lkp_BASELINE_COST_AMT,
  MASTER.BILLING_METHOD AS lkp_BILLING_METHOD,
  MASTER.DROPOFF_PICKUP AS lkp_DROPOFF_PICKUP,
  MASTER.MV_CURRENCY_CD AS lkp_MV_CURRENCY_CD,
  MASTER.MONETARY_VALUE_AMT AS lkp_MONETARY_VALUE_AMT,
  MASTER.CREATED_SOURCE_TYPE AS lkp_CREATED_SOURCE_TYPE,
  MASTER.CREATED_SOURCE AS lkp_CREATED_SOURCE,
  MASTER.OMS_DO_CREATED_TSTMP AS lkp_OMS_DO_CREATED_TSTMP,
  MASTER.LAST_UPDATED_TSTMP AS lkp_LAST_UPDATED_TSTMP,
  MASTER.SHIPMENT_ID AS lkp_SHIPMENT_ID,
  MASTER.OMS_DIST_ORDER_TRANS_STATUS_ID AS lkp_OMS_DIST_ORDER_TRANS_STATUS_ID,
  MASTER.OMS_DIST_ORDER_STATUS_ID AS lkp_OMS_DIST_ORDER_STATUS_ID,
  MASTER.OMS_DIST_ORDER_TYPE_ID AS lkp_OMS_DIST_ORDER_TYPE_ID,
  MASTER.ACTUAL_SHIPPED_DT AS lkp_ACTUAL_SHIPPED_DT,
  MASTER.SCHED_PICKUP_DT AS lkp_SCHED_PICKUP_DT,
  MASTER.SCHED_DELIVERY_DT AS lkp_SCHED_DELIVERY_DT,
  MASTER.OMS_ORDER_ID AS lkp_OMS_ORDER_ID,
  MASTER.PRTL_SHIP_CONF_FLG AS lkp_PRTL_SHIP_CONF_FLG,
  MASTER.PRTL_SHIP_CONF_STATUS_ID AS lkp_PRTL_SHIP_CONF_STATUS_ID,
  MASTER.OMS_DO_TYPE_ID AS lkp_OMS_DO_TYPE_ID,
  MASTER.COMPLETED_ORDER_FLG AS lkp_COMPLETED_ORDER_FLG,
  MASTER.ISPU_PXY_FIRST_NAME AS lkp_ISPU_PXY_FIRST_NAME,
  MASTER.ISPU_PXY_LAST_NAME AS lkp_ISPU_PXY_LAST_NAME,
  MASTER.ISPU_PXY_ADD_LINE1 AS lkp_ISPU_PXY_ADD_LINE1,
  MASTER.ISPU_PXY_ADD_LINE2 AS lkp_ISPU_PXY_ADD_LINE2,
  MASTER.ISPU_PXY_ADD_LINE3 AS lkp_ISPU_PXY_ADD_LINE3,
  MASTER.ISPU_PXY_CITY AS lkp_ISPU_PXY_CITY,
  MASTER.ISPU_PXY_STATE AS lkp_ISPU_PXY_STATE,
  MASTER.ISPU_PXY_POSTAL_CD AS lkp_ISPU_PXY_POSTAL_CD,
  MASTER.ISPU_PXY_COUNTRY AS lkp_ISPU_PXY_COUNTRY,
  MASTER.ISPU_PXY_EMAIL AS lkp_ISPU_PXY_EMAIL,
  MASTER.ISUP_PXY_PHONE AS lkp_ISUP_PXY_PHONE,
  MASTER.OMS_ORDER_NBR AS lkp_OMS_ORDER_NBR,
  MASTER.ORDER_NBR AS lkp_ORDER_NBR,
  MASTER.OMS_ORDER_CREATED_TSTMP AS lkp_OMS_ORDER_CREATED_TSTMP,
  MASTER.ORDER_CREATION_CHANNEL AS lkp_ORDER_CREATION_CHANNEL,
  MASTER.ORDER_FULFILLMENT_CHANNEL AS lkp_ORDER_FULFILLMENT_CHANNEL,
  MASTER.ORDER_CHANNEL AS lkp_ORDER_CHANNEL,
  MASTER.SCHED_DELIVERY_FLG AS lkp_SCHED_DELIVERY_FLG,
  MASTER.SUBSCRIPTION_ORDER_FLG AS lkp_SUBSCRIPTION_ORDER_FLG,
  MASTER.CANCELED_DT AS lkp_CANCELED_DT,
  MASTER.OMS_COMPANY_ID AS lkp_OMS_COMPANY_ID,
  MASTER.EXCHANGE_RATE_PCNT AS lkp_EXCHANGE_RATE_PCNT1,
  MASTER.RX_ORDER_FLG AS lkp_RX_ORDER_FLG,
  MASTER.LOAD_TSTMP AS lkp_LOAD_TSTMP,
  DETAIL.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_DIST_ORDER_33 MASTER
  RIGHT JOIN EXP_FLAGS_31 DETAIL ON MASTER.OMS_DIST_ORDER_ID = DETAIL.src_ORDER_ID"""

df_34 = spark.sql(query_34)

df_34.createOrReplaceTempView("JNR_OMS_DIST_ORDER_34")

# COMMAND ----------
# DBTITLE 1, EXP_MD5_35


query_35 = f"""SELECT
  src_ORDER_ID AS src_ORDER_ID,
  src_TC_ORDER_ID AS src_TC_ORDER_ID,
  src_CREATION_TYPE AS src_CREATION_TYPE,
  src_O_FACILITY_ALIAS_ID AS src_O_FACILITY_ALIAS_ID,
  src_D_FACILITY_ALIAS_ID AS src_D_FACILITY_ALIAS_ID,
  src_BILL_FACILITY_ALIAS_ID AS src_BILL_FACILITY_ALIAS_ID,
  src_PICKUP_TZ AS src_PICKUP_TZ,
  src_DELIVERY_TZ AS src_DELIVERY_TZ,
  src_PICKUP_START_DTTM AS src_PICKUP_START_DTTM,
  src_PICKUP_END_DTTM AS src_PICKUP_END_DTTM,
  src_DELIVERY_START_DTTM AS src_DELIVERY_START_DTTM,
  src_DELIVERY_END_DTTM AS src_DELIVERY_END_DTTM,
  src_ORDER_DATE_DTTM AS src_ORDER_DATE_DTTM,
  src_ORDER_RECON_DTTM AS src_ORDER_RECON_DTTM,
  src_INBOUND_REGION_ID AS src_INBOUND_REGION_ID,
  src_OUTBOUND_REGION_ID AS src_OUTBOUND_REGION_ID,
  src_HAS_ALERTS AS src_HAS_ALERTS,
  src_HAS_SPLIT AS src_HAS_SPLIT,
  src_IS_CANCELLED AS src_IS_CANCELLED,
  src_IS_PARTIALLY_PLANNED AS src_IS_PARTIALLY_PLANNED,
  src_PARTIAL_SHIP_CONFIRMATION_FLAG AS src_PARTIAL_SHIP_CONFIRMATION_FLAG,
  src_PARTIAL_SHIP_CONFIRMATION_STATUS AS src_PARTIAL_SHIP_CONFIRMATION_STATUS,
  src_ACTUAL_COST AS src_ACTUAL_COST,
  src_BASELINE_COST AS src_BASELINE_COST,
  src_BILLING_METHOD AS src_BILLING_METHOD,
  src_DROPOFF_PICKUP AS src_DROPOFF_PICKUP,
  src_MV_CURRENCY_CODE AS src_MV_CURRENCY_CODE,
  src_MONETARY_VALUE AS src_MONETARY_VALUE,
  src_CREATED_SOURCE_TYPE AS src_CREATED_SOURCE_TYPE,
  src_CREATED_SOURCE AS src_CREATED_SOURCE,
  src_OMS_DO_CREATED_TSTMP AS src_OMS_DO_CREATED_TSTMP,
  src_LAST_UPDATED_DTTM AS src_LAST_UPDATED_DTTM,
  src_SHIPMENT_ID AS src_SHIPMENT_ID,
  src_ORDER_STATUS AS src_ORDER_STATUS,
  src_DO_STATUS AS src_DO_STATUS,
  src_DO_TYPE AS src_DO_TYPE,
  src_ACTUAL_SHIPPED_DTTM AS src_ACTUAL_SHIPPED_DTTM,
  src_SCHED_PICKUP_DTTM AS src_SCHED_PICKUP_DTTM,
  src_SCHED_DELIVERY_DTTM AS src_SCHED_DELIVERY_DTTM,
  src_PURCHASE_ORDER_ID AS src_PURCHASE_ORDER_ID,
  src_ORDER_TYPE AS src_ORDER_TYPE,
  src_REF_NUM1 AS src_REF_NUM1,
  src_ISPU_PXY_FIRST_NAME AS src_ISPU_PXY_FIRST_NAME,
  src_ISPU_PXY_LAST_NAME AS src_ISPU_PXY_LAST_NAME,
  src_ISPU_PXY_ADD_LINE1 AS src_ISPU_PXY_ADD_LINE1,
  src_ISPU_PXY_ADD_LINE2 AS src_ISPU_PXY_ADD_LINE2,
  src_ISPU_PXY_ADD_LINE3 AS src_ISPU_PXY_ADD_LINE3,
  src_ISPU_PXY_CITY AS src_ISPU_PXY_CITY,
  src_ISPU_PXY_STATE AS src_ISPU_PXY_STATE,
  src_ISPU_PXY_POSTAL_CD AS src_ISPU_PXY_POSTAL_CD,
  src_ISPU_PXY_COUNTRY AS src_ISPU_PXY_COUNTRY,
  src_ISPU_PXY_EMAIL AS src_ISPU_PXY_EMAIL,
  src_ISUP_PXY_PHONE AS src_ISUP_PXY_PHONE,
  src_TC_PURCHASE_ORDERS_ID AS src_TC_PURCHASE_ORDERS_ID,
  src_ORDER_NBR AS src_ORDER_NBR,
  src_OMS_ORDER_CREATED_TSTMP AS src_OMS_ORDER_CREATED_TSTMP,
  src_ORDER_CREATION_CHANNEL AS src_ORDER_CREATION_CHANNEL,
  src_ORDER_FULFILLMENT_CHANNEL AS src_ORDER_FULFILLMENT_CHANNEL,
  src_ORDER_CHANNEL AS src_ORDER_CHANNEL,
  src_SCHED_DELIVERY_FLG AS src_SCHED_DELIVERY_FLG,
  src_SUBSCRIPTION_ORDER_FLG AS src_SUBSCRIPTION_ORDER_FLG,
  src_CANCELED_DT AS src_CANCELED_DT,
  src_TC_COMPANY_ID AS src_TC_COMPANY_ID,
  src_RX_ORDER_FLG AS src_RX_ORDER_FLG,
  src_EXCHANGE_RATE_PCNT AS src_EXCHANGE_RATE_PCNT,
  src_ORIG_LOCATION_ID AS src_ORIG_LOCATION_ID,
  src_DEST_LOCATION_ID AS src_DEST_LOCATION_ID,
  src_BILL_LOCATION_ID AS src_BILL_LOCATION_ID,
  MD5(
    LTRIM(RTRIM(src_TC_ORDER_ID)) || TO_CHAR(src_CREATION_TYPE) || LTRIM(RTRIM(src_O_FACILITY_ALIAS_ID)) || TO_CHAR(src_ORIG_LOCATION_ID) || LTRIM(RTRIM(src_D_FACILITY_ALIAS_ID)) || TO_CHAR(src_DEST_LOCATION_ID) || LTRIM(RTRIM(src_BILL_FACILITY_ALIAS_ID)) || TO_CHAR(src_BILL_LOCATION_ID) || TO_CHAR(src_PICKUP_TZ) || TO_CHAR(src_DELIVERY_TZ) || TO_CHAR(
      TRUNC(src_PICKUP_START_DTTM),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(
      TRUNC(src_PICKUP_END_DTTM),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(
      TRUNC(src_DELIVERY_START_DTTM),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(
      TRUNC(src_DELIVERY_END_DTTM),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(
      TRUNC(src_ORDER_DATE_DTTM),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(
      TRUNC(src_ORDER_RECON_DTTM),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(src_INBOUND_REGION_ID) || TO_CHAR(src_OUTBOUND_REGION_ID) || TO_CHAR(src_HAS_ALERTS) || TO_CHAR(src_HAS_SPLIT) || TO_CHAR(src_IS_CANCELLED) || TO_CHAR(src_IS_PARTIALLY_PLANNED) || TO_CHAR(src_ACTUAL_COST) || TO_CHAR(src_BASELINE_COST) || TO_CHAR(src_BILLING_METHOD) || LTRIM(RTRIM(src_DROPOFF_PICKUP)) || LTRIM(RTRIM(src_MV_CURRENCY_CODE)) || TO_CHAR(src_MONETARY_VALUE) || TO_CHAR(src_CREATED_SOURCE_TYPE) || LTRIM(RTRIM(src_CREATED_SOURCE)) || TO_CHAR(src_OMS_DO_CREATED_TSTMP, 'YYYY-MM-DD HH24:MI:SS') || TO_CHAR(
      TRUNC(src_LAST_UPDATED_DTTM),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(src_SHIPMENT_ID) || TO_CHAR(src_ORDER_STATUS) || TO_CHAR(src_DO_STATUS) || TO_CHAR(src_DO_TYPE) || TO_CHAR(
      TRUNC(src_ACTUAL_SHIPPED_DTTM),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(
      TRUNC(src_SCHED_PICKUP_DTTM),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(
      TRUNC(src_SCHED_DELIVERY_DTTM),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(src_PURCHASE_ORDER_ID) || LTRIM(RTRIM(src_ORDER_TYPE)) || TO_CHAR(src_REF_NUM1) || LTRIM(RTRIM(src_ISPU_PXY_FIRST_NAME)) || LTRIM(RTRIM(src_ISPU_PXY_LAST_NAME)) || LTRIM(RTRIM(src_ISPU_PXY_ADD_LINE1)) || LTRIM(RTRIM(src_ISPU_PXY_ADD_LINE2)) || LTRIM(RTRIM(src_ISPU_PXY_ADD_LINE3)) || LTRIM(RTRIM(src_ISPU_PXY_CITY)) || LTRIM(RTRIM(src_ISPU_PXY_STATE)) || LTRIM(RTRIM(src_ISPU_PXY_POSTAL_CD)) || LTRIM(RTRIM(src_ISPU_PXY_COUNTRY)) || LTRIM(RTRIM(src_ISPU_PXY_EMAIL)) || LTRIM(RTRIM(src_ISUP_PXY_PHONE)) || LTRIM(RTRIM(src_TC_PURCHASE_ORDERS_ID)) || TO_CHAR(src_ORDER_NBR) || TO_CHAR(
      src_OMS_ORDER_CREATED_TSTMP,
      'YYYY-MM-DD HH24:MI:SS'
    ) || LTRIM(RTRIM(src_ORDER_CREATION_CHANNEL)) || LTRIM(RTRIM(src_ORDER_FULFILLMENT_CHANNEL)) || LTRIM(RTRIM(src_ORDER_CHANNEL)) || TO_CHAR(src_SCHED_DELIVERY_FLG) || TO_CHAR(src_SUBSCRIPTION_ORDER_FLG) || TO_CHAR(TRUNC(src_CANCELED_DT), 'YYYY-MM-DD HH24:MI:SS') || TO_CHAR(src_TC_COMPANY_ID) || TO_CHAR(src_RX_ORDER_FLG)
  ) AS v_SRC_MD5,
  MD5(
    LTRIM(RTRIM(lkp_OMS_DIST_ORDER_NBR)) || TO_CHAR(lkp_CREATION_TYPE_ID) || LTRIM(RTRIM(lkp_ORIG_LOCATION_NBR)) || TO_CHAR(lkp_ORIG_LOCATION_ID1) || LTRIM(RTRIM(lkp_DEST_LOCATION_NBR)) || TO_CHAR(lkp_DEST_LOCATION_ID1) || LTRIM(RTRIM(lkp_BILL_LOCATION_NBR)) || TO_CHAR(lkp_BILL_LOCATION_ID1) || TO_CHAR(lkp_PICKUP_TZ) || TO_CHAR(lkp_DELIVERY_TZ) || TO_CHAR(
      TRUNC(lkp_PICKUP_START_DT),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(TRUNC(lkp_PICKUP_END_DT), 'YYYY-MM-DD HH24:MI:SS') || TO_CHAR(
      TRUNC(lkp_DELIVERY_START_DT),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(
      TRUNC(lkp_DELIVERY_END_DT),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(TRUNC(lkp_ORDER_DATE_DT), 'YYYY-MM-DD HH24:MI:SS') || TO_CHAR(
      TRUNC(lkp_ORDER_RECON_DT),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(lkp_INBOUND_REGION_ID) || TO_CHAR(lkp_OUTBOUND_REGION_ID) || TO_CHAR(lkp_ALERTS_FLG) || TO_CHAR(lkp_SPLIT_FLG) || TO_CHAR(lkp_CANCELED_FLG) || TO_CHAR(lkp_PARTIALLY_PLANNED_FLG) || TO_CHAR(lkp_ACTUAL_COST_AMT) || TO_CHAR(lkp_BASELINE_COST_AMT) || TO_CHAR(lkp_BILLING_METHOD) || LTRIM(RTRIM(lkp_DROPOFF_PICKUP)) || LTRIM(RTRIM(lkp_MV_CURRENCY_CD)) || TO_CHAR(lkp_MONETARY_VALUE_AMT) || TO_CHAR(lkp_CREATED_SOURCE_TYPE) || LTRIM(RTRIM(lkp_CREATED_SOURCE)) || TO_CHAR(lkp_OMS_DO_CREATED_TSTMP, 'YYYY-MM-DD HH24:MI:SS') || TO_CHAR(
      TRUNC(lkp_LAST_UPDATED_TSTMP),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(lkp_SHIPMENT_ID) || TO_CHAR(lkp_OMS_DIST_ORDER_TRANS_STATUS_ID) || TO_CHAR(lkp_OMS_DIST_ORDER_STATUS_ID) || TO_CHAR(lkp_OMS_DIST_ORDER_TYPE_ID) || TO_CHAR(
      TRUNC(lkp_ACTUAL_SHIPPED_DT),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(
      TRUNC(lkp_SCHED_PICKUP_DT),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(
      TRUNC(lkp_SCHED_DELIVERY_DT),
      'YYYY-MM-DD HH24:MI:SS'
    ) || TO_CHAR(lkp_OMS_ORDER_ID) || LTRIM(RTRIM(lkp_OMS_DO_TYPE_ID)) || TO_CHAR(lkp_COMPLETED_ORDER_FLG) || LTRIM(RTRIM(lkp_ISPU_PXY_FIRST_NAME)) || LTRIM(RTRIM(lkp_ISPU_PXY_LAST_NAME)) || LTRIM(RTRIM(lkp_ISPU_PXY_ADD_LINE1)) || LTRIM(RTRIM(lkp_ISPU_PXY_ADD_LINE2)) || LTRIM(RTRIM(lkp_ISPU_PXY_ADD_LINE3)) || LTRIM(RTRIM(lkp_ISPU_PXY_CITY)) || LTRIM(RTRIM(lkp_ISPU_PXY_STATE)) || LTRIM(RTRIM(lkp_ISPU_PXY_POSTAL_CD)) || LTRIM(RTRIM(lkp_ISPU_PXY_COUNTRY)) || LTRIM(RTRIM(lkp_ISPU_PXY_EMAIL)) || LTRIM(RTRIM(lkp_ISUP_PXY_PHONE)) || LTRIM(RTRIM(lkp_OMS_ORDER_NBR)) || TO_CHAR(lkp_ORDER_NBR) || TO_CHAR(
      lkp_OMS_ORDER_CREATED_TSTMP,
      'YYYY-MM-DD HH24:MI:SS'
    ) || LTRIM(RTRIM(lkp_ORDER_CREATION_CHANNEL)) || LTRIM(RTRIM(lkp_ORDER_FULFILLMENT_CHANNEL)) || LTRIM(RTRIM(lkp_ORDER_CHANNEL)) || TO_CHAR(lkp_SCHED_DELIVERY_FLG) || TO_CHAR(lkp_SUBSCRIPTION_ORDER_FLG) || TO_CHAR(TRUNC(lkp_CANCELED_DT), 'YYYY-MM-DD HH24:MI:SS') || TO_CHAR(lkp_OMS_COMPANY_ID) || TO_CHAR(lkp_RX_ORDER_FLG)
  ) AS v_LKP_MD5,
  IFF(
    ISNULL(lkp_OMS_DIST_ORDER_ID),
    1,
    (
      IFF(
        MD5(
          LTRIM(RTRIM(src_TC_ORDER_ID)) || TO_CHAR(src_CREATION_TYPE) || LTRIM(RTRIM(src_O_FACILITY_ALIAS_ID)) || TO_CHAR(src_ORIG_LOCATION_ID) || LTRIM(RTRIM(src_D_FACILITY_ALIAS_ID)) || TO_CHAR(src_DEST_LOCATION_ID) || LTRIM(RTRIM(src_BILL_FACILITY_ALIAS_ID)) || TO_CHAR(src_BILL_LOCATION_ID) || TO_CHAR(src_PICKUP_TZ) || TO_CHAR(src_DELIVERY_TZ) || TO_CHAR(
            TRUNC(src_PICKUP_START_DTTM),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(
            TRUNC(src_PICKUP_END_DTTM),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(
            TRUNC(src_DELIVERY_START_DTTM),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(
            TRUNC(src_DELIVERY_END_DTTM),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(
            TRUNC(src_ORDER_DATE_DTTM),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(
            TRUNC(src_ORDER_RECON_DTTM),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(src_INBOUND_REGION_ID) || TO_CHAR(src_OUTBOUND_REGION_ID) || TO_CHAR(src_HAS_ALERTS) || TO_CHAR(src_HAS_SPLIT) || TO_CHAR(src_IS_CANCELLED) || TO_CHAR(src_IS_PARTIALLY_PLANNED) || TO_CHAR(src_ACTUAL_COST) || TO_CHAR(src_BASELINE_COST) || TO_CHAR(src_BILLING_METHOD) || LTRIM(RTRIM(src_DROPOFF_PICKUP)) || LTRIM(RTRIM(src_MV_CURRENCY_CODE)) || TO_CHAR(src_MONETARY_VALUE) || TO_CHAR(src_CREATED_SOURCE_TYPE) || LTRIM(RTRIM(src_CREATED_SOURCE)) || TO_CHAR(src_OMS_DO_CREATED_TSTMP, 'YYYY-MM-DD HH24:MI:SS') || TO_CHAR(
            TRUNC(src_LAST_UPDATED_DTTM),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(src_SHIPMENT_ID) || TO_CHAR(src_ORDER_STATUS) || TO_CHAR(src_DO_STATUS) || TO_CHAR(src_DO_TYPE) || TO_CHAR(
            TRUNC(src_ACTUAL_SHIPPED_DTTM),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(
            TRUNC(src_SCHED_PICKUP_DTTM),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(
            TRUNC(src_SCHED_DELIVERY_DTTM),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(src_PURCHASE_ORDER_ID) || LTRIM(RTRIM(src_ORDER_TYPE)) || TO_CHAR(src_REF_NUM1) || LTRIM(RTRIM(src_ISPU_PXY_FIRST_NAME)) || LTRIM(RTRIM(src_ISPU_PXY_LAST_NAME)) || LTRIM(RTRIM(src_ISPU_PXY_ADD_LINE1)) || LTRIM(RTRIM(src_ISPU_PXY_ADD_LINE2)) || LTRIM(RTRIM(src_ISPU_PXY_ADD_LINE3)) || LTRIM(RTRIM(src_ISPU_PXY_CITY)) || LTRIM(RTRIM(src_ISPU_PXY_STATE)) || LTRIM(RTRIM(src_ISPU_PXY_POSTAL_CD)) || LTRIM(RTRIM(src_ISPU_PXY_COUNTRY)) || LTRIM(RTRIM(src_ISPU_PXY_EMAIL)) || LTRIM(RTRIM(src_ISUP_PXY_PHONE)) || LTRIM(RTRIM(src_TC_PURCHASE_ORDERS_ID)) || TO_CHAR(src_ORDER_NBR) || TO_CHAR(
            src_OMS_ORDER_CREATED_TSTMP,
            'YYYY-MM-DD HH24:MI:SS'
          ) || LTRIM(RTRIM(src_ORDER_CREATION_CHANNEL)) || LTRIM(RTRIM(src_ORDER_FULFILLMENT_CHANNEL)) || LTRIM(RTRIM(src_ORDER_CHANNEL)) || TO_CHAR(src_SCHED_DELIVERY_FLG) || TO_CHAR(src_SUBSCRIPTION_ORDER_FLG) || TO_CHAR(TRUNC(src_CANCELED_DT), 'YYYY-MM-DD HH24:MI:SS') || TO_CHAR(src_TC_COMPANY_ID) || TO_CHAR(src_RX_ORDER_FLG)
        ) <> MD5(
          LTRIM(RTRIM(lkp_OMS_DIST_ORDER_NBR)) || TO_CHAR(lkp_CREATION_TYPE_ID) || LTRIM(RTRIM(lkp_ORIG_LOCATION_NBR)) || TO_CHAR(lkp_ORIG_LOCATION_ID1) || LTRIM(RTRIM(lkp_DEST_LOCATION_NBR)) || TO_CHAR(lkp_DEST_LOCATION_ID1) || LTRIM(RTRIM(lkp_BILL_LOCATION_NBR)) || TO_CHAR(lkp_BILL_LOCATION_ID1) || TO_CHAR(lkp_PICKUP_TZ) || TO_CHAR(lkp_DELIVERY_TZ) || TO_CHAR(
            TRUNC(lkp_PICKUP_START_DT),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(TRUNC(lkp_PICKUP_END_DT), 'YYYY-MM-DD HH24:MI:SS') || TO_CHAR(
            TRUNC(lkp_DELIVERY_START_DT),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(
            TRUNC(lkp_DELIVERY_END_DT),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(TRUNC(lkp_ORDER_DATE_DT), 'YYYY-MM-DD HH24:MI:SS') || TO_CHAR(
            TRUNC(lkp_ORDER_RECON_DT),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(lkp_INBOUND_REGION_ID) || TO_CHAR(lkp_OUTBOUND_REGION_ID) || TO_CHAR(lkp_ALERTS_FLG) || TO_CHAR(lkp_SPLIT_FLG) || TO_CHAR(lkp_CANCELED_FLG) || TO_CHAR(lkp_PARTIALLY_PLANNED_FLG) || TO_CHAR(lkp_ACTUAL_COST_AMT) || TO_CHAR(lkp_BASELINE_COST_AMT) || TO_CHAR(lkp_BILLING_METHOD) || LTRIM(RTRIM(lkp_DROPOFF_PICKUP)) || LTRIM(RTRIM(lkp_MV_CURRENCY_CD)) || TO_CHAR(lkp_MONETARY_VALUE_AMT) || TO_CHAR(lkp_CREATED_SOURCE_TYPE) || LTRIM(RTRIM(lkp_CREATED_SOURCE)) || TO_CHAR(lkp_OMS_DO_CREATED_TSTMP, 'YYYY-MM-DD HH24:MI:SS') || TO_CHAR(
            TRUNC(lkp_LAST_UPDATED_TSTMP),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(lkp_SHIPMENT_ID) || TO_CHAR(lkp_OMS_DIST_ORDER_TRANS_STATUS_ID) || TO_CHAR(lkp_OMS_DIST_ORDER_STATUS_ID) || TO_CHAR(lkp_OMS_DIST_ORDER_TYPE_ID) || TO_CHAR(
            TRUNC(lkp_ACTUAL_SHIPPED_DT),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(
            TRUNC(lkp_SCHED_PICKUP_DT),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(
            TRUNC(lkp_SCHED_DELIVERY_DT),
            'YYYY-MM-DD HH24:MI:SS'
          ) || TO_CHAR(lkp_OMS_ORDER_ID) || LTRIM(RTRIM(lkp_OMS_DO_TYPE_ID)) || TO_CHAR(lkp_COMPLETED_ORDER_FLG) || LTRIM(RTRIM(lkp_ISPU_PXY_FIRST_NAME)) || LTRIM(RTRIM(lkp_ISPU_PXY_LAST_NAME)) || LTRIM(RTRIM(lkp_ISPU_PXY_ADD_LINE1)) || LTRIM(RTRIM(lkp_ISPU_PXY_ADD_LINE2)) || LTRIM(RTRIM(lkp_ISPU_PXY_ADD_LINE3)) || LTRIM(RTRIM(lkp_ISPU_PXY_CITY)) || LTRIM(RTRIM(lkp_ISPU_PXY_STATE)) || LTRIM(RTRIM(lkp_ISPU_PXY_POSTAL_CD)) || LTRIM(RTRIM(lkp_ISPU_PXY_COUNTRY)) || LTRIM(RTRIM(lkp_ISPU_PXY_EMAIL)) || LTRIM(RTRIM(lkp_ISUP_PXY_PHONE)) || LTRIM(RTRIM(lkp_OMS_ORDER_NBR)) || TO_CHAR(lkp_ORDER_NBR) || TO_CHAR(
            lkp_OMS_ORDER_CREATED_TSTMP,
            'YYYY-MM-DD HH24:MI:SS'
          ) || LTRIM(RTRIM(lkp_ORDER_CREATION_CHANNEL)) || LTRIM(RTRIM(lkp_ORDER_FULFILLMENT_CHANNEL)) || LTRIM(RTRIM(lkp_ORDER_CHANNEL)) || TO_CHAR(lkp_SCHED_DELIVERY_FLG) || TO_CHAR(lkp_SUBSCRIPTION_ORDER_FLG) || TO_CHAR(TRUNC(lkp_CANCELED_DT), 'YYYY-MM-DD HH24:MI:SS') || TO_CHAR(lkp_OMS_COMPANY_ID) || TO_CHAR(lkp_RX_ORDER_FLG)
        ),
        2
      )
    )
  ) AS o_UPDATE_FLAG,
  now() AS o_UPDATE_TSTMP,
  IFF(ISNULL(lkp_LOAD_TSTMP), now(), lkp_LOAD_TSTMP) AS o_LOAD_TSTMP,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  JNR_OMS_DIST_ORDER_34"""

df_35 = spark.sql(query_35)

df_35.createOrReplaceTempView("EXP_MD5_35")

# COMMAND ----------
# DBTITLE 1, FIL_FLAGS_36


query_36 = f"""SELECT
  src_ORDER_ID AS src_ORDER_ID,
  src_TC_ORDER_ID AS src_TC_ORDER_ID,
  src_CREATION_TYPE AS src_CREATION_TYPE,
  src_O_FACILITY_ALIAS_ID AS src_O_FACILITY_ALIAS_ID,
  src_D_FACILITY_ALIAS_ID AS src_D_FACILITY_ALIAS_ID,
  src_BILL_FACILITY_ALIAS_ID AS src_BILL_FACILITY_ALIAS_ID,
  src_PICKUP_TZ AS src_PICKUP_TZ,
  src_DELIVERY_TZ AS src_DELIVERY_TZ,
  src_PICKUP_START_DTTM AS src_PICKUP_START_DTTM,
  src_PICKUP_END_DTTM AS src_PICKUP_END_DTTM,
  src_DELIVERY_START_DTTM AS src_DELIVERY_START_DTTM,
  src_DELIVERY_END_DTTM AS src_DELIVERY_END_DTTM,
  src_ORDER_DATE_DTTM AS src_ORDER_DATE_DTTM,
  src_ORDER_RECON_DTTM AS src_ORDER_RECON_DTTM,
  src_INBOUND_REGION_ID AS src_INBOUND_REGION_ID,
  src_OUTBOUND_REGION_ID AS src_OUTBOUND_REGION_ID,
  src_HAS_ALERTS AS src_HAS_ALERTS,
  src_HAS_SPLIT AS src_HAS_SPLIT,
  src_IS_CANCELLED AS src_IS_CANCELLED,
  src_IS_PARTIALLY_PLANNED AS src_IS_PARTIALLY_PLANNED,
  src_PARTIAL_SHIP_CONFIRMATION_FLAG AS src_PARTIAL_SHIP_CONFIRMATION_FLAG,
  src_PARTIAL_SHIP_CONFIRMATION_STATUS AS src_PARTIAL_SHIP_CONFIRMATION_STATUS,
  src_ACTUAL_COST AS src_ACTUAL_COST,
  src_BASELINE_COST AS src_BASELINE_COST,
  src_BILLING_METHOD AS src_BILLING_METHOD,
  src_DROPOFF_PICKUP AS src_DROPOFF_PICKUP,
  src_MV_CURRENCY_CODE AS src_MV_CURRENCY_CODE,
  src_MONETARY_VALUE AS src_MONETARY_VALUE,
  src_CREATED_SOURCE_TYPE AS src_CREATED_SOURCE_TYPE,
  src_CREATED_SOURCE AS src_CREATED_SOURCE,
  src_OMS_DO_CREATED_TSTMP AS src_OMS_DO_CREATED_TSTMP,
  src_LAST_UPDATED_DTTM AS src_LAST_UPDATED_DTTM,
  src_SHIPMENT_ID AS src_SHIPMENT_ID,
  src_ORDER_STATUS AS src_ORDER_STATUS,
  src_DO_STATUS AS src_DO_STATUS,
  src_DO_TYPE AS src_DO_TYPE,
  src_ACTUAL_SHIPPED_DTTM AS src_ACTUAL_SHIPPED_DTTM,
  src_SCHED_PICKUP_DTTM AS src_SCHED_PICKUP_DTTM,
  src_SCHED_DELIVERY_DTTM AS src_SCHED_DELIVERY_DTTM,
  src_PURCHASE_ORDER_ID AS src_PURCHASE_ORDER_ID,
  src_ORDER_TYPE AS src_ORDER_TYPE,
  src_REF_NUM1 AS src_REF_NUM1,
  src_ISPU_PXY_FIRST_NAME AS src_ISPU_PXY_FIRST_NAME,
  src_ISPU_PXY_LAST_NAME AS src_ISPU_PXY_LAST_NAME,
  src_ISPU_PXY_ADD_LINE1 AS src_ISPU_PXY_ADD_LINE1,
  src_ISPU_PXY_ADD_LINE2 AS src_ISPU_PXY_ADD_LINE2,
  src_ISPU_PXY_ADD_LINE3 AS src_ISPU_PXY_ADD_LINE3,
  src_ISPU_PXY_CITY AS src_ISPU_PXY_CITY,
  src_ISPU_PXY_STATE AS src_ISPU_PXY_STATE,
  src_ISPU_PXY_POSTAL_CD AS src_ISPU_PXY_POSTAL_CD,
  src_ISPU_PXY_COUNTRY AS src_ISPU_PXY_COUNTRY,
  src_ISPU_PXY_EMAIL AS src_ISPU_PXY_EMAIL,
  src_ISUP_PXY_PHONE AS src_ISUP_PXY_PHONE,
  src_TC_PURCHASE_ORDERS_ID AS src_TC_PURCHASE_ORDERS_ID,
  src_ORDER_NBR AS src_ORDER_NBR,
  src_OMS_ORDER_CREATED_TSTMP AS src_OMS_ORDER_CREATED_TSTMP,
  src_ORDER_CREATION_CHANNEL AS src_ORDER_CREATION_CHANNEL,
  src_ORDER_FULFILLMENT_CHANNEL AS src_ORDER_FULFILLMENT_CHANNEL,
  src_ORDER_CHANNEL AS src_ORDER_CHANNEL,
  src_SCHED_DELIVERY_FLG AS src_SCHED_DELIVERY_FLG,
  src_SUBSCRIPTION_ORDER_FLG AS src_SUBSCRIPTION_ORDER_FLG,
  src_CANCELED_DT AS src_CANCELED_DT,
  src_TC_COMPANY_ID AS src_TC_COMPANY_ID,
  src_RX_ORDER_FLG AS src_RX_ORDER_FLG,
  src_EXCHANGE_RATE_PCNT AS src_EXCHANGE_RATE_PCNT,
  src_ORIG_LOCATION_ID AS src_ORIG_LOCATION_ID,
  src_DEST_LOCATION_ID AS src_DEST_LOCATION_ID,
  src_BILL_LOCATION_ID AS src_BILL_LOCATION_ID,
  o_UPDATE_FLAG AS o_UPDATE_FLAG,
  o_UPDATE_TSTMP AS o_UPDATE_TSTMP,
  o_LOAD_TSTMP AS o_LOAD_TSTMP,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  EXP_MD5_35
WHERE
  IN(o_UPDATE_FLAG, 1, 2)"""

df_36 = spark.sql(query_36)

df_36.createOrReplaceTempView("FIL_FLAGS_36")

# COMMAND ----------
# DBTITLE 1, UPD_INSERT_UPDATE_37


query_37 = f"""SELECT
  src_ORDER_ID AS src_ORDER_ID,
  src_TC_ORDER_ID AS src_TC_ORDER_ID,
  src_CREATION_TYPE AS src_CREATION_TYPE,
  src_O_FACILITY_ALIAS_ID AS src_O_FACILITY_ALIAS_ID,
  src_D_FACILITY_ALIAS_ID AS src_D_FACILITY_ALIAS_ID,
  src_BILL_FACILITY_ALIAS_ID AS src_BILL_FACILITY_ALIAS_ID,
  src_PICKUP_TZ AS src_PICKUP_TZ,
  src_DELIVERY_TZ AS src_DELIVERY_TZ,
  src_PICKUP_START_DTTM AS src_PICKUP_START_DTTM,
  src_PICKUP_END_DTTM AS src_PICKUP_END_DTTM,
  src_DELIVERY_START_DTTM AS src_DELIVERY_START_DTTM,
  src_DELIVERY_END_DTTM AS src_DELIVERY_END_DTTM,
  src_ORDER_DATE_DTTM AS src_ORDER_DATE_DTTM,
  src_ORDER_RECON_DTTM AS src_ORDER_RECON_DTTM,
  src_INBOUND_REGION_ID AS src_INBOUND_REGION_ID,
  src_OUTBOUND_REGION_ID AS src_OUTBOUND_REGION_ID,
  src_HAS_ALERTS AS src_HAS_ALERTS,
  src_HAS_SPLIT AS src_HAS_SPLIT,
  src_IS_CANCELLED AS src_IS_CANCELLED,
  src_IS_PARTIALLY_PLANNED AS src_IS_PARTIALLY_PLANNED,
  src_PARTIAL_SHIP_CONFIRMATION_FLAG AS src_PARTIAL_SHIP_CONFIRMATION_FLAG,
  src_PARTIAL_SHIP_CONFIRMATION_STATUS AS src_PARTIAL_SHIP_CONFIRMATION_STATUS,
  src_ACTUAL_COST AS src_ACTUAL_COST,
  src_BASELINE_COST AS src_BASELINE_COST,
  src_BILLING_METHOD AS src_BILLING_METHOD,
  src_DROPOFF_PICKUP AS src_DROPOFF_PICKUP,
  src_MV_CURRENCY_CODE AS src_MV_CURRENCY_CODE,
  src_MONETARY_VALUE AS src_MONETARY_VALUE,
  src_CREATED_SOURCE_TYPE AS src_CREATED_SOURCE_TYPE,
  src_CREATED_SOURCE AS src_CREATED_SOURCE,
  src_OMS_DO_CREATED_TSTMP AS src_OMS_DO_CREATED_TSTMP,
  src_LAST_UPDATED_DTTM AS src_LAST_UPDATED_DTTM,
  src_SHIPMENT_ID AS src_SHIPMENT_ID,
  src_ORDER_STATUS AS src_ORDER_STATUS,
  src_DO_STATUS AS src_DO_STATUS,
  src_DO_TYPE AS src_DO_TYPE,
  src_ACTUAL_SHIPPED_DTTM AS src_ACTUAL_SHIPPED_DTTM,
  src_SCHED_PICKUP_DTTM AS src_SCHED_PICKUP_DTTM,
  src_SCHED_DELIVERY_DTTM AS src_SCHED_DELIVERY_DTTM,
  src_PURCHASE_ORDER_ID AS src_PURCHASE_ORDER_ID,
  src_ORDER_TYPE AS src_ORDER_TYPE,
  src_REF_NUM1 AS src_REF_NUM1,
  src_ISPU_PXY_FIRST_NAME AS src_ISPU_PXY_FIRST_NAME,
  src_ISPU_PXY_LAST_NAME AS src_ISPU_PXY_LAST_NAME,
  src_ISPU_PXY_ADD_LINE1 AS src_ISPU_PXY_ADD_LINE1,
  src_ISPU_PXY_ADD_LINE2 AS src_ISPU_PXY_ADD_LINE2,
  src_ISPU_PXY_ADD_LINE3 AS src_ISPU_PXY_ADD_LINE3,
  src_ISPU_PXY_CITY AS src_ISPU_PXY_CITY,
  src_ISPU_PXY_STATE AS src_ISPU_PXY_STATE,
  src_ISPU_PXY_POSTAL_CD AS src_ISPU_PXY_POSTAL_CD,
  src_ISPU_PXY_COUNTRY AS src_ISPU_PXY_COUNTRY,
  src_ISPU_PXY_EMAIL AS src_ISPU_PXY_EMAIL,
  src_ISUP_PXY_PHONE AS src_ISUP_PXY_PHONE,
  src_TC_PURCHASE_ORDERS_ID AS src_TC_PURCHASE_ORDERS_ID,
  src_ORDER_NBR AS src_ORDER_NBR,
  src_OMS_ORDER_CREATED_TSTMP AS src_OMS_ORDER_CREATED_TSTMP,
  src_ORDER_CREATION_CHANNEL AS src_ORDER_CREATION_CHANNEL,
  src_ORDER_FULFILLMENT_CHANNEL AS src_ORDER_FULFILLMENT_CHANNEL,
  src_ORDER_CHANNEL AS src_ORDER_CHANNEL,
  src_SCHED_DELIVERY_FLG AS src_SCHED_DELIVERY_FLG,
  src_SUBSCRIPTION_ORDER_FLG AS src_SUBSCRIPTION_ORDER_FLG,
  src_CANCELED_DT AS src_CANCELED_DT,
  src_TC_COMPANY_ID AS src_TC_COMPANY_ID,
  src_RX_ORDER_FLG AS src_RX_ORDER_FLG,
  src_EXCHANGE_RATE_PCNT AS src_EXCHANGE_RATE_PCNT,
  src_ORIG_LOCATION_ID AS src_ORIG_LOCATION_ID,
  src_DEST_LOCATION_ID AS src_DEST_LOCATION_ID,
  src_BILL_LOCATION_ID AS src_BILL_LOCATION_ID,
  o_UPDATE_FLAG AS o_UPDATE_FLAG,
  o_UPDATE_TSTMP AS o_UPDATE_TSTMP,
  o_LOAD_TSTMP AS o_LOAD_TSTMP,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id,
  DECODE(o_UPDATE_FLAG, 1, 'DD_INSERT', 2, 'DD_UPDATE') AS UPDATE_STRATEGY_FLAG
FROM
  FIL_FLAGS_36"""

df_37 = spark.sql(query_37)

df_37.createOrReplaceTempView("UPD_INSERT_UPDATE_37")

# COMMAND ----------
# DBTITLE 1, OMS_DIST_ORDER


spark.sql("""MERGE INTO OMS_DIST_ORDER AS TARGET
USING
  UPD_INSERT_UPDATE_37 AS SOURCE ON TARGET.OMS_DIST_ORDER_ID = SOURCE.src_ORDER_ID
  WHEN MATCHED
  AND SOURCE.UPDATE_STRATEGY_FLAG = "DD_UPDATE" THEN
UPDATE
SET
  TARGET.OMS_DIST_ORDER_ID = SOURCE.src_ORDER_ID,
  TARGET.OMS_DIST_ORDER_NBR = SOURCE.src_TC_ORDER_ID,
  TARGET.CREATION_TYPE_ID = SOURCE.src_CREATION_TYPE,
  TARGET.ORIG_LOCATION_NBR = SOURCE.src_O_FACILITY_ALIAS_ID,
  TARGET.ORIG_LOCATION_ID = SOURCE.src_ORIG_LOCATION_ID,
  TARGET.DEST_LOCATION_NBR = SOURCE.src_D_FACILITY_ALIAS_ID,
  TARGET.DEST_LOCATION_ID = SOURCE.src_DEST_LOCATION_ID,
  TARGET.BILL_LOCATION_NBR = SOURCE.src_BILL_FACILITY_ALIAS_ID,
  TARGET.BILL_LOCATION_ID = SOURCE.src_BILL_LOCATION_ID,
  TARGET.PICKUP_TZ = SOURCE.src_PICKUP_TZ,
  TARGET.DELIVERY_TZ = SOURCE.src_DELIVERY_TZ,
  TARGET.PICKUP_START_DT = SOURCE.src_PICKUP_START_DTTM,
  TARGET.PICKUP_END_DT = SOURCE.src_PICKUP_END_DTTM,
  TARGET.DELIVERY_START_DT = SOURCE.src_DELIVERY_START_DTTM,
  TARGET.DELIVERY_END_DT = SOURCE.src_DELIVERY_END_DTTM,
  TARGET.ORDER_DATE_DT = SOURCE.src_ORDER_DATE_DTTM,
  TARGET.ORDER_RECON_DT = SOURCE.src_ORDER_RECON_DTTM,
  TARGET.INBOUND_REGION_ID = SOURCE.src_INBOUND_REGION_ID,
  TARGET.OUTBOUND_REGION_ID = SOURCE.src_OUTBOUND_REGION_ID,
  TARGET.ALERTS_FLG = SOURCE.src_HAS_ALERTS,
  TARGET.SPLIT_FLG = SOURCE.src_HAS_SPLIT,
  TARGET.CANCELED_FLG = SOURCE.src_IS_CANCELLED,
  TARGET.PARTIALLY_PLANNED_FLG = SOURCE.src_IS_PARTIALLY_PLANNED,
  TARGET.ACTUAL_COST_AMT = SOURCE.src_ACTUAL_COST,
  TARGET.BASELINE_COST_AMT = SOURCE.src_BASELINE_COST,
  TARGET.BILLING_METHOD = SOURCE.src_BILLING_METHOD,
  TARGET.DROPOFF_PICKUP = SOURCE.src_DROPOFF_PICKUP,
  TARGET.MV_CURRENCY_CD = SOURCE.src_MV_CURRENCY_CODE,
  TARGET.MONETARY_VALUE_AMT = SOURCE.src_MONETARY_VALUE,
  TARGET.CREATED_SOURCE_TYPE = SOURCE.src_CREATED_SOURCE_TYPE,
  TARGET.CREATED_SOURCE = SOURCE.src_CREATED_SOURCE,
  TARGET.OMS_DO_CREATED_TSTMP = SOURCE.src_OMS_DO_CREATED_TSTMP,
  TARGET.LAST_UPDATED_TSTMP = SOURCE.src_LAST_UPDATED_DTTM,
  TARGET.SHIPMENT_ID = SOURCE.src_SHIPMENT_ID,
  TARGET.OMS_DIST_ORDER_TRANS_STATUS_ID = SOURCE.src_ORDER_STATUS,
  TARGET.OMS_DIST_ORDER_STATUS_ID = SOURCE.src_DO_STATUS,
  TARGET.OMS_DIST_ORDER_TYPE_ID = SOURCE.src_DO_TYPE,
  TARGET.ACTUAL_SHIPPED_DT = SOURCE.src_ACTUAL_SHIPPED_DTTM,
  TARGET.SCHED_PICKUP_DT = SOURCE.src_SCHED_PICKUP_DTTM,
  TARGET.SCHED_DELIVERY_DT = SOURCE.src_SCHED_DELIVERY_DTTM,
  TARGET.OMS_ORDER_ID = SOURCE.src_PURCHASE_ORDER_ID,
  TARGET.PRTL_SHIP_CONF_FLG = SOURCE.src_PARTIAL_SHIP_CONFIRMATION_FLAG,
  TARGET.PRTL_SHIP_CONF_STATUS_ID = SOURCE.src_PARTIAL_SHIP_CONFIRMATION_STATUS,
  TARGET.OMS_DO_TYPE_ID = SOURCE.src_ORDER_TYPE,
  TARGET.COMPLETED_ORDER_FLG = SOURCE.src_REF_NUM1,
  TARGET.ISPU_PXY_FIRST_NAME = SOURCE.src_ISPU_PXY_FIRST_NAME,
  TARGET.ISPU_PXY_LAST_NAME = SOURCE.src_ISPU_PXY_LAST_NAME,
  TARGET.ISPU_PXY_ADD_LINE1 = SOURCE.src_ISPU_PXY_ADD_LINE1,
  TARGET.ISPU_PXY_ADD_LINE2 = SOURCE.src_ISPU_PXY_ADD_LINE2,
  TARGET.ISPU_PXY_ADD_LINE3 = SOURCE.src_ISPU_PXY_ADD_LINE3,
  TARGET.ISPU_PXY_CITY = SOURCE.src_ISPU_PXY_CITY,
  TARGET.ISPU_PXY_STATE = SOURCE.src_ISPU_PXY_STATE,
  TARGET.ISPU_PXY_POSTAL_CD = SOURCE.src_ISPU_PXY_POSTAL_CD,
  TARGET.ISPU_PXY_COUNTRY = SOURCE.src_ISPU_PXY_COUNTRY,
  TARGET.ISPU_PXY_EMAIL = SOURCE.src_ISPU_PXY_EMAIL,
  TARGET.ISUP_PXY_PHONE = SOURCE.src_ISUP_PXY_PHONE,
  TARGET.OMS_ORDER_NBR = SOURCE.src_TC_PURCHASE_ORDERS_ID,
  TARGET.ORDER_NBR = SOURCE.src_ORDER_NBR,
  TARGET.OMS_ORDER_CREATED_TSTMP = SOURCE.src_OMS_ORDER_CREATED_TSTMP,
  TARGET.ORDER_CREATION_CHANNEL = SOURCE.src_ORDER_CREATION_CHANNEL,
  TARGET.ORDER_FULFILLMENT_CHANNEL = SOURCE.src_ORDER_FULFILLMENT_CHANNEL,
  TARGET.ORDER_CHANNEL = SOURCE.src_ORDER_CHANNEL,
  TARGET.SCHED_DELIVERY_FLG = SOURCE.src_SCHED_DELIVERY_FLG,
  TARGET.SUBSCRIPTION_ORDER_FLG = SOURCE.src_SUBSCRIPTION_ORDER_FLG,
  TARGET.CANCELED_DT = SOURCE.src_CANCELED_DT,
  TARGET.OMS_COMPANY_ID = SOURCE.src_TC_COMPANY_ID,
  TARGET.EXCHANGE_RATE_PCNT = SOURCE.src_EXCHANGE_RATE_PCNT,
  TARGET.RX_ORDER_FLG = SOURCE.src_RX_ORDER_FLG,
  TARGET.UPDATE_TSTMP = SOURCE.o_UPDATE_TSTMP,
  TARGET.LOAD_TSTMP = SOURCE.o_LOAD_TSTMP
  WHEN MATCHED
  AND SOURCE.UPDATE_STRATEGY_FLAG = "DD_DELETE"
  AND TARGET.OMS_DIST_ORDER_NBR = SOURCE.src_TC_ORDER_ID
  AND TARGET.CREATION_TYPE_ID = SOURCE.src_CREATION_TYPE
  AND TARGET.ORIG_LOCATION_NBR = SOURCE.src_O_FACILITY_ALIAS_ID
  AND TARGET.ORIG_LOCATION_ID = SOURCE.src_ORIG_LOCATION_ID
  AND TARGET.DEST_LOCATION_NBR = SOURCE.src_D_FACILITY_ALIAS_ID
  AND TARGET.DEST_LOCATION_ID = SOURCE.src_DEST_LOCATION_ID
  AND TARGET.BILL_LOCATION_NBR = SOURCE.src_BILL_FACILITY_ALIAS_ID
  AND TARGET.BILL_LOCATION_ID = SOURCE.src_BILL_LOCATION_ID
  AND TARGET.PICKUP_TZ = SOURCE.src_PICKUP_TZ
  AND TARGET.DELIVERY_TZ = SOURCE.src_DELIVERY_TZ
  AND TARGET.PICKUP_START_DT = SOURCE.src_PICKUP_START_DTTM
  AND TARGET.PICKUP_END_DT = SOURCE.src_PICKUP_END_DTTM
  AND TARGET.DELIVERY_START_DT = SOURCE.src_DELIVERY_START_DTTM
  AND TARGET.DELIVERY_END_DT = SOURCE.src_DELIVERY_END_DTTM
  AND TARGET.ORDER_DATE_DT = SOURCE.src_ORDER_DATE_DTTM
  AND TARGET.ORDER_RECON_DT = SOURCE.src_ORDER_RECON_DTTM
  AND TARGET.INBOUND_REGION_ID = SOURCE.src_INBOUND_REGION_ID
  AND TARGET.OUTBOUND_REGION_ID = SOURCE.src_OUTBOUND_REGION_ID
  AND TARGET.ALERTS_FLG = SOURCE.src_HAS_ALERTS
  AND TARGET.SPLIT_FLG = SOURCE.src_HAS_SPLIT
  AND TARGET.CANCELED_FLG = SOURCE.src_IS_CANCELLED
  AND TARGET.PARTIALLY_PLANNED_FLG = SOURCE.src_IS_PARTIALLY_PLANNED
  AND TARGET.ACTUAL_COST_AMT = SOURCE.src_ACTUAL_COST
  AND TARGET.BASELINE_COST_AMT = SOURCE.src_BASELINE_COST
  AND TARGET.BILLING_METHOD = SOURCE.src_BILLING_METHOD
  AND TARGET.DROPOFF_PICKUP = SOURCE.src_DROPOFF_PICKUP
  AND TARGET.MV_CURRENCY_CD = SOURCE.src_MV_CURRENCY_CODE
  AND TARGET.MONETARY_VALUE_AMT = SOURCE.src_MONETARY_VALUE
  AND TARGET.CREATED_SOURCE_TYPE = SOURCE.src_CREATED_SOURCE_TYPE
  AND TARGET.CREATED_SOURCE = SOURCE.src_CREATED_SOURCE
  AND TARGET.OMS_DO_CREATED_TSTMP = SOURCE.src_OMS_DO_CREATED_TSTMP
  AND TARGET.LAST_UPDATED_TSTMP = SOURCE.src_LAST_UPDATED_DTTM
  AND TARGET.SHIPMENT_ID = SOURCE.src_SHIPMENT_ID
  AND TARGET.OMS_DIST_ORDER_TRANS_STATUS_ID = SOURCE.src_ORDER_STATUS
  AND TARGET.OMS_DIST_ORDER_STATUS_ID = SOURCE.src_DO_STATUS
  AND TARGET.OMS_DIST_ORDER_TYPE_ID = SOURCE.src_DO_TYPE
  AND TARGET.ACTUAL_SHIPPED_DT = SOURCE.src_ACTUAL_SHIPPED_DTTM
  AND TARGET.SCHED_PICKUP_DT = SOURCE.src_SCHED_PICKUP_DTTM
  AND TARGET.SCHED_DELIVERY_DT = SOURCE.src_SCHED_DELIVERY_DTTM
  AND TARGET.OMS_ORDER_ID = SOURCE.src_PURCHASE_ORDER_ID
  AND TARGET.PRTL_SHIP_CONF_FLG = SOURCE.src_PARTIAL_SHIP_CONFIRMATION_FLAG
  AND TARGET.PRTL_SHIP_CONF_STATUS_ID = SOURCE.src_PARTIAL_SHIP_CONFIRMATION_STATUS
  AND TARGET.OMS_DO_TYPE_ID = SOURCE.src_ORDER_TYPE
  AND TARGET.COMPLETED_ORDER_FLG = SOURCE.src_REF_NUM1
  AND TARGET.ISPU_PXY_FIRST_NAME = SOURCE.src_ISPU_PXY_FIRST_NAME
  AND TARGET.ISPU_PXY_LAST_NAME = SOURCE.src_ISPU_PXY_LAST_NAME
  AND TARGET.ISPU_PXY_ADD_LINE1 = SOURCE.src_ISPU_PXY_ADD_LINE1
  AND TARGET.ISPU_PXY_ADD_LINE2 = SOURCE.src_ISPU_PXY_ADD_LINE2
  AND TARGET.ISPU_PXY_ADD_LINE3 = SOURCE.src_ISPU_PXY_ADD_LINE3
  AND TARGET.ISPU_PXY_CITY = SOURCE.src_ISPU_PXY_CITY
  AND TARGET.ISPU_PXY_STATE = SOURCE.src_ISPU_PXY_STATE
  AND TARGET.ISPU_PXY_POSTAL_CD = SOURCE.src_ISPU_PXY_POSTAL_CD
  AND TARGET.ISPU_PXY_COUNTRY = SOURCE.src_ISPU_PXY_COUNTRY
  AND TARGET.ISPU_PXY_EMAIL = SOURCE.src_ISPU_PXY_EMAIL
  AND TARGET.ISUP_PXY_PHONE = SOURCE.src_ISUP_PXY_PHONE
  AND TARGET.OMS_ORDER_NBR = SOURCE.src_TC_PURCHASE_ORDERS_ID
  AND TARGET.ORDER_NBR = SOURCE.src_ORDER_NBR
  AND TARGET.OMS_ORDER_CREATED_TSTMP = SOURCE.src_OMS_ORDER_CREATED_TSTMP
  AND TARGET.ORDER_CREATION_CHANNEL = SOURCE.src_ORDER_CREATION_CHANNEL
  AND TARGET.ORDER_FULFILLMENT_CHANNEL = SOURCE.src_ORDER_FULFILLMENT_CHANNEL
  AND TARGET.ORDER_CHANNEL = SOURCE.src_ORDER_CHANNEL
  AND TARGET.SCHED_DELIVERY_FLG = SOURCE.src_SCHED_DELIVERY_FLG
  AND TARGET.SUBSCRIPTION_ORDER_FLG = SOURCE.src_SUBSCRIPTION_ORDER_FLG
  AND TARGET.CANCELED_DT = SOURCE.src_CANCELED_DT
  AND TARGET.OMS_COMPANY_ID = SOURCE.src_TC_COMPANY_ID
  AND TARGET.EXCHANGE_RATE_PCNT = SOURCE.src_EXCHANGE_RATE_PCNT
  AND TARGET.RX_ORDER_FLG = SOURCE.src_RX_ORDER_FLG
  AND TARGET.UPDATE_TSTMP = SOURCE.o_UPDATE_TSTMP
  AND TARGET.LOAD_TSTMP = SOURCE.o_LOAD_TSTMP THEN DELETE
  WHEN NOT MATCHED
  AND SOURCE.UPDATE_STRATEGY_FLAG = "DD_INSERT" THEN
INSERT
  (
    TARGET.OMS_DIST_ORDER_ID,
    TARGET.OMS_DIST_ORDER_NBR,
    TARGET.CREATION_TYPE_ID,
    TARGET.ORIG_LOCATION_NBR,
    TARGET.ORIG_LOCATION_ID,
    TARGET.DEST_LOCATION_NBR,
    TARGET.DEST_LOCATION_ID,
    TARGET.BILL_LOCATION_NBR,
    TARGET.BILL_LOCATION_ID,
    TARGET.PICKUP_TZ,
    TARGET.DELIVERY_TZ,
    TARGET.PICKUP_START_DT,
    TARGET.PICKUP_END_DT,
    TARGET.DELIVERY_START_DT,
    TARGET.DELIVERY_END_DT,
    TARGET.ORDER_DATE_DT,
    TARGET.ORDER_RECON_DT,
    TARGET.INBOUND_REGION_ID,
    TARGET.OUTBOUND_REGION_ID,
    TARGET.ALERTS_FLG,
    TARGET.SPLIT_FLG,
    TARGET.CANCELED_FLG,
    TARGET.PARTIALLY_PLANNED_FLG,
    TARGET.ACTUAL_COST_AMT,
    TARGET.BASELINE_COST_AMT,
    TARGET.BILLING_METHOD,
    TARGET.DROPOFF_PICKUP,
    TARGET.MV_CURRENCY_CD,
    TARGET.MONETARY_VALUE_AMT,
    TARGET.CREATED_SOURCE_TYPE,
    TARGET.CREATED_SOURCE,
    TARGET.OMS_DO_CREATED_TSTMP,
    TARGET.LAST_UPDATED_TSTMP,
    TARGET.SHIPMENT_ID,
    TARGET.OMS_DIST_ORDER_TRANS_STATUS_ID,
    TARGET.OMS_DIST_ORDER_STATUS_ID,
    TARGET.OMS_DIST_ORDER_TYPE_ID,
    TARGET.ACTUAL_SHIPPED_DT,
    TARGET.SCHED_PICKUP_DT,
    TARGET.SCHED_DELIVERY_DT,
    TARGET.OMS_ORDER_ID,
    TARGET.PRTL_SHIP_CONF_FLG,
    TARGET.PRTL_SHIP_CONF_STATUS_ID,
    TARGET.OMS_DO_TYPE_ID,
    TARGET.COMPLETED_ORDER_FLG,
    TARGET.ISPU_PXY_FIRST_NAME,
    TARGET.ISPU_PXY_LAST_NAME,
    TARGET.ISPU_PXY_ADD_LINE1,
    TARGET.ISPU_PXY_ADD_LINE2,
    TARGET.ISPU_PXY_ADD_LINE3,
    TARGET.ISPU_PXY_CITY,
    TARGET.ISPU_PXY_STATE,
    TARGET.ISPU_PXY_POSTAL_CD,
    TARGET.ISPU_PXY_COUNTRY,
    TARGET.ISPU_PXY_EMAIL,
    TARGET.ISUP_PXY_PHONE,
    TARGET.OMS_ORDER_NBR,
    TARGET.ORDER_NBR,
    TARGET.OMS_ORDER_CREATED_TSTMP,
    TARGET.ORDER_CREATION_CHANNEL,
    TARGET.ORDER_FULFILLMENT_CHANNEL,
    TARGET.ORDER_CHANNEL,
    TARGET.SCHED_DELIVERY_FLG,
    TARGET.SUBSCRIPTION_ORDER_FLG,
    TARGET.CANCELED_DT,
    TARGET.OMS_COMPANY_ID,
    TARGET.EXCHANGE_RATE_PCNT,
    TARGET.RX_ORDER_FLG,
    TARGET.UPDATE_TSTMP,
    TARGET.LOAD_TSTMP
  )
VALUES
  (
    SOURCE.src_ORDER_ID,
    SOURCE.src_TC_ORDER_ID,
    SOURCE.src_CREATION_TYPE,
    SOURCE.src_O_FACILITY_ALIAS_ID,
    SOURCE.src_ORIG_LOCATION_ID,
    SOURCE.src_D_FACILITY_ALIAS_ID,
    SOURCE.src_DEST_LOCATION_ID,
    SOURCE.src_BILL_FACILITY_ALIAS_ID,
    SOURCE.src_BILL_LOCATION_ID,
    SOURCE.src_PICKUP_TZ,
    SOURCE.src_DELIVERY_TZ,
    SOURCE.src_PICKUP_START_DTTM,
    SOURCE.src_PICKUP_END_DTTM,
    SOURCE.src_DELIVERY_START_DTTM,
    SOURCE.src_DELIVERY_END_DTTM,
    SOURCE.src_ORDER_DATE_DTTM,
    SOURCE.src_ORDER_RECON_DTTM,
    SOURCE.src_INBOUND_REGION_ID,
    SOURCE.src_OUTBOUND_REGION_ID,
    SOURCE.src_HAS_ALERTS,
    SOURCE.src_HAS_SPLIT,
    SOURCE.src_IS_CANCELLED,
    SOURCE.src_IS_PARTIALLY_PLANNED,
    SOURCE.src_ACTUAL_COST,
    SOURCE.src_BASELINE_COST,
    SOURCE.src_BILLING_METHOD,
    SOURCE.src_DROPOFF_PICKUP,
    SOURCE.src_MV_CURRENCY_CODE,
    SOURCE.src_MONETARY_VALUE,
    SOURCE.src_CREATED_SOURCE_TYPE,
    SOURCE.src_CREATED_SOURCE,
    SOURCE.src_OMS_DO_CREATED_TSTMP,
    SOURCE.src_LAST_UPDATED_DTTM,
    SOURCE.src_SHIPMENT_ID,
    SOURCE.src_ORDER_STATUS,
    SOURCE.src_DO_STATUS,
    SOURCE.src_DO_TYPE,
    SOURCE.src_ACTUAL_SHIPPED_DTTM,
    SOURCE.src_SCHED_PICKUP_DTTM,
    SOURCE.src_SCHED_DELIVERY_DTTM,
    SOURCE.src_PURCHASE_ORDER_ID,
    SOURCE.src_PARTIAL_SHIP_CONFIRMATION_FLAG,
    SOURCE.src_PARTIAL_SHIP_CONFIRMATION_STATUS,
    SOURCE.src_ORDER_TYPE,
    SOURCE.src_REF_NUM1,
    SOURCE.src_ISPU_PXY_FIRST_NAME,
    SOURCE.src_ISPU_PXY_LAST_NAME,
    SOURCE.src_ISPU_PXY_ADD_LINE1,
    SOURCE.src_ISPU_PXY_ADD_LINE2,
    SOURCE.src_ISPU_PXY_ADD_LINE3,
    SOURCE.src_ISPU_PXY_CITY,
    SOURCE.src_ISPU_PXY_STATE,
    SOURCE.src_ISPU_PXY_POSTAL_CD,
    SOURCE.src_ISPU_PXY_COUNTRY,
    SOURCE.src_ISPU_PXY_EMAIL,
    SOURCE.src_ISUP_PXY_PHONE,
    SOURCE.src_TC_PURCHASE_ORDERS_ID,
    SOURCE.src_ORDER_NBR,
    SOURCE.src_OMS_ORDER_CREATED_TSTMP,
    SOURCE.src_ORDER_CREATION_CHANNEL,
    SOURCE.src_ORDER_FULFILLMENT_CHANNEL,
    SOURCE.src_ORDER_CHANNEL,
    SOURCE.src_SCHED_DELIVERY_FLG,
    SOURCE.src_SUBSCRIPTION_ORDER_FLG,
    SOURCE.src_CANCELED_DT,
    SOURCE.src_TC_COMPANY_ID,
    SOURCE.src_EXCHANGE_RATE_PCNT,
    SOURCE.src_RX_ORDER_FLG,
    SOURCE.o_UPDATE_TSTMP,
    SOURCE.o_LOAD_TSTMP
  )""")

# COMMAND ----------
#Post session variable updation
updateVariable(postVariableAssignment, variablesTableName, mainWorkflowId, parentName, "m_OMS_Dist_Order")

# COMMAND ----------
#Update Mapping Variables in database.
persistVariables(variablesTableName, "m_OMS_Dist_Order", mainWorkflowId, parentName)
