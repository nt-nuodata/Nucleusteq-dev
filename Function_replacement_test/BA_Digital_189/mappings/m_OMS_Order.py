# Databricks notebook source
# MAGIC %run "./udf_informatica"

# COMMAND ----------


from pyspark.sql.types import *

spark.sql("use DELTA_TRAINING")
spark.sql("set spark.sql.legacy.timeParserPolicy = LEGACY")

# COMMAND ----------
%run ../WorkflowUtility

# COMMAND ----------
mainWorkflowId = dbutils.widgets.get("mainWorkflowId")
mainWorkflowRunId = dbutils.widgets.get("mainWorkflowRunId")
parentName = dbutils.widgets.get("parentName")
preVariableAssignment = dbutils.widgets.get("preVariableAssignment")
postVariableAssignment = dbutils.widgets.get("postVariableAssignment")
truncTargetTableOptions = dbutils.widgets.get("truncTargetTableOptions")
variablesTableName = dbutils.widgets.get("variablesTableName")

# COMMAND ----------
#Truncate Target Tables
truncateTargetTables(truncTargetTableOptions)

# COMMAND ----------
#Pre presession variable updation
updateVariable(preVariableAssignment, variablesTableName, mainWorkflowId, parentName, "m_OMS_Order")

# COMMAND ----------
fetchAndCreateVariables(parentName,"m_OMS_Order", variablesTableName, mainWorkflowId)

# COMMAND ----------
# DBTITLE 1, Lkp_Site_Profile


spark.sql(
  """CREATE OR REPLACE FUNCTION Lkp_Site_Profile (in_FACILITY_ALIAS_ID STRING, in_FACILITY_TYPE_ID INT)
RETURNS INT
READS SQL DATA SQL SECURITY DEFINER
RETURN SELECT FIRST(LOCATION_ID) FROM SITE_PROFILE WHERE LOCATION_NBR = in_FACILITY_ALIAS_ID AND LOCATION_TYPE_ID = in_FACILITY_TYPE_ID"""
)

# COMMAND ----------
# DBTITLE 1, Lkp_CURRENCY_DAY


spark.sql(
  """CREATE OR REPLACE FUNCTION Lkp_CURRENCY_DAY (in_DAY_DT DATE)
RETURNS STRING
READS SQL DATA SQL SECURITY DEFINER
RETURN SELECT FIRST(EXCHANGE_RATE_PCNT) FROM CURRENCY_DAY WHERE DAY_DT = in_DAY_DT"""
)

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_FACILITY1_2


query_2 = f"""SELECT
  OMS_FACILITY_ID AS OMS_FACILITY_ID,
  FACILITY_TYPE_BITS AS FACILITY_TYPE_BITS,
  MARK_FOR_DELETION_FLAG AS MARK_FOR_DELETION_FLAG,
  OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_FACILITY"""

df_2 = spark.sql(query_2)

df_2.createOrReplaceTempView("Shortcut_to_OMS_FACILITY1_2")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_FACILITY1_3


query_3 = f"""SELECT
  OMS_FACILITY_ID AS OMS_FACILITY_ID,
  FACILITY_TYPE_BITS AS FACILITY_TYPE_BITS,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_FACILITY1_2"""

df_3 = spark.sql(query_3)

df_3.createOrReplaceTempView("SQ_Shortcut_to_OMS_FACILITY1_3")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_FACILITY_4


query_4 = f"""SELECT
  OMS_FACILITY_ID AS OMS_FACILITY_ID,
  FACILITY_TYPE_BITS AS FACILITY_TYPE_BITS,
  MARK_FOR_DELETION_FLAG AS MARK_FOR_DELETION_FLAG,
  OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_FACILITY"""

df_4 = spark.sql(query_4)

df_4.createOrReplaceTempView("Shortcut_to_OMS_FACILITY_4")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_FACILITY_5


query_5 = f"""SELECT
  OMS_FACILITY_ID AS OMS_FACILITY_ID,
  FACILITY_TYPE_BITS AS FACILITY_TYPE_BITS,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_FACILITY_4"""

df_5 = spark.sql(query_5)

df_5.createOrReplaceTempView("SQ_Shortcut_to_OMS_FACILITY_5")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_A_CO_REASON_CODE_6


query_6 = f"""SELECT
  OMS_REASON_CODE_ID AS OMS_REASON_CODE_ID,
  OMS_TC_COMPANY_ID AS OMS_TC_COMPANY_ID,
  OMS_REASON_CD AS OMS_REASON_CD,
  OMS_REASON_DESC AS OMS_REASON_DESC,
  OMS_REASON_CODE_TYPE AS OMS_REASON_CODE_TYPE,
  MARK_FOR_DELETION_FLAG AS MARK_FOR_DELETION_FLAG,
  SYSTEM_DEFINED_FLAG AS SYSTEM_DEFINED_FLAG,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_A_CO_REASON_CODE"""

df_6 = spark.sql(query_6)

df_6.createOrReplaceTempView("Shortcut_to_OMS_A_CO_REASON_CODE_6")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_A_CO_REASON_CODE_7


query_7 = f"""SELECT
  OMS_REASON_CODE_ID AS OMS_REASON_CODE_ID,
  OMS_REASON_CD AS OMS_REASON_CD,
  OMS_REASON_CODE_TYPE AS OMS_REASON_CODE_TYPE,
  MARK_FOR_DELETION_FLAG AS MARK_FOR_DELETION_FLAG,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_A_CO_REASON_CODE_6"""

df_7 = spark.sql(query_7)

df_7.createOrReplaceTempView("SQ_Shortcut_to_OMS_A_CO_REASON_CODE_7")

# COMMAND ----------
# DBTITLE 1, FIL_ACR_8


query_8 = f"""SELECT
  OMS_REASON_CODE_ID AS REASON_CODE_ID,
  OMS_REASON_CD AS REASON_CODE,
  OMS_REASON_CODE_TYPE AS REASON_CODE_TYPE,
  MARK_FOR_DELETION_FLAG AS MARK_FOR_DELETION,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_A_CO_REASON_CODE_7
WHERE
  OMS_REASON_CODE_TYPE = 1
  AND MARK_FOR_DELETION_FLAG = 0"""

df_8 = spark.sql(query_8)

df_8.createOrReplaceTempView("FIL_ACR_8")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_A_PAYMENT_DETAIL_9


query_9 = f"""SELECT
  OMS_PAYMENT_DETAIL_ID AS OMS_PAYMENT_DETAIL_ID,
  OMS_ENTITY_TYPE_ID AS OMS_ENTITY_TYPE_ID,
  OMS_ENTITY_ID AS OMS_ENTITY_ID,
  OMS_ENTITY_NBR AS OMS_ENTITY_NBR,
  CARD_NUMBER AS CARD_NUMBER,
  BILL_TO_FIRST_NAME AS BILL_TO_FIRST_NAME,
  BILL_TO_MIDDLE_NAME AS BILL_TO_MIDDLE_NAME,
  BILL_TO_LAST_NAME AS BILL_TO_LAST_NAME,
  BILL_TO_ADDR_LINE1 AS BILL_TO_ADDR_LINE1,
  BILL_TO_ADDR_LINE2 AS BILL_TO_ADDR_LINE2,
  BILL_TO_CITY AS BILL_TO_CITY,
  BILL_TO_STATE_PROV AS BILL_TO_STATE_PROV,
  BILL_TO_POSTAL_CD AS BILL_TO_POSTAL_CD,
  BILL_TO_COUNTRY_CD AS BILL_TO_COUNTRY_CD,
  BILL_TO_PHONE_NBR AS BILL_TO_PHONE_NBR,
  BILL_TO_EMAIL AS BILL_TO_EMAIL,
  OMS_PAYMENT_METHOD_ID AS OMS_PAYMENT_METHOD_ID,
  AFTERPAY_FLG AS AFTERPAY_FLG,
  REQ_AUTH_AMT AS REQ_AUTH_AMT,
  REQ_SETTLEMENT_AMT AS REQ_SETTLEMENT_AMT,
  REQ_REFUND_AMT AS REQ_REFUND_AMT,
  CURRENCY_CD AS CURRENCY_CD,
  OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_A_PAYMENT_DETAIL"""

df_9 = spark.sql(query_9)

df_9.createOrReplaceTempView("Shortcut_to_OMS_A_PAYMENT_DETAIL_9")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_A_PAYMENT_DETAIL_10


query_10 = f"""SELECT
  OMS_PAYMENT_DETAIL_ID AS OMS_PAYMENT_DETAIL_ID,
  OMS_ENTITY_ID AS OMS_ENTITY_ID,
  OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  AFTERPAY_FLG AS AFTERPAY_FLG,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_A_PAYMENT_DETAIL_9"""

df_10 = spark.sql(query_10)

df_10.createOrReplaceTempView("SQ_Shortcut_to_OMS_A_PAYMENT_DETAIL_10")

# COMMAND ----------
# DBTITLE 1, SRTTRANS2_11


query_11 = f"""SELECT
  OMS_PAYMENT_DETAIL_ID AS PAYMENT_DETAIL_ID,
  OMS_ENTITY_ID AS ENTITY_ID,
  AFTERPAY_FLG AS AFTERPAY_FLG,
  OMS_LAST_UPDATED_TSTMP AS LAST_UPDATED_DTTM,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_A_PAYMENT_DETAIL_10
ORDER BY
  ENTITY_ID ASC"""

df_11 = spark.sql(query_11)

df_11.createOrReplaceTempView("SRTTRANS2_11")

# COMMAND ----------
# DBTITLE 1, AGG_PD_12


query_12 = f"""SELECT
  MAX(PAYMENT_DETAIL_ID) AS PAYMENT_DETAIL_ID1,
  MAX(LAST_UPDATED_DTTM) AS LAST_UPDATED_DTTM1,
  MAX(IFF(IsNull(AFTERPAY_FLG), 0, AFTERPAY_FLG)) AS AFTERPAY_FLG,
  last(Monotonically_Increasing_Id) AS Monotonically_Increasing_Id
FROM
  SRTTRANS2_11
GROUP BY
  ENTITY_ID"""

df_12 = spark.sql(query_12)

df_12.createOrReplaceTempView("AGG_PD_12")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_A_PAYMENT_DETAIL1_13


query_13 = f"""SELECT
  OMS_PAYMENT_DETAIL_ID AS OMS_PAYMENT_DETAIL_ID,
  OMS_ENTITY_TYPE_ID AS OMS_ENTITY_TYPE_ID,
  OMS_ENTITY_ID AS OMS_ENTITY_ID,
  OMS_ENTITY_NBR AS OMS_ENTITY_NBR,
  CARD_NUMBER AS CARD_NUMBER,
  BILL_TO_FIRST_NAME AS BILL_TO_FIRST_NAME,
  BILL_TO_MIDDLE_NAME AS BILL_TO_MIDDLE_NAME,
  BILL_TO_LAST_NAME AS BILL_TO_LAST_NAME,
  BILL_TO_ADDR_LINE1 AS BILL_TO_ADDR_LINE1,
  BILL_TO_ADDR_LINE2 AS BILL_TO_ADDR_LINE2,
  BILL_TO_CITY AS BILL_TO_CITY,
  BILL_TO_STATE_PROV AS BILL_TO_STATE_PROV,
  BILL_TO_POSTAL_CD AS BILL_TO_POSTAL_CD,
  BILL_TO_COUNTRY_CD AS BILL_TO_COUNTRY_CD,
  BILL_TO_PHONE_NBR AS BILL_TO_PHONE_NBR,
  BILL_TO_EMAIL AS BILL_TO_EMAIL,
  OMS_PAYMENT_METHOD_ID AS OMS_PAYMENT_METHOD_ID,
  AFTERPAY_FLG AS AFTERPAY_FLG,
  REQ_AUTH_AMT AS REQ_AUTH_AMT,
  REQ_SETTLEMENT_AMT AS REQ_SETTLEMENT_AMT,
  REQ_REFUND_AMT AS REQ_REFUND_AMT,
  CURRENCY_CD AS CURRENCY_CD,
  OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_A_PAYMENT_DETAIL"""

df_13 = spark.sql(query_13)

df_13.createOrReplaceTempView("Shortcut_to_OMS_A_PAYMENT_DETAIL1_13")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_A_PAYMENT_DETAIL1_14


query_14 = f"""SELECT
  DISTINCT OMS_PAYMENT_DETAIL_ID AS OMS_PAYMENT_DETAIL_ID,
  OMS_ENTITY_ID AS OMS_ENTITY_ID,
  BILL_TO_FIRST_NAME AS BILL_TO_FIRST_NAME,
  BILL_TO_LAST_NAME AS BILL_TO_LAST_NAME,
  BILL_TO_ADDR_LINE1 AS BILL_TO_ADDR_LINE1,
  BILL_TO_ADDR_LINE2 AS BILL_TO_ADDR_LINE2,
  BILL_TO_CITY AS BILL_TO_CITY,
  BILL_TO_STATE_PROV AS BILL_TO_STATE_PROV,
  BILL_TO_POSTAL_CD AS BILL_TO_POSTAL_CD,
  BILL_TO_COUNTRY_CD AS BILL_TO_COUNTRY_CD,
  BILL_TO_PHONE_NBR AS BILL_TO_PHONE_NBR,
  BILL_TO_EMAIL AS BILL_TO_EMAIL,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_A_PAYMENT_DETAIL1_13"""

df_14 = spark.sql(query_14)

df_14.createOrReplaceTempView("SQ_Shortcut_to_OMS_A_PAYMENT_DETAIL1_14")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_EDW_LOAD_CTRL_PRE_15


query_15 = f"""SELECT
  OMS_PURCHASE_ORDERS_ID AS OMS_PURCHASE_ORDERS_ID,
  OMS_PURCHASE_ORDERS_LINE_ITEM_ID AS OMS_PURCHASE_ORDERS_LINE_ITEM_ID,
  OMS_TC_COMPANY_ID AS OMS_TC_COMPANY_ID,
  ORDER_NBR AS ORDER_NBR,
  OMS_TC_PURCHASE_ORDERS_ID AS OMS_TC_PURCHASE_ORDERS_ID,
  OMS_TC_PO_LINE_ID AS OMS_TC_PO_LINE_ID,
  OMS_ORDER_FULFILLMENT_OPTION AS OMS_ORDER_FULFILLMENT_OPTION,
  ORDER_FULFILLMENT_CHANNEL AS ORDER_FULFILLMENT_CHANNEL,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  ORDER_CHANNEL AS ORDER_CHANNEL,
  OMS_CREATED_SOURCE AS OMS_CREATED_SOURCE,
  OMS_ENTERED_BY AS OMS_ENTERED_BY,
  OMS_ROLE_NAME AS OMS_ROLE_NAME,
  PO_OMS_CREATED_TSTMP AS PO_OMS_CREATED_TSTMP,
  PO_OMS_LAST_UPDATED_DTTM AS PO_OMS_LAST_UPDATED_DTTM,
  POL_OMS_CREATED_TSTMP AS POL_OMS_CREATED_TSTMP,
  POL_OMS_LAST_UPDATED_TSTMP AS POL_OMS_LAST_UPDATED_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_EDW_LOAD_CTRL_PRE"""

df_15 = spark.sql(query_15)

df_15.createOrReplaceTempView("Shortcut_to_OMS_EDW_LOAD_CTRL_PRE_15")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_EDW_LOAD_CTRL_PRE_16


query_16 = f"""SELECT
  DISTINCT OMS_PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  ORDER_NBR AS ORDER_NBR,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_EDW_LOAD_CTRL_PRE_15"""

df_16 = spark.sql(query_16)

df_16.createOrReplaceTempView("SQ_Shortcut_to_OMS_EDW_LOAD_CTRL_PRE_16")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_A_TAX_DETAIL_17


query_17 = f"""SELECT
  OMS_TAX_DETAIL_ID AS OMS_TAX_DETAIL_ID,
  OMS_COMPANY_ID AS OMS_COMPANY_ID,
  OMS_ENTITY_TYPE_ID AS OMS_ENTITY_TYPE_ID,
  OMS_ENTITY_ID AS OMS_ENTITY_ID,
  OMS_ENTITY_LINE_ID AS OMS_ENTITY_LINE_ID,
  OMS_TAX_TYPE AS OMS_TAX_TYPE,
  OMS_TAX_CATEGORY AS OMS_TAX_CATEGORY,
  OMS_TAX_NAME AS OMS_TAX_NAME,
  TAX_TSTMP AS TAX_TSTMP,
  TAXABLE_AMT AS TAXABLE_AMT,
  TAX_RATE AS TAX_RATE,
  TAX_AMT AS TAX_AMT,
  MARK_FOR_DELETION_FLAG AS MARK_FOR_DELETION_FLAG,
  OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_A_TAX_DETAIL"""

df_17 = spark.sql(query_17)

df_17.createOrReplaceTempView("Shortcut_to_OMS_A_TAX_DETAIL_17")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_A_TAX_DETAIL_18


query_18 = f"""SELECT
  OMS_ENTITY_ID AS OMS_ENTITY_ID,
  TAX_AMT AS TAX_AMT,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_A_TAX_DETAIL_17"""

df_18 = spark.sql(query_18)

df_18.createOrReplaceTempView("SQ_Shortcut_to_OMS_A_TAX_DETAIL_18")

# COMMAND ----------
# DBTITLE 1, SRTTRANS4_19


query_19 = f"""SELECT
  OMS_ENTITY_ID AS ENTITY_ID,
  TAX_AMT AS TAX_AMOUNT,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_A_TAX_DETAIL_18
ORDER BY
  ENTITY_ID ASC"""

df_19 = spark.sql(query_19)

df_19.createOrReplaceTempView("SRTTRANS4_19")

# COMMAND ----------
# DBTITLE 1, AGGTRANS_20


query_20 = f"""SELECT
  ENTITY_ID AS ENTITY_ID,
  SUM(TAX_AMOUNT) AS TAX_AMOUNT,
  last(Monotonically_Increasing_Id) AS Monotonically_Increasing_Id
FROM
  SRTTRANS4_19
GROUP BY
  ENTITY_ID"""

df_20 = spark.sql(query_20)

df_20.createOrReplaceTempView("AGGTRANS_20")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_PO_LINE_ITEM_REF_FIELDS_21


query_21 = f"""SELECT
  OMS_PURCHASE_ORDERS_LINE_ITEM_ID AS OMS_PURCHASE_ORDERS_LINE_ITEM_ID,
  OMS_PURCHASE_ORDERS_ID AS OMS_PURCHASE_ORDERS_ID,
  REF_FIELD1 AS REF_FIELD1,
  REF_FIELD2 AS REF_FIELD2,
  REF_FIELD3 AS REF_FIELD3,
  REF_FIELD4 AS REF_FIELD4,
  REF_FIELD5 AS REF_FIELD5,
  REF_FIELD6 AS REF_FIELD6,
  REF_FIELD7 AS REF_FIELD7,
  REF_FIELD8 AS REF_FIELD8,
  REF_FIELD9 AS REF_FIELD9,
  REF_FIELD10 AS REF_FIELD10,
  REF_NUM1 AS REF_NUM1,
  REF_NUM2 AS REF_NUM2,
  REF_NUM3 AS REF_NUM3,
  REF_NUM4 AS REF_NUM4,
  REF_NUM5 AS REF_NUM5,
  RX_STATUS AS RX_STATUS,
  RX_ASSIGNED_TO AS RX_ASSIGNED_TO,
  RX_ASSIGNED_TSTMP AS RX_ASSIGNED_TSTMP,
  RX_VET_INQUIRY AS RX_VET_INQUIRY,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_PO_LINE_ITEM_REF_FIELDS"""

df_21 = spark.sql(query_21)

df_21.createOrReplaceTempView("Shortcut_to_OMS_PO_LINE_ITEM_REF_FIELDS_21")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_PO_LINE_ITEM_REF_FIELDS_22


query_22 = f"""SELECT
  OMS_PURCHASE_ORDERS_LINE_ITEM_ID AS OMS_PURCHASE_ORDERS_LINE_ITEM_ID,
  OMS_PURCHASE_ORDERS_ID AS OMS_PURCHASE_ORDERS_ID,
  REF_FIELD1 AS REF_FIELD1,
  REF_FIELD3 AS REF_FIELD3,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_PO_LINE_ITEM_REF_FIELDS_21"""

df_22 = spark.sql(query_22)

df_22.createOrReplaceTempView("SQ_Shortcut_to_OMS_PO_LINE_ITEM_REF_FIELDS_22")

# COMMAND ----------
# DBTITLE 1, EXP_DATA_TYPES_23


query_23 = f"""SELECT
  OMS_PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  OMS_PURCHASE_ORDERS_LINE_ITEM_ID AS PURCHASE_ORDERS_LINE_ITEM_ID,
  IFF(
    ISNULL(REF_FIELD3)
    or UPPER(REF_FIELD3) = 'FALSE',
    0,
    1
  ) AS SUBSCRIPTION_ORDER_FLG,
  IFF(ISNULL(REF_FIELD1), 0, TO_INTEGER(REF_FIELD1)) AS SCHED_DELIVERY_FLG,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_PO_LINE_ITEM_REF_FIELDS_22"""

df_23 = spark.sql(query_23)

df_23.createOrReplaceTempView("EXP_DATA_TYPES_23")

# COMMAND ----------
# DBTITLE 1, SRTTRANS3_24


query_24 = f"""SELECT
  PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  EXP_DATA_TYPES_23
ORDER BY
  PURCHASE_ORDERS_ID ASC"""

df_24 = spark.sql(query_24)

df_24.createOrReplaceTempView("SRTTRANS3_24")

# COMMAND ----------
# DBTITLE 1, AGG_FLAG_25


query_25 = f"""SELECT
  PURCHASE_ORDERS_ID AS polr_PURCHASE_ORDERS_ID,
  MAX(SUBSCRIPTION_ORDER_FLG) AS SUBSCRIPTION_ORDER_FLG,
  MAX(SCHED_DELIVERY_FLG) AS SCHED_DELIVERY_FLG,
  last(Monotonically_Increasing_Id) AS Monotonically_Increasing_Id
FROM
  SRTTRANS3_24
GROUP BY
  PURCHASE_ORDERS_ID"""

df_25 = spark.sql(query_25)

df_25.createOrReplaceTempView("AGG_FLAG_25")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_PURCHASE_ORDERS_ATTRIBUTE_26


query_26 = f"""SELECT
  OMS_PURCHASE_ORDERS_ID AS OMS_PURCHASE_ORDERS_ID,
  ATTRIBUTE_NAME AS ATTRIBUTE_NAME,
  ATTRIBUTE_SEQ AS ATTRIBUTE_SEQ,
  ATTRIBUTE_VALUE AS ATTRIBUTE_VALUE,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_PURCHASE_ORDERS_ATTRIBUTE"""

df_26 = spark.sql(query_26)

df_26.createOrReplaceTempView("Shortcut_to_OMS_PURCHASE_ORDERS_ATTRIBUTE_26")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_PURCHASE_ORDERS_ATTRIBUTE_27


query_27 = f"""SELECT
  DT.OMS_PURCHASE_ORDERS_ID,
  CAST(SW.ATTRIBUTE_VALUE AS INTEGER) AS ScreenWidth,
  CAST(DT.ATTRIBUTE_VALUE AS VARCHAR (50)) AS DeviceType
FROM
  (
    SELECT
      OMS_PURCHASE_ORDERS_ID,
      ATTRIBUTE_VALUE,
      ATTRIBUTE_NAME
    FROM
      Shortcut_to_OMS_PURCHASE_ORDERS_ATTRIBUTE_26
    WHERE
      ATTRIBUTE_NAME IN ('DeviceType')
  ) DT
  LEFT OUTER JOIN (
    SELECT
      OMS_PURCHASE_ORDERS_ID,
      ATTRIBUTE_VALUE,
      ATTRIBUTE_NAME
    FROM
      Shortcut_to_OMS_PURCHASE_ORDERS_ATTRIBUTE_26
    WHERE
      ATTRIBUTE_NAME IN ('ScreenWidth')
  ) SW ON DT.OMS_PURCHASE_ORDERS_ID = SW.OMS_PURCHASE_ORDERS_ID"""

df_27 = spark.sql(query_27)

df_27.createOrReplaceTempView("SQ_Shortcut_to_OMS_PURCHASE_ORDERS_ATTRIBUTE_27")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_PURCHASE_ORDERS_LINE_ITEM_28


query_28 = f"""SELECT
  OMS_PURCHASE_ORDERS_ID AS OMS_PURCHASE_ORDERS_ID,
  OMS_PURCHASE_ORDERS_LINE_ITEM_ID AS OMS_PURCHASE_ORDERS_LINE_ITEM_ID,
  OMS_TC_PO_LINE_ID AS OMS_TC_PO_LINE_ID,
  OMS_PARENT_PO_LINE_ITEM_ID AS OMS_PARENT_PO_LINE_ITEM_ID,
  OMS_ORIGINAL_PO_LINE_ITEM_ID AS OMS_ORIGINAL_PO_LINE_ITEM_ID,
  OMS_PURCHASE_ORDERS_LINE_STATUS_ID AS OMS_PURCHASE_ORDERS_LINE_STATUS_ID,
  ORDER_FULFILLMENT_OPTION_ID AS ORDER_FULFILLMENT_OPTION_ID,
  SKU AS SKU,
  CUST_SKU AS CUST_SKU,
  OMS_PRODUCT_CLASS_ID AS OMS_PRODUCT_CLASS_ID,
  RETURNABLE_FLAG AS RETURNABLE_FLAG,
  EXCHANGEABLE_FLAG AS EXCHANGEABLE_FLAG,
  PRICE_OVERRIDE_FLAG AS PRICE_OVERRIDE_FLAG,
  OMS_STORE_FACILITY_ALIAS_ID AS OMS_STORE_FACILITY_ALIAS_ID,
  OMS_STORE_FACILITY_ID AS OMS_STORE_FACILITY_ID,
  OMS_O_FACILITY_ID AS OMS_O_FACILITY_ID,
  OMS_O_FACILITY_ALIAS_ID AS OMS_O_FACILITY_ALIAS_ID,
  OMS_BILL_FACILITY_ALIAS_ID AS OMS_BILL_FACILITY_ALIAS_ID,
  OMS_BILL_FACILITY_ID AS OMS_BILL_FACILITY_ID,
  OMS_D_FACILITY_ID AS OMS_D_FACILITY_ID,
  OMS_D_FACILITY_ALIAS_ID AS OMS_D_FACILITY_ALIAS_ID,
  D_FIRST_NAME AS D_FIRST_NAME,
  D_LAST_NAME AS D_LAST_NAME,
  D_ADDR_1 AS D_ADDR_1,
  D_ADDR_2 AS D_ADDR_2,
  D_ADDR_3 AS D_ADDR_3,
  D_CITY AS D_CITY,
  D_STATE_PROV AS D_STATE_PROV,
  D_POSTAL_CD AS D_POSTAL_CD,
  D_COUNTY AS D_COUNTY,
  D_COUNTRY_CD AS D_COUNTRY_CD,
  D_PHONE_NBR AS D_PHONE_NBR,
  D_EMAIL AS D_EMAIL,
  ADDR_VALID_FLAG AS ADDR_VALID_FLAG,
  OMS_ALLOC_FINALIZER AS OMS_ALLOC_FINALIZER,
  OMS_DSG_CARRIER_ID AS OMS_DSG_CARRIER_ID,
  DSG_SHIP_VIA AS DSG_SHIP_VIA,
  DO_CREATED_FLAG AS DO_CREATED_FLAG,
  READY_TO_SHIP_FLAG AS READY_TO_SHIP_FLAG,
  CANCELLED_FLAG AS CANCELLED_FLAG,
  CLOSED_FLAG AS CLOSED_FLAG,
  DELETED_FLAG AS DELETED_FLAG,
  OMS_REASON_ID AS OMS_REASON_ID,
  OMS_REASON_CODES_GROUP_ID AS OMS_REASON_CODES_GROUP_ID,
  OMS_BACK_ORD_REASON_ID AS OMS_BACK_ORD_REASON_ID,
  OMS_PICKUP_START_TSTMP AS OMS_PICKUP_START_TSTMP,
  OMS_PICKUP_END_TSTMP AS OMS_PICKUP_END_TSTMP,
  OMS_PICKUP_TZ_ID AS OMS_PICKUP_TZ_ID,
  OMS_DELIVERY_START_TSTMP AS OMS_DELIVERY_START_TSTMP,
  OMS_DELIVERY_END_TSTMP AS OMS_DELIVERY_END_TSTMP,
  OMS_DELIVERY_TZ_ID AS OMS_DELIVERY_TZ_ID,
  OMS_REQ_DLVR_TSTMP AS OMS_REQ_DLVR_TSTMP,
  OMS_MUST_DLVR_TSTMP AS OMS_MUST_DLVR_TSTMP,
  OMS_SHIP_BY_DT AS OMS_SHIP_BY_DT,
  ORIG_ORDER_QTY AS ORIG_ORDER_QTY,
  ORDER_QTY AS ORDER_QTY,
  CANCELLED_QTY AS CANCELLED_QTY,
  ALLOCATED_QTY AS ALLOCATED_QTY,
  RELEASED_QTY AS RELEASED_QTY,
  RECEIVED_QTY AS RECEIVED_QTY,
  PPACK_QTY AS PPACK_QTY,
  SHIPPED_QTY AS SHIPPED_QTY,
  ORIGINAL_PRICE_AMT AS ORIGINAL_PRICE_AMT,
  RETAIL_PRICE_AMT AS RETAIL_PRICE_AMT,
  UNIT_TAX_AMT AS UNIT_TAX_AMT,
  LINE_TOTAL_AMT AS LINE_TOTAL_AMT,
  UNIT_MONETARY_VALUE AS UNIT_MONETARY_VALUE,
  TOTAL_MONETARY_VALUE AS TOTAL_MONETARY_VALUE,
  MV_CURRENCY_CD AS MV_CURRENCY_CD,
  OMS_EXT_CREATED_TSTMP AS OMS_EXT_CREATED_TSTMP,
  OMS_CREATED_SOURCE_TYPE_ID AS OMS_CREATED_SOURCE_TYPE_ID,
  OMS_CREATED_SOURCE AS OMS_CREATED_SOURCE,
  OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_PURCHASE_ORDERS_LINE_ITEM"""

df_28 = spark.sql(query_28)

df_28.createOrReplaceTempView("Shortcut_to_OMS_PURCHASE_ORDERS_LINE_ITEM_28")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_PURCHASE_ORDERS_LINE_ITEM_29


query_29 = f"""SELECT
  OMS_PURCHASE_ORDERS_ID AS OMS_PURCHASE_ORDERS_ID,
  CANCELLED_FLAG AS CANCELLED_FLAG,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_PURCHASE_ORDERS_LINE_ITEM_28"""

df_29 = spark.sql(query_29)

df_29.createOrReplaceTempView("SQ_Shortcut_to_OMS_PURCHASE_ORDERS_LINE_ITEM_29")

# COMMAND ----------
# DBTITLE 1, SRTTRANS1_30


query_30 = f"""SELECT
  OMS_PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  CANCELLED_FLAG AS IS_CANCELLED,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_PURCHASE_ORDERS_LINE_ITEM_29
ORDER BY
  PURCHASE_ORDERS_ID ASC"""

df_30 = spark.sql(query_30)

df_30.createOrReplaceTempView("SRTTRANS1_30")

# COMMAND ----------
# DBTITLE 1, AGG_IS_CANCELLED_31


query_31 = f"""SELECT
  PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  MAX(IFF(ISNULL(IS_CANCELLED), 0)) AS MAX_IS_CANCELLED,
  MAX(IFF(ISNULL(IS_CANCELLED), 0)) AS MIN_IS_CANCELLED,
  last(Monotonically_Increasing_Id) AS Monotonically_Increasing_Id
FROM
  SRTTRANS1_30
GROUP BY
  PURCHASE_ORDERS_ID"""

df_31 = spark.sql(query_31)

df_31.createOrReplaceTempView("AGG_IS_CANCELLED_31")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_PURCHASE_ORDERS_32


query_32 = f"""SELECT
  OMS_PURCHASE_ORDERS_ID AS OMS_PURCHASE_ORDERS_ID,
  OMS_TC_COMPANY_ID AS OMS_TC_COMPANY_ID,
  OMS_TC_PURCHASE_ORDERS_ID AS OMS_TC_PURCHASE_ORDERS_ID,
  OMS_EXT_PURCHASE_ORDERS_ID AS OMS_EXT_PURCHASE_ORDERS_ID,
  OMS_PARENT_PURCHASE_ORDERS_ID AS OMS_PARENT_PURCHASE_ORDERS_ID,
  OMS_PURCHASE_ORDERS_TYPE_ID AS OMS_PURCHASE_ORDERS_TYPE_ID,
  OMS_PURCHASE_ORDERS_STATUS_ID AS OMS_PURCHASE_ORDERS_STATUS_ID,
  OMS_ORDER_CATEGORY_ID AS OMS_ORDER_CATEGORY_ID,
  OMS_O_FACILITY_ID AS OMS_O_FACILITY_ID,
  OMS_O_FACILITY_ALIAS_ID AS OMS_O_FACILITY_ALIAS_ID,
  OMS_D_FACILITY_ID AS OMS_D_FACILITY_ID,
  OMS_D_FACILITY_ALIAS_ID AS OMS_D_FACILITY_ALIAS_ID,
  OMS_BILL_FACILITY_ID AS OMS_BILL_FACILITY_ID,
  OMS_BILL_FACILITY_ALIAS_ID AS OMS_BILL_FACILITY_ALIAS_ID,
  OMS_ORIGIN_SHIP_VIA_FACILITY_ALIAS_ID AS OMS_ORIGIN_SHIP_VIA_FACILITY_ALIAS_ID,
  OMS_ORIGIN_SHIP_VIA_FACILITY_ID AS OMS_ORIGIN_SHIP_VIA_FACILITY_ID,
  OMS_DES_SHIP_VIA_FACILITY_ALIAS_ID AS OMS_DES_SHIP_VIA_FACILITY_ALIAS_ID,
  OMS_DES_SHIP_VIA_FACILITY_ID AS OMS_DES_SHIP_VIA_FACILITY_ID,
  OMS_CUSTOMER_CD AS OMS_CUSTOMER_CD,
  CUSTOMER_FIRST_NAME AS CUSTOMER_FIRST_NAME,
  CUSTOMER_LAST_NAME AS CUSTOMER_LAST_NAME,
  CUSTOMER_PHONE_NBR AS CUSTOMER_PHONE_NBR,
  CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  OMS_RETURN_REFERENCE_NBR AS OMS_RETURN_REFERENCE_NBR,
  OMS_BILL_OF_LADING_NBR AS OMS_BILL_OF_LADING_NBR,
  OMS_TRANS_RESP_CD AS OMS_TRANS_RESP_CD,
  OMS_COMMODITY_CODE_ID AS OMS_COMMODITY_CODE_ID,
  OMS_CARRIER_ID AS OMS_CARRIER_ID,
  OMS_PRODUCT_CLASS_ID AS OMS_PRODUCT_CLASS_ID,
  OMS_PROTECTION_LEVEL_ID AS OMS_PROTECTION_LEVEL_ID,
  OMS_CREATION_TYPE_ID AS OMS_CREATION_TYPE_ID,
  OMS_CHANNEL_TYPE_ID AS OMS_CHANNEL_TYPE_ID,
  OMS_CHANNEL_ID AS OMS_CHANNEL_ID,
  OMS_FULFILL_MODE_ID AS OMS_FULFILL_MODE_ID,
  OMS_ENTERED_BY AS OMS_ENTERED_BY,
  OMS_ENTRY_CD AS OMS_ENTRY_CD,
  OMS_PAYMENT_MODE_ID AS OMS_PAYMENT_MODE_ID,
  OMS_PAYMENT_STATUS_ID AS OMS_PAYMENT_STATUS_ID,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  ORDER_RECEIVED_FLAG AS ORDER_RECEIVED_FLAG,
  ON_HOLD_FLAG AS ON_HOLD_FLAG,
  HAS_ALERTS_FLAG AS HAS_ALERTS_FLAG,
  CANCELLED_FLAG AS CANCELLED_FLAG,
  CLOSED_FLAG AS CLOSED_FLAG,
  OMS_REASON_ID AS OMS_REASON_ID,
  OMS_DECLINE_REASON_ID AS OMS_DECLINE_REASON_ID,
  OMS_REASON_CODES_GROUP_ID AS OMS_REASON_CODES_GROUP_ID,
  IMPORTED_FLAG AS IMPORTED_FLAG,
  PURCHASE_ORDERS_RECONCILED_FLAG AS PURCHASE_ORDERS_RECONCILED_FLAG,
  READY_TO_SHIP_FLAG AS READY_TO_SHIP_FLAG,
  CUSTOMER_PICKUP_FLAG AS CUSTOMER_PICKUP_FLAG,
  DIRECT_ALLOWED_FLAG AS DIRECT_ALLOWED_FLAG,
  PARTIALLY_PLANNED_FLAG AS PARTIALLY_PLANNED_FLAG,
  OMS_PURCHASE_ORDERS_DT_TSTMP AS OMS_PURCHASE_ORDERS_DT_TSTMP,
  OMS_PICKUP_START_TSTMP AS OMS_PICKUP_START_TSTMP,
  OMS_PICKUP_END_TSTMP AS OMS_PICKUP_END_TSTMP,
  OMS_PICKUP_TZ_ID AS OMS_PICKUP_TZ_ID,
  OMS_DELIVERY_START_TSTMP AS OMS_DELIVERY_START_TSTMP,
  OMS_DELIVERY_END_TSTMP AS OMS_DELIVERY_END_TSTMP,
  OMS_DELIVERY_TZ_ID AS OMS_DELIVERY_TZ_ID,
  OMS_REQUESTED_DLVR_TSTMP AS OMS_REQUESTED_DLVR_TSTMP,
  OMS_MUST_DLVR_TSTMP AS OMS_MUST_DLVR_TSTMP,
  OMS_PROMISED_DLVR_TSTMP AS OMS_PROMISED_DLVR_TSTMP,
  OMS_DUE_DT AS OMS_DUE_DT,
  OMS_CANCEL_DT AS OMS_CANCEL_DT,
  OMS_RELEASE_TSTMP AS OMS_RELEASE_TSTMP,
  OMS_FIRST_RCPT_TSTMP AS OMS_FIRST_RCPT_TSTMP,
  OMS_LAST_RCPT_TSTMP AS OMS_LAST_RCPT_TSTMP,
  MONETARY_VALUE AS MONETARY_VALUE,
  MV_CURRENCY_CD AS MV_CURRENCY_CD,
  ORIG_BUDG_COST AS ORIG_BUDG_COST,
  BUDG_COST AS BUDG_COST,
  BUDG_COST_CURRENCY_CD AS BUDG_COST_CURRENCY_CD,
  TAX_CHARGES_AMT AS TAX_CHARGES_AMT,
  MISC_CHARGES_AMT AS MISC_CHARGES_AMT,
  GRAND_TOTAL_AMT AS GRAND_TOTAL_AMT,
  FREIGHT_REVENUE_AMT AS FREIGHT_REVENUE_AMT,
  CURRENCY_CD AS CURRENCY_CD,
  OMS_CREATED_SOURCE_TYPE_ID AS OMS_CREATED_SOURCE_TYPE_ID,
  OMS_CREATED_SOURCE AS OMS_CREATED_SOURCE,
  OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_PURCHASE_ORDERS"""

df_32 = spark.sql(query_32)

df_32.createOrReplaceTempView("Shortcut_to_OMS_PURCHASE_ORDERS_32")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_PURCHASE_ORDERS_33


query_33 = f"""SELECT
  OMS_PURCHASE_ORDERS_ID AS OMS_PURCHASE_ORDERS_ID,
  OMS_TC_COMPANY_ID AS OMS_TC_COMPANY_ID,
  OMS_TC_PURCHASE_ORDERS_ID AS OMS_TC_PURCHASE_ORDERS_ID,
  OMS_EXT_PURCHASE_ORDERS_ID AS OMS_EXT_PURCHASE_ORDERS_ID,
  OMS_PARENT_PURCHASE_ORDERS_ID AS OMS_PARENT_PURCHASE_ORDERS_ID,
  OMS_PURCHASE_ORDERS_TYPE_ID AS OMS_PURCHASE_ORDERS_TYPE_ID,
  OMS_PURCHASE_ORDERS_STATUS_ID AS OMS_PURCHASE_ORDERS_STATUS_ID,
  OMS_ORDER_CATEGORY_ID AS OMS_ORDER_CATEGORY_ID,
  OMS_O_FACILITY_ID AS OMS_O_FACILITY_ID,
  OMS_O_FACILITY_ALIAS_ID AS OMS_O_FACILITY_ALIAS_ID,
  OMS_D_FACILITY_ID AS OMS_D_FACILITY_ID,
  OMS_D_FACILITY_ALIAS_ID AS OMS_D_FACILITY_ALIAS_ID,
  OMS_BILL_FACILITY_ID AS OMS_BILL_FACILITY_ID,
  OMS_BILL_FACILITY_ALIAS_ID AS OMS_BILL_FACILITY_ALIAS_ID,
  OMS_ORIGIN_SHIP_VIA_FACILITY_ALIAS_ID AS OMS_ORIGIN_SHIP_VIA_FACILITY_ALIAS_ID,
  OMS_ORIGIN_SHIP_VIA_FACILITY_ID AS OMS_ORIGIN_SHIP_VIA_FACILITY_ID,
  OMS_DES_SHIP_VIA_FACILITY_ALIAS_ID AS OMS_DES_SHIP_VIA_FACILITY_ALIAS_ID,
  OMS_DES_SHIP_VIA_FACILITY_ID AS OMS_DES_SHIP_VIA_FACILITY_ID,
  OMS_CUSTOMER_CD AS OMS_CUSTOMER_CD,
  CUSTOMER_FIRST_NAME AS CUSTOMER_FIRST_NAME,
  CUSTOMER_LAST_NAME AS CUSTOMER_LAST_NAME,
  CUSTOMER_PHONE_NBR AS CUSTOMER_PHONE_NBR,
  CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  OMS_RETURN_REFERENCE_NBR AS OMS_RETURN_REFERENCE_NBR,
  OMS_BILL_OF_LADING_NBR AS OMS_BILL_OF_LADING_NBR,
  OMS_TRANS_RESP_CD AS OMS_TRANS_RESP_CD,
  OMS_COMMODITY_CODE_ID AS OMS_COMMODITY_CODE_ID,
  OMS_CARRIER_ID AS OMS_CARRIER_ID,
  OMS_PRODUCT_CLASS_ID AS OMS_PRODUCT_CLASS_ID,
  OMS_PROTECTION_LEVEL_ID AS OMS_PROTECTION_LEVEL_ID,
  OMS_CREATION_TYPE_ID AS OMS_CREATION_TYPE_ID,
  OMS_CHANNEL_TYPE_ID AS OMS_CHANNEL_TYPE_ID,
  OMS_CHANNEL_ID AS OMS_CHANNEL_ID,
  OMS_FULFILL_MODE_ID AS OMS_FULFILL_MODE_ID,
  OMS_ENTERED_BY AS OMS_ENTERED_BY,
  OMS_ENTRY_CD AS OMS_ENTRY_CD,
  OMS_PAYMENT_MODE_ID AS OMS_PAYMENT_MODE_ID,
  OMS_PAYMENT_STATUS_ID AS OMS_PAYMENT_STATUS_ID,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  ORDER_RECEIVED_FLAG AS ORDER_RECEIVED_FLAG,
  ON_HOLD_FLAG AS ON_HOLD_FLAG,
  HAS_ALERTS_FLAG AS HAS_ALERTS_FLAG,
  CANCELLED_FLAG AS CANCELLED_FLAG,
  CLOSED_FLAG AS CLOSED_FLAG,
  OMS_REASON_ID AS OMS_REASON_ID,
  OMS_DECLINE_REASON_ID AS OMS_DECLINE_REASON_ID,
  OMS_REASON_CODES_GROUP_ID AS OMS_REASON_CODES_GROUP_ID,
  IMPORTED_FLAG AS IMPORTED_FLAG,
  PURCHASE_ORDERS_RECONCILED_FLAG AS PURCHASE_ORDERS_RECONCILED_FLAG,
  READY_TO_SHIP_FLAG AS READY_TO_SHIP_FLAG,
  CUSTOMER_PICKUP_FLAG AS CUSTOMER_PICKUP_FLAG,
  DIRECT_ALLOWED_FLAG AS DIRECT_ALLOWED_FLAG,
  PARTIALLY_PLANNED_FLAG AS PARTIALLY_PLANNED_FLAG,
  OMS_PURCHASE_ORDERS_DT_TSTMP AS OMS_PURCHASE_ORDERS_DT_TSTMP,
  OMS_PICKUP_START_TSTMP AS OMS_PICKUP_START_TSTMP,
  OMS_PICKUP_END_TSTMP AS OMS_PICKUP_END_TSTMP,
  OMS_PICKUP_TZ_ID AS OMS_PICKUP_TZ_ID,
  OMS_DELIVERY_START_TSTMP AS OMS_DELIVERY_START_TSTMP,
  OMS_DELIVERY_END_TSTMP AS OMS_DELIVERY_END_TSTMP,
  OMS_DELIVERY_TZ_ID AS OMS_DELIVERY_TZ_ID,
  OMS_REQUESTED_DLVR_TSTMP AS OMS_REQUESTED_DLVR_TSTMP,
  OMS_MUST_DLVR_TSTMP AS OMS_MUST_DLVR_TSTMP,
  OMS_PROMISED_DLVR_TSTMP AS OMS_PROMISED_DLVR_TSTMP,
  OMS_DUE_DT AS OMS_DUE_DT,
  OMS_CANCEL_DT AS OMS_CANCEL_DT,
  OMS_RELEASE_TSTMP AS OMS_RELEASE_TSTMP,
  OMS_FIRST_RCPT_TSTMP AS OMS_FIRST_RCPT_TSTMP,
  OMS_LAST_RCPT_TSTMP AS OMS_LAST_RCPT_TSTMP,
  MONETARY_VALUE AS MONETARY_VALUE,
  MV_CURRENCY_CD AS MV_CURRENCY_CD,
  ORIG_BUDG_COST AS ORIG_BUDG_COST,
  BUDG_COST AS BUDG_COST,
  BUDG_COST_CURRENCY_CD AS BUDG_COST_CURRENCY_CD,
  TAX_CHARGES_AMT AS TAX_CHARGES_AMT,
  MISC_CHARGES_AMT AS MISC_CHARGES_AMT,
  GRAND_TOTAL_AMT AS GRAND_TOTAL_AMT,
  FREIGHT_REVENUE_AMT AS FREIGHT_REVENUE_AMT,
  CURRENCY_CD AS CURRENCY_CD,
  OMS_CREATED_SOURCE_TYPE_ID AS OMS_CREATED_SOURCE_TYPE_ID,
  OMS_CREATED_SOURCE AS OMS_CREATED_SOURCE,
  OMS_CREATED_TSTMP AS OMS_CREATED_TSTMP,
  OMS_LAST_UPDATED_TSTMP AS OMS_LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_PURCHASE_ORDERS_32"""

df_33 = spark.sql(query_33)

df_33.createOrReplaceTempView("SQ_Shortcut_to_OMS_PURCHASE_ORDERS_33")

# COMMAND ----------
# DBTITLE 1, JNR_PO_ATTR_34


query_34 = f"""SELECT
  DETAIL.OMS_PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID_A,
  DETAIL.ScreenWidth AS ScreenWidth,
  DETAIL.DeviceType AS DeviceType,
  MASTER.OMS_PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  MASTER.OMS_CREATION_TYPE_ID AS CREATION_TYPE,
  MASTER.OMS_PURCHASE_ORDERS_TYPE_ID AS PURCHASE_ORDERS_TYPE,
  MASTER.OMS_PURCHASE_ORDERS_STATUS_ID AS PURCHASE_ORDERS_STATUS,
  MASTER.OMS_TC_COMPANY_ID AS TC_COMPANY_ID,
  MASTER.OMS_TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  MASTER.OMS_PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  MASTER.OMS_O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  MASTER.OMS_D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  MASTER.OMS_BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  MASTER.OMS_ORIGIN_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  MASTER.OMS_DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  MASTER.OMS_PICKUP_TZ_ID AS PICKUP_TZ,
  MASTER.OMS_DELIVERY_TZ_ID AS DELIVERY_TZ,
  MASTER.OMS_PICKUP_START_TSTMP AS PICKUP_START_DTTM,
  MASTER.OMS_PICKUP_END_TSTMP AS PICKUP_END_DTTM,
  MASTER.OMS_DELIVERY_START_TSTMP AS DELIVERY_START_DTTM,
  MASTER.OMS_DELIVERY_END_TSTMP AS DELIVERY_END_DTTM,
  MASTER.OMS_REQUESTED_DLVR_TSTMP AS REQUESTED_DLVR_DTTM,
  MASTER.OMS_MUST_DLVR_TSTMP AS MUST_DLVR_DTTM,
  MASTER.OMS_PROMISED_DLVR_TSTMP AS PROMISED_DLVR_DTTM,
  MASTER.OMS_DUE_DT AS DUE_DT,
  MASTER.OMS_PURCHASE_ORDERS_DT_TSTMP AS PURCHASE_ORDERS_DATE_DTTM,
  MASTER.OMS_RELEASE_TSTMP AS RELEASE_DTTM,
  MASTER.OMS_FIRST_RCPT_TSTMP AS FIRST_RCPT_DTTM,
  MASTER.OMS_LAST_RCPT_TSTMP AS LAST_RCPT_DTTM,
  MASTER.OMS_PAYMENT_MODE_ID AS PAYMENT_MODE,
  MASTER.MV_CURRENCY_CD AS MV_CURRENCY_CODE,
  MASTER.MONETARY_VALUE AS MONETARY_VALUE,
  MASTER.CURRENCY_CD AS CURRENCY_CODE,
  MASTER.ORIG_BUDG_COST AS ORIG_BUDG_COST,
  MASTER.BUDG_COST_CURRENCY_CD AS BUDG_COST_CURRENCY_CODE,
  MASTER.BUDG_COST AS BUDG_COST,
  MASTER.TAX_CHARGES_AMT AS TAX_CHARGES,
  MASTER.MISC_CHARGES_AMT AS MISC_CHARGES,
  MASTER.CANCELLED_FLAG AS IS_CANCELLED,
  MASTER.IMPORTED_FLAG AS IS_IMPORTED,
  MASTER.READY_TO_SHIP_FLAG AS IS_READY_TO_SHIP,
  MASTER.CUSTOMER_PICKUP_FLAG AS IS_CUSTOMER_PICKUP,
  MASTER.PARTIALLY_PLANNED_FLAG AS IS_PARTIALLY_PLANNED,
  MASTER.OMS_BILL_OF_LADING_NBR AS BILL_OF_LADING_NUMBER,
  MASTER.OMS_TRANS_RESP_CD AS TRANS_RESP_CODE,
  MASTER.OMS_COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  MASTER.OMS_CARRIER_ID AS CARRIER_ID,
  MASTER.OMS_PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  MASTER.OMS_PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  MASTER.OMS_DECLINE_REASON_ID AS DECLINE_REASON_ID,
  MASTER.OMS_CHANNEL_TYPE_ID AS CHANNEL_TYPE,
  MASTER.OMS_CUSTOMER_CD AS CUSTOMER_CODE,
  MASTER.CUSTOMER_FIRST_NAME AS CUSTOMER_FIRSTNAME,
  MASTER.CUSTOMER_LAST_NAME AS CUSTOMER_LASTNAME,
  MASTER.OMS_CREATED_SOURCE_TYPE_ID AS CREATED_SOURCE_TYPE,
  MASTER.OMS_CREATED_SOURCE AS CREATED_SOURCE,
  MASTER.OMS_CREATED_TSTMP AS CREATED_DTTM,
  MASTER.OMS_LAST_UPDATED_TSTMP AS LAST_UPDATED_DTTM,
  MASTER.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  MASTER.CLOSED_FLAG AS IS_CLOSED,
  MASTER.GRAND_TOTAL_AMT AS GRAND_TOTAL,
  MASTER.OMS_ORDER_CATEGORY_ID AS ORDER_CATEGORY,
  MASTER.OMS_CHANNEL_ID AS CHANNEL_ID,
  MASTER.OMS_FULFILL_MODE_ID AS FULFILL_MODE,
  MASTER.OMS_ENTERED_BY AS ENTERED_BY,
  MASTER.OMS_ENTRY_CD AS ENTRY_CODE,
  MASTER.OMS_PAYMENT_STATUS_ID AS PAYMENT_STATUS,
  MASTER.OMS_REASON_ID AS REASON_ID,
  MASTER.ORDER_RECEIVED_FLAG AS ORDER_RECEIVED,
  MASTER.FREIGHT_REVENUE_AMT AS FREIGHT_REVENUE,
  MASTER.OMS_REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  MASTER.OMS_RETURN_REFERENCE_NBR AS RETURN_REFERENCE_NUMBER,
  MASTER.CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  MASTER.CUSTOMER_PHONE_NBR AS CUSTOMER_PHONE,
  MASTER.OMS_O_FACILITY_ID AS O_FACILITY_ID,
  MASTER.OMS_D_FACILITY_ID AS D_FACILITY_ID,
  MASTER.ON_HOLD_FLAG AS ON_HOLD,
  MASTER.HAS_ALERTS_FLAG AS HAS_ALERTS_FLAG,
  MASTER.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_PURCHASE_ORDERS_33 MASTER
  LEFT JOIN SQ_Shortcut_to_OMS_PURCHASE_ORDERS_ATTRIBUTE_27 DETAIL ON MASTER.OMS_PURCHASE_ORDERS_ID = DETAIL.OMS_PURCHASE_ORDERS_ID"""

df_34 = spark.sql(query_34)

df_34.createOrReplaceTempView("JNR_PO_ATTR_34")

# COMMAND ----------
# DBTITLE 1, Jnr_Facility_Orig_35


query_35 = f"""SELECT
  DETAIL.PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  DETAIL.CREATION_TYPE AS CREATION_TYPE,
  DETAIL.PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  DETAIL.PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  DETAIL.TC_COMPANY_ID AS TC_COMPANY_ID,
  DETAIL.TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  DETAIL.PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  DETAIL.O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  DETAIL.D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  DETAIL.BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  DETAIL.ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.PICKUP_TZ AS PICKUP_TZ,
  DETAIL.DELIVERY_TZ AS DELIVERY_TZ,
  DETAIL.PICKUP_START_DTTM AS PICKUP_START_DTTM,
  DETAIL.PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DETAIL.DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DETAIL.DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  DETAIL.REQUESTED_DLVR_DTTM AS REQUESTED_DLVR_DTTM,
  DETAIL.MUST_DLVR_DTTM AS MUST_DLVR_DTTM,
  DETAIL.PROMISED_DLVR_DTTM AS PROMISED_DLVR_DTTM,
  DETAIL.DUE_DT AS DUE_DT,
  DETAIL.PURCHASE_ORDERS_DATE_DTTM AS PURCHASE_ORDERS_DATE_DTTM,
  DETAIL.RELEASE_DTTM AS RELEASE_DTTM,
  DETAIL.FIRST_RCPT_DTTM AS FIRST_RCPT_DTTM,
  DETAIL.LAST_RCPT_DTTM AS LAST_RCPT_DTTM,
  DETAIL.PAYMENT_MODE AS PAYMENT_MODE,
  DETAIL.MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.CURRENCY_CODE AS CURRENCY_CODE,
  DETAIL.ORIG_BUDG_COST AS ORIG_BUDG_COST,
  DETAIL.BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  DETAIL.BUDG_COST AS BUDG_COST,
  DETAIL.TAX_CHARGES AS TAX_CHARGES,
  DETAIL.MISC_CHARGES AS MISC_CHARGES,
  DETAIL.IS_CANCELLED AS IS_CANCELLED,
  DETAIL.IS_IMPORTED AS IS_IMPORTED,
  DETAIL.HAS_ALERTS_FLAG AS HAS_ALERTS,
  DETAIL.IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  DETAIL.IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  DETAIL.IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  DETAIL.BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  DETAIL.TRANS_RESP_CODE AS TRANS_RESP_CODE,
  DETAIL.COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  DETAIL.CARRIER_ID AS CARRIER_ID,
  DETAIL.PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  DETAIL.PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DETAIL.DECLINE_REASON_ID AS DECLINE_REASON_ID,
  DETAIL.CHANNEL_TYPE AS CHANNEL_TYPE,
  DETAIL.ENTERED_BY AS ENTERED_BY,
  DETAIL.CUSTOMER_CODE AS CUSTOMER_CODE,
  DETAIL.CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  DETAIL.CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  DETAIL.CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  DETAIL.CUSTOMER_PHONE AS CUSTOMER_PHONE,
  DETAIL.CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  DETAIL.CREATED_SOURCE AS CREATED_SOURCE,
  DETAIL.CREATED_DTTM AS CREATED_DTTM,
  DETAIL.LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.IS_CLOSED AS IS_CLOSED,
  DETAIL.GRAND_TOTAL AS GRAND_TOTAL,
  DETAIL.ORDER_CATEGORY AS ORDER_CATEGORY,
  DETAIL.CHANNEL_ID AS CHANNEL_ID,
  DETAIL.FULFILL_MODE AS FULFILL_MODE,
  DETAIL.ENTRY_CODE AS ENTRY_CODE,
  DETAIL.PAYMENT_STATUS AS PAYMENT_STATUS,
  DETAIL.REASON_ID AS REASON_ID,
  DETAIL.ORDER_RECEIVED AS ORDER_RECEIVED,
  DETAIL.FREIGHT_REVENUE AS FREIGHT_REVENUE,
  DETAIL.REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  DETAIL.RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  DETAIL.O_FACILITY_ID AS O_FACILITY_ID,
  DETAIL.D_FACILITY_ID AS D_FACILITY_ID,
  MASTER.OMS_FACILITY_ID AS FACILITY_ID,
  MASTER.FACILITY_TYPE_BITS AS FACILITY_TYPE_BITS,
  DETAIL.ON_HOLD AS ON_HOLD,
  DETAIL.DeviceType AS DeviceType,
  DETAIL.ScreenWidth AS ScreenWidth,
  DETAIL.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_FACILITY1_3 MASTER
  RIGHT JOIN JNR_PO_ATTR_34 DETAIL ON MASTER.OMS_FACILITY_ID = DETAIL.O_FACILITY_ID"""

df_35 = spark.sql(query_35)

df_35.createOrReplaceTempView("Jnr_Facility_Orig_35")

# COMMAND ----------
# DBTITLE 1, Jnr_Facility_Destination_36


query_36 = f"""SELECT
  DETAIL.PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  DETAIL.CREATION_TYPE AS CREATION_TYPE,
  DETAIL.PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  DETAIL.PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  DETAIL.TC_COMPANY_ID AS TC_COMPANY_ID,
  DETAIL.TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  DETAIL.PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  DETAIL.O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  DETAIL.D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  DETAIL.BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  DETAIL.ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.PICKUP_TZ AS PICKUP_TZ,
  DETAIL.DELIVERY_TZ AS DELIVERY_TZ,
  DETAIL.PICKUP_START_DTTM AS PICKUP_START_DTTM,
  DETAIL.PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DETAIL.DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DETAIL.DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  DETAIL.REQUESTED_DLVR_DTTM AS REQUESTED_DLVR_DTTM,
  DETAIL.MUST_DLVR_DTTM AS MUST_DLVR_DTTM,
  DETAIL.PROMISED_DLVR_DTTM AS PROMISED_DLVR_DTTM,
  DETAIL.DUE_DT AS DUE_DT,
  DETAIL.PURCHASE_ORDERS_DATE_DTTM AS PURCHASE_ORDERS_DATE_DTTM,
  DETAIL.RELEASE_DTTM AS RELEASE_DTTM,
  DETAIL.FIRST_RCPT_DTTM AS FIRST_RCPT_DTTM,
  DETAIL.LAST_RCPT_DTTM AS LAST_RCPT_DTTM,
  DETAIL.PAYMENT_MODE AS PAYMENT_MODE,
  DETAIL.MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.CURRENCY_CODE AS CURRENCY_CODE,
  DETAIL.ORIG_BUDG_COST AS ORIG_BUDG_COST,
  DETAIL.BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  DETAIL.BUDG_COST AS BUDG_COST,
  DETAIL.TAX_CHARGES AS TAX_CHARGES,
  DETAIL.MISC_CHARGES AS MISC_CHARGES,
  DETAIL.IS_CANCELLED AS IS_CANCELLED,
  DETAIL.IS_IMPORTED AS IS_IMPORTED,
  DETAIL.HAS_ALERTS AS HAS_ALERTS,
  DETAIL.IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  DETAIL.IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  DETAIL.IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  DETAIL.BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  DETAIL.TRANS_RESP_CODE AS TRANS_RESP_CODE,
  DETAIL.COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  DETAIL.CARRIER_ID AS CARRIER_ID,
  DETAIL.PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  DETAIL.PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DETAIL.DECLINE_REASON_ID AS DECLINE_REASON_ID,
  DETAIL.CHANNEL_TYPE AS CHANNEL_TYPE,
  DETAIL.ENTERED_BY AS ENTERED_BY,
  DETAIL.CUSTOMER_CODE AS CUSTOMER_CODE,
  DETAIL.CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  DETAIL.CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  DETAIL.CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  DETAIL.CUSTOMER_PHONE AS CUSTOMER_PHONE,
  DETAIL.CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  DETAIL.CREATED_SOURCE AS CREATED_SOURCE,
  DETAIL.CREATED_DTTM AS CREATED_DTTM,
  DETAIL.LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.IS_CLOSED AS IS_CLOSED,
  DETAIL.GRAND_TOTAL AS GRAND_TOTAL,
  DETAIL.ORDER_CATEGORY AS ORDER_CATEGORY,
  DETAIL.CHANNEL_ID AS CHANNEL_ID,
  DETAIL.FULFILL_MODE AS FULFILL_MODE,
  DETAIL.ENTRY_CODE AS ENTRY_CODE,
  DETAIL.PAYMENT_STATUS AS PAYMENT_STATUS,
  DETAIL.REASON_ID AS REASON_ID,
  DETAIL.ORDER_RECEIVED AS ORDER_RECEIVED,
  DETAIL.FREIGHT_REVENUE AS FREIGHT_REVENUE,
  DETAIL.REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  DETAIL.RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  DETAIL.D_FACILITY_ID AS D_FACILITY_ID,
  DETAIL.FACILITY_TYPE_BITS AS ORIG_FACILITY_TYPE_BITS,
  MASTER.OMS_FACILITY_ID AS FACILITY_ID1,
  MASTER.FACILITY_TYPE_BITS AS DEST_FACILITY_TYPE_BITS,
  DETAIL.ON_HOLD AS ON_HOLD,
  DETAIL.DeviceType AS DeviceType,
  DETAIL.ScreenWidth AS ScreenWidth,
  DETAIL.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_FACILITY_5 MASTER
  RIGHT JOIN Jnr_Facility_Orig_35 DETAIL ON MASTER.OMS_FACILITY_ID = DETAIL.D_FACILITY_ID"""

df_36 = spark.sql(query_36)

df_36.createOrReplaceTempView("Jnr_Facility_Destination_36")

# COMMAND ----------
# DBTITLE 1, JNR_PO_POL_37


query_37 = f"""SELECT
  DETAIL.PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  DETAIL.CREATION_TYPE AS CREATION_TYPE,
  DETAIL.PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  DETAIL.PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  DETAIL.TC_COMPANY_ID AS TC_COMPANY_ID,
  DETAIL.TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  DETAIL.PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  DETAIL.O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  DETAIL.D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  DETAIL.BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  DETAIL.ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.PICKUP_TZ AS PICKUP_TZ,
  DETAIL.DELIVERY_TZ AS DELIVERY_TZ,
  DETAIL.PICKUP_START_DTTM AS PICKUP_START_DTTM,
  DETAIL.PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DETAIL.DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DETAIL.DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  DETAIL.REQUESTED_DLVR_DTTM AS REQUESTED_DLVR_DTTM,
  DETAIL.MUST_DLVR_DTTM AS MUST_DLVR_DTTM,
  DETAIL.PROMISED_DLVR_DTTM AS PROMISED_DLVR_DTTM,
  DETAIL.DUE_DT AS DUE_DT,
  DETAIL.PURCHASE_ORDERS_DATE_DTTM AS PURCHASE_ORDERS_DATE_DTTM,
  DETAIL.RELEASE_DTTM AS RELEASE_DTTM,
  DETAIL.FIRST_RCPT_DTTM AS FIRST_RCPT_DTTM,
  DETAIL.LAST_RCPT_DTTM AS LAST_RCPT_DTTM,
  DETAIL.PAYMENT_MODE AS PAYMENT_MODE,
  DETAIL.MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.CURRENCY_CODE AS CURRENCY_CODE,
  DETAIL.ORIG_BUDG_COST AS ORIG_BUDG_COST,
  DETAIL.BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  DETAIL.BUDG_COST AS BUDG_COST,
  DETAIL.TAX_CHARGES AS TAX_CHARGES,
  DETAIL.MISC_CHARGES AS MISC_CHARGES,
  DETAIL.IS_CANCELLED AS IS_CANCELLED,
  DETAIL.IS_IMPORTED AS IS_IMPORTED,
  DETAIL.HAS_ALERTS AS HAS_ALERTS,
  DETAIL.IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  DETAIL.IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  DETAIL.IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  DETAIL.BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  DETAIL.TRANS_RESP_CODE AS TRANS_RESP_CODE,
  DETAIL.COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  DETAIL.CARRIER_ID AS CARRIER_ID,
  DETAIL.PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  DETAIL.PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DETAIL.DECLINE_REASON_ID AS DECLINE_REASON_ID,
  DETAIL.CHANNEL_TYPE AS CHANNEL_TYPE,
  DETAIL.ENTERED_BY AS ENTERED_BY,
  DETAIL.CUSTOMER_CODE AS CUSTOMER_CODE,
  DETAIL.CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  DETAIL.CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  DETAIL.CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  DETAIL.CUSTOMER_PHONE AS CUSTOMER_PHONE,
  DETAIL.CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  DETAIL.CREATED_SOURCE AS CREATED_SOURCE,
  DETAIL.CREATED_DTTM AS CREATED_DTTM,
  DETAIL.LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.IS_CLOSED AS IS_CLOSED,
  DETAIL.GRAND_TOTAL AS GRAND_TOTAL,
  DETAIL.ORDER_CATEGORY AS ORDER_CATEGORY,
  DETAIL.CHANNEL_ID AS CHANNEL_ID,
  DETAIL.FULFILL_MODE AS FULFILL_MODE,
  DETAIL.ENTRY_CODE AS ENTRY_CODE,
  DETAIL.PAYMENT_STATUS AS PAYMENT_STATUS,
  DETAIL.REASON_ID AS REASON_ID,
  DETAIL.ORDER_RECEIVED AS ORDER_RECEIVED,
  DETAIL.FREIGHT_REVENUE AS FREIGHT_REVENUE,
  DETAIL.REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  DETAIL.RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  MASTER.PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID1,
  MASTER.MAX_IS_CANCELLED AS MAX_IS_CANCELLED,
  MASTER.MIN_IS_CANCELLED AS MIN_IS_CANCELLED,
  DETAIL.ORIG_FACILITY_TYPE_BITS AS ORIG_FACILITY_TYPE_BITS,
  DETAIL.DEST_FACILITY_TYPE_BITS AS DEST_FACILITY_TYPE_BITS,
  DETAIL.ON_HOLD AS ON_HOLD,
  DETAIL.DeviceType AS DeviceType,
  DETAIL.ScreenWidth AS ScreenWidth,
  MASTER.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  AGG_IS_CANCELLED_31 MASTER
  INNER JOIN Jnr_Facility_Destination_36 DETAIL ON MASTER.PURCHASE_ORDERS_ID = DETAIL.PURCHASE_ORDERS_ID"""

df_37 = spark.sql(query_37)

df_37.createOrReplaceTempView("JNR_PO_POL_37")

# COMMAND ----------
# DBTITLE 1, JNR_MO_38


query_38 = f"""SELECT
  DETAIL.PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  DETAIL.CREATION_TYPE AS CREATION_TYPE,
  DETAIL.PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  DETAIL.PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  DETAIL.TC_COMPANY_ID AS TC_COMPANY_ID,
  DETAIL.TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  DETAIL.PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  DETAIL.O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  DETAIL.D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  DETAIL.BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  DETAIL.ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.PICKUP_TZ AS PICKUP_TZ,
  DETAIL.DELIVERY_TZ AS DELIVERY_TZ,
  DETAIL.PICKUP_START_DTTM AS PICKUP_START_DTTM,
  DETAIL.PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DETAIL.DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DETAIL.DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  DETAIL.REQUESTED_DLVR_DTTM AS REQUESTED_DLVR_DTTM,
  DETAIL.MUST_DLVR_DTTM AS MUST_DLVR_DTTM,
  DETAIL.PROMISED_DLVR_DTTM AS PROMISED_DLVR_DTTM,
  DETAIL.DUE_DT AS DUE_DT,
  DETAIL.PURCHASE_ORDERS_DATE_DTTM AS PURCHASE_ORDERS_DATE_DTTM,
  DETAIL.RELEASE_DTTM AS RELEASE_DTTM,
  DETAIL.FIRST_RCPT_DTTM AS FIRST_RCPT_DTTM,
  DETAIL.LAST_RCPT_DTTM AS LAST_RCPT_DTTM,
  DETAIL.PAYMENT_MODE AS PAYMENT_MODE,
  DETAIL.MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.CURRENCY_CODE AS CURRENCY_CODE,
  DETAIL.ORIG_BUDG_COST AS ORIG_BUDG_COST,
  DETAIL.BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  DETAIL.BUDG_COST AS BUDG_COST,
  DETAIL.TAX_CHARGES AS TAX_CHARGES,
  DETAIL.MISC_CHARGES AS MISC_CHARGES,
  DETAIL.IS_CANCELLED AS IS_CANCELLED,
  DETAIL.IS_IMPORTED AS IS_IMPORTED,
  DETAIL.HAS_ALERTS AS HAS_ALERTS,
  DETAIL.IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  DETAIL.IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  DETAIL.IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  DETAIL.BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  DETAIL.TRANS_RESP_CODE AS TRANS_RESP_CODE,
  DETAIL.COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  DETAIL.CARRIER_ID AS CARRIER_ID,
  DETAIL.PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  DETAIL.PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DETAIL.DECLINE_REASON_ID AS DECLINE_REASON_ID,
  DETAIL.CHANNEL_TYPE AS CHANNEL_TYPE,
  DETAIL.ENTERED_BY AS ENTERED_BY,
  DETAIL.CUSTOMER_CODE AS CUSTOMER_CODE,
  DETAIL.CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  DETAIL.CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  DETAIL.CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  DETAIL.CUSTOMER_PHONE AS CUSTOMER_PHONE,
  DETAIL.CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  DETAIL.CREATED_SOURCE AS CREATED_SOURCE,
  DETAIL.CREATED_DTTM AS CREATED_DTTM,
  DETAIL.LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.IS_CLOSED AS IS_CLOSED,
  DETAIL.GRAND_TOTAL AS GRAND_TOTAL,
  DETAIL.ORDER_CATEGORY AS ORDER_CATEGORY,
  DETAIL.CHANNEL_ID AS CHANNEL_ID,
  DETAIL.FULFILL_MODE AS FULFILL_MODE,
  DETAIL.ENTRY_CODE AS ENTRY_CODE,
  DETAIL.PAYMENT_STATUS AS PAYMENT_STATUS,
  DETAIL.REASON_ID AS REASON_ID,
  DETAIL.ORDER_RECEIVED AS ORDER_RECEIVED,
  DETAIL.FREIGHT_REVENUE AS FREIGHT_REVENUE,
  DETAIL.REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  DETAIL.RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  DETAIL.MAX_IS_CANCELLED AS MAX_IS_CANCELLED,
  DETAIL.MIN_IS_CANCELLED AS MIN_IS_CANCELLED,
  MASTER.PURCHASE_ORDERS_ID AS mo_PURCHASE_ORDERS_ID,
  MASTER.ORDER_NBR AS ORDER_NBR,
  MASTER.ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  DETAIL.ORIG_FACILITY_TYPE_BITS AS ORIG_FACILITY_TYPE_BITS,
  DETAIL.DEST_FACILITY_TYPE_BITS AS DEST_FACILITY_TYPE_BITS,
  DETAIL.ON_HOLD AS ON_HOLD,
  DETAIL.DeviceType AS DeviceType,
  DETAIL.ScreenWidth AS ScreenWidth,
  MASTER.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_EDW_LOAD_CTRL_PRE_16 MASTER
  INNER JOIN JNR_PO_POL_37 DETAIL ON MASTER.PURCHASE_ORDERS_ID = DETAIL.PURCHASE_ORDERS_ID"""

df_38 = spark.sql(query_38)

df_38.createOrReplaceTempView("JNR_MO_38")

# COMMAND ----------
# DBTITLE 1, JNR_TAX_AMOUNT_39


query_39 = f"""SELECT
  DETAIL.PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  DETAIL.CREATION_TYPE AS CREATION_TYPE,
  DETAIL.PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  DETAIL.PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  DETAIL.TC_COMPANY_ID AS TC_COMPANY_ID,
  DETAIL.TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  DETAIL.PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  DETAIL.O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  DETAIL.D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  DETAIL.BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  DETAIL.ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.PICKUP_TZ AS PICKUP_TZ,
  DETAIL.DELIVERY_TZ AS DELIVERY_TZ,
  DETAIL.PICKUP_START_DTTM AS PICKUP_START_DTTM,
  DETAIL.PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DETAIL.DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DETAIL.DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  DETAIL.REQUESTED_DLVR_DTTM AS REQUESTED_DLVR_DTTM,
  DETAIL.MUST_DLVR_DTTM AS MUST_DLVR_DTTM,
  DETAIL.PROMISED_DLVR_DTTM AS PROMISED_DLVR_DTTM,
  DETAIL.DUE_DT AS DUE_DT,
  DETAIL.PURCHASE_ORDERS_DATE_DTTM AS PURCHASE_ORDERS_DATE_DTTM,
  DETAIL.RELEASE_DTTM AS RELEASE_DTTM,
  DETAIL.FIRST_RCPT_DTTM AS FIRST_RCPT_DTTM,
  DETAIL.LAST_RCPT_DTTM AS LAST_RCPT_DTTM,
  DETAIL.PAYMENT_MODE AS PAYMENT_MODE,
  DETAIL.MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.CURRENCY_CODE AS CURRENCY_CODE,
  DETAIL.ORIG_BUDG_COST AS ORIG_BUDG_COST,
  DETAIL.BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  DETAIL.BUDG_COST AS BUDG_COST,
  DETAIL.TAX_CHARGES AS TAX_CHARGES,
  DETAIL.MISC_CHARGES AS MISC_CHARGES,
  DETAIL.IS_CANCELLED AS IS_CANCELLED,
  DETAIL.IS_IMPORTED AS IS_IMPORTED,
  DETAIL.HAS_ALERTS AS HAS_ALERTS,
  DETAIL.IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  DETAIL.IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  DETAIL.IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  DETAIL.BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  DETAIL.TRANS_RESP_CODE AS TRANS_RESP_CODE,
  DETAIL.COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  DETAIL.CARRIER_ID AS CARRIER_ID,
  DETAIL.PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  DETAIL.PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DETAIL.DECLINE_REASON_ID AS DECLINE_REASON_ID,
  DETAIL.CHANNEL_TYPE AS CHANNEL_TYPE,
  DETAIL.ENTERED_BY AS ENTERED_BY,
  DETAIL.CUSTOMER_CODE AS CUSTOMER_CODE,
  DETAIL.CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  DETAIL.CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  DETAIL.CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  DETAIL.CUSTOMER_PHONE AS CUSTOMER_PHONE,
  DETAIL.CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  DETAIL.CREATED_SOURCE AS CREATED_SOURCE,
  DETAIL.CREATED_DTTM AS CREATED_DTTM,
  DETAIL.LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.IS_CLOSED AS IS_CLOSED,
  DETAIL.GRAND_TOTAL AS GRAND_TOTAL,
  DETAIL.ORDER_CATEGORY AS ORDER_CATEGORY,
  DETAIL.CHANNEL_ID AS CHANNEL_ID,
  DETAIL.FULFILL_MODE AS FULFILL_MODE,
  DETAIL.ENTRY_CODE AS ENTRY_CODE,
  DETAIL.PAYMENT_STATUS AS PAYMENT_STATUS,
  DETAIL.REASON_ID AS REASON_ID,
  DETAIL.ORDER_RECEIVED AS ORDER_RECEIVED,
  DETAIL.FREIGHT_REVENUE AS FREIGHT_REVENUE,
  DETAIL.REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  DETAIL.RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  DETAIL.MAX_IS_CANCELLED AS MAX_IS_CANCELLED,
  DETAIL.MIN_IS_CANCELLED AS MIN_IS_CANCELLED,
  DETAIL.ORDER_NBR AS ORDER_NBR,
  DETAIL.ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  MASTER.ENTITY_ID AS ENTITY_ID,
  MASTER.TAX_AMOUNT AS TAX_AMOUNT,
  DETAIL.ORIG_FACILITY_TYPE_BITS AS ORIG_FACILITY_TYPE_BITS,
  DETAIL.DEST_FACILITY_TYPE_BITS AS DEST_FACILITY_TYPE_BITS,
  DETAIL.ON_HOLD AS ON_HOLD,
  DETAIL.DeviceType AS DeviceType,
  DETAIL.ScreenWidth AS ScreenWidth,
  DETAIL.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  AGGTRANS_20 MASTER
  RIGHT JOIN JNR_MO_38 DETAIL ON MASTER.ENTITY_ID = DETAIL.PURCHASE_ORDERS_ID"""

df_39 = spark.sql(query_39)

df_39.createOrReplaceTempView("JNR_TAX_AMOUNT_39")

# COMMAND ----------
# DBTITLE 1, Jnr_PO_PD_40


query_40 = f"""SELECT
  DETAIL.PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  DETAIL.CREATION_TYPE AS CREATION_TYPE,
  DETAIL.PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  DETAIL.PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  DETAIL.TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  DETAIL.PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  DETAIL.O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  DETAIL.D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  DETAIL.BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  DETAIL.ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.PICKUP_TZ AS PICKUP_TZ,
  DETAIL.DELIVERY_TZ AS DELIVERY_TZ,
  DETAIL.PICKUP_START_DTTM AS PICKUP_START_DTTM,
  DETAIL.PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DETAIL.DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DETAIL.DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  DETAIL.REQUESTED_DLVR_DTTM AS REQUESTED_DLVR_DTTM,
  DETAIL.MUST_DLVR_DTTM AS MUST_DLVR_DTTM,
  DETAIL.PROMISED_DLVR_DTTM AS PROMISED_DLVR_DTTM,
  DETAIL.DUE_DT AS DUE_DT,
  DETAIL.PURCHASE_ORDERS_DATE_DTTM AS PURCHASE_ORDERS_DATE_DTTM,
  DETAIL.RELEASE_DTTM AS RELEASE_DTTM,
  DETAIL.FIRST_RCPT_DTTM AS FIRST_RCPT_DTTM,
  DETAIL.LAST_RCPT_DTTM AS LAST_RCPT_DTTM,
  DETAIL.PAYMENT_MODE AS PAYMENT_MODE,
  DETAIL.MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.CURRENCY_CODE AS CURRENCY_CODE,
  DETAIL.ORIG_BUDG_COST AS ORIG_BUDG_COST,
  DETAIL.BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  DETAIL.BUDG_COST AS BUDG_COST,
  DETAIL.TAX_CHARGES AS TAX_CHARGES,
  DETAIL.MISC_CHARGES AS MISC_CHARGES,
  DETAIL.IS_CANCELLED AS IS_CANCELLED,
  DETAIL.IS_IMPORTED AS IS_IMPORTED,
  DETAIL.HAS_ALERTS AS HAS_ALERTS,
  DETAIL.IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  DETAIL.IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  DETAIL.IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  DETAIL.BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  DETAIL.TRANS_RESP_CODE AS TRANS_RESP_CODE,
  DETAIL.COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  DETAIL.CARRIER_ID AS CARRIER_ID,
  DETAIL.PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  DETAIL.PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DETAIL.DECLINE_REASON_ID AS DECLINE_REASON_ID,
  DETAIL.CHANNEL_TYPE AS CHANNEL_TYPE,
  DETAIL.ENTERED_BY AS ENTERED_BY,
  DETAIL.CUSTOMER_CODE AS CUSTOMER_CODE,
  DETAIL.CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  DETAIL.CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  DETAIL.CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  DETAIL.CUSTOMER_PHONE AS CUSTOMER_PHONE,
  DETAIL.CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  DETAIL.CREATED_SOURCE AS CREATED_SOURCE,
  DETAIL.CREATED_DTTM AS CREATED_DTTM,
  DETAIL.LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.IS_CLOSED AS IS_CLOSED,
  DETAIL.GRAND_TOTAL AS GRAND_TOTAL,
  DETAIL.ORDER_CATEGORY AS ORDER_CATEGORY,
  DETAIL.CHANNEL_ID AS CHANNEL_ID,
  DETAIL.FULFILL_MODE AS FULFILL_MODE,
  DETAIL.ENTRY_CODE AS ENTRY_CODE,
  DETAIL.PAYMENT_STATUS AS PAYMENT_STATUS,
  DETAIL.REASON_ID AS REASON_ID,
  DETAIL.ORDER_RECEIVED AS ORDER_RECEIVED,
  DETAIL.FREIGHT_REVENUE AS FREIGHT_REVENUE,
  DETAIL.REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  DETAIL.RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  DETAIL.MAX_IS_CANCELLED AS MAX_IS_CANCELLED,
  DETAIL.MIN_IS_CANCELLED AS MIN_IS_CANCELLED,
  DETAIL.ORDER_NBR AS ORDER_NBR,
  DETAIL.ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  DETAIL.TAX_AMOUNT AS TAX_AMOUNT,
  MASTER.OMS_PAYMENT_DETAIL_ID AS PAYMENT_DETAIL_ID,
  MASTER.OMS_ENTITY_ID AS ENTITY_ID,
  MASTER.BILL_TO_FIRST_NAME AS BILL_TO_FIRST_NAME,
  MASTER.BILL_TO_LAST_NAME AS BILL_TO_LAST_NAME,
  MASTER.BILL_TO_ADDR_LINE1 AS BILL_TO_ADDRESS_LINE1,
  MASTER.BILL_TO_ADDR_LINE2 AS BILL_TO_ADDRESS_LINE2,
  MASTER.BILL_TO_CITY AS BILL_TO_CITY,
  MASTER.BILL_TO_STATE_PROV AS BILLTO_STATE_PROV,
  MASTER.BILL_TO_POSTAL_CD AS BILL_TO_POSTAL_CODE,
  MASTER.BILL_TO_COUNTRY_CD AS BILL_TO_COUNTRY_CODE,
  MASTER.BILL_TO_PHONE_NBR AS BILL_TO_PHONE_NUMBER,
  MASTER.BILL_TO_EMAIL AS BILL_TO_EMAIL,
  DETAIL.TC_COMPANY_ID AS TC_COMPANY_ID,
  DETAIL.ORIG_FACILITY_TYPE_BITS AS ORIG_FACILITY_TYPE_BITS,
  DETAIL.DEST_FACILITY_TYPE_BITS AS DEST_FACILITY_TYPE_BITS,
  DETAIL.ON_HOLD AS ON_HOLD,
  DETAIL.DeviceType AS DeviceType,
  DETAIL.ScreenWidth AS ScreenWidth,
  DETAIL.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_A_PAYMENT_DETAIL1_14 MASTER
  RIGHT JOIN JNR_TAX_AMOUNT_39 DETAIL ON MASTER.OMS_ENTITY_ID = DETAIL.PURCHASE_ORDERS_ID"""

df_40 = spark.sql(query_40)

df_40.createOrReplaceTempView("Jnr_PO_PD_40")

# COMMAND ----------
# DBTITLE 1, Jnr_PD1_PD2_41


query_41 = f"""SELECT
  DETAIL.PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  DETAIL.CREATION_TYPE AS CREATION_TYPE,
  DETAIL.PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  DETAIL.PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  DETAIL.TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  DETAIL.PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  DETAIL.O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  DETAIL.D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  DETAIL.BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  DETAIL.ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.PICKUP_TZ AS PICKUP_TZ,
  DETAIL.DELIVERY_TZ AS DELIVERY_TZ,
  DETAIL.PICKUP_START_DTTM AS PICKUP_START_DTTM,
  DETAIL.PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DETAIL.DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DETAIL.DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  DETAIL.REQUESTED_DLVR_DTTM AS REQUESTED_DLVR_DTTM,
  DETAIL.MUST_DLVR_DTTM AS MUST_DLVR_DTTM,
  DETAIL.PROMISED_DLVR_DTTM AS PROMISED_DLVR_DTTM,
  DETAIL.DUE_DT AS DUE_DT,
  DETAIL.PURCHASE_ORDERS_DATE_DTTM AS PURCHASE_ORDERS_DATE_DTTM,
  DETAIL.RELEASE_DTTM AS RELEASE_DTTM,
  DETAIL.FIRST_RCPT_DTTM AS FIRST_RCPT_DTTM,
  DETAIL.LAST_RCPT_DTTM AS LAST_RCPT_DTTM,
  DETAIL.PAYMENT_MODE AS PAYMENT_MODE,
  DETAIL.MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.CURRENCY_CODE AS CURRENCY_CODE,
  DETAIL.ORIG_BUDG_COST AS ORIG_BUDG_COST,
  DETAIL.BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  DETAIL.BUDG_COST AS BUDG_COST,
  DETAIL.TAX_CHARGES AS TAX_CHARGES,
  DETAIL.MISC_CHARGES AS MISC_CHARGES,
  DETAIL.IS_CANCELLED AS IS_CANCELLED,
  DETAIL.IS_IMPORTED AS IS_IMPORTED,
  DETAIL.HAS_ALERTS AS HAS_ALERTS,
  DETAIL.IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  DETAIL.IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  DETAIL.IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  DETAIL.BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  DETAIL.TRANS_RESP_CODE AS TRANS_RESP_CODE,
  DETAIL.COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  DETAIL.CARRIER_ID AS CARRIER_ID,
  DETAIL.PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  DETAIL.PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DETAIL.DECLINE_REASON_ID AS DECLINE_REASON_ID,
  DETAIL.CHANNEL_TYPE AS CHANNEL_TYPE,
  DETAIL.ENTERED_BY AS ENTERED_BY,
  DETAIL.CUSTOMER_CODE AS CUSTOMER_CODE,
  DETAIL.CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  DETAIL.CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  DETAIL.CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  DETAIL.CUSTOMER_PHONE AS CUSTOMER_PHONE,
  DETAIL.CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  DETAIL.CREATED_SOURCE AS CREATED_SOURCE,
  DETAIL.CREATED_DTTM AS CREATED_DTTM,
  DETAIL.LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.IS_CLOSED AS IS_CLOSED,
  DETAIL.GRAND_TOTAL AS GRAND_TOTAL,
  DETAIL.ORDER_CATEGORY AS ORDER_CATEGORY,
  DETAIL.CHANNEL_ID AS CHANNEL_ID,
  DETAIL.FULFILL_MODE AS FULFILL_MODE,
  DETAIL.ENTRY_CODE AS ENTRY_CODE,
  DETAIL.PAYMENT_STATUS AS PAYMENT_STATUS,
  DETAIL.REASON_ID AS REASON_ID,
  DETAIL.ORDER_RECEIVED AS ORDER_RECEIVED,
  DETAIL.FREIGHT_REVENUE AS FREIGHT_REVENUE,
  DETAIL.REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  DETAIL.RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  DETAIL.MAX_IS_CANCELLED AS MAX_IS_CANCELLED,
  DETAIL.MIN_IS_CANCELLED AS MIN_IS_CANCELLED,
  DETAIL.ORDER_NBR AS ORDER_NBR,
  DETAIL.ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  DETAIL.TAX_AMOUNT AS TAX_AMOUNT,
  DETAIL.PAYMENT_DETAIL_ID AS PAYMENT_DETAIL_ID,
  DETAIL.ENTITY_ID AS ENTITY_ID,
  DETAIL.BILL_TO_FIRST_NAME AS BILL_TO_FIRST_NAME,
  DETAIL.BILL_TO_LAST_NAME AS BILL_TO_LAST_NAME,
  DETAIL.BILL_TO_ADDRESS_LINE1 AS BILL_TO_ADDRESS_LINE1,
  DETAIL.BILL_TO_ADDRESS_LINE2 AS BILL_TO_ADDRESS_LINE2,
  DETAIL.BILL_TO_CITY AS BILL_TO_CITY,
  DETAIL.BILLTO_STATE_PROV AS BILLTO_STATE_PROV,
  DETAIL.BILL_TO_POSTAL_CODE AS BILL_TO_POSTAL_CODE,
  DETAIL.BILL_TO_COUNTRY_CODE AS BILL_TO_COUNTRY_CODE,
  DETAIL.BILL_TO_PHONE_NUMBER AS BILL_TO_PHONE_NUMBER,
  DETAIL.BILL_TO_EMAIL AS BILL_TO_EMAIL,
  MASTER.PAYMENT_DETAIL_ID1 AS PAYMENT_DETAIL_ID1,
  MASTER.LAST_UPDATED_DTTM1 AS LAST_UPDATED_DTTM1,
  MASTER.AFTERPAY_FLG AS AFTERPAY_FLG,
  DETAIL.TC_COMPANY_ID AS TC_COMPANY_ID,
  DETAIL.ORIG_FACILITY_TYPE_BITS AS ORIG_FACILITY_TYPE_BITS,
  DETAIL.DEST_FACILITY_TYPE_BITS AS DEST_FACILITY_TYPE_BITS,
  DETAIL.ON_HOLD AS ON_HOLD,
  DETAIL.DeviceType AS DeviceType,
  DETAIL.ScreenWidth AS ScreenWidth,
  DETAIL.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  AGG_PD_12 MASTER
  RIGHT JOIN Jnr_PO_PD_40 DETAIL ON MASTER.PAYMENT_DETAIL_ID1 = DETAIL.PAYMENT_DETAIL_ID"""

df_41 = spark.sql(query_41)

df_41.createOrReplaceTempView("Jnr_PD1_PD2_41")

# COMMAND ----------
# DBTITLE 1, JNR_REF_FEILDS_42


query_42 = f"""SELECT
  DETAIL.PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  DETAIL.CREATION_TYPE AS CREATION_TYPE,
  DETAIL.PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  DETAIL.PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  DETAIL.TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  DETAIL.PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  DETAIL.O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  DETAIL.D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  DETAIL.BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  DETAIL.ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.PICKUP_TZ AS PICKUP_TZ,
  DETAIL.DELIVERY_TZ AS DELIVERY_TZ,
  DETAIL.PICKUP_START_DTTM AS PICKUP_START_DTTM,
  DETAIL.PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DETAIL.DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DETAIL.DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  DETAIL.REQUESTED_DLVR_DTTM AS REQUESTED_DLVR_DTTM,
  DETAIL.MUST_DLVR_DTTM AS MUST_DLVR_DTTM,
  DETAIL.PROMISED_DLVR_DTTM AS PROMISED_DLVR_DTTM,
  DETAIL.DUE_DT AS DUE_DT,
  DETAIL.PURCHASE_ORDERS_DATE_DTTM AS PURCHASE_ORDERS_DATE_DTTM,
  DETAIL.RELEASE_DTTM AS RELEASE_DTTM,
  DETAIL.FIRST_RCPT_DTTM AS FIRST_RCPT_DTTM,
  DETAIL.LAST_RCPT_DTTM AS LAST_RCPT_DTTM,
  DETAIL.PAYMENT_MODE AS PAYMENT_MODE,
  DETAIL.MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.CURRENCY_CODE AS CURRENCY_CODE,
  DETAIL.ORIG_BUDG_COST AS ORIG_BUDG_COST,
  DETAIL.BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  DETAIL.BUDG_COST AS BUDG_COST,
  DETAIL.TAX_CHARGES AS TAX_CHARGES,
  DETAIL.MISC_CHARGES AS MISC_CHARGES,
  DETAIL.IS_CANCELLED AS IS_CANCELLED,
  DETAIL.IS_IMPORTED AS IS_IMPORTED,
  DETAIL.HAS_ALERTS AS HAS_ALERTS,
  DETAIL.IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  DETAIL.IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  DETAIL.IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  DETAIL.BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  DETAIL.TRANS_RESP_CODE AS TRANS_RESP_CODE,
  DETAIL.COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  DETAIL.CARRIER_ID AS CARRIER_ID,
  DETAIL.PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  DETAIL.PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DETAIL.DECLINE_REASON_ID AS DECLINE_REASON_ID,
  DETAIL.CHANNEL_TYPE AS CHANNEL_TYPE,
  DETAIL.ENTERED_BY AS ENTERED_BY,
  DETAIL.CUSTOMER_CODE AS CUSTOMER_CODE,
  DETAIL.CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  DETAIL.CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  DETAIL.CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  DETAIL.CUSTOMER_PHONE AS CUSTOMER_PHONE,
  DETAIL.CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  DETAIL.CREATED_SOURCE AS CREATED_SOURCE,
  DETAIL.CREATED_DTTM AS CREATED_DTTM,
  DETAIL.LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.IS_CLOSED AS IS_CLOSED,
  DETAIL.GRAND_TOTAL AS GRAND_TOTAL,
  DETAIL.ORDER_CATEGORY AS ORDER_CATEGORY,
  DETAIL.CHANNEL_ID AS CHANNEL_ID,
  DETAIL.FULFILL_MODE AS FULFILL_MODE,
  DETAIL.ENTRY_CODE AS ENTRY_CODE,
  DETAIL.PAYMENT_STATUS AS PAYMENT_STATUS,
  DETAIL.REASON_ID AS REASON_ID,
  DETAIL.ORDER_RECEIVED AS ORDER_RECEIVED,
  DETAIL.FREIGHT_REVENUE AS FREIGHT_REVENUE,
  DETAIL.REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  DETAIL.RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  DETAIL.MAX_IS_CANCELLED AS MAX_IS_CANCELLED,
  DETAIL.MIN_IS_CANCELLED AS MIN_IS_CANCELLED,
  DETAIL.ORDER_NBR AS ORDER_NBR,
  DETAIL.ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  DETAIL.TAX_AMOUNT AS TAX_AMOUNT,
  DETAIL.BILL_TO_FIRST_NAME AS BILL_TO_FIRST_NAME,
  DETAIL.BILL_TO_LAST_NAME AS BILL_TO_LAST_NAME,
  DETAIL.BILL_TO_ADDRESS_LINE1 AS BILL_TO_ADDRESS_LINE1,
  DETAIL.BILL_TO_ADDRESS_LINE2 AS BILL_TO_ADDRESS_LINE2,
  DETAIL.BILL_TO_CITY AS BILL_TO_CITY,
  DETAIL.BILLTO_STATE_PROV AS BILLTO_STATE_PROV,
  DETAIL.BILL_TO_POSTAL_CODE AS BILL_TO_POSTAL_CODE,
  DETAIL.BILL_TO_COUNTRY_CODE AS BILL_TO_COUNTRY_CODE,
  DETAIL.BILL_TO_PHONE_NUMBER AS BILL_TO_PHONE_NUMBER,
  DETAIL.BILL_TO_EMAIL AS BILL_TO_EMAIL,
  DETAIL.AFTERPAY_FLG AS AFTERPAY_FLG,
  MASTER.polr_PURCHASE_ORDERS_ID AS polr_PURCHASE_ORDERS_ID,
  MASTER.SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  MASTER.SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  DETAIL.TC_COMPANY_ID AS TC_COMPANY_ID,
  DETAIL.ORIG_FACILITY_TYPE_BITS AS ORIG_FACILITY_TYPE_BITS,
  DETAIL.DEST_FACILITY_TYPE_BITS AS DEST_FACILITY_TYPE_BITS,
  DETAIL.ON_HOLD AS ON_HOLD,
  DETAIL.DeviceType AS DeviceType,
  DETAIL.ScreenWidth AS ScreenWidth,
  DETAIL.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  AGG_FLAG_25 MASTER
  RIGHT JOIN Jnr_PD1_PD2_41 DETAIL ON MASTER.polr_PURCHASE_ORDERS_ID = DETAIL.PURCHASE_ORDERS_ID"""

df_42 = spark.sql(query_42)

df_42.createOrReplaceTempView("JNR_REF_FEILDS_42")

# COMMAND ----------
# DBTITLE 1, JNR_ACR_43


query_43 = f"""SELECT
  DETAIL.PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  DETAIL.CREATION_TYPE AS CREATION_TYPE,
  DETAIL.PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  DETAIL.PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  DETAIL.TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  DETAIL.PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  DETAIL.O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  DETAIL.D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  DETAIL.BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  DETAIL.ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.PICKUP_TZ AS PICKUP_TZ,
  DETAIL.DELIVERY_TZ AS DELIVERY_TZ,
  DETAIL.PICKUP_START_DTTM AS PICKUP_START_DTTM,
  DETAIL.PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DETAIL.DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DETAIL.DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  DETAIL.REQUESTED_DLVR_DTTM AS REQUESTED_DLVR_DTTM,
  DETAIL.MUST_DLVR_DTTM AS MUST_DLVR_DTTM,
  DETAIL.PROMISED_DLVR_DTTM AS PROMISED_DLVR_DTTM,
  DETAIL.DUE_DT AS DUE_DT,
  DETAIL.PURCHASE_ORDERS_DATE_DTTM AS PURCHASE_ORDERS_DATE_DTTM,
  DETAIL.RELEASE_DTTM AS RELEASE_DTTM,
  DETAIL.FIRST_RCPT_DTTM AS FIRST_RCPT_DTTM,
  DETAIL.LAST_RCPT_DTTM AS LAST_RCPT_DTTM,
  DETAIL.PAYMENT_MODE AS PAYMENT_MODE,
  DETAIL.MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.CURRENCY_CODE AS CURRENCY_CODE,
  DETAIL.ORIG_BUDG_COST AS ORIG_BUDG_COST,
  DETAIL.BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  DETAIL.BUDG_COST AS BUDG_COST,
  DETAIL.TAX_CHARGES AS TAX_CHARGES,
  DETAIL.MISC_CHARGES AS MISC_CHARGES,
  DETAIL.IS_CANCELLED AS IS_CANCELLED,
  DETAIL.IS_IMPORTED AS IS_IMPORTED,
  DETAIL.HAS_ALERTS AS HAS_ALERTS,
  DETAIL.IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  DETAIL.IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  DETAIL.IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  DETAIL.BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  DETAIL.TRANS_RESP_CODE AS TRANS_RESP_CODE,
  DETAIL.COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  DETAIL.CARRIER_ID AS CARRIER_ID,
  DETAIL.PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  DETAIL.PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DETAIL.DECLINE_REASON_ID AS DECLINE_REASON_ID,
  DETAIL.CHANNEL_TYPE AS CHANNEL_TYPE,
  DETAIL.CUSTOMER_CODE AS CUSTOMER_CODE,
  DETAIL.CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  DETAIL.CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  DETAIL.CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  DETAIL.CUSTOMER_PHONE AS CUSTOMER_PHONE,
  DETAIL.CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  DETAIL.CREATED_SOURCE AS CREATED_SOURCE,
  DETAIL.CREATED_DTTM AS CREATED_DTTM,
  DETAIL.LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.IS_CLOSED AS IS_CLOSED,
  DETAIL.GRAND_TOTAL AS GRAND_TOTAL,
  DETAIL.ORDER_CATEGORY AS ORDER_CATEGORY,
  DETAIL.CHANNEL_ID AS CHANNEL_ID,
  DETAIL.FULFILL_MODE AS FULFILL_MODE,
  DETAIL.ENTRY_CODE AS ENTRY_CODE,
  DETAIL.PAYMENT_STATUS AS PAYMENT_STATUS,
  DETAIL.REASON_ID AS REASON_ID,
  DETAIL.ORDER_RECEIVED AS ORDER_RECEIVED,
  DETAIL.FREIGHT_REVENUE AS FREIGHT_REVENUE,
  DETAIL.REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  DETAIL.RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  DETAIL.MAX_IS_CANCELLED AS MAX_IS_CANCELLED,
  DETAIL.MIN_IS_CANCELLED AS MIN_IS_CANCELLED,
  DETAIL.ORDER_NBR AS ORDER_NBR,
  DETAIL.ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  DETAIL.TAX_AMOUNT AS TAX_AMOUNT,
  DETAIL.BILL_TO_FIRST_NAME AS BILL_TO_FIRST_NAME,
  DETAIL.BILL_TO_LAST_NAME AS BILL_TO_LAST_NAME,
  DETAIL.BILL_TO_ADDRESS_LINE1 AS BILL_TO_ADDRESS_LINE1,
  DETAIL.BILL_TO_ADDRESS_LINE2 AS BILL_TO_ADDRESS_LINE2,
  DETAIL.BILL_TO_CITY AS BILL_TO_CITY,
  DETAIL.BILLTO_STATE_PROV AS BILLTO_STATE_PROV,
  DETAIL.BILL_TO_POSTAL_CODE AS BILL_TO_POSTAL_CODE,
  DETAIL.BILL_TO_COUNTRY_CODE AS BILL_TO_COUNTRY_CODE,
  DETAIL.BILL_TO_PHONE_NUMBER AS BILL_TO_PHONE_NUMBER,
  DETAIL.BILL_TO_EMAIL AS BILL_TO_EMAIL,
  DETAIL.AFTERPAY_FLG AS AFTERPAY_FLG,
  DETAIL.SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  DETAIL.SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  MASTER.REASON_CODE_ID AS REASON_CODE_ID,
  MASTER.REASON_CODE AS REASON_CODE,
  DETAIL.TC_COMPANY_ID AS TC_COMPANY_ID,
  DETAIL.ORIG_FACILITY_TYPE_BITS AS ORIG_FACILITY_TYPE_BITS,
  DETAIL.DEST_FACILITY_TYPE_BITS AS DEST_FACILITY_TYPE_BITS,
  DETAIL.ON_HOLD AS ON_HOLD,
  DETAIL.DeviceType AS DeviceType,
  DETAIL.ScreenWidth AS ScreenWidth,
  DETAIL.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  FIL_ACR_8 MASTER
  RIGHT JOIN JNR_REF_FEILDS_42 DETAIL ON MASTER.REASON_CODE_ID = DETAIL.REASON_ID"""

df_43 = spark.sql(query_43)

df_43.createOrReplaceTempView("JNR_ACR_43")

# COMMAND ----------
# DBTITLE 1, EXP_CANCELED_DTTM_44


query_44 = f"""SELECT
  PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  CREATION_TYPE AS o_CREATION_TYPE,
  PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  PICKUP_TZ AS PICKUP_TZ,
  DELIVERY_TZ AS DELIVERY_TZ,
  TRUNC(PICKUP_START_DTTM) AS o_PICKUP_START_DT,
  TRUNC(PICKUP_END_DTTM) AS o_PICKUP_END_DT,
  TRUNC(DELIVERY_START_DTTM) AS o_DELIVERY_START_DT,
  TRUNC(DELIVERY_END_DTTM) AS o_DELIVERY_END_DT,
  TRUNC(REQUESTED_DLVR_DTTM) AS o_REQUESTED_DLVR_DT,
  TRUNC(MUST_DLVR_DTTM) AS o_MUST_DLVR_DT,
  TRUNC(PROMISED_DLVR_DTTM) AS o_PROMISED_DLVR_DT,
  DUE_DT AS DUE_DT,
  TRUNC(PURCHASE_ORDERS_DATE_DTTM) AS o_PURCHASE_ORDERS_DT,
  TRUNC(RELEASE_DTTM) AS o_RELEASE_DT,
  TRUNC(FIRST_RCPT_DTTM) AS o_FIRST_RCPT_DT,
  TRUNC(LAST_RCPT_DTTM) AS o_LAST_RCPT_DT,
  PAYMENT_MODE AS PAYMENT_MODE,
  MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  MONETARY_VALUE AS MONETARY_VALUE,
  CURRENCY_CODE AS CURRENCY_CODE,
  ORIG_BUDG_COST AS ORIG_BUDG_COST,
  BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  BUDG_COST AS BUDG_COST,
  TAX_CHARGES AS TAX_CHARGES,
  MISC_CHARGES AS MISC_CHARGES,
  IS_CANCELLED AS IS_CANCELLED,
  IS_IMPORTED AS IS_IMPORTED,
  IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  TRANS_RESP_CODE AS TRANS_RESP_CODE,
  TO_BIGINT(COMMODITY_CODE_ID) AS o_COMMODITY_CODE_ID,
  TO_BIGINT(CARRIER_ID) AS o_CARRIER_ID,
  PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DECLINE_REASON_ID AS DECLINE_REASON_ID,
  CHANNEL_TYPE AS o_CHANNEL_TYPE,
  CUSTOMER_CODE AS CUSTOMER_CODE,
  CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  CUSTOMER_PHONE AS CUSTOMER_PHONE,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_DTTM AS CREATED_DTTM,
  LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  IS_CLOSED AS IS_CLOSED,
  GRAND_TOTAL AS GRAND_TOTAL,
  ORDER_CATEGORY AS ORDER_CATEGORY,
  TO_BIGINT(CHANNEL_ID) AS o_CHANNEL_ID,
  FULFILL_MODE AS FULFILL_MODE,
  ENTRY_CODE AS ENTRY_CODE,
  PAYMENT_STATUS AS PAYMENT_STATUS,
  REASON_ID AS REASON_ID,
  ORDER_RECEIVED AS ORDER_RECEIVED,
  FREIGHT_REVENUE AS FREIGHT_REVENUE,
  REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  IFF(
    IS_CANCELLED = 0
    AND MAX_IS_CANCELLED = 1
    AND MIN_IS_CANCELLED = 0,
    2,
    IFF(
      IS_CANCELLED = 1
      AND MAX_IS_CANCELLED = 1
      AND MIN_IS_CANCELLED = 1,
      1,
      0
    )
  ) AS CANCELLED_TYPE_ID,
  IFF(
    SUBSTR(TC_PURCHASE_ORDERS_ID, 1, 1) = 'X',
    'X',
    IFF(
      SUBSTR(TC_PURCHASE_ORDERS_ID, 1, 1) != 'X'
      AND NOT ISNULL (PARENT_PURCHASE_ORDERS_ID),
      'R',
      'O'
    )
  ) AS OMS_ORDER_TYPE,
  ORDER_NBR AS ORDER_NBR,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  TAX_AMOUNT AS TAX_AMOUNT,
  BILL_TO_FIRST_NAME AS BILL_TO_FIRST_NAME,
  BILL_TO_LAST_NAME AS BILL_TO_LAST_NAME,
  RTRIM(LTRIM(BILL_TO_ADDRESS_LINE1)) || RTRIM(LTRIM(BILL_TO_ADDRESS_LINE2)) AS BILL_TO_ADDRESS_LINE1,
  BILL_TO_CITY AS BILL_TO_CITY,
  BILLTO_STATE_PROV AS BILLTO_STATE_PROV,
  BILL_TO_POSTAL_CODE AS BILL_TO_POSTAL_CODE,
  BILL_TO_COUNTRY_CODE AS BILL_TO_COUNTRY_CODE,
  BILL_TO_PHONE_NUMBER AS BILL_TO_PHONE_NUMBER,
  BILL_TO_EMAIL AS BILL_TO_EMAIL,
  AFTERPAY_FLG AS AFTERPAY_FLG,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  REASON_CODE AS REASON_CODE,
  IFF (
    IS_CANCELLED = 1
    AND PURCHASE_ORDERS_STATUS = 940,
    LAST_UPDATED_DTTM,
    NULL
  ) AS CANCELLED_DTTM,
  TC_COMPANY_ID AS TC_COMPANY_ID,
  ORIG_FACILITY_TYPE_BITS AS ORIG_FACILITY_TYPE_BITS,
  DEST_FACILITY_TYPE_BITS AS DEST_FACILITY_TYPE_BITS,
  ON_HOLD AS ON_HOLD,
  TO_CHAR(
    IFF (
      ISNULL (LTRIM(RTRIM(DeviceType))),
      'NA',
      UPPER(LTRIM(RTRIM(DeviceType)))
    )
  ) AS DeviceType,
  TO_INTEGER(IFF (ISNULL(ScreenWidth), 0, ScreenWidth)) AS ScreenWidth,
  HAS_ALERTS AS HAS_ALERTS,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  JNR_ACR_43"""

df_44 = spark.sql(query_44)

df_44.createOrReplaceTempView("EXP_CANCELED_DTTM_44")

# COMMAND ----------
# DBTITLE 1, srt_DISTINCT_45


query_45 = f"""SELECT
  PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  o_CREATION_TYPE AS CREATION_TYPE,
  PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  PICKUP_TZ AS PICKUP_TZ,
  DELIVERY_TZ AS DELIVERY_TZ,
  o_PICKUP_START_DT AS PICKUP_START_DTTM,
  o_PICKUP_END_DT AS PICKUP_END_DTTM,
  o_DELIVERY_START_DT AS DELIVERY_START_DTTM,
  o_DELIVERY_END_DT AS DELIVERY_END_DTTM,
  o_REQUESTED_DLVR_DT AS REQUESTED_DLVR_DTTM,
  o_MUST_DLVR_DT AS MUST_DLVR_DTTM,
  o_PROMISED_DLVR_DT AS PROMISED_DLVR_DTTM,
  DUE_DT AS DUE_DT,
  o_PURCHASE_ORDERS_DT AS PURCHASE_ORDERS_DATE_DTTM,
  o_RELEASE_DT AS RELEASE_DTTM,
  o_FIRST_RCPT_DT AS FIRST_RCPT_DTTM,
  o_LAST_RCPT_DT AS LAST_RCPT_DTTM,
  PAYMENT_MODE AS PAYMENT_MODE,
  MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  MONETARY_VALUE AS MONETARY_VALUE,
  CURRENCY_CODE AS CURRENCY_CODE,
  ORIG_BUDG_COST AS ORIG_BUDG_COST,
  BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  BUDG_COST AS BUDG_COST,
  TAX_CHARGES AS TAX_CHARGES,
  MISC_CHARGES AS MISC_CHARGES,
  IS_CANCELLED AS IS_CANCELLED,
  IS_IMPORTED AS IS_IMPORTED,
  HAS_ALERTS AS HAS_ALERTS,
  IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  TRANS_RESP_CODE AS TRANS_RESP_CODE,
  o_COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  o_CARRIER_ID AS CARRIER_ID,
  PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DECLINE_REASON_ID AS DECLINE_REASON_ID,
  o_CHANNEL_TYPE AS CHANNEL_TYPE,
  CUSTOMER_CODE AS CUSTOMER_CODE,
  CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  CUSTOMER_PHONE AS CUSTOMER_PHONE,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_DTTM AS CREATED_DTTM,
  LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  IS_CLOSED AS IS_CLOSED,
  GRAND_TOTAL AS GRAND_TOTAL,
  ORDER_CATEGORY AS ORDER_CATEGORY,
  o_CHANNEL_ID AS CHANNEL_ID,
  FULFILL_MODE AS FULFILL_MODE,
  ENTRY_CODE AS ENTRY_CODE,
  PAYMENT_STATUS AS PAYMENT_STATUS,
  REASON_ID AS REASON_ID,
  ORDER_RECEIVED AS ORDER_RECEIVED,
  FREIGHT_REVENUE AS FREIGHT_REVENUE,
  REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  CANCELLED_TYPE_ID AS CANCELLED_TYPE_ID,
  OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  ORDER_NBR AS ORDER_NBR,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  TAX_AMOUNT AS TAX_AMOUNT,
  BILL_TO_FIRST_NAME AS BILL_TO_FIRST_NAME,
  BILL_TO_LAST_NAME AS BILL_TO_LAST_NAME,
  BILL_TO_ADDRESS_LINE1 AS BILL_TO_ADDRESS_LINE1,
  BILL_TO_CITY AS BILL_TO_CITY,
  BILLTO_STATE_PROV AS BILLTO_STATE_PROV,
  BILL_TO_POSTAL_CODE AS BILL_TO_POSTAL_CODE,
  BILL_TO_COUNTRY_CODE AS BILL_TO_COUNTRY_CODE,
  BILL_TO_PHONE_NUMBER AS BILL_TO_PHONE_NUMBER,
  BILL_TO_EMAIL AS BILL_TO_EMAIL,
  AFTERPAY_FLG AS AFTERPAY_FLG,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  REASON_CODE AS REASON_CODE,
  CANCELLED_DTTM AS CANCELLED_DTTM,
  TC_COMPANY_ID AS TC_COMPANY_ID,
  ORIG_FACILITY_TYPE_BITS AS ORIG_FACILITY_TYPE_BITS,
  DEST_FACILITY_TYPE_BITS AS DEST_FACILITY_TYPE_BITS,
  ON_HOLD AS ON_HOLD,
  DeviceType AS DeviceType,
  ScreenWidth AS ScreenWidth,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  EXP_CANCELED_DTTM_44
ORDER BY
  PURCHASE_ORDERS_ID ASC,
  CREATION_TYPE ASC,
  PURCHASE_ORDERS_TYPE ASC,
  PURCHASE_ORDERS_STATUS ASC,
  TC_PURCHASE_ORDERS_ID ASC,
  PARENT_PURCHASE_ORDERS_ID ASC,
  O_FACILITY_ALIAS_ID ASC,
  D_FACILITY_ALIAS_ID ASC,
  BILL_FACILITY_ALIAS_ID ASC,
  ORG_SHIP_VIA_FACILITY_ALIAS_ID ASC,
  DES_SHIP_VIA_FACILITY_ALIAS_ID ASC,
  PICKUP_TZ ASC,
  DELIVERY_TZ ASC,
  PICKUP_START_DTTM ASC,
  PICKUP_END_DTTM ASC,
  DELIVERY_START_DTTM ASC,
  DELIVERY_END_DTTM ASC,
  REQUESTED_DLVR_DTTM ASC,
  MUST_DLVR_DTTM ASC,
  PROMISED_DLVR_DTTM ASC,
  DUE_DT ASC,
  PURCHASE_ORDERS_DATE_DTTM ASC,
  RELEASE_DTTM ASC,
  FIRST_RCPT_DTTM ASC,
  LAST_RCPT_DTTM ASC,
  PAYMENT_MODE ASC,
  MV_CURRENCY_CODE ASC,
  MONETARY_VALUE ASC,
  CURRENCY_CODE ASC,
  ORIG_BUDG_COST ASC,
  BUDG_COST_CURRENCY_CODE ASC,
  BUDG_COST ASC,
  TAX_CHARGES ASC,
  MISC_CHARGES ASC,
  IS_CANCELLED ASC,
  IS_IMPORTED ASC,
  HAS_ALERTS ASC,
  IS_READY_TO_SHIP ASC,
  IS_CUSTOMER_PICKUP ASC,
  IS_PARTIALLY_PLANNED ASC,
  BILL_OF_LADING_NUMBER ASC,
  TRANS_RESP_CODE ASC,
  COMMODITY_CODE_ID ASC,
  CARRIER_ID ASC,
  PRODUCT_CLASS_ID ASC,
  PROTECTION_LEVEL_ID ASC,
  DECLINE_REASON_ID ASC,
  CHANNEL_TYPE ASC,
  CUSTOMER_CODE ASC,
  CUSTOMER_FIRSTNAME ASC,
  CUSTOMER_LASTNAME ASC,
  CUSTOMER_EMAIL ASC,
  CUSTOMER_PHONE ASC,
  CREATED_SOURCE_TYPE ASC,
  CREATED_SOURCE ASC,
  CREATED_DTTM ASC,
  LAST_UPDATED_DTTM ASC,
  DROPOFF_PICKUP ASC,
  IS_CLOSED ASC,
  GRAND_TOTAL ASC,
  ORDER_CATEGORY ASC,
  CHANNEL_ID ASC,
  FULFILL_MODE ASC,
  ENTRY_CODE ASC,
  PAYMENT_STATUS ASC,
  REASON_ID ASC,
  ORDER_RECEIVED ASC,
  FREIGHT_REVENUE ASC,
  REASON_CODES_GROUP_ID ASC,
  RETURN_REFERENCE_NUMBER ASC,
  CANCELLED_TYPE_ID ASC,
  OMS_ORDER_TYPE ASC,
  ORDER_NBR ASC,
  ORDER_CREATION_CHANNEL ASC,
  TAX_AMOUNT ASC,
  BILL_TO_FIRST_NAME ASC,
  BILL_TO_LAST_NAME ASC,
  BILL_TO_ADDRESS_LINE1 ASC,
  BILL_TO_CITY ASC,
  BILLTO_STATE_PROV ASC,
  BILL_TO_POSTAL_CODE ASC,
  BILL_TO_COUNTRY_CODE ASC,
  BILL_TO_PHONE_NUMBER ASC,
  BILL_TO_EMAIL ASC,
  AFTERPAY_FLG ASC,
  SCHED_DELIVERY_FLG ASC,
  SUBSCRIPTION_ORDER_FLG ASC,
  REASON_CODE ASC,
  CANCELLED_DTTM ASC,
  TC_COMPANY_ID ASC,
  ORIG_FACILITY_TYPE_BITS ASC,
  DEST_FACILITY_TYPE_BITS ASC,
  ON_HOLD ASC,
  DeviceType ASC,
  ScreenWidth ASC"""

df_45 = spark.sql(query_45)

df_45.createOrReplaceTempView("srt_DISTINCT_45")

# COMMAND ----------
# DBTITLE 1, EXP_PRE_46


query_46 = f"""SELECT
  TO_INTEGER(PURCHASE_ORDERS_ID) AS o_PURCHASE_ORDERS_ID,
  CREATION_TYPE AS CREATION_TYPE,
  PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  PICKUP_TZ AS PICKUP_TZ,
  DELIVERY_TZ AS DELIVERY_TZ,
  PICKUP_START_DTTM AS PICKUP_START_DTTM,
  PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  REQUESTED_DLVR_DTTM AS REQUESTED_DLVR_DTTM,
  MUST_DLVR_DTTM AS MUST_DLVR_DTTM,
  PROMISED_DLVR_DTTM AS PROMISED_DLVR_DTTM,
  DUE_DT AS DUE_DT,
  PURCHASE_ORDERS_DATE_DTTM AS PURCHASE_ORDERS_DATE_DTTM,
  RELEASE_DTTM AS RELEASE_DTTM,
  FIRST_RCPT_DTTM AS FIRST_RCPT_DTTM,
  LAST_RCPT_DTTM AS LAST_RCPT_DTTM,
  PAYMENT_MODE AS PAYMENT_MODE,
  MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  MONETARY_VALUE AS MONETARY_VALUE,
  CURRENCY_CODE AS CURRENCY_CODE,
  ORIG_BUDG_COST AS ORIG_BUDG_COST,
  BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  BUDG_COST AS BUDG_COST,
  TAX_CHARGES AS TAX_CHARGES,
  MISC_CHARGES AS MISC_CHARGES,
  IS_CANCELLED AS IS_CANCELLED,
  IS_IMPORTED AS IS_IMPORTED,
  HAS_ALERTS AS HAS_ALERTS,
  IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  TRANS_RESP_CODE AS TRANS_RESP_CODE,
  COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  CARRIER_ID AS CARRIER_ID,
  PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DECLINE_REASON_ID AS DECLINE_REASON_ID,
  CHANNEL_TYPE AS CHANNEL_TYPE,
  CUSTOMER_CODE AS CUSTOMER_CODE,
  CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  CUSTOMER_PHONE AS CUSTOMER_PHONE,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_DTTM AS CREATED_DTTM,
  LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  IS_CLOSED AS IS_CLOSED,
  GRAND_TOTAL AS GRAND_TOTAL,
  ORDER_CATEGORY AS ORDER_CATEGORY,
  CHANNEL_ID AS CHANNEL_ID,
  FULFILL_MODE AS FULFILL_MODE,
  ENTRY_CODE AS ENTRY_CODE,
  PAYMENT_STATUS AS PAYMENT_STATUS,
  REASON_ID AS REASON_ID,
  ORDER_RECEIVED AS ORDER_RECEIVED,
  FREIGHT_REVENUE AS FREIGHT_REVENUE,
  REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  CANCELLED_TYPE_ID AS CANCELLED_TYPE_ID,
  OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  ORDER_NBR AS ORDER_NBR,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  TAX_AMOUNT AS TAX_AMOUNT,
  BILL_TO_FIRST_NAME AS BILL_TO_FIRST_NAME,
  BILL_TO_LAST_NAME AS BILL_TO_LAST_NAME,
  BILL_TO_ADDRESS_LINE1 AS BILL_TO_ADDRESS_LINE1,
  BILL_TO_CITY AS BILL_TO_CITY,
  BILLTO_STATE_PROV AS BILLTO_STATE_PROV,
  BILL_TO_POSTAL_CODE AS BILL_TO_POSTAL_CODE,
  BILL_TO_COUNTRY_CODE AS BILL_TO_COUNTRY_CODE,
  BILL_TO_PHONE_NUMBER AS BILL_TO_PHONE_NUMBER,
  BILL_TO_EMAIL AS BILL_TO_EMAIL,
  AFTERPAY_FLG AS AFTERPAY_FLG,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  REASON_CODE AS REASON_CODE,
  CANCELLED_DTTM AS CANCELLED_DTTM,
  TC_COMPANY_ID AS TC_COMPANY_ID,
  ORIG_FACILITY_TYPE_BITS AS ORIG_FACILITY_TYPE_BITS,
  DEST_FACILITY_TYPE_BITS AS DEST_FACILITY_TYPE_BITS,
  ON_HOLD AS ON_HOLD,
  DeviceType AS DeviceType,
  ScreenWidth AS ScreenWidth,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  srt_DISTINCT_45"""

df_46 = spark.sql(query_46)

df_46.createOrReplaceTempView("EXP_PRE_46")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_ORDER_47


query_47 = f"""SELECT
  OMS_ORDER_ID AS OMS_ORDER_ID,
  OMS_ORDER_NBR AS OMS_ORDER_NBR,
  ORDER_NBR AS ORDER_NBR,
  OMS_PARENT_ORDER_ID AS OMS_PARENT_ORDER_ID,
  OMS_ORDER_DT AS OMS_ORDER_DT,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  CREATION_TYPE AS CREATION_TYPE,
  CREATION_DEVICE_TYPE AS CREATION_DEVICE_TYPE,
  CREATION_DEVICE_WIDTH AS CREATION_DEVICE_WIDTH,
  CHANNEL_TYPE_ID AS CHANNEL_TYPE_ID,
  CHANNEL_ID AS CHANNEL_ID,
  OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  OMS_ORDER_TYPE_ID AS OMS_ORDER_TYPE_ID,
  ORDER_CATEGORY_ID AS ORDER_CATEGORY_ID,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  CUSTOMER_PICKUP_FLG AS CUSTOMER_PICKUP_FLG,
  OMS_ORDER_STATUS_ID AS OMS_ORDER_STATUS_ID,
  REASON_ID AS REASON_ID,
  REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  ORDER_RECEIVED_FLG AS ORDER_RECEIVED_FLG,
  PARTIALLY_PLANNED_FLG AS PARTIALLY_PLANNED_FLG,
  READY_TO_SHIP_FLG AS READY_TO_SHIP_FLG,
  CLOSED_FLG AS CLOSED_FLG,
  ON_HOLD AS ON_HOLD,
  CANCELLED_FLG AS CANCELLED_FLG,
  CANCELLED_TSTMP AS CANCELLED_TSTMP,
  OMS_CANCELLED_TYPE_ID AS OMS_CANCELLED_TYPE_ID,
  CANCEL_REASON_DESC AS CANCEL_REASON_DESC,
  DECLINE_REASON_ID AS DECLINE_REASON_ID,
  OMS_COMPANY_ID AS OMS_COMPANY_ID,
  BILL_OF_LADING_NBR AS BILL_OF_LADING_NBR,
  RETURN_REFERENCE_NBR AS RETURN_REFERENCE_NBR,
  COMMODITY_CD AS COMMODITY_CD,
  CARRIER_ID AS CARRIER_ID,
  PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  ENTRY_CODE AS ENTRY_CODE,
  FULFILL_MODE AS FULFILL_MODE,
  IMPORTED_FLG AS IMPORTED_FLG,
  ALERTS_FLG AS ALERTS_FLG,
  TRANS_RESP_CD AS TRANS_RESP_CD,
  ORIG_LOCATION_NBR AS ORIG_LOCATION_NBR,
  ORIG_LOCATION_ID AS ORIG_LOCATION_ID,
  ORIG_SHIP_VIA_LOCATION_ID AS ORIG_SHIP_VIA_LOCATION_ID,
  DEST_LOCATION_NBR AS DEST_LOCATION_NBR,
  DEST_LOCATION_ID AS DEST_LOCATION_ID,
  DEST_SHIP_VIA_LOCATION_ID AS DEST_SHIP_VIA_LOCATION_ID,
  BILL_LOCATION_NBR AS BILL_LOCATION_NBR,
  BILL_LOCATION_ID AS BILL_LOCATION_ID,
  RELEASE_DT AS RELEASE_DT,
  FIRST_RCPT_DT AS FIRST_RCPT_DT,
  LAST_RCPT_DT AS LAST_RCPT_DT,
  DUE_DT AS DUE_DT,
  PICKUP_START_DT AS PICKUP_START_DT,
  PICKUP_END_DT AS PICKUP_END_DT,
  PICKUP_TZ AS PICKUP_TZ,
  REQUESTED_DLVR_DT AS REQUESTED_DLVR_DT,
  PROMISED_DLVR_DT AS PROMISED_DLVR_DT,
  MUST_DLVR_DT AS MUST_DLVR_DT,
  DELIVERY_START_DT AS DELIVERY_START_DT,
  DELIVERY_END_DT AS DELIVERY_END_DT,
  DELIVERY_TZ AS DELIVERY_TZ,
  CUSTOMER_CD AS CUSTOMER_CD,
  CUSTOMER_FIRST_NAME AS CUSTOMER_FIRST_NAME,
  CUSTOMER_LAST_NAME AS CUSTOMER_LAST_NAME,
  CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  CUSTOMER_PHONE AS CUSTOMER_PHONE,
  BILL_FIRST_NAME AS BILL_FIRST_NAME,
  BILL_LAST_NAME AS BILL_LAST_NAME,
  BILL_ADDRESS AS BILL_ADDRESS,
  BILL_CITY AS BILL_CITY,
  BILL_STATE_CD AS BILL_STATE_CD,
  BILL_POSTAL_CD AS BILL_POSTAL_CD,
  BILL_COUNTRY_CD AS BILL_COUNTRY_CD,
  BILL_PHONE AS BILL_PHONE,
  BILL_EMAIL AS BILL_EMAIL,
  AFTERPAY_FLG AS AFTERPAY_FLG,
  FREIGHT_REVENUE_AMT AS FREIGHT_REVENUE_AMT,
  MONETARY_VALUE_AMT AS MONETARY_VALUE_AMT,
  ORIG_BUDG_COST_AMT AS ORIG_BUDG_COST_AMT,
  BUDG_COST_AMT AS BUDG_COST_AMT,
  TAX_AMT AS TAX_AMT,
  TAX_CHARGES_AMT AS TAX_CHARGES_AMT,
  MISC_CHARGES_AMT AS MISC_CHARGES_AMT,
  GRAND_TOTAL_AMT AS GRAND_TOTAL_AMT,
  PAYMENT_STATUS AS PAYMENT_STATUS,
  PAYMENT_MODE AS PAYMENT_MODE,
  BUDG_COST_CURRENCY_CD AS BUDG_COST_CURRENCY_CD,
  MV_CURRENCY_CD AS MV_CURRENCY_CD,
  CURRENCY_CD AS CURRENCY_CD,
  EXCHANGE_RATE_PCNT AS EXCHANGE_RATE_PCNT,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_TSTMP AS CREATED_TSTMP,
  LAST_UPDATED_TSTMP AS LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_ORDER"""

df_47 = spark.sql(query_47)

df_47.createOrReplaceTempView("Shortcut_to_OMS_ORDER_47")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_ORDER_48


query_48 = f"""SELECT
  OMS_ORDER_ID AS OMS_ORDER_ID,
  OMS_ORDER_NBR AS OMS_ORDER_NBR,
  ORDER_NBR AS ORDER_NBR,
  OMS_PARENT_ORDER_ID AS OMS_PARENT_ORDER_ID,
  OMS_ORDER_DT AS OMS_ORDER_DT,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  CREATION_TYPE AS CREATION_TYPE,
  CREATION_DEVICE_TYPE AS CREATION_DEVICE_TYPE,
  CREATION_DEVICE_WIDTH AS CREATION_DEVICE_WIDTH,
  CHANNEL_TYPE_ID AS CHANNEL_TYPE_ID,
  CHANNEL_ID AS CHANNEL_ID,
  OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  OMS_ORDER_TYPE_ID AS OMS_ORDER_TYPE_ID,
  ORDER_CATEGORY_ID AS ORDER_CATEGORY_ID,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  CUSTOMER_PICKUP_FLG AS CUSTOMER_PICKUP_FLG,
  OMS_ORDER_STATUS_ID AS OMS_ORDER_STATUS_ID,
  REASON_ID AS REASON_ID,
  REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  ORDER_RECEIVED_FLG AS ORDER_RECEIVED_FLG,
  PARTIALLY_PLANNED_FLG AS PARTIALLY_PLANNED_FLG,
  READY_TO_SHIP_FLG AS READY_TO_SHIP_FLG,
  CLOSED_FLG AS CLOSED_FLG,
  ON_HOLD AS ON_HOLD,
  CANCELLED_FLG AS CANCELLED_FLG,
  CANCELLED_TSTMP AS CANCELLED_TSTMP,
  OMS_CANCELLED_TYPE_ID AS OMS_CANCELLED_TYPE_ID,
  CANCEL_REASON_DESC AS CANCEL_REASON_DESC,
  DECLINE_REASON_ID AS DECLINE_REASON_ID,
  OMS_COMPANY_ID AS OMS_COMPANY_ID,
  BILL_OF_LADING_NBR AS BILL_OF_LADING_NBR,
  RETURN_REFERENCE_NBR AS RETURN_REFERENCE_NBR,
  COMMODITY_CD AS COMMODITY_CD,
  CARRIER_ID AS CARRIER_ID,
  PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  ENTRY_CODE AS ENTRY_CODE,
  FULFILL_MODE AS FULFILL_MODE,
  IMPORTED_FLG AS IMPORTED_FLG,
  ALERTS_FLG AS ALERTS_FLG,
  TRANS_RESP_CD AS TRANS_RESP_CD,
  ORIG_LOCATION_NBR AS ORIG_LOCATION_NBR,
  ORIG_LOCATION_ID AS ORIG_LOCATION_ID,
  ORIG_SHIP_VIA_LOCATION_ID AS ORIG_SHIP_VIA_LOCATION_ID,
  DEST_LOCATION_NBR AS DEST_LOCATION_NBR,
  DEST_LOCATION_ID AS DEST_LOCATION_ID,
  DEST_SHIP_VIA_LOCATION_ID AS DEST_SHIP_VIA_LOCATION_ID,
  BILL_LOCATION_NBR AS BILL_LOCATION_NBR,
  BILL_LOCATION_ID AS BILL_LOCATION_ID,
  RELEASE_DT AS RELEASE_DT,
  FIRST_RCPT_DT AS FIRST_RCPT_DT,
  LAST_RCPT_DT AS LAST_RCPT_DT,
  DUE_DT AS DUE_DT,
  PICKUP_START_DT AS PICKUP_START_DT,
  PICKUP_END_DT AS PICKUP_END_DT,
  PICKUP_TZ AS PICKUP_TZ,
  REQUESTED_DLVR_DT AS REQUESTED_DLVR_DT,
  PROMISED_DLVR_DT AS PROMISED_DLVR_DT,
  MUST_DLVR_DT AS MUST_DLVR_DT,
  DELIVERY_START_DT AS DELIVERY_START_DT,
  DELIVERY_END_DT AS DELIVERY_END_DT,
  DELIVERY_TZ AS DELIVERY_TZ,
  CUSTOMER_CD AS CUSTOMER_CD,
  CUSTOMER_FIRST_NAME AS CUSTOMER_FIRST_NAME,
  CUSTOMER_LAST_NAME AS CUSTOMER_LAST_NAME,
  CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  CUSTOMER_PHONE AS CUSTOMER_PHONE,
  BILL_FIRST_NAME AS BILL_FIRST_NAME,
  BILL_LAST_NAME AS BILL_LAST_NAME,
  BILL_ADDRESS AS BILL_ADDRESS,
  BILL_CITY AS BILL_CITY,
  BILL_STATE_CD AS BILL_STATE_CD,
  BILL_POSTAL_CD AS BILL_POSTAL_CD,
  BILL_COUNTRY_CD AS BILL_COUNTRY_CD,
  BILL_PHONE AS BILL_PHONE,
  BILL_EMAIL AS BILL_EMAIL,
  FREIGHT_REVENUE_AMT AS FREIGHT_REVENUE_AMT,
  MONETARY_VALUE_AMT AS MONETARY_VALUE_AMT,
  ORIG_BUDG_COST_AMT AS ORIG_BUDG_COST_AMT,
  BUDG_COST_AMT AS BUDG_COST_AMT,
  TAX_AMT AS TAX_AMT,
  TAX_CHARGES_AMT AS TAX_CHARGES_AMT,
  MISC_CHARGES_AMT AS MISC_CHARGES_AMT,
  GRAND_TOTAL_AMT AS GRAND_TOTAL_AMT,
  PAYMENT_STATUS AS PAYMENT_STATUS,
  PAYMENT_MODE AS PAYMENT_MODE,
  BUDG_COST_CURRENCY_CD AS BUDG_COST_CURRENCY_CD,
  MV_CURRENCY_CD AS MV_CURRENCY_CD,
  CURRENCY_CD AS CURRENCY_CD,
  EXCHANGE_RATE_PCNT AS EXCHANGE_RATE_PCNT,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_TSTMP AS CREATED_TSTMP,
  LAST_UPDATED_TSTMP AS LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP,
  AFTERPAY_FLG AS AFTERPAY_FLG,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_ORDER_47"""

df_48 = spark.sql(query_48)

df_48.createOrReplaceTempView("SQ_Shortcut_to_OMS_ORDER_48")

# COMMAND ----------
# DBTITLE 1, JNR_OMS_ORDER_49


query_49 = f"""SELECT
  DETAIL.o_PURCHASE_ORDERS_ID AS o_PURCHASE_ORDERS_ID,
  DETAIL.CREATION_TYPE AS CREATION_TYPE,
  DETAIL.PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  DETAIL.PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  DETAIL.TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  DETAIL.PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  DETAIL.O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  DETAIL.D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  DETAIL.BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  DETAIL.ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  DETAIL.PICKUP_TZ AS PICKUP_TZ,
  DETAIL.DELIVERY_TZ AS DELIVERY_TZ,
  DETAIL.PICKUP_START_DTTM AS PICKUP_START_DTTM,
  DETAIL.PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DETAIL.DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DETAIL.DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  DETAIL.REQUESTED_DLVR_DTTM AS REQUESTED_DLVR_DTTM,
  DETAIL.MUST_DLVR_DTTM AS MUST_DLVR_DTTM,
  DETAIL.PROMISED_DLVR_DTTM AS PROMISED_DLVR_DTTM,
  DETAIL.DUE_DT AS DUE_DT,
  DETAIL.PURCHASE_ORDERS_DATE_DTTM AS PURCHASE_ORDERS_DATE_DTTM,
  DETAIL.RELEASE_DTTM AS RELEASE_DTTM,
  DETAIL.FIRST_RCPT_DTTM AS FIRST_RCPT_DTTM,
  DETAIL.LAST_RCPT_DTTM AS LAST_RCPT_DTTM,
  DETAIL.PAYMENT_MODE AS PAYMENT_MODE,
  DETAIL.MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  DETAIL.MONETARY_VALUE AS MONETARY_VALUE,
  DETAIL.CURRENCY_CODE AS CURRENCY_CODE,
  DETAIL.ORIG_BUDG_COST AS ORIG_BUDG_COST,
  DETAIL.BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  DETAIL.BUDG_COST AS BUDG_COST,
  DETAIL.TAX_CHARGES AS TAX_CHARGES,
  DETAIL.MISC_CHARGES AS MISC_CHARGES,
  DETAIL.IS_CANCELLED AS IS_CANCELLED,
  DETAIL.IS_IMPORTED AS IS_IMPORTED,
  DETAIL.HAS_ALERTS AS HAS_ALERTS,
  DETAIL.IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  DETAIL.IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  DETAIL.IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  DETAIL.BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  DETAIL.TRANS_RESP_CODE AS TRANS_RESP_CODE,
  DETAIL.COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  DETAIL.CARRIER_ID AS CARRIER_ID,
  DETAIL.PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  DETAIL.PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DETAIL.DECLINE_REASON_ID AS DECLINE_REASON_ID,
  DETAIL.CHANNEL_TYPE AS CHANNEL_TYPE,
  DETAIL.CUSTOMER_CODE AS CUSTOMER_CODE,
  DETAIL.CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  DETAIL.CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  DETAIL.CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  DETAIL.CUSTOMER_PHONE AS CUSTOMER_PHONE,
  DETAIL.CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  DETAIL.CREATED_SOURCE AS CREATED_SOURCE,
  DETAIL.CREATED_DTTM AS CREATED_DTTM,
  DETAIL.LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  DETAIL.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  DETAIL.IS_CLOSED AS IS_CLOSED,
  DETAIL.GRAND_TOTAL AS GRAND_TOTAL,
  DETAIL.ORDER_CATEGORY AS ORDER_CATEGORY,
  DETAIL.CHANNEL_ID AS CHANNEL_ID,
  DETAIL.FULFILL_MODE AS FULFILL_MODE,
  DETAIL.ENTRY_CODE AS ENTRY_CODE,
  DETAIL.PAYMENT_STATUS AS PAYMENT_STATUS,
  DETAIL.REASON_ID AS REASON_ID,
  DETAIL.ORDER_RECEIVED AS ORDER_RECEIVED,
  DETAIL.FREIGHT_REVENUE AS FREIGHT_REVENUE,
  DETAIL.REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  DETAIL.RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  DETAIL.CANCELLED_TYPE_ID AS CANCELLED_TYPE_ID,
  DETAIL.OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  DETAIL.ORDER_NBR AS ORDER_NBR,
  DETAIL.ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  DETAIL.TAX_AMOUNT AS TAX_AMOUNT,
  DETAIL.BILL_TO_FIRST_NAME AS BILL_TO_FIRST_NAME,
  DETAIL.BILL_TO_LAST_NAME AS BILL_TO_LAST_NAME,
  DETAIL.BILL_TO_ADDRESS_LINE1 AS BILL_TO_ADDRESS_LINE1,
  DETAIL.BILL_TO_CITY AS BILL_TO_CITY,
  DETAIL.BILLTO_STATE_PROV AS BILLTO_STATE_PROV,
  DETAIL.BILL_TO_POSTAL_CODE AS BILL_TO_POSTAL_CODE,
  DETAIL.BILL_TO_COUNTRY_CODE AS BILL_TO_COUNTRY_CODE,
  DETAIL.BILL_TO_PHONE_NUMBER AS BILL_TO_PHONE_NUMBER,
  DETAIL.BILL_TO_EMAIL AS BILL_TO_EMAIL,
  DETAIL.AFTERPAY_FLG AS AFTERPAY_FLG,
  DETAIL.SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  DETAIL.SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  DETAIL.REASON_CODE AS REASON_CODE,
  DETAIL.CANCELLED_DTTM AS CANCELLED_DTTM,
  DETAIL.TC_COMPANY_ID AS TC_COMPANY_ID,
  DETAIL.ORIG_FACILITY_TYPE_BITS AS ORIG_FACILITY_TYPE_BITS,
  DETAIL.DEST_FACILITY_TYPE_BITS AS DEST_FACILITY_TYPE_BITS,
  DETAIL.ON_HOLD AS ON_HOLD,
  DETAIL.DeviceType AS DeviceType,
  DETAIL.ScreenWidth AS ScreenWidth,
  MASTER.OMS_ORDER_ID AS lkp_OMS_ORDER_ID,
  MASTER.OMS_ORDER_NBR AS lkp_OMS_ORDER_NBR,
  MASTER.ORDER_NBR AS lkp_ORDER_NBR1,
  MASTER.OMS_PARENT_ORDER_ID AS lkp_OMS_PARENT_ORDER_ID,
  MASTER.OMS_ORDER_DT AS lkp_OMS_ORDER_DT,
  MASTER.ORDER_CREATION_CHANNEL AS lkp_ORDER_CREATION_CHANNEL1,
  MASTER.CREATION_TYPE AS lkp_CREATION_TYPE1,
  MASTER.CREATION_DEVICE_TYPE AS lkp_CREATION_DEVICE_TYPE,
  MASTER.CREATION_DEVICE_WIDTH AS lkp_CREATION_DEVICE_WIDTH,
  MASTER.CHANNEL_TYPE_ID AS lkp_CHANNEL_TYPE_ID,
  MASTER.CHANNEL_ID AS lkp_CHANNEL_ID1,
  MASTER.OMS_ORDER_TYPE AS lkp_OMS_ORDER_TYPE1,
  MASTER.OMS_ORDER_TYPE_ID AS lkp_OMS_ORDER_TYPE_ID,
  MASTER.ORDER_CATEGORY_ID AS lkp_ORDER_CATEGORY_ID,
  MASTER.SCHED_DELIVERY_FLG AS lkp_SCHED_DELIVERY_FLG1,
  MASTER.SUBSCRIPTION_ORDER_FLG AS lkp_SUBSCRIPTION_ORDER_FLG1,
  MASTER.CUSTOMER_PICKUP_FLG AS lkp_CUSTOMER_PICKUP_FLG,
  MASTER.OMS_ORDER_STATUS_ID AS lkp_OMS_ORDER_STATUS_ID,
  MASTER.REASON_ID AS lkp_REASON_ID1,
  MASTER.REASON_CODES_GROUP_ID AS lkp_REASON_CODES_GROUP_ID1,
  MASTER.ORDER_RECEIVED_FLG AS lkp_ORDER_RECEIVED_FLG,
  MASTER.PARTIALLY_PLANNED_FLG AS lkp_PARTIALLY_PLANNED_FLG,
  MASTER.READY_TO_SHIP_FLG AS lkp_READY_TO_SHIP_FLG,
  MASTER.CLOSED_FLG AS lkp_CLOSED_FLG,
  MASTER.ON_HOLD AS lkp_ON_HOLD1,
  MASTER.CANCELLED_FLG AS lkp_CANCELLED_FLG,
  MASTER.CANCELLED_TSTMP AS lkp_CANCELLED_TSTMP,
  MASTER.OMS_CANCELLED_TYPE_ID AS lkp_OMS_CANCELLED_TYPE_ID,
  MASTER.CANCEL_REASON_DESC AS lkp_CANCEL_REASON_DESC,
  MASTER.DECLINE_REASON_ID AS lkp_DECLINE_REASON_ID1,
  MASTER.OMS_COMPANY_ID AS lkp_OMS_COMPANY_ID,
  MASTER.BILL_OF_LADING_NBR AS lkp_BILL_OF_LADING_NBR,
  MASTER.RETURN_REFERENCE_NBR AS lkp_RETURN_REFERENCE_NBR,
  MASTER.COMMODITY_CD AS lkp_COMMODITY_CD,
  MASTER.CARRIER_ID AS lkp_CARRIER_ID1,
  MASTER.PRODUCT_CLASS_ID AS lkp_PRODUCT_CLASS_ID1,
  MASTER.PROTECTION_LEVEL_ID AS lkp_PROTECTION_LEVEL_ID1,
  MASTER.DROPOFF_PICKUP AS lkp_DROPOFF_PICKUP1,
  MASTER.ENTRY_CODE AS lkp_ENTRY_CODE1,
  MASTER.FULFILL_MODE AS lkp_FULFILL_MODE1,
  MASTER.IMPORTED_FLG AS lkp_IMPORTED_FLG,
  MASTER.ALERTS_FLG AS lkp_ALERTS_FLG,
  MASTER.TRANS_RESP_CD AS lkp_TRANS_RESP_CD,
  MASTER.ORIG_LOCATION_NBR AS lkp_ORIG_LOCATION_NBR,
  MASTER.ORIG_LOCATION_ID AS lkp_ORIG_LOCATION_ID,
  MASTER.ORIG_SHIP_VIA_LOCATION_ID AS lkp_ORIG_SHIP_VIA_LOCATION_ID,
  MASTER.DEST_LOCATION_NBR AS lkp_DEST_LOCATION_NBR,
  MASTER.DEST_LOCATION_ID AS lkp_DEST_LOCATION_ID,
  MASTER.DEST_SHIP_VIA_LOCATION_ID AS lkp_DEST_SHIP_VIA_LOCATION_ID,
  MASTER.BILL_LOCATION_NBR AS lkp_BILL_LOCATION_NBR,
  MASTER.BILL_LOCATION_ID AS lkp_BILL_LOCATION_ID,
  MASTER.RELEASE_DT AS lkp_RELEASE_DT,
  MASTER.FIRST_RCPT_DT AS lkp_FIRST_RCPT_DT,
  MASTER.LAST_RCPT_DT AS lkp_LAST_RCPT_DT,
  MASTER.DUE_DT AS lkp_DUE_DT1,
  MASTER.PICKUP_START_DT AS lkp_PICKUP_START_DT,
  MASTER.PICKUP_END_DT AS lkp_PICKUP_END_DT,
  MASTER.PICKUP_TZ AS lkp_PICKUP_TZ1,
  MASTER.REQUESTED_DLVR_DT AS lkp_REQUESTED_DLVR_DT,
  MASTER.PROMISED_DLVR_DT AS lkp_PROMISED_DLVR_DT,
  MASTER.MUST_DLVR_DT AS lkp_MUST_DLVR_DT,
  MASTER.DELIVERY_START_DT AS lkp_DELIVERY_START_DT,
  MASTER.DELIVERY_END_DT AS lkp_DELIVERY_END_DT,
  MASTER.DELIVERY_TZ AS lkp_DELIVERY_TZ1,
  MASTER.CUSTOMER_CD AS lkp_CUSTOMER_CD,
  MASTER.CUSTOMER_FIRST_NAME AS lkp_CUSTOMER_FIRST_NAME,
  MASTER.CUSTOMER_LAST_NAME AS lkp_CUSTOMER_LAST_NAME,
  MASTER.CUSTOMER_EMAIL AS lkp_CUSTOMER_EMAIL1,
  MASTER.CUSTOMER_PHONE AS lkp_CUSTOMER_PHONE1,
  MASTER.BILL_FIRST_NAME AS lkp_BILL_FIRST_NAME,
  MASTER.BILL_LAST_NAME AS lkp_BILL_LAST_NAME,
  MASTER.BILL_ADDRESS AS lkp_BILL_ADDRESS,
  MASTER.BILL_CITY AS lkp_BILL_CITY,
  MASTER.BILL_STATE_CD AS lkp_BILL_STATE_CD,
  MASTER.BILL_POSTAL_CD AS lkp_BILL_POSTAL_CD,
  MASTER.BILL_COUNTRY_CD AS lkp_BILL_COUNTRY_CD,
  MASTER.BILL_PHONE AS lkp_BILL_PHONE,
  MASTER.BILL_EMAIL AS lkp_BILL_EMAIL,
  MASTER.FREIGHT_REVENUE_AMT AS lkp_FREIGHT_REVENUE_AMT,
  MASTER.MONETARY_VALUE_AMT AS lkp_MONETARY_VALUE_AMT,
  MASTER.ORIG_BUDG_COST_AMT AS lkp_ORIG_BUDG_COST_AMT,
  MASTER.BUDG_COST_AMT AS lkp_BUDG_COST_AMT,
  MASTER.TAX_AMT AS lkp_TAX_AMT,
  MASTER.TAX_CHARGES_AMT AS lkp_TAX_CHARGES_AMT,
  MASTER.MISC_CHARGES_AMT AS lkp_MISC_CHARGES_AMT,
  MASTER.GRAND_TOTAL_AMT AS lkp_GRAND_TOTAL_AMT,
  MASTER.PAYMENT_STATUS AS lkp_PAYMENT_STATUS1,
  MASTER.PAYMENT_MODE AS lkp_PAYMENT_MODE1,
  MASTER.BUDG_COST_CURRENCY_CD AS lkp_BUDG_COST_CURRENCY_CD,
  MASTER.MV_CURRENCY_CD AS lkp_MV_CURRENCY_CD,
  MASTER.CURRENCY_CD AS lkp_CURRENCY_CD,
  MASTER.EXCHANGE_RATE_PCNT AS lkp_EXCHANGE_RATE_PCNT,
  MASTER.CREATED_SOURCE_TYPE AS lkp_CREATED_SOURCE_TYPE1,
  MASTER.CREATED_SOURCE AS lkp_CREATED_SOURCE1,
  MASTER.CREATED_TSTMP AS lkp_CREATED_TSTMP,
  MASTER.LAST_UPDATED_TSTMP AS lkp_LAST_UPDATED_TSTMP,
  MASTER.LOAD_TSTMP AS lkp_LOAD_TSTMP1,
  MASTER.AFTERPAY_FLG AS lkp_AFTERPAY_FLG,
  DETAIL.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_ORDER_48 MASTER
  RIGHT JOIN EXP_PRE_46 DETAIL ON MASTER.OMS_ORDER_ID = DETAIL.o_PURCHASE_ORDERS_ID"""

df_49 = spark.sql(query_49)

df_49.createOrReplaceTempView("JNR_OMS_ORDER_49")

# COMMAND ----------
# DBTITLE 1, EXP_FLAGS_50


query_50 = f"""SELECT
  o_PURCHASE_ORDERS_ID AS src_PURCHASE_ORDERS_ID,
  CREATION_TYPE AS src_CREATION_TYPE,
  PURCHASE_ORDERS_TYPE AS src_PURCHASE_ORDERS_TYPE,
  PURCHASE_ORDERS_STATUS AS src_PURCHASE_ORDERS_STATUS,
  TC_PURCHASE_ORDERS_ID AS src_TC_PURCHASE_ORDERS_ID,
  ORDER_NBR AS src_ORDER_NBR,
  PARENT_PURCHASE_ORDERS_ID AS src_PARENT_PURCHASE_ORDERS_ID,
  O_FACILITY_ALIAS_ID AS src_O_FACILITY_ALIAS_ID,
  D_FACILITY_ALIAS_ID AS src_D_FACILITY_ALIAS_ID,
  BILL_FACILITY_ALIAS_ID AS src_BILL_FACILITY_ALIAS_ID,
  ORG_SHIP_VIA_FACILITY_ALIAS_ID AS src_ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  DES_SHIP_VIA_FACILITY_ALIAS_ID AS src_DES_SHIP_VIA_FACILITY_ALIAS_ID,
  PICKUP_TZ AS src_PICKUP_TZ,
  DELIVERY_TZ AS src_DELIVERY_TZ,
  PICKUP_START_DTTM AS src_PICKUP_START_DTTM,
  PICKUP_END_DTTM AS src_PICKUP_END_DTTM,
  DELIVERY_START_DTTM AS src_DELIVERY_START_DTTM,
  DELIVERY_END_DTTM AS src_DELIVERY_END_DTTM,
  REQUESTED_DLVR_DTTM AS src_REQUESTED_DLVR_DTTM,
  MUST_DLVR_DTTM AS src_MUST_DLVR_DTTM,
  PROMISED_DLVR_DTTM AS src_PROMISED_DLVR_DTTM,
  DUE_DT AS src_DUE_DT,
  PURCHASE_ORDERS_DATE_DTTM AS src_OMS_ORDER_DT,
  RELEASE_DTTM AS src_RELEASE_DT,
  FIRST_RCPT_DTTM AS src_FIRST_RCPT_DT,
  LAST_RCPT_DTTM AS src_LAST_RCPT_DT,
  PAYMENT_MODE AS src_PAYMENT_MODE,
  MV_CURRENCY_CODE AS src_MV_CURRENCY_CD,
  MONETARY_VALUE AS src_MONETARY_VALUE_AMT,
  CURRENCY_CODE AS src_CURRENCY_CD,
  ORIG_BUDG_COST AS src_ORIG_BUDG_COST_AMT,
  BUDG_COST_CURRENCY_CODE AS src_BUDG_COST_CURRENCY_CD,
  BUDG_COST AS src_BUDG_COST_AMT,
  TAX_CHARGES AS src_TAX_CHARGES_AMT,
  MISC_CHARGES AS src_MISC_CHARGES_AMT,
  IS_CANCELLED AS src_CANCELLED_FLG,
  IS_IMPORTED AS src_IMPORTED_FLG,
  HAS_ALERTS AS src_ALERTS_FLG,
  IS_READY_TO_SHIP AS src_READY_TO_SHIP_FLG,
  IS_PARTIALLY_PLANNED AS src_PARTIALLY_PLANNED_FLG,
  BILL_OF_LADING_NUMBER AS src_BILL_OF_LADING_NBR,
  TRANS_RESP_CODE AS src_TRANS_RESP_CD,
  COMMODITY_CODE_ID AS src_COMMODITY_CD,
  CARRIER_ID AS src_CARRIER_ID,
  PRODUCT_CLASS_ID AS src_PRODUCT_CLASS_ID,
  PROTECTION_LEVEL_ID AS src_PROTECTION_LEVEL_ID,
  DECLINE_REASON_ID AS src_DECLINE_REASON_ID,
  CHANNEL_TYPE AS src_CHANNEL_TYPE_ID,
  CUSTOMER_CODE AS src_CUSTOMER_CODE,
  IS_CUSTOMER_PICKUP AS src_CUSTOMER_PICKUP_FLG,
  CUSTOMER_FIRSTNAME AS src_CUSTOMER_FIRSTNAME,
  CUSTOMER_LASTNAME AS src_CUSTOMER_LASTNAME,
  CUSTOMER_EMAIL AS src_CUSTOMER_EMAIL,
  CUSTOMER_PHONE AS src_CUSTOMER_PHONE,
  CREATED_SOURCE_TYPE AS src_CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS src_CREATED_SOURCE,
  CREATED_DTTM AS src_CREATED_DTTM,
  LAST_UPDATED_DTTM AS src_LAST_UPDATED_DTTM,
  DROPOFF_PICKUP AS src_DROPOFF_PICKUP,
  IS_CLOSED AS src_CLOSED_FLG,
  GRAND_TOTAL AS src_GRAND_TOTAL_AMT,
  ORDER_CATEGORY AS src_ORDER_CATEGORY_ID,
  CHANNEL_ID AS src_CHANNEL_ID,
  FULFILL_MODE AS src_FULFILL_MODE,
  ENTRY_CODE AS src_ENTRY_CODE,
  PAYMENT_STATUS AS src_PAYMENT_STATUS,
  REASON_ID AS src_REASON_ID,
  ORDER_RECEIVED AS src_ORDER_RECEIVED_FLG,
  FREIGHT_REVENUE AS src_FREIGHT_REVENUE_AMT,
  REASON_CODES_GROUP_ID AS src_REASON_CODES_GROUP_ID,
  RETURN_REFERENCE_NUMBER AS src_RETURN_REFERENCE_NBR,
  CANCELLED_TYPE_ID AS src_CANCELLED_TYPE_ID,
  ORDER_CREATION_CHANNEL AS src_ORDER_CREATION_CHANNEL,
  OMS_ORDER_TYPE AS src_OMS_ORDER_TYPE,
  TAX_AMOUNT AS src_TAX_AMOUNT,
  BILL_TO_FIRST_NAME AS src_BILL_TO_FIRST_NAME,
  BILL_TO_LAST_NAME AS src_BILL_TO_LAST_NAME,
  BILL_TO_ADDRESS_LINE1 AS src_BILL_TO_ADDRESS_LINE1,
  BILL_TO_CITY AS src_BILL_TO_CITY,
  BILLTO_STATE_PROV AS src_BILLTO_STATE_PROV,
  BILL_TO_POSTAL_CODE AS src_BILL_TO_POSTAL_CODE,
  BILL_TO_COUNTRY_CODE AS src_BILL_TO_COUNTRY_CODE,
  BILL_TO_PHONE_NUMBER AS src_BILL_TO_PHONE_NUMBER,
  BILL_TO_EMAIL AS src_BILL_TO_EMAIL,
  AFTERPAY_FLG AS src_AFTERPAY_FLG,
  SCHED_DELIVERY_FLG AS src_SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS src_SUBSCRIPTION_ORDER_FLG,
  REASON_CODE AS src_REASON_CODE,
  CANCELLED_DTTM AS src_CANCELLED_DTTM,
  TC_COMPANY_ID AS src_TC_COMPANY_ID,
  ON_HOLD AS src_ON_HOLD,
  DeviceType AS src_CREATION_DEVICE_TYPE,
  ScreenWidth AS src_CREATION_DEVICE_WIDTH,
  IFF(
    NOT ISNULL(src_O_FACILITY_ALIAS_ID),
    LKP_SITE_PROFILE(
      src_O_FACILITY_ALIAS_ID,
      DECODE(src_O_FACILITY_TYPE_ID, 64, 8, 545, 6, 33, 6, 9, 19, 8)
    ),
    NULL
  ) AS v_ORIG_LOCATION_ID,
  IFF(
    NOT ISNULL(O_FACILITY_ALIAS_ID),
    LKP_SITE_PROFILE(
      O_FACILITY_ALIAS_ID,
      DECODE(ORIG_FACILITY_TYPE_BITS, 64, 8, 545, 6, 33, 6, 9, 19, 8)
    ),
    NULL
  ) AS ORIG_LOCATION_ID,
  IFF(
    NOT ISNULL(src_D_FACILITY_ALIAS_ID),
    LKP_SITE_PROFILE(
      src_D_FACILITY_ALIAS_ID,
      DECODE(src_D_FACILITY_TYPE_ID, 64, 8, 545, 6, 33, 6, 9, 19, 8)
    ),
    NULL
  ) AS v_DEST_LOCATION_ID,
  IFF(
    NOT ISNULL(D_FACILITY_ALIAS_ID),
    LKP_SITE_PROFILE(
      D_FACILITY_ALIAS_ID,
      DECODE(DEST_FACILITY_TYPE_BITS, 64, 8, 545, 6, 33, 6, 9, 19, 8)
    ),
    NULL
  ) AS DEST_LOCATION_ID,
  IFF(
    NOT ISNULL(src_BILL_FACILITY_ALIAS_ID),
    LKP_SITE_PROFILE(src_BILL_FACILITY_ALIAS_ID, 8),
    NULL
  ) AS v_BILL_LOCATION_ID,
  IFF(
    NOT ISNULL(BILL_FACILITY_ALIAS_ID),
    LKP_SITE_PROFILE(BILL_FACILITY_ALIAS_ID, 8),
    NULL
  ) AS BILL_LOCATION_ID,
  IFF(
    NOT ISNULL(src_ORG_SHIP_VIA_FACILITY_ALIAS_ID),
    LKP_SITE_PROFILE(src_ORG_SHIP_VIA_FACILITY_ALIAS_ID, 8),
    NULL
  ) AS v_ORG_SHIP_VIA_LOCATION_ID,
  IFF(
    NOT ISNULL(ORG_SHIP_VIA_FACILITY_ALIAS_ID),
    LKP_SITE_PROFILE(ORG_SHIP_VIA_FACILITY_ALIAS_ID, 8),
    NULL
  ) AS ORG_SHIP_VIA_LOCATION_ID,
  IFF(
    NOT ISNULL(src_DES_SHIP_VIA_FACILITY_ALIAS_ID),
    LKP_SITE_PROFILE(src_DES_SHIP_VIA_FACILITY_ALIAS_ID, 8),
    NULL
  ) AS v_DES_SHIP_VIA_LOCATION_ID,
  IFF(
    NOT ISNULL(DES_SHIP_VIA_FACILITY_ALIAS_ID),
    LKP_SITE_PROFILE(DES_SHIP_VIA_FACILITY_ALIAS_ID, 8),
    NULL
  ) AS DES_SHIP_VIA_LOCATION_ID,
  IFF(
    ISNULL(lkp_OMS_ORDER_ID),
    'INSERT',
    IFF(
      (
        src_CREATION_TYPE <> lkp_CREATION_TYPE1
        OR src_PURCHASE_ORDERS_TYPE <> lkp_OMS_ORDER_TYPE_ID
        OR src_PURCHASE_ORDERS_STATUS <> lkp_OMS_ORDER_STATUS_ID
        OR LTRIM(RTRIM(src_TC_PURCHASE_ORDERS_ID)) <> LTRIM(RTRIM(lkp_OMS_ORDER_NBR))
        OR src_ORDER_NBR <> lkp_ORDER_NBR1
        OR src_PARENT_PURCHASE_ORDERS_ID <> lkp_OMS_PARENT_ORDER_ID
        OR LTRIM(RTRIM(src_O_FACILITY_ALIAS_ID)) <> LTRIM(RTRIM(lkp_ORIG_LOCATION_NBR))
        OR v_ORIG_LOCATION_ID <> lkp_ORIG_LOCATION_ID
        OR LTRIM(RTRIM(src_D_FACILITY_ALIAS_ID)) <> LTRIM(RTRIM(lkp_DEST_LOCATION_NBR))
        OR v_DEST_LOCATION_ID <> lkp_DEST_LOCATION_ID
        OR LTRIM(RTRIM(src_BILL_FACILITY_ALIAS_ID)) <> LTRIM(RTRIM(lkp_BILL_LOCATION_NBR))
        OR v_BILL_LOCATION_ID <> lkp_BILL_LOCATION_ID
        OR v_ORG_SHIP_VIA_LOCATION_ID <> lkp_ORIG_SHIP_VIA_LOCATION_ID
        OR v_DES_SHIP_VIA_LOCATION_ID <> lkp_DEST_SHIP_VIA_LOCATION_ID
        OR src_PICKUP_TZ <> lkp_PICKUP_TZ1
        OR src_DELIVERY_TZ <> lkp_DELIVERY_TZ1
        OR TRUNC(src_PICKUP_START_DTTM) <> lkp_PICKUP_START_DT
        OR TRUNC(src_PICKUP_END_DTTM) <> lkp_PICKUP_END_DT
        OR TRUNC(src_DELIVERY_START_DTTM) <> lkp_DELIVERY_START_DT
        OR TRUNC(src_DELIVERY_END_DTTM) <> lkp_DELIVERY_END_DT
        OR TRUNC(src_REQUESTED_DLVR_DTTM) <> lkp_REQUESTED_DLVR_DT
        OR TRUNC(src_MUST_DLVR_DTTM) <> lkp_MUST_DLVR_DT
        OR TRUNC(src_PROMISED_DLVR_DTTM) <> lkp_PROMISED_DLVR_DT
        OR TRUNC(src_DUE_DT) <> lkp_DUE_DT1
        OR TRUNC(src_OMS_ORDER_DT) <> lkp_OMS_ORDER_DT
        OR TRUNC(src_RELEASE_DT) <> lkp_RELEASE_DT
        OR TRUNC(src_FIRST_RCPT_DT) <> lkp_FIRST_RCPT_DT
        OR TRUNC(src_LAST_RCPT_DT) <> lkp_LAST_RCPT_DT
        OR src_PAYMENT_MODE <> lkp_PAYMENT_MODE1
        OR LTRIM(RTRIM(src_MV_CURRENCY_CD)) <> LTRIM(RTRIM(lkp_MV_CURRENCY_CD))
        OR src_MONETARY_VALUE_AMT <> lkp_MONETARY_VALUE_AMT
        OR LTRIM(RTRIM(src_CURRENCY_CD)) <> LTRIM(RTRIM(lkp_CURRENCY_CD))
        OR src_ORIG_BUDG_COST_AMT <> lkp_ORIG_BUDG_COST_AMT
        OR LTRIM(RTRIM(src_BUDG_COST_CURRENCY_CD)) <> LTRIM(RTRIM(lkp_BUDG_COST_CURRENCY_CD))
        OR src_BUDG_COST_AMT <> lkp_BUDG_COST_AMT
        OR src_TAX_CHARGES_AMT <> lkp_TAX_CHARGES_AMT
        OR src_MISC_CHARGES_AMT <> lkp_MISC_CHARGES_AMT
        OR src_CANCELLED_FLG <> lkp_CANCELLED_FLG
        OR src_IMPORTED_FLG <> lkp_IMPORTED_FLG
        OR src_ALERTS_FLG <> lkp_ALERTS_FLG
        OR src_READY_TO_SHIP_FLG <> lkp_READY_TO_SHIP_FLG
        OR src_PARTIALLY_PLANNED_FLG <> lkp_PARTIALLY_PLANNED_FLG
        OR LTRIM(RTRIM(src_BILL_OF_LADING_NBR)) <> LTRIM(RTRIM(lkp_BILL_OF_LADING_NBR))
        OR LTRIM(RTRIM(src_TRANS_RESP_CD)) <> LTRIM(RTRIM(lkp_TRANS_RESP_CD))
        OR src_COMMODITY_CD <> lkp_COMMODITY_CD
        OR src_CARRIER_ID <> lkp_CARRIER_ID1
        OR src_PRODUCT_CLASS_ID <> lkp_PRODUCT_CLASS_ID1
        OR src_PROTECTION_LEVEL_ID <> lkp_PROTECTION_LEVEL_ID1
        OR src_DECLINE_REASON_ID <> lkp_DECLINE_REASON_ID1
        OR src_CHANNEL_TYPE_ID <> lkp_CHANNEL_TYPE_ID
        OR LTRIM(RTRIM(src_CUSTOMER_CODE)) <> LTRIM(RTRIM(lkp_CUSTOMER_CD))
        OR src_CUSTOMER_PICKUP_FLG <> lkp_CUSTOMER_PICKUP_FLG
        OR LTRIM(RTRIM(src_CUSTOMER_FIRSTNAME)) <> LTRIM(RTRIM(lkp_CUSTOMER_FIRST_NAME))
        OR LTRIM(RTRIM(src_CUSTOMER_LASTNAME)) <> LTRIM(RTRIM(lkp_CUSTOMER_LAST_NAME))
        OR LTRIM(RTRIM(src_CUSTOMER_EMAIL)) <> LTRIM(RTRIM(lkp_CUSTOMER_EMAIL1))
        OR LTRIM(RTRIM(src_CUSTOMER_PHONE)) <> LTRIM(RTRIM(lkp_CUSTOMER_PHONE1))
        OR src_CREATED_SOURCE_TYPE <> lkp_CREATED_SOURCE_TYPE1
        OR LTRIM(RTRIM(src_CREATED_SOURCE)) <> LTRIM(RTRIM(lkp_CREATED_SOURCE1))
        OR src_CREATED_DTTM <> lkp_CREATED_TSTMP
        OR src_LAST_UPDATED_DTTM <> lkp_LAST_UPDATED_TSTMP
        OR LTRIM(RTRIM(src_DROPOFF_PICKUP)) <> LTRIM(RTRIM(lkp_DROPOFF_PICKUP1))
        OR src_CLOSED_FLG <> lkp_CLOSED_FLG
        OR src_GRAND_TOTAL_AMT <> lkp_GRAND_TOTAL_AMT
        OR src_ORDER_CATEGORY_ID <> lkp_ORDER_CATEGORY_ID
        OR src_CHANNEL_ID <> lkp_CHANNEL_ID1
        OR src_FULFILL_MODE <> lkp_FULFILL_MODE1
        OR LTRIM(RTRIM(src_ENTRY_CODE)) <> LTRIM(RTRIM(lkp_ENTRY_CODE1))
        OR src_PAYMENT_STATUS <> lkp_PAYMENT_STATUS1
        OR src_REASON_ID <> lkp_REASON_ID1
        OR src_ORDER_RECEIVED_FLG <> lkp_ORDER_RECEIVED_FLG
        OR src_FREIGHT_REVENUE_AMT <> lkp_FREIGHT_REVENUE_AMT
        OR src_REASON_CODES_GROUP_ID <> lkp_REASON_CODES_GROUP_ID1
        OR LTRIM(RTRIM(src_RETURN_REFERENCE_NBR)) <> LTRIM(RTRIM(lkp_RETURN_REFERENCE_NBR))
        OR src_CANCELLED_TYPE_ID <> lkp_OMS_CANCELLED_TYPE_ID
        OR LTRIM(RTRIM(src_ORDER_CREATION_CHANNEL)) <> LTRIM(RTRIM(lkp_ORDER_CREATION_CHANNEL1))
        OR LTRIM(RTRIM(src_OMS_ORDER_TYPE)) <> LTRIM(RTRIM(lkp_OMS_ORDER_TYPE1))
        OR src_TAX_AMOUNT <> lkp_TAX_AMT
        OR LTRIM(RTRIM(src_BILL_TO_FIRST_NAME)) <> LTRIM(RTRIM(lkp_BILL_FIRST_NAME))
        OR LTRIM(RTRIM(src_BILL_TO_LAST_NAME)) <> LTRIM(RTRIM(lkp_BILL_LAST_NAME))
        OR UPPER(LTRIM(RTRIM(src_BILL_TO_ADDRESS_LINE1))) <> UPPER(LTRIM(RTRIM(lkp_BILL_ADDRESS)))
        OR UPPER(LTRIM(RTRIM(src_BILL_TO_CITY))) <> UPPER(LTRIM(RTRIM(lkp_BILL_CITY)))
        OR LTRIM(RTRIM(src_BILLTO_STATE_PROV)) <> LTRIM(RTRIM(lkp_BILL_STATE_CD))
        OR LTRIM(RTRIM(src_BILL_TO_POSTAL_CODE)) <> LTRIM(RTRIM(lkp_BILL_POSTAL_CD))
        OR LTRIM(RTRIM(src_BILL_TO_COUNTRY_CODE)) <> LTRIM(RTRIM(lkp_BILL_COUNTRY_CD))
        OR LTRIM(RTRIM(src_BILL_TO_PHONE_NUMBER)) <> LTRIM(RTRIM(lkp_BILL_PHONE))
        OR LTRIM(RTRIM(src_BILL_TO_EMAIL)) <> LTRIM(RTRIM(lkp_BILL_EMAIL))
        OR IFF(isnull(src_AFTERPAY_FLG), 9, src_AFTERPAY_FLG) <> IFF(ISNULL(lkp_AFTERPAY_FLG), 9, lkp_AFTERPAY_FLG)
        OR src_SCHED_DELIVERY_FLG <> lkp_SCHED_DELIVERY_FLG1
        OR src_SUBSCRIPTION_ORDER_FLG <> lkp_SUBSCRIPTION_ORDER_FLG1
        OR LTRIM(RTRIM(src_REASON_CODE)) <> LTRIM(RTRIM(lkp_CANCEL_REASON_DESC))
        OR src_CANCELLED_DTTM <> lkp_CANCELLED_TSTMP
        OR src_TC_COMPANY_ID <> lkp_OMS_COMPANY_ID
        OR src_ON_HOLD <> lkp_ON_HOLD1
        OR src_CREATION_DEVICE_TYPE <> lkp_CREATION_DEVICE_TYPE
        OR src_CREATION_DEVICE_WIDTH <> lkp_CREATION_DEVICE_WIDTH
      ),
      'UPDATE',
      'REJECT'
    )
  ) AS v_LOAD_FLAG,
  IFF(
    TC_COMPANY_ID = 8840,
    1,
    LKP_CURRENCY_DAY(TRUNC(CREATED_DTTM))
  ) AS EXCHANGE_RATE_PCNT,
  IFF(
    ISNULL(lkp_OMS_ORDER_ID),
    'INSERT',
    IFF(
      (
        CREATION_TYPE <> lkp_CREATION_TYPE1
        OR PURCHASE_ORDERS_TYPE <> lkp_OMS_ORDER_TYPE_ID
        OR PURCHASE_ORDERS_STATUS <> lkp_OMS_ORDER_STATUS_ID
        OR LTRIM(RTRIM(TC_PURCHASE_ORDERS_ID)) <> LTRIM(RTRIM(lkp_OMS_ORDER_NBR))
        OR ORDER_NBR <> lkp_ORDER_NBR1
        OR PARENT_PURCHASE_ORDERS_ID <> lkp_OMS_PARENT_ORDER_ID
        OR LTRIM(RTRIM(O_FACILITY_ALIAS_ID)) <> LTRIM(RTRIM(lkp_ORIG_LOCATION_NBR))
        OR IFF(
          NOT ISNULL(O_FACILITY_ALIAS_ID),
          LKP_SITE_PROFILE(
            O_FACILITY_ALIAS_ID,
            DECODE(ORIG_FACILITY_TYPE_BITS, 64, 8, 545, 6, 33, 6, 9, 19, 8)
          ),
          NULL
        ) <> lkp_ORIG_LOCATION_ID
        OR LTRIM(RTRIM(D_FACILITY_ALIAS_ID)) <> LTRIM(RTRIM(lkp_DEST_LOCATION_NBR))
        OR IFF(
          NOT ISNULL(D_FACILITY_ALIAS_ID),
          LKP_SITE_PROFILE(
            D_FACILITY_ALIAS_ID,
            DECODE(DEST_FACILITY_TYPE_BITS, 64, 8, 545, 6, 33, 6, 9, 19, 8)
          ),
          NULL
        ) <> lkp_DEST_LOCATION_ID
        OR LTRIM(RTRIM(BILL_FACILITY_ALIAS_ID)) <> LTRIM(RTRIM(lkp_BILL_LOCATION_NBR))
        OR IFF(
          NOT ISNULL(BILL_FACILITY_ALIAS_ID),
          LKP_SITE_PROFILE(BILL_FACILITY_ALIAS_ID, 8),
          NULL
        ) <> lkp_BILL_LOCATION_ID
        OR IFF(
          NOT ISNULL(ORG_SHIP_VIA_FACILITY_ALIAS_ID),
          LKP_SITE_PROFILE(ORG_SHIP_VIA_FACILITY_ALIAS_ID, 8),
          NULL
        ) <> lkp_ORIG_SHIP_VIA_LOCATION_ID
        OR IFF(
          NOT ISNULL(DES_SHIP_VIA_FACILITY_ALIAS_ID),
          LKP_SITE_PROFILE(DES_SHIP_VIA_FACILITY_ALIAS_ID, 8),
          NULL
        ) <> lkp_DEST_SHIP_VIA_LOCATION_ID
        OR PICKUP_TZ <> lkp_PICKUP_TZ1
        OR DELIVERY_TZ <> lkp_DELIVERY_TZ1
        OR TRUNC(PICKUP_START_DTTM) <> lkp_PICKUP_START_DT
        OR TRUNC(PICKUP_END_DTTM) <> lkp_PICKUP_END_DT
        OR TRUNC(DELIVERY_START_DTTM) <> lkp_DELIVERY_START_DT
        OR TRUNC(DELIVERY_END_DTTM) <> lkp_DELIVERY_END_DT
        OR TRUNC(REQUESTED_DLVR_DTTM) <> lkp_REQUESTED_DLVR_DT
        OR TRUNC(MUST_DLVR_DTTM) <> lkp_MUST_DLVR_DT
        OR TRUNC(PROMISED_DLVR_DTTM) <> lkp_PROMISED_DLVR_DT
        OR TRUNC(DUE_DT) <> lkp_DUE_DT1
        OR TRUNC(PURCHASE_ORDERS_DATE_DTTM) <> lkp_OMS_ORDER_DT
        OR TRUNC(RELEASE_DTTM) <> lkp_RELEASE_DT
        OR TRUNC(FIRST_RCPT_DTTM) <> lkp_FIRST_RCPT_DT
        OR TRUNC(LAST_RCPT_DTTM) <> lkp_LAST_RCPT_DT
        OR PAYMENT_MODE <> lkp_PAYMENT_MODE1
        OR LTRIM(RTRIM(MV_CURRENCY_CODE)) <> LTRIM(RTRIM(lkp_MV_CURRENCY_CD))
        OR MONETARY_VALUE <> lkp_MONETARY_VALUE_AMT
        OR LTRIM(RTRIM(CURRENCY_CODE)) <> LTRIM(RTRIM(lkp_CURRENCY_CD))
        OR ORIG_BUDG_COST <> lkp_ORIG_BUDG_COST_AMT
        OR LTRIM(RTRIM(BUDG_COST_CURRENCY_CODE)) <> LTRIM(RTRIM(lkp_BUDG_COST_CURRENCY_CD))
        OR BUDG_COST <> lkp_BUDG_COST_AMT
        OR TAX_CHARGES <> lkp_TAX_CHARGES_AMT
        OR MISC_CHARGES <> lkp_MISC_CHARGES_AMT
        OR IS_CANCELLED <> lkp_CANCELLED_FLG
        OR IS_IMPORTED <> lkp_IMPORTED_FLG
        OR HAS_ALERTS <> lkp_ALERTS_FLG
        OR IS_READY_TO_SHIP <> lkp_READY_TO_SHIP_FLG
        OR IS_PARTIALLY_PLANNED <> lkp_PARTIALLY_PLANNED_FLG
        OR LTRIM(RTRIM(BILL_OF_LADING_NUMBER)) <> LTRIM(RTRIM(lkp_BILL_OF_LADING_NBR))
        OR LTRIM(RTRIM(TRANS_RESP_CODE)) <> LTRIM(RTRIM(lkp_TRANS_RESP_CD))
        OR COMMODITY_CODE_ID <> lkp_COMMODITY_CD
        OR CARRIER_ID <> lkp_CARRIER_ID1
        OR PRODUCT_CLASS_ID <> lkp_PRODUCT_CLASS_ID1
        OR PROTECTION_LEVEL_ID <> lkp_PROTECTION_LEVEL_ID1
        OR DECLINE_REASON_ID <> lkp_DECLINE_REASON_ID1
        OR CHANNEL_TYPE <> lkp_CHANNEL_TYPE_ID
        OR LTRIM(RTRIM(CUSTOMER_CODE)) <> LTRIM(RTRIM(lkp_CUSTOMER_CD))
        OR IS_CUSTOMER_PICKUP <> lkp_CUSTOMER_PICKUP_FLG
        OR LTRIM(RTRIM(CUSTOMER_FIRSTNAME)) <> LTRIM(RTRIM(lkp_CUSTOMER_FIRST_NAME))
        OR LTRIM(RTRIM(CUSTOMER_LASTNAME)) <> LTRIM(RTRIM(lkp_CUSTOMER_LAST_NAME))
        OR LTRIM(RTRIM(CUSTOMER_EMAIL)) <> LTRIM(RTRIM(lkp_CUSTOMER_EMAIL1))
        OR LTRIM(RTRIM(CUSTOMER_PHONE)) <> LTRIM(RTRIM(lkp_CUSTOMER_PHONE1))
        OR CREATED_SOURCE_TYPE <> lkp_CREATED_SOURCE_TYPE1
        OR LTRIM(RTRIM(CREATED_SOURCE)) <> LTRIM(RTRIM(lkp_CREATED_SOURCE1))
        OR CREATED_DTTM <> lkp_CREATED_TSTMP
        OR LAST_UPDATED_DTTM <> lkp_LAST_UPDATED_TSTMP
        OR LTRIM(RTRIM(DROPOFF_PICKUP)) <> LTRIM(RTRIM(lkp_DROPOFF_PICKUP1))
        OR IS_CLOSED <> lkp_CLOSED_FLG
        OR GRAND_TOTAL <> lkp_GRAND_TOTAL_AMT
        OR ORDER_CATEGORY <> lkp_ORDER_CATEGORY_ID
        OR CHANNEL_ID <> lkp_CHANNEL_ID1
        OR FULFILL_MODE <> lkp_FULFILL_MODE1
        OR LTRIM(RTRIM(ENTRY_CODE)) <> LTRIM(RTRIM(lkp_ENTRY_CODE1))
        OR PAYMENT_STATUS <> lkp_PAYMENT_STATUS1
        OR REASON_ID <> lkp_REASON_ID1
        OR ORDER_RECEIVED <> lkp_ORDER_RECEIVED_FLG
        OR FREIGHT_REVENUE <> lkp_FREIGHT_REVENUE_AMT
        OR REASON_CODES_GROUP_ID <> lkp_REASON_CODES_GROUP_ID1
        OR LTRIM(RTRIM(RETURN_REFERENCE_NUMBER)) <> LTRIM(RTRIM(lkp_RETURN_REFERENCE_NBR))
        OR CANCELLED_TYPE_ID <> lkp_OMS_CANCELLED_TYPE_ID
        OR LTRIM(RTRIM(ORDER_CREATION_CHANNEL)) <> LTRIM(RTRIM(lkp_ORDER_CREATION_CHANNEL1))
        OR LTRIM(RTRIM(OMS_ORDER_TYPE)) <> LTRIM(RTRIM(lkp_OMS_ORDER_TYPE1))
        OR TAX_AMOUNT <> lkp_TAX_AMT
        OR LTRIM(RTRIM(BILL_TO_FIRST_NAME)) <> LTRIM(RTRIM(lkp_BILL_FIRST_NAME))
        OR LTRIM(RTRIM(BILL_TO_LAST_NAME)) <> LTRIM(RTRIM(lkp_BILL_LAST_NAME))
        OR UPPER(LTRIM(RTRIM(BILL_TO_ADDRESS_LINE1))) <> UPPER(LTRIM(RTRIM(lkp_BILL_ADDRESS)))
        OR UPPER(LTRIM(RTRIM(BILL_TO_CITY))) <> UPPER(LTRIM(RTRIM(lkp_BILL_CITY)))
        OR LTRIM(RTRIM(BILLTO_STATE_PROV)) <> LTRIM(RTRIM(lkp_BILL_STATE_CD))
        OR LTRIM(RTRIM(BILL_TO_POSTAL_CODE)) <> LTRIM(RTRIM(lkp_BILL_POSTAL_CD))
        OR LTRIM(RTRIM(BILL_TO_COUNTRY_CODE)) <> LTRIM(RTRIM(lkp_BILL_COUNTRY_CD))
        OR LTRIM(RTRIM(BILL_TO_PHONE_NUMBER)) <> LTRIM(RTRIM(lkp_BILL_PHONE))
        OR LTRIM(RTRIM(BILL_TO_EMAIL)) <> LTRIM(RTRIM(lkp_BILL_EMAIL))
        OR IFF(isnull(AFTERPAY_FLG), 9, AFTERPAY_FLG) <> IFF(ISNULL(lkp_AFTERPAY_FLG), 9, lkp_AFTERPAY_FLG)
        OR SCHED_DELIVERY_FLG <> lkp_SCHED_DELIVERY_FLG1
        OR SUBSCRIPTION_ORDER_FLG <> lkp_SUBSCRIPTION_ORDER_FLG1
        OR LTRIM(RTRIM(REASON_CODE)) <> LTRIM(RTRIM(lkp_CANCEL_REASON_DESC))
        OR CANCELLED_DTTM <> lkp_CANCELLED_TSTMP
        OR TC_COMPANY_ID <> lkp_OMS_COMPANY_ID
        OR ON_HOLD <> lkp_ON_HOLD1
        OR DeviceType <> lkp_CREATION_DEVICE_TYPE
        OR ScreenWidth <> lkp_CREATION_DEVICE_WIDTH
      ),
      'UPDATE',
      'REJECT'
    )
  ) AS LOAD_FLAG,
  sysdate AS UPDATE_TSTMP,
  IFF(ISNULL(lkp_OMS_ORDER_ID), now(), lkp_LOAD_TSTMP1) AS LOAD_TSTMP,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  JNR_OMS_ORDER_49"""

df_50 = spark.sql(query_50)

df_50.createOrReplaceTempView("EXP_FLAGS_50")

# COMMAND ----------
# DBTITLE 1, FIL_FLAGS_51


query_51 = f"""SELECT
  src_PURCHASE_ORDERS_ID AS src_PURCHASE_ORDERS_ID,
  src_CREATION_TYPE AS src_CREATION_TYPE,
  src_PURCHASE_ORDERS_TYPE AS src_PURCHASE_ORDERS_TYPE,
  src_PURCHASE_ORDERS_STATUS AS src_PURCHASE_ORDERS_STATUS,
  src_TC_PURCHASE_ORDERS_ID AS src_TC_PURCHASE_ORDERS_ID,
  src_ORDER_NBR AS src_ORDER_NBR,
  src_PARENT_PURCHASE_ORDERS_ID AS src_PARENT_PURCHASE_ORDERS_ID,
  src_O_FACILITY_ALIAS_ID AS src_O_FACILITY_ALIAS_ID,
  src_D_FACILITY_ALIAS_ID AS src_D_FACILITY_ALIAS_ID,
  src_BILL_FACILITY_ALIAS_ID AS src_BILL_FACILITY_ALIAS_ID,
  src_ORG_SHIP_VIA_FACILITY_ALIAS_ID AS src_ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  src_DES_SHIP_VIA_FACILITY_ALIAS_ID AS src_DES_SHIP_VIA_FACILITY_ALIAS_ID,
  src_PICKUP_TZ AS src_PICKUP_TZ,
  src_DELIVERY_TZ AS src_DELIVERY_TZ,
  src_PICKUP_START_DTTM AS src_PICKUP_START_DTTM,
  src_PICKUP_END_DTTM AS src_PICKUP_END_DTTM,
  src_DELIVERY_START_DTTM AS src_DELIVERY_START_DTTM,
  src_DELIVERY_END_DTTM AS src_DELIVERY_END_DTTM,
  src_REQUESTED_DLVR_DTTM AS src_REQUESTED_DLVR_DTTM,
  src_MUST_DLVR_DTTM AS src_MUST_DLVR_DTTM,
  src_PROMISED_DLVR_DTTM AS src_PROMISED_DLVR_DTTM,
  src_DUE_DT AS src_DUE_DT,
  src_OMS_ORDER_DT AS src_OMS_ORDER_DT,
  src_RELEASE_DT AS src_RELEASE_DT,
  src_FIRST_RCPT_DT AS src_FIRST_RCPT_DT,
  src_LAST_RCPT_DT AS src_LAST_RCPT_DT,
  src_PAYMENT_MODE AS src_PAYMENT_MODE,
  src_MV_CURRENCY_CD AS src_MV_CURRENCY_CD,
  src_MONETARY_VALUE_AMT AS src_MONETARY_VALUE_AMT,
  src_CURRENCY_CD AS src_CURRENCY_CD,
  src_ORIG_BUDG_COST_AMT AS src_ORIG_BUDG_COST_AMT,
  src_BUDG_COST_CURRENCY_CD AS src_BUDG_COST_CURRENCY_CD,
  src_BUDG_COST_AMT AS src_BUDG_COST_AMT,
  src_TAX_CHARGES_AMT AS src_TAX_CHARGES_AMT,
  src_MISC_CHARGES_AMT AS src_MISC_CHARGES_AMT,
  src_CANCELLED_FLG AS src_CANCELLED_FLG,
  src_IMPORTED_FLG AS src_IMPORTED_FLG,
  src_ALERTS_FLG AS src_ALERTS_FLG,
  src_READY_TO_SHIP_FLG AS src_READY_TO_SHIP_FLG,
  src_PARTIALLY_PLANNED_FLG AS src_PARTIALLY_PLANNED_FLG,
  src_BILL_OF_LADING_NBR AS src_BILL_OF_LADING_NBR,
  src_TRANS_RESP_CD AS src_TRANS_RESP_CD,
  src_COMMODITY_CD AS src_COMMODITY_CD,
  src_CARRIER_ID AS src_CARRIER_ID,
  src_PRODUCT_CLASS_ID AS src_PRODUCT_CLASS_ID,
  src_PROTECTION_LEVEL_ID AS src_PROTECTION_LEVEL_ID,
  src_DECLINE_REASON_ID AS src_DECLINE_REASON_ID,
  src_CHANNEL_TYPE_ID AS src_CHANNEL_TYPE_ID,
  src_CUSTOMER_CODE AS src_CUSTOMER_CODE,
  src_CUSTOMER_PICKUP_FLG AS src_CUSTOMER_PICKUP_FLG,
  src_CUSTOMER_FIRSTNAME AS src_CUSTOMER_FIRSTNAME,
  src_CUSTOMER_LASTNAME AS src_CUSTOMER_LASTNAME,
  src_CUSTOMER_EMAIL AS src_CUSTOMER_EMAIL,
  src_CUSTOMER_PHONE AS src_CUSTOMER_PHONE,
  src_CREATED_SOURCE_TYPE AS src_CREATED_SOURCE_TYPE,
  src_CREATED_SOURCE AS src_CREATED_SOURCE,
  src_CREATED_DTTM AS src_CREATED_DTTM,
  src_LAST_UPDATED_DTTM AS src_LAST_UPDATED_DTTM,
  src_DROPOFF_PICKUP AS src_DROPOFF_PICKUP,
  src_CLOSED_FLG AS src_CLOSED_FLG,
  src_GRAND_TOTAL_AMT AS src_GRAND_TOTAL_AMT,
  src_ORDER_CATEGORY_ID AS src_ORDER_CATEGORY_ID,
  src_CHANNEL_ID AS src_CHANNEL_ID,
  src_FULFILL_MODE AS src_FULFILL_MODE,
  src_ENTRY_CODE AS src_ENTRY_CODE,
  src_PAYMENT_STATUS AS src_PAYMENT_STATUS,
  src_REASON_ID AS src_REASON_ID,
  src_ORDER_RECEIVED_FLG AS src_ORDER_RECEIVED_FLG,
  src_FREIGHT_REVENUE_AMT AS src_FREIGHT_REVENUE_AMT,
  src_REASON_CODES_GROUP_ID AS src_REASON_CODES_GROUP_ID,
  src_RETURN_REFERENCE_NBR AS src_RETURN_REFERENCE_NBR,
  src_CANCELLED_TYPE_ID AS src_CANCELLED_TYPE_ID,
  src_ORDER_CREATION_CHANNEL AS src_ORDER_CREATION_CHANNEL,
  src_OMS_ORDER_TYPE AS src_OMS_ORDER_TYPE,
  src_TAX_AMOUNT AS src_TAX_AMOUNT,
  src_BILL_TO_FIRST_NAME AS src_BILL_TO_FIRST_NAME,
  src_BILL_TO_LAST_NAME AS src_BILL_TO_LAST_NAME,
  src_BILL_TO_ADDRESS_LINE1 AS src_BILL_TO_ADDRESS_LINE1,
  src_BILL_TO_CITY AS src_BILL_TO_CITY,
  src_BILLTO_STATE_PROV AS src_BILLTO_STATE_PROV,
  src_BILL_TO_POSTAL_CODE AS src_BILL_TO_POSTAL_CODE,
  src_BILL_TO_COUNTRY_CODE AS src_BILL_TO_COUNTRY_CODE,
  src_BILL_TO_PHONE_NUMBER AS src_BILL_TO_PHONE_NUMBER,
  src_BILL_TO_EMAIL AS src_BILL_TO_EMAIL,
  src_AFTERPAY_FLG AS src_AFTERPAY_FLG,
  src_SCHED_DELIVERY_FLG AS src_SCHED_DELIVERY_FLG,
  src_SUBSCRIPTION_ORDER_FLG AS src_SUBSCRIPTION_ORDER_FLG,
  src_REASON_CODE AS src_REASON_CODE,
  src_CANCELLED_DTTM AS src_CANCELLED_DTTM,
  src_TC_COMPANY_ID AS src_TC_COMPANY_ID,
  src_ON_HOLD AS src_ON_HOLD,
  src_CREATION_DEVICE_TYPE AS src_CREATION_DEVICE_TYPE,
  src_CREATION_DEVICE_WIDTH AS src_CREATION_DEVICE_WIDTH,
  ORIG_LOCATION_ID AS ORIG_LOCATION_ID,
  DEST_LOCATION_ID AS DEST_LOCATION_ID,
  BILL_LOCATION_ID AS BILL_LOCATION_ID,
  ORG_SHIP_VIA_LOCATION_ID AS ORG_SHIP_VIA_LOCATION_ID,
  DES_SHIP_VIA_LOCATION_ID AS DES_SHIP_VIA_LOCATION_ID,
  EXCHANGE_RATE_PCNT AS EXCHANGE_RATE_PCNT,
  LOAD_FLAG AS LOAD_FLAG,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  EXP_FLAGS_50
WHERE
  IN(LOAD_FLAG, 'INSERT', 'UPDATE')"""

df_51 = spark.sql(query_51)

df_51.createOrReplaceTempView("FIL_FLAGS_51")

# COMMAND ----------
# DBTITLE 1, UPD_INSERT_UPDATE_52


query_52 = f"""SELECT
  src_PURCHASE_ORDERS_ID AS src_PURCHASE_ORDERS_ID,
  src_CREATION_TYPE AS src_CREATION_TYPE,
  src_PURCHASE_ORDERS_TYPE AS src_PURCHASE_ORDERS_TYPE,
  src_PURCHASE_ORDERS_STATUS AS src_PURCHASE_ORDERS_STATUS,
  src_TC_PURCHASE_ORDERS_ID AS src_TC_PURCHASE_ORDERS_ID,
  src_ORDER_NBR AS src_ORDER_NBR,
  src_PARENT_PURCHASE_ORDERS_ID AS src_PARENT_PURCHASE_ORDERS_ID,
  src_O_FACILITY_ALIAS_ID AS src_O_FACILITY_ALIAS_ID,
  src_D_FACILITY_ALIAS_ID AS src_D_FACILITY_ALIAS_ID,
  src_BILL_FACILITY_ALIAS_ID AS src_BILL_FACILITY_ALIAS_ID,
  src_ORG_SHIP_VIA_FACILITY_ALIAS_ID AS src_ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  src_DES_SHIP_VIA_FACILITY_ALIAS_ID AS src_DES_SHIP_VIA_FACILITY_ALIAS_ID,
  src_PICKUP_TZ AS src_PICKUP_TZ,
  src_DELIVERY_TZ AS src_DELIVERY_TZ,
  src_PICKUP_START_DTTM AS src_PICKUP_START_DTTM,
  src_PICKUP_END_DTTM AS src_PICKUP_END_DTTM,
  src_DELIVERY_START_DTTM AS src_DELIVERY_START_DTTM,
  src_DELIVERY_END_DTTM AS src_DELIVERY_END_DTTM,
  src_REQUESTED_DLVR_DTTM AS src_REQUESTED_DLVR_DTTM,
  src_MUST_DLVR_DTTM AS src_MUST_DLVR_DTTM,
  src_PROMISED_DLVR_DTTM AS src_PROMISED_DLVR_DTTM,
  src_DUE_DT AS src_DUE_DT,
  src_OMS_ORDER_DT AS src_OMS_ORDER_DT,
  src_RELEASE_DT AS src_RELEASE_DT,
  src_FIRST_RCPT_DT AS src_FIRST_RCPT_DT,
  src_LAST_RCPT_DT AS src_LAST_RCPT_DT,
  src_PAYMENT_MODE AS src_PAYMENT_MODE,
  src_MV_CURRENCY_CD AS src_MV_CURRENCY_CD,
  src_MONETARY_VALUE_AMT AS src_MONETARY_VALUE_AMT,
  src_CURRENCY_CD AS src_CURRENCY_CD,
  src_ORIG_BUDG_COST_AMT AS src_ORIG_BUDG_COST_AMT,
  src_BUDG_COST_CURRENCY_CD AS src_BUDG_COST_CURRENCY_CD,
  src_BUDG_COST_AMT AS src_BUDG_COST_AMT,
  src_TAX_CHARGES_AMT AS src_TAX_CHARGES_AMT,
  src_MISC_CHARGES_AMT AS src_MISC_CHARGES_AMT,
  src_CANCELLED_FLG AS src_CANCELLED_FLG,
  src_IMPORTED_FLG AS src_IMPORTED_FLG,
  src_ALERTS_FLG AS src_ALERTS_FLG,
  src_READY_TO_SHIP_FLG AS src_READY_TO_SHIP_FLG,
  src_PARTIALLY_PLANNED_FLG AS src_PARTIALLY_PLANNED_FLG,
  src_BILL_OF_LADING_NBR AS src_BILL_OF_LADING_NBR,
  src_TRANS_RESP_CD AS src_TRANS_RESP_CD,
  src_COMMODITY_CD AS src_COMMODITY_CD,
  src_CARRIER_ID AS src_CARRIER_ID,
  src_PRODUCT_CLASS_ID AS src_PRODUCT_CLASS_ID,
  src_PROTECTION_LEVEL_ID AS src_PROTECTION_LEVEL_ID,
  src_DECLINE_REASON_ID AS src_DECLINE_REASON_ID,
  src_CHANNEL_TYPE_ID AS src_CHANNEL_TYPE_ID,
  src_CUSTOMER_CODE AS src_CUSTOMER_CODE,
  src_CUSTOMER_PICKUP_FLG AS src_CUSTOMER_PICKUP_FLG,
  src_CUSTOMER_FIRSTNAME AS src_CUSTOMER_FIRSTNAME,
  src_CUSTOMER_LASTNAME AS src_CUSTOMER_LASTNAME,
  src_CUSTOMER_EMAIL AS src_CUSTOMER_EMAIL,
  src_CUSTOMER_PHONE AS src_CUSTOMER_PHONE,
  src_CREATED_SOURCE_TYPE AS src_CREATED_SOURCE_TYPE,
  src_CREATED_SOURCE AS src_CREATED_SOURCE,
  src_CREATED_DTTM AS src_CREATED_DTTM,
  src_LAST_UPDATED_DTTM AS src_LAST_UPDATED_DTTM,
  src_DROPOFF_PICKUP AS src_DROPOFF_PICKUP,
  src_CLOSED_FLG AS src_CLOSED_FLG,
  src_GRAND_TOTAL_AMT AS src_GRAND_TOTAL_AMT,
  src_ORDER_CATEGORY_ID AS src_ORDER_CATEGORY_ID,
  src_CHANNEL_ID AS src_CHANNEL_ID,
  src_FULFILL_MODE AS src_FULFILL_MODE,
  src_ENTRY_CODE AS src_ENTRY_CODE,
  src_PAYMENT_STATUS AS src_PAYMENT_STATUS,
  src_REASON_ID AS src_REASON_ID,
  src_ORDER_RECEIVED_FLG AS src_ORDER_RECEIVED_FLG,
  src_FREIGHT_REVENUE_AMT AS src_FREIGHT_REVENUE_AMT,
  src_REASON_CODES_GROUP_ID AS src_REASON_CODES_GROUP_ID,
  src_RETURN_REFERENCE_NBR AS src_RETURN_REFERENCE_NBR,
  src_CANCELLED_TYPE_ID AS src_CANCELLED_TYPE_ID,
  src_ORDER_CREATION_CHANNEL AS src_ORDER_CREATION_CHANNEL,
  src_OMS_ORDER_TYPE AS src_OMS_ORDER_TYPE,
  src_TAX_AMOUNT AS src_TAX_AMOUNT,
  src_BILL_TO_FIRST_NAME AS src_BILL_TO_FIRST_NAME,
  src_BILL_TO_LAST_NAME AS src_BILL_TO_LAST_NAME,
  src_BILL_TO_ADDRESS_LINE1 AS src_BILL_TO_ADDRESS_LINE1,
  src_BILL_TO_CITY AS src_BILL_TO_CITY,
  src_BILLTO_STATE_PROV AS src_BILLTO_STATE_PROV,
  src_BILL_TO_POSTAL_CODE AS src_BILL_TO_POSTAL_CODE,
  src_BILL_TO_COUNTRY_CODE AS src_BILL_TO_COUNTRY_CODE,
  src_BILL_TO_PHONE_NUMBER AS src_BILL_TO_PHONE_NUMBER,
  src_BILL_TO_EMAIL AS src_BILL_TO_EMAIL,
  src_AFTERPAY_FLG AS src_AFTERPAY_FLG,
  src_SCHED_DELIVERY_FLG AS src_SCHED_DELIVERY_FLG,
  src_SUBSCRIPTION_ORDER_FLG AS src_SUBSCRIPTION_ORDER_FLG,
  src_REASON_CODE AS src_REASON_CODE,
  src_CANCELLED_DTTM AS src_CANCELLED_DTTM,
  src_TC_COMPANY_ID AS src_TC_COMPANY_ID,
  src_ON_HOLD AS src_ON_HOLD,
  src_CREATION_DEVICE_TYPE AS src_CREATION_DEVICE_TYPE,
  src_CREATION_DEVICE_WIDTH AS src_CREATION_DEVICE_WIDTH,
  ORIG_LOCATION_ID AS ORIG_LOCATION_ID,
  DEST_LOCATION_ID AS DEST_LOCATION_ID,
  BILL_LOCATION_ID AS BILL_LOCATION_ID,
  ORG_SHIP_VIA_LOCATION_ID AS ORG_SHIP_VIA_LOCATION_ID,
  DES_SHIP_VIA_LOCATION_ID AS DES_SHIP_VIA_LOCATION_ID,
  EXCHANGE_RATE_PCNT AS EXCHANGE_RATE_PCNT,
  LOAD_FLAG AS LOAD_FLAG,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id,
  DECODE(
    LOAD_FLAG,
    'INSERT',
    'DD_INSERT',
    'UPDATE',
    'DD_UPDATE'
  ) AS UPDATE_STRATEGY_FLAG
FROM
  FIL_FLAGS_51"""

df_52 = spark.sql(query_52)

df_52.createOrReplaceTempView("UPD_INSERT_UPDATE_52")

# COMMAND ----------
# DBTITLE 1, OMS_ORDER


spark.sql("""MERGE INTO OMS_ORDER AS TARGET
USING
  UPD_INSERT_UPDATE_52 AS SOURCE ON TARGET.OMS_ORDER_ID = SOURCE.src_PURCHASE_ORDERS_ID
  WHEN MATCHED
  AND SOURCE.UPDATE_STRATEGY_FLAG = "DD_UPDATE" THEN
UPDATE
SET
  TARGET.OMS_ORDER_ID = SOURCE.src_PURCHASE_ORDERS_ID,
  TARGET.OMS_ORDER_NBR = SOURCE.src_TC_PURCHASE_ORDERS_ID,
  TARGET.ORDER_NBR = SOURCE.src_ORDER_NBR,
  TARGET.OMS_PARENT_ORDER_ID = SOURCE.src_PARENT_PURCHASE_ORDERS_ID,
  TARGET.OMS_ORDER_DT = SOURCE.src_OMS_ORDER_DT,
  TARGET.ORDER_CREATION_CHANNEL = SOURCE.src_ORDER_CREATION_CHANNEL,
  TARGET.CREATION_TYPE = SOURCE.src_CREATION_TYPE,
  TARGET.CREATION_DEVICE_TYPE = SOURCE.src_CREATION_DEVICE_TYPE,
  TARGET.CREATION_DEVICE_WIDTH = SOURCE.src_CREATION_DEVICE_WIDTH,
  TARGET.CHANNEL_TYPE_ID = SOURCE.src_CHANNEL_TYPE_ID,
  TARGET.CHANNEL_ID = SOURCE.src_CHANNEL_ID,
  TARGET.OMS_ORDER_TYPE = SOURCE.src_OMS_ORDER_TYPE,
  TARGET.OMS_ORDER_TYPE_ID = SOURCE.src_PURCHASE_ORDERS_TYPE,
  TARGET.ORDER_CATEGORY_ID = SOURCE.src_ORDER_CATEGORY_ID,
  TARGET.SCHED_DELIVERY_FLG = SOURCE.src_SCHED_DELIVERY_FLG,
  TARGET.SUBSCRIPTION_ORDER_FLG = SOURCE.src_SUBSCRIPTION_ORDER_FLG,
  TARGET.CUSTOMER_PICKUP_FLG = SOURCE.src_CUSTOMER_PICKUP_FLG,
  TARGET.OMS_ORDER_STATUS_ID = SOURCE.src_PURCHASE_ORDERS_STATUS,
  TARGET.REASON_ID = SOURCE.src_REASON_ID,
  TARGET.REASON_CODES_GROUP_ID = SOURCE.src_REASON_CODES_GROUP_ID,
  TARGET.ORDER_RECEIVED_FLG = SOURCE.src_ORDER_RECEIVED_FLG,
  TARGET.PARTIALLY_PLANNED_FLG = SOURCE.src_PARTIALLY_PLANNED_FLG,
  TARGET.READY_TO_SHIP_FLG = SOURCE.src_READY_TO_SHIP_FLG,
  TARGET.CLOSED_FLG = SOURCE.src_CLOSED_FLG,
  TARGET.ON_HOLD = SOURCE.src_ON_HOLD,
  TARGET.CANCELLED_FLG = SOURCE.src_CANCELLED_FLG,
  TARGET.CANCELLED_TSTMP = SOURCE.src_CANCELLED_DTTM,
  TARGET.OMS_CANCELLED_TYPE_ID = SOURCE.src_CANCELLED_TYPE_ID,
  TARGET.CANCEL_REASON_DESC = SOURCE.src_REASON_CODE,
  TARGET.DECLINE_REASON_ID = SOURCE.src_DECLINE_REASON_ID,
  TARGET.OMS_COMPANY_ID = SOURCE.src_TC_COMPANY_ID,
  TARGET.BILL_OF_LADING_NBR = SOURCE.src_BILL_OF_LADING_NBR,
  TARGET.RETURN_REFERENCE_NBR = SOURCE.src_RETURN_REFERENCE_NBR,
  TARGET.COMMODITY_CD = SOURCE.src_COMMODITY_CD,
  TARGET.CARRIER_ID = SOURCE.src_CARRIER_ID,
  TARGET.PRODUCT_CLASS_ID = SOURCE.src_PRODUCT_CLASS_ID,
  TARGET.PROTECTION_LEVEL_ID = SOURCE.src_PROTECTION_LEVEL_ID,
  TARGET.DROPOFF_PICKUP = SOURCE.src_DROPOFF_PICKUP,
  TARGET.ENTRY_CODE = SOURCE.src_ENTRY_CODE,
  TARGET.FULFILL_MODE = SOURCE.src_FULFILL_MODE,
  TARGET.IMPORTED_FLG = SOURCE.src_IMPORTED_FLG,
  TARGET.ALERTS_FLG = SOURCE.src_ALERTS_FLG,
  TARGET.TRANS_RESP_CD = SOURCE.src_TRANS_RESP_CD,
  TARGET.ORIG_LOCATION_NBR = SOURCE.src_O_FACILITY_ALIAS_ID,
  TARGET.ORIG_LOCATION_ID = SOURCE.ORIG_LOCATION_ID,
  TARGET.ORIG_SHIP_VIA_LOCATION_ID = SOURCE.ORG_SHIP_VIA_LOCATION_ID,
  TARGET.DEST_LOCATION_NBR = SOURCE.src_D_FACILITY_ALIAS_ID,
  TARGET.DEST_LOCATION_ID = SOURCE.DEST_LOCATION_ID,
  TARGET.DEST_SHIP_VIA_LOCATION_ID = SOURCE.DES_SHIP_VIA_LOCATION_ID,
  TARGET.BILL_LOCATION_NBR = SOURCE.src_BILL_FACILITY_ALIAS_ID,
  TARGET.BILL_LOCATION_ID = SOURCE.BILL_LOCATION_ID,
  TARGET.RELEASE_DT = SOURCE.src_RELEASE_DT,
  TARGET.FIRST_RCPT_DT = SOURCE.src_FIRST_RCPT_DT,
  TARGET.LAST_RCPT_DT = SOURCE.src_LAST_RCPT_DT,
  TARGET.DUE_DT = SOURCE.src_DUE_DT,
  TARGET.PICKUP_START_DT = SOURCE.src_PICKUP_START_DTTM,
  TARGET.PICKUP_END_DT = SOURCE.src_PICKUP_END_DTTM,
  TARGET.PICKUP_TZ = SOURCE.src_PICKUP_TZ,
  TARGET.REQUESTED_DLVR_DT = SOURCE.src_REQUESTED_DLVR_DTTM,
  TARGET.PROMISED_DLVR_DT = SOURCE.src_PROMISED_DLVR_DTTM,
  TARGET.MUST_DLVR_DT = SOURCE.src_MUST_DLVR_DTTM,
  TARGET.DELIVERY_START_DT = SOURCE.src_DELIVERY_START_DTTM,
  TARGET.DELIVERY_END_DT = SOURCE.src_DELIVERY_END_DTTM,
  TARGET.DELIVERY_TZ = SOURCE.src_DELIVERY_TZ,
  TARGET.CUSTOMER_CD = SOURCE.src_CUSTOMER_CODE,
  TARGET.CUSTOMER_FIRST_NAME = SOURCE.src_CUSTOMER_FIRSTNAME,
  TARGET.CUSTOMER_LAST_NAME = SOURCE.src_CUSTOMER_LASTNAME,
  TARGET.CUSTOMER_EMAIL = SOURCE.src_CUSTOMER_EMAIL,
  TARGET.CUSTOMER_PHONE = SOURCE.src_CUSTOMER_PHONE,
  TARGET.BILL_FIRST_NAME = SOURCE.src_BILL_TO_FIRST_NAME,
  TARGET.BILL_LAST_NAME = SOURCE.src_BILL_TO_LAST_NAME,
  TARGET.BILL_ADDRESS = SOURCE.src_BILL_TO_ADDRESS_LINE1,
  TARGET.BILL_CITY = SOURCE.src_BILL_TO_CITY,
  TARGET.BILL_STATE_CD = SOURCE.src_BILLTO_STATE_PROV,
  TARGET.BILL_POSTAL_CD = SOURCE.src_BILL_TO_POSTAL_CODE,
  TARGET.BILL_COUNTRY_CD = SOURCE.src_BILL_TO_COUNTRY_CODE,
  TARGET.BILL_PHONE = SOURCE.src_BILL_TO_PHONE_NUMBER,
  TARGET.BILL_EMAIL = SOURCE.src_BILL_TO_EMAIL,
  TARGET.AFTERPAY_FLG = SOURCE.src_AFTERPAY_FLG,
  TARGET.FREIGHT_REVENUE_AMT = SOURCE.src_FREIGHT_REVENUE_AMT,
  TARGET.MONETARY_VALUE_AMT = SOURCE.src_MONETARY_VALUE_AMT,
  TARGET.ORIG_BUDG_COST_AMT = SOURCE.src_ORIG_BUDG_COST_AMT,
  TARGET.BUDG_COST_AMT = SOURCE.src_BUDG_COST_AMT,
  TARGET.TAX_AMT = SOURCE.src_TAX_AMOUNT,
  TARGET.TAX_CHARGES_AMT = SOURCE.src_TAX_CHARGES_AMT,
  TARGET.MISC_CHARGES_AMT = SOURCE.src_MISC_CHARGES_AMT,
  TARGET.GRAND_TOTAL_AMT = SOURCE.src_GRAND_TOTAL_AMT,
  TARGET.PAYMENT_STATUS = SOURCE.src_PAYMENT_STATUS,
  TARGET.PAYMENT_MODE = SOURCE.src_PAYMENT_MODE,
  TARGET.BUDG_COST_CURRENCY_CD = SOURCE.src_BUDG_COST_CURRENCY_CD,
  TARGET.MV_CURRENCY_CD = SOURCE.src_MV_CURRENCY_CD,
  TARGET.CURRENCY_CD = SOURCE.src_CURRENCY_CD,
  TARGET.EXCHANGE_RATE_PCNT = SOURCE.EXCHANGE_RATE_PCNT,
  TARGET.CREATED_SOURCE_TYPE = SOURCE.src_CREATED_SOURCE_TYPE,
  TARGET.CREATED_SOURCE = SOURCE.src_CREATED_SOURCE,
  TARGET.CREATED_TSTMP = SOURCE.src_CREATED_DTTM,
  TARGET.LAST_UPDATED_TSTMP = SOURCE.src_LAST_UPDATED_DTTM,
  TARGET.UPDATE_TSTMP = SOURCE.UPDATE_TSTMP,
  TARGET.LOAD_TSTMP = SOURCE.LOAD_TSTMP
  WHEN MATCHED
  AND SOURCE.UPDATE_STRATEGY_FLAG = "DD_DELETE"
  AND TARGET.OMS_ORDER_NBR = SOURCE.src_TC_PURCHASE_ORDERS_ID
  AND TARGET.ORDER_NBR = SOURCE.src_ORDER_NBR
  AND TARGET.OMS_PARENT_ORDER_ID = SOURCE.src_PARENT_PURCHASE_ORDERS_ID
  AND TARGET.OMS_ORDER_DT = SOURCE.src_OMS_ORDER_DT
  AND TARGET.ORDER_CREATION_CHANNEL = SOURCE.src_ORDER_CREATION_CHANNEL
  AND TARGET.CREATION_TYPE = SOURCE.src_CREATION_TYPE
  AND TARGET.CREATION_DEVICE_TYPE = SOURCE.src_CREATION_DEVICE_TYPE
  AND TARGET.CREATION_DEVICE_WIDTH = SOURCE.src_CREATION_DEVICE_WIDTH
  AND TARGET.CHANNEL_TYPE_ID = SOURCE.src_CHANNEL_TYPE_ID
  AND TARGET.CHANNEL_ID = SOURCE.src_CHANNEL_ID
  AND TARGET.OMS_ORDER_TYPE = SOURCE.src_OMS_ORDER_TYPE
  AND TARGET.OMS_ORDER_TYPE_ID = SOURCE.src_PURCHASE_ORDERS_TYPE
  AND TARGET.ORDER_CATEGORY_ID = SOURCE.src_ORDER_CATEGORY_ID
  AND TARGET.SCHED_DELIVERY_FLG = SOURCE.src_SCHED_DELIVERY_FLG
  AND TARGET.SUBSCRIPTION_ORDER_FLG = SOURCE.src_SUBSCRIPTION_ORDER_FLG
  AND TARGET.CUSTOMER_PICKUP_FLG = SOURCE.src_CUSTOMER_PICKUP_FLG
  AND TARGET.OMS_ORDER_STATUS_ID = SOURCE.src_PURCHASE_ORDERS_STATUS
  AND TARGET.REASON_ID = SOURCE.src_REASON_ID
  AND TARGET.REASON_CODES_GROUP_ID = SOURCE.src_REASON_CODES_GROUP_ID
  AND TARGET.ORDER_RECEIVED_FLG = SOURCE.src_ORDER_RECEIVED_FLG
  AND TARGET.PARTIALLY_PLANNED_FLG = SOURCE.src_PARTIALLY_PLANNED_FLG
  AND TARGET.READY_TO_SHIP_FLG = SOURCE.src_READY_TO_SHIP_FLG
  AND TARGET.CLOSED_FLG = SOURCE.src_CLOSED_FLG
  AND TARGET.ON_HOLD = SOURCE.src_ON_HOLD
  AND TARGET.CANCELLED_FLG = SOURCE.src_CANCELLED_FLG
  AND TARGET.CANCELLED_TSTMP = SOURCE.src_CANCELLED_DTTM
  AND TARGET.OMS_CANCELLED_TYPE_ID = SOURCE.src_CANCELLED_TYPE_ID
  AND TARGET.CANCEL_REASON_DESC = SOURCE.src_REASON_CODE
  AND TARGET.DECLINE_REASON_ID = SOURCE.src_DECLINE_REASON_ID
  AND TARGET.OMS_COMPANY_ID = SOURCE.src_TC_COMPANY_ID
  AND TARGET.BILL_OF_LADING_NBR = SOURCE.src_BILL_OF_LADING_NBR
  AND TARGET.RETURN_REFERENCE_NBR = SOURCE.src_RETURN_REFERENCE_NBR
  AND TARGET.COMMODITY_CD = SOURCE.src_COMMODITY_CD
  AND TARGET.CARRIER_ID = SOURCE.src_CARRIER_ID
  AND TARGET.PRODUCT_CLASS_ID = SOURCE.src_PRODUCT_CLASS_ID
  AND TARGET.PROTECTION_LEVEL_ID = SOURCE.src_PROTECTION_LEVEL_ID
  AND TARGET.DROPOFF_PICKUP = SOURCE.src_DROPOFF_PICKUP
  AND TARGET.ENTRY_CODE = SOURCE.src_ENTRY_CODE
  AND TARGET.FULFILL_MODE = SOURCE.src_FULFILL_MODE
  AND TARGET.IMPORTED_FLG = SOURCE.src_IMPORTED_FLG
  AND TARGET.ALERTS_FLG = SOURCE.src_ALERTS_FLG
  AND TARGET.TRANS_RESP_CD = SOURCE.src_TRANS_RESP_CD
  AND TARGET.ORIG_LOCATION_NBR = SOURCE.src_O_FACILITY_ALIAS_ID
  AND TARGET.ORIG_LOCATION_ID = SOURCE.ORIG_LOCATION_ID
  AND TARGET.ORIG_SHIP_VIA_LOCATION_ID = SOURCE.ORG_SHIP_VIA_LOCATION_ID
  AND TARGET.DEST_LOCATION_NBR = SOURCE.src_D_FACILITY_ALIAS_ID
  AND TARGET.DEST_LOCATION_ID = SOURCE.DEST_LOCATION_ID
  AND TARGET.DEST_SHIP_VIA_LOCATION_ID = SOURCE.DES_SHIP_VIA_LOCATION_ID
  AND TARGET.BILL_LOCATION_NBR = SOURCE.src_BILL_FACILITY_ALIAS_ID
  AND TARGET.BILL_LOCATION_ID = SOURCE.BILL_LOCATION_ID
  AND TARGET.RELEASE_DT = SOURCE.src_RELEASE_DT
  AND TARGET.FIRST_RCPT_DT = SOURCE.src_FIRST_RCPT_DT
  AND TARGET.LAST_RCPT_DT = SOURCE.src_LAST_RCPT_DT
  AND TARGET.DUE_DT = SOURCE.src_DUE_DT
  AND TARGET.PICKUP_START_DT = SOURCE.src_PICKUP_START_DTTM
  AND TARGET.PICKUP_END_DT = SOURCE.src_PICKUP_END_DTTM
  AND TARGET.PICKUP_TZ = SOURCE.src_PICKUP_TZ
  AND TARGET.REQUESTED_DLVR_DT = SOURCE.src_REQUESTED_DLVR_DTTM
  AND TARGET.PROMISED_DLVR_DT = SOURCE.src_PROMISED_DLVR_DTTM
  AND TARGET.MUST_DLVR_DT = SOURCE.src_MUST_DLVR_DTTM
  AND TARGET.DELIVERY_START_DT = SOURCE.src_DELIVERY_START_DTTM
  AND TARGET.DELIVERY_END_DT = SOURCE.src_DELIVERY_END_DTTM
  AND TARGET.DELIVERY_TZ = SOURCE.src_DELIVERY_TZ
  AND TARGET.CUSTOMER_CD = SOURCE.src_CUSTOMER_CODE
  AND TARGET.CUSTOMER_FIRST_NAME = SOURCE.src_CUSTOMER_FIRSTNAME
  AND TARGET.CUSTOMER_LAST_NAME = SOURCE.src_CUSTOMER_LASTNAME
  AND TARGET.CUSTOMER_EMAIL = SOURCE.src_CUSTOMER_EMAIL
  AND TARGET.CUSTOMER_PHONE = SOURCE.src_CUSTOMER_PHONE
  AND TARGET.BILL_FIRST_NAME = SOURCE.src_BILL_TO_FIRST_NAME
  AND TARGET.BILL_LAST_NAME = SOURCE.src_BILL_TO_LAST_NAME
  AND TARGET.BILL_ADDRESS = SOURCE.src_BILL_TO_ADDRESS_LINE1
  AND TARGET.BILL_CITY = SOURCE.src_BILL_TO_CITY
  AND TARGET.BILL_STATE_CD = SOURCE.src_BILLTO_STATE_PROV
  AND TARGET.BILL_POSTAL_CD = SOURCE.src_BILL_TO_POSTAL_CODE
  AND TARGET.BILL_COUNTRY_CD = SOURCE.src_BILL_TO_COUNTRY_CODE
  AND TARGET.BILL_PHONE = SOURCE.src_BILL_TO_PHONE_NUMBER
  AND TARGET.BILL_EMAIL = SOURCE.src_BILL_TO_EMAIL
  AND TARGET.AFTERPAY_FLG = SOURCE.src_AFTERPAY_FLG
  AND TARGET.FREIGHT_REVENUE_AMT = SOURCE.src_FREIGHT_REVENUE_AMT
  AND TARGET.MONETARY_VALUE_AMT = SOURCE.src_MONETARY_VALUE_AMT
  AND TARGET.ORIG_BUDG_COST_AMT = SOURCE.src_ORIG_BUDG_COST_AMT
  AND TARGET.BUDG_COST_AMT = SOURCE.src_BUDG_COST_AMT
  AND TARGET.TAX_AMT = SOURCE.src_TAX_AMOUNT
  AND TARGET.TAX_CHARGES_AMT = SOURCE.src_TAX_CHARGES_AMT
  AND TARGET.MISC_CHARGES_AMT = SOURCE.src_MISC_CHARGES_AMT
  AND TARGET.GRAND_TOTAL_AMT = SOURCE.src_GRAND_TOTAL_AMT
  AND TARGET.PAYMENT_STATUS = SOURCE.src_PAYMENT_STATUS
  AND TARGET.PAYMENT_MODE = SOURCE.src_PAYMENT_MODE
  AND TARGET.BUDG_COST_CURRENCY_CD = SOURCE.src_BUDG_COST_CURRENCY_CD
  AND TARGET.MV_CURRENCY_CD = SOURCE.src_MV_CURRENCY_CD
  AND TARGET.CURRENCY_CD = SOURCE.src_CURRENCY_CD
  AND TARGET.EXCHANGE_RATE_PCNT = SOURCE.EXCHANGE_RATE_PCNT
  AND TARGET.CREATED_SOURCE_TYPE = SOURCE.src_CREATED_SOURCE_TYPE
  AND TARGET.CREATED_SOURCE = SOURCE.src_CREATED_SOURCE
  AND TARGET.CREATED_TSTMP = SOURCE.src_CREATED_DTTM
  AND TARGET.LAST_UPDATED_TSTMP = SOURCE.src_LAST_UPDATED_DTTM
  AND TARGET.UPDATE_TSTMP = SOURCE.UPDATE_TSTMP
  AND TARGET.LOAD_TSTMP = SOURCE.LOAD_TSTMP THEN DELETE
  WHEN NOT MATCHED
  AND SOURCE.UPDATE_STRATEGY_FLAG = "DD_INSERT" THEN
INSERT
  (
    TARGET.OMS_ORDER_ID,
    TARGET.OMS_ORDER_NBR,
    TARGET.ORDER_NBR,
    TARGET.OMS_PARENT_ORDER_ID,
    TARGET.OMS_ORDER_DT,
    TARGET.ORDER_CREATION_CHANNEL,
    TARGET.CREATION_TYPE,
    TARGET.CREATION_DEVICE_TYPE,
    TARGET.CREATION_DEVICE_WIDTH,
    TARGET.CHANNEL_TYPE_ID,
    TARGET.CHANNEL_ID,
    TARGET.OMS_ORDER_TYPE,
    TARGET.OMS_ORDER_TYPE_ID,
    TARGET.ORDER_CATEGORY_ID,
    TARGET.SCHED_DELIVERY_FLG,
    TARGET.SUBSCRIPTION_ORDER_FLG,
    TARGET.CUSTOMER_PICKUP_FLG,
    TARGET.OMS_ORDER_STATUS_ID,
    TARGET.REASON_ID,
    TARGET.REASON_CODES_GROUP_ID,
    TARGET.ORDER_RECEIVED_FLG,
    TARGET.PARTIALLY_PLANNED_FLG,
    TARGET.READY_TO_SHIP_FLG,
    TARGET.CLOSED_FLG,
    TARGET.ON_HOLD,
    TARGET.CANCELLED_FLG,
    TARGET.CANCELLED_TSTMP,
    TARGET.OMS_CANCELLED_TYPE_ID,
    TARGET.CANCEL_REASON_DESC,
    TARGET.DECLINE_REASON_ID,
    TARGET.OMS_COMPANY_ID,
    TARGET.BILL_OF_LADING_NBR,
    TARGET.RETURN_REFERENCE_NBR,
    TARGET.COMMODITY_CD,
    TARGET.CARRIER_ID,
    TARGET.PRODUCT_CLASS_ID,
    TARGET.PROTECTION_LEVEL_ID,
    TARGET.DROPOFF_PICKUP,
    TARGET.ENTRY_CODE,
    TARGET.FULFILL_MODE,
    TARGET.IMPORTED_FLG,
    TARGET.ALERTS_FLG,
    TARGET.TRANS_RESP_CD,
    TARGET.ORIG_LOCATION_NBR,
    TARGET.ORIG_LOCATION_ID,
    TARGET.ORIG_SHIP_VIA_LOCATION_ID,
    TARGET.DEST_LOCATION_NBR,
    TARGET.DEST_LOCATION_ID,
    TARGET.DEST_SHIP_VIA_LOCATION_ID,
    TARGET.BILL_LOCATION_NBR,
    TARGET.BILL_LOCATION_ID,
    TARGET.RELEASE_DT,
    TARGET.FIRST_RCPT_DT,
    TARGET.LAST_RCPT_DT,
    TARGET.DUE_DT,
    TARGET.PICKUP_START_DT,
    TARGET.PICKUP_END_DT,
    TARGET.PICKUP_TZ,
    TARGET.REQUESTED_DLVR_DT,
    TARGET.PROMISED_DLVR_DT,
    TARGET.MUST_DLVR_DT,
    TARGET.DELIVERY_START_DT,
    TARGET.DELIVERY_END_DT,
    TARGET.DELIVERY_TZ,
    TARGET.CUSTOMER_CD,
    TARGET.CUSTOMER_FIRST_NAME,
    TARGET.CUSTOMER_LAST_NAME,
    TARGET.CUSTOMER_EMAIL,
    TARGET.CUSTOMER_PHONE,
    TARGET.BILL_FIRST_NAME,
    TARGET.BILL_LAST_NAME,
    TARGET.BILL_ADDRESS,
    TARGET.BILL_CITY,
    TARGET.BILL_STATE_CD,
    TARGET.BILL_POSTAL_CD,
    TARGET.BILL_COUNTRY_CD,
    TARGET.BILL_PHONE,
    TARGET.BILL_EMAIL,
    TARGET.AFTERPAY_FLG,
    TARGET.FREIGHT_REVENUE_AMT,
    TARGET.MONETARY_VALUE_AMT,
    TARGET.ORIG_BUDG_COST_AMT,
    TARGET.BUDG_COST_AMT,
    TARGET.TAX_AMT,
    TARGET.TAX_CHARGES_AMT,
    TARGET.MISC_CHARGES_AMT,
    TARGET.GRAND_TOTAL_AMT,
    TARGET.PAYMENT_STATUS,
    TARGET.PAYMENT_MODE,
    TARGET.BUDG_COST_CURRENCY_CD,
    TARGET.MV_CURRENCY_CD,
    TARGET.CURRENCY_CD,
    TARGET.EXCHANGE_RATE_PCNT,
    TARGET.CREATED_SOURCE_TYPE,
    TARGET.CREATED_SOURCE,
    TARGET.CREATED_TSTMP,
    TARGET.LAST_UPDATED_TSTMP,
    TARGET.UPDATE_TSTMP,
    TARGET.LOAD_TSTMP
  )
VALUES
  (
    SOURCE.src_PURCHASE_ORDERS_ID,
    SOURCE.src_TC_PURCHASE_ORDERS_ID,
    SOURCE.src_ORDER_NBR,
    SOURCE.src_PARENT_PURCHASE_ORDERS_ID,
    SOURCE.src_OMS_ORDER_DT,
    SOURCE.src_ORDER_CREATION_CHANNEL,
    SOURCE.src_CREATION_TYPE,
    SOURCE.src_CREATION_DEVICE_TYPE,
    SOURCE.src_CREATION_DEVICE_WIDTH,
    SOURCE.src_CHANNEL_TYPE_ID,
    SOURCE.src_CHANNEL_ID,
    SOURCE.src_OMS_ORDER_TYPE,
    SOURCE.src_PURCHASE_ORDERS_TYPE,
    SOURCE.src_ORDER_CATEGORY_ID,
    SOURCE.src_SCHED_DELIVERY_FLG,
    SOURCE.src_SUBSCRIPTION_ORDER_FLG,
    SOURCE.src_CUSTOMER_PICKUP_FLG,
    SOURCE.src_PURCHASE_ORDERS_STATUS,
    SOURCE.src_REASON_ID,
    SOURCE.src_REASON_CODES_GROUP_ID,
    SOURCE.src_ORDER_RECEIVED_FLG,
    SOURCE.src_PARTIALLY_PLANNED_FLG,
    SOURCE.src_READY_TO_SHIP_FLG,
    SOURCE.src_CLOSED_FLG,
    SOURCE.src_ON_HOLD,
    SOURCE.src_CANCELLED_FLG,
    SOURCE.src_CANCELLED_DTTM,
    SOURCE.src_CANCELLED_TYPE_ID,
    SOURCE.src_REASON_CODE,
    SOURCE.src_DECLINE_REASON_ID,
    SOURCE.src_TC_COMPANY_ID,
    SOURCE.src_BILL_OF_LADING_NBR,
    SOURCE.src_RETURN_REFERENCE_NBR,
    SOURCE.src_COMMODITY_CD,
    SOURCE.src_CARRIER_ID,
    SOURCE.src_PRODUCT_CLASS_ID,
    SOURCE.src_PROTECTION_LEVEL_ID,
    SOURCE.src_DROPOFF_PICKUP,
    SOURCE.src_ENTRY_CODE,
    SOURCE.src_FULFILL_MODE,
    SOURCE.src_IMPORTED_FLG,
    SOURCE.src_ALERTS_FLG,
    SOURCE.src_TRANS_RESP_CD,
    SOURCE.src_O_FACILITY_ALIAS_ID,
    SOURCE.ORIG_LOCATION_ID,
    SOURCE.ORG_SHIP_VIA_LOCATION_ID,
    SOURCE.src_D_FACILITY_ALIAS_ID,
    SOURCE.DEST_LOCATION_ID,
    SOURCE.DES_SHIP_VIA_LOCATION_ID,
    SOURCE.src_BILL_FACILITY_ALIAS_ID,
    SOURCE.BILL_LOCATION_ID,
    SOURCE.src_RELEASE_DT,
    SOURCE.src_FIRST_RCPT_DT,
    SOURCE.src_LAST_RCPT_DT,
    SOURCE.src_DUE_DT,
    SOURCE.src_PICKUP_START_DTTM,
    SOURCE.src_PICKUP_END_DTTM,
    SOURCE.src_PICKUP_TZ,
    SOURCE.src_REQUESTED_DLVR_DTTM,
    SOURCE.src_PROMISED_DLVR_DTTM,
    SOURCE.src_MUST_DLVR_DTTM,
    SOURCE.src_DELIVERY_START_DTTM,
    SOURCE.src_DELIVERY_END_DTTM,
    SOURCE.src_DELIVERY_TZ,
    SOURCE.src_CUSTOMER_CODE,
    SOURCE.src_CUSTOMER_FIRSTNAME,
    SOURCE.src_CUSTOMER_LASTNAME,
    SOURCE.src_CUSTOMER_EMAIL,
    SOURCE.src_CUSTOMER_PHONE,
    SOURCE.src_BILL_TO_FIRST_NAME,
    SOURCE.src_BILL_TO_LAST_NAME,
    SOURCE.src_BILL_TO_ADDRESS_LINE1,
    SOURCE.src_BILL_TO_CITY,
    SOURCE.src_BILLTO_STATE_PROV,
    SOURCE.src_BILL_TO_POSTAL_CODE,
    SOURCE.src_BILL_TO_COUNTRY_CODE,
    SOURCE.src_BILL_TO_PHONE_NUMBER,
    SOURCE.src_BILL_TO_EMAIL,
    SOURCE.src_AFTERPAY_FLG,
    SOURCE.src_FREIGHT_REVENUE_AMT,
    SOURCE.src_MONETARY_VALUE_AMT,
    SOURCE.src_ORIG_BUDG_COST_AMT,
    SOURCE.src_BUDG_COST_AMT,
    SOURCE.src_TAX_AMOUNT,
    SOURCE.src_TAX_CHARGES_AMT,
    SOURCE.src_MISC_CHARGES_AMT,
    SOURCE.src_GRAND_TOTAL_AMT,
    SOURCE.src_PAYMENT_STATUS,
    SOURCE.src_PAYMENT_MODE,
    SOURCE.src_BUDG_COST_CURRENCY_CD,
    SOURCE.src_MV_CURRENCY_CD,
    SOURCE.src_CURRENCY_CD,
    SOURCE.EXCHANGE_RATE_PCNT,
    SOURCE.src_CREATED_SOURCE_TYPE,
    SOURCE.src_CREATED_SOURCE,
    SOURCE.src_CREATED_DTTM,
    SOURCE.src_LAST_UPDATED_DTTM,
    SOURCE.UPDATE_TSTMP,
    SOURCE.LOAD_TSTMP
  )""")

# COMMAND ----------
#Post session variable updation
updateVariable(postVariableAssignment, variablesTableName, mainWorkflowId, parentName, "m_OMS_Order")

# COMMAND ----------
#Update Mapping Variables in database.
persistVariables(variablesTableName, "m_OMS_Order", mainWorkflowId, parentName)
