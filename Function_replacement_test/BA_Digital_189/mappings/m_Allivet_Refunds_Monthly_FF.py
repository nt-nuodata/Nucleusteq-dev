# Databricks notebook source
# MAGIC %run "./udf_informatica"

# COMMAND ----------


from pyspark.sql.types import *

spark.sql("use DELTA_TRAINING")
spark.sql("set spark.sql.legacy.timeParserPolicy = LEGACY")

# COMMAND ----------
%run ../WorkflowUtility

# COMMAND ----------
mainWorkflowId = dbutils.widgets.get("mainWorkflowId")
mainWorkflowRunId = dbutils.widgets.get("mainWorkflowRunId")
parentName = dbutils.widgets.get("parentName")
preVariableAssignment = dbutils.widgets.get("preVariableAssignment")
postVariableAssignment = dbutils.widgets.get("postVariableAssignment")
truncTargetTableOptions = dbutils.widgets.get("truncTargetTableOptions")
variablesTableName = dbutils.widgets.get("variablesTableName")

# COMMAND ----------
#Truncate Target Tables
truncateTargetTables(truncTargetTableOptions)

# COMMAND ----------
#Pre presession variable updation
updateVariable(preVariableAssignment, variablesTableName, mainWorkflowId, parentName, "m_Allivet_Refunds_Monthly_FF")

# COMMAND ----------
fetchAndCreateVariables(parentName,"m_Allivet_Refunds_Monthly_FF", variablesTableName, mainWorkflowId)

# COMMAND ----------
# DBTITLE 1, Shortcut_to_ALLIVET_INVOICE_DAY_0


query_0 = f"""SELECT
  INVOICE_POSTING_DT AS INVOICE_POSTING_DT,
  INVOICE_CD AS INVOICE_CD,
  TXN_TYPE AS TXN_TYPE,
  ALLIVET_ORDER_NBR AS ALLIVET_ORDER_NBR,
  ALLIVET_SKU_NBR AS ALLIVET_SKU_NBR,
  PRODUCT_ID AS PRODUCT_ID,
  PETSMART_ORDER_NBR AS PETSMART_ORDER_NBR,
  PETSMART_SKU_NBR AS PETSMART_SKU_NBR,
  UPC_ID AS UPC_ID,
  SOLD_UNITS_QTY AS SOLD_UNITS_QTY,
  PRODUCT_COST AS PRODUCT_COST,
  RETAIL_PRICE AS RETAIL_PRICE,
  MANUFACTURER AS MANUFACTURER,
  BRAND_NAME AS BRAND_NAME,
  TITLE AS TITLE,
  FREIGHT_FEE_AMT AS FREIGHT_FEE_AMT,
  PACKAGING_FEE_AMT AS PACKAGING_FEE_AMT,
  DISPENSING_FEE_AMT AS DISPENSING_FEE_AMT,
  SHIPPED_DT AS SHIPPED_DT,
  FULFILLMENT_ORIGIN_ZIP_CD AS FULFILLMENT_ORIGIN_ZIP_CD,
  SHIP_CARRIER_NAME AS SHIP_CARRIER_NAME,
  TRACKING_NBR AS TRACKING_NBR,
  ALLIVET_CUSTOMER_NBR AS ALLIVET_CUSTOMER_NBR,
  PET_NAME AS PET_NAME,
  PET_TYPE AS PET_TYPE,
  BREED_TYPE AS BREED_TYPE,
  PET_GENDER AS PET_GENDER,
  PET_BIRT_DT AS PET_BIRT_DT,
  PET_WEIGHT AS PET_WEIGHT,
  PET_ALLERGY_DESC AS PET_ALLERGY_DESC,
  PET_MEDICAL_CONDITION AS PET_MEDICAL_CONDITION,
  PET_PREGNANT_FLAG AS PET_PREGNANT_FLAG,
  VET_CLINIC_NAME AS VET_CLINIC_NAME,
  VET_NAME AS VET_NAME,
  VET_ADDRESS AS VET_ADDRESS,
  VET_CITY AS VET_CITY,
  VET_STATE_CD AS VET_STATE_CD,
  VET_ZIP_CD AS VET_ZIP_CD,
  VET_PHONE_NBR AS VET_PHONE_NBR,
  DELETE_FLAG AS DELETE_FLAG,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  ALLIVET_INVOICE_DAY"""

df_0 = spark.sql(query_0)

df_0.createOrReplaceTempView("Shortcut_to_ALLIVET_INVOICE_DAY_0")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_ALLIVET_INVOICE_DAY_1


query_1 = f"""SELECT
  DISTINCT ALLIVET_ORDER_NBR AS ALLIVET_ORDER_NBR,
  ALLIVET_SKU_NBR AS ALLIVET_SKU_NBR,
  PETSMART_ORDER_NBR AS PETSMART_ORDER_NBR,
  PETSMART_SKU_NBR AS PETSMART_SKU_NBR,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_ALLIVET_INVOICE_DAY_0"""

df_1 = spark.sql(query_1)

df_1.createOrReplaceTempView("SQ_Shortcut_to_ALLIVET_INVOICE_DAY_1")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_ORDER_LN_2


query_2 = f"""SELECT
  OMS_ORDER_ID AS OMS_ORDER_ID,
  OMS_ORDER_LN_ID AS OMS_ORDER_LN_ID,
  OMS_COMPANY_ID AS OMS_COMPANY_ID,
  ORIG_LOCATION_NBR AS ORIG_LOCATION_NBR,
  ORIG_LOCATION_ID AS ORIG_LOCATION_ID,
  DEST_LOCATION_NBR AS DEST_LOCATION_NBR,
  DEST_LOCATION_ID AS DEST_LOCATION_ID,
  SHIP_NAME AS SHIP_NAME,
  SHIP_LAST_NAME AS SHIP_LAST_NAME,
  SHIP_ADDRESS AS SHIP_ADDRESS,
  SHIP_CITY AS SHIP_CITY,
  SHIP_STATE AS SHIP_STATE,
  SHIP_POSTAL_CD AS SHIP_POSTAL_CD,
  SHIP_COUNTRY_CD AS SHIP_COUNTRY_CD,
  SHIP_PHONE AS SHIP_PHONE,
  SHIP_EMAIL AS SHIP_EMAIL,
  BILL_LOCATION_NBR AS BILL_LOCATION_NBR,
  BILL_LOCATION_ID AS BILL_LOCATION_ID,
  STORE_LOCATION_NBR AS STORE_LOCATION_NBR,
  STORE_LOCATION_ID AS STORE_LOCATION_ID,
  PRODUCT_ID AS PRODUCT_ID,
  MV_CURRENCY_CD AS MV_CURRENCY_CD,
  TOTAL_MONETARY_VALUE_AMT AS TOTAL_MONETARY_VALUE_AMT,
  UNIT_MONETARY_VALUE_AMT AS UNIT_MONETARY_VALUE_AMT,
  UNIT_TAX_AMOUNT_AMT AS UNIT_TAX_AMOUNT_AMT,
  PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  ALLOCATED_QTY AS ALLOCATED_QTY,
  RELEASED_QTY AS RELEASED_QTY,
  CANCELLED_QTY AS CANCELLED_QTY,
  PPACK_QTY AS PPACK_QTY,
  DELIVERY_TZ AS DELIVERY_TZ,
  PICKUP_TZ AS PICKUP_TZ,
  PICKUP_START_DT AS PICKUP_START_DT,
  PICKUP_END_DT AS PICKUP_END_DT,
  DELIVERY_START_DT AS DELIVERY_START_DT,
  DELIVERY_END_DT AS DELIVERY_END_DT,
  REQ_DLVR_DT AS REQ_DLVR_DT,
  MUST_DLVR_DT AS MUST_DLVR_DT,
  SHIP_BY_DT AS SHIP_BY_DT,
  READY_TO_SHIP_FLG AS READY_TO_SHIP_FLG,
  CANCELLED_FLG AS CANCELLED_FLG,
  CLOSED_FLG AS CLOSED_FLG,
  DELETED_FLG AS DELETED_FLG,
  SHIPPED_QTY AS SHIPPED_QTY,
  RECEIVED_QTY AS RECEIVED_QTY,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_TSTMP AS CREATED_TSTMP,
  LAST_UPDATED_TSTMP AS LAST_UPDATED_TSTMP,
  DSG_CARRIER_ID AS DSG_CARRIER_ID,
  OMS_ORDER_LN_STATUS_ID AS OMS_ORDER_LN_STATUS_ID,
  OMS_ORDER_LN_NBR AS OMS_ORDER_LN_NBR,
  ORDER_QTY AS ORDER_QTY,
  ALLOC_FINALIZER AS ALLOC_FINALIZER,
  DIST_ORDER_CREATED_FLG AS DIST_ORDER_CREATED_FLG,
  ORIG_ORDER_QTY AS ORIG_ORDER_QTY,
  RETAIL_PRICE AS RETAIL_PRICE,
  DSG_SHIP_VIA AS DSG_SHIP_VIA,
  LINE_TOTAL AS LINE_TOTAL,
  REASON_ID AS REASON_ID,
  ORDER_FULFILLMENT_OPTION AS ORDER_FULFILLMENT_OPTION,
  PRICE_OVERRIDE_FLG AS PRICE_OVERRIDE_FLG,
  ORIGINAL_PRICE_AMT AS ORIGINAL_PRICE_AMT,
  REASON_CDS_GROUP_ID AS REASON_CDS_GROUP_ID,
  ORDER_FULFILLMENT_CHANNEL AS ORDER_FULFILLMENT_CHANNEL,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  ORDER_CHANNEL AS ORDER_CHANNEL,
  ORDER_NBR AS ORDER_NBR,
  OMS_ORDER_CREATED_TSTMP AS OMS_ORDER_CREATED_TSTMP,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  ADD_ON_FLAG AS ADD_ON_FLAG,
  SHIP_CHARGE_NAME AS SHIP_CHARGE_NAME,
  SHIP_CHARGE_AMT AS SHIP_CHARGE_AMT,
  ORIG_SHIP_CHARGE_AMT AS ORIG_SHIP_CHARGE_AMT,
  SHIP_CHARGE_DESC AS SHIP_CHARGE_DESC,
  RETURN_REASON_ID AS RETURN_REASON_ID,
  RETURN_SHIP_HANDLING_AMT AS RETURN_SHIP_HANDLING_AMT,
  RETURN_TOTAL_FEE_AMT AS RETURN_TOTAL_FEE_AMT,
  RETURN_CODE_DESC AS RETURN_CODE_DESC,
  RETURN_SHORT_DESC AS RETURN_SHORT_DESC,
  CANCEL_REASON_DESC AS CANCEL_REASON_DESC,
  CANCELLED_TSTMP AS CANCELLED_TSTMP,
  EXCHANGE_RATE_PCNT AS EXCHANGE_RATE_PCNT,
  TRACKING_NBR AS TRACKING_NBR,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_ORDER_LN"""

df_2 = spark.sql(query_2)

df_2.createOrReplaceTempView("Shortcut_to_OMS_ORDER_LN_2")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_ORDER_LN_3


query_3 = f"""SELECT
  OMS_ORDER_ID AS OMS_ORDER_ID,
  OMS_ORDER_LN_ID AS OMS_ORDER_LN_ID,
  OMS_COMPANY_ID AS OMS_COMPANY_ID,
  ORIG_LOCATION_NBR AS ORIG_LOCATION_NBR,
  ORIG_LOCATION_ID AS ORIG_LOCATION_ID,
  DEST_LOCATION_NBR AS DEST_LOCATION_NBR,
  DEST_LOCATION_ID AS DEST_LOCATION_ID,
  SHIP_NAME AS SHIP_NAME,
  SHIP_LAST_NAME AS SHIP_LAST_NAME,
  SHIP_ADDRESS AS SHIP_ADDRESS,
  SHIP_CITY AS SHIP_CITY,
  SHIP_STATE AS SHIP_STATE,
  SHIP_POSTAL_CD AS SHIP_POSTAL_CD,
  SHIP_COUNTRY_CD AS SHIP_COUNTRY_CD,
  SHIP_PHONE AS SHIP_PHONE,
  SHIP_EMAIL AS SHIP_EMAIL,
  BILL_LOCATION_NBR AS BILL_LOCATION_NBR,
  BILL_LOCATION_ID AS BILL_LOCATION_ID,
  STORE_LOCATION_NBR AS STORE_LOCATION_NBR,
  STORE_LOCATION_ID AS STORE_LOCATION_ID,
  PRODUCT_ID AS PRODUCT_ID,
  MV_CURRENCY_CD AS MV_CURRENCY_CD,
  TOTAL_MONETARY_VALUE_AMT AS TOTAL_MONETARY_VALUE_AMT,
  UNIT_MONETARY_VALUE_AMT AS UNIT_MONETARY_VALUE_AMT,
  UNIT_TAX_AMOUNT_AMT AS UNIT_TAX_AMOUNT_AMT,
  PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  ALLOCATED_QTY AS ALLOCATED_QTY,
  RELEASED_QTY AS RELEASED_QTY,
  CANCELLED_QTY AS CANCELLED_QTY,
  PPACK_QTY AS PPACK_QTY,
  DELIVERY_TZ AS DELIVERY_TZ,
  PICKUP_TZ AS PICKUP_TZ,
  PICKUP_START_DT AS PICKUP_START_DT,
  PICKUP_END_DT AS PICKUP_END_DT,
  DELIVERY_START_DT AS DELIVERY_START_DT,
  DELIVERY_END_DT AS DELIVERY_END_DT,
  REQ_DLVR_DT AS REQ_DLVR_DT,
  MUST_DLVR_DT AS MUST_DLVR_DT,
  SHIP_BY_DT AS SHIP_BY_DT,
  READY_TO_SHIP_FLG AS READY_TO_SHIP_FLG,
  CANCELLED_FLG AS CANCELLED_FLG,
  CLOSED_FLG AS CLOSED_FLG,
  DELETED_FLG AS DELETED_FLG,
  SHIPPED_QTY AS SHIPPED_QTY,
  RECEIVED_QTY AS RECEIVED_QTY,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_TSTMP AS CREATED_TSTMP,
  LAST_UPDATED_TSTMP AS LAST_UPDATED_TSTMP,
  DSG_CARRIER_ID AS DSG_CARRIER_ID,
  OMS_ORDER_LN_STATUS_ID AS OMS_ORDER_LN_STATUS_ID,
  OMS_ORDER_LN_NBR AS OMS_ORDER_LN_NBR,
  ORDER_QTY AS ORDER_QTY,
  ALLOC_FINALIZER AS ALLOC_FINALIZER,
  DIST_ORDER_CREATED_FLG AS DIST_ORDER_CREATED_FLG,
  ORIG_ORDER_QTY AS ORIG_ORDER_QTY,
  RETAIL_PRICE AS RETAIL_PRICE,
  DSG_SHIP_VIA AS DSG_SHIP_VIA,
  LINE_TOTAL AS LINE_TOTAL,
  REASON_ID AS REASON_ID,
  ORDER_FULFILLMENT_OPTION AS ORDER_FULFILLMENT_OPTION,
  PRICE_OVERRIDE_FLG AS PRICE_OVERRIDE_FLG,
  ORIGINAL_PRICE_AMT AS ORIGINAL_PRICE_AMT,
  REASON_CDS_GROUP_ID AS REASON_CDS_GROUP_ID,
  ORDER_FULFILLMENT_CHANNEL AS ORDER_FULFILLMENT_CHANNEL,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  ORDER_CHANNEL AS ORDER_CHANNEL,
  ORDER_NBR AS ORDER_NBR,
  OMS_ORDER_CREATED_TSTMP AS OMS_ORDER_CREATED_TSTMP,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  ADD_ON_FLAG AS ADD_ON_FLAG,
  SHIP_CHARGE_NAME AS SHIP_CHARGE_NAME,
  SHIP_CHARGE_AMT AS SHIP_CHARGE_AMT,
  ORIG_SHIP_CHARGE_AMT AS ORIG_SHIP_CHARGE_AMT,
  SHIP_CHARGE_DESC AS SHIP_CHARGE_DESC,
  RETURN_REASON_ID AS RETURN_REASON_ID,
  RETURN_SHIP_HANDLING_AMT AS RETURN_SHIP_HANDLING_AMT,
  RETURN_TOTAL_FEE_AMT AS RETURN_TOTAL_FEE_AMT,
  RETURN_CODE_DESC AS RETURN_CODE_DESC,
  RETURN_SHORT_DESC AS RETURN_SHORT_DESC,
  CANCEL_REASON_DESC AS CANCEL_REASON_DESC,
  CANCELLED_TSTMP AS CANCELLED_TSTMP,
  EXCHANGE_RATE_PCNT AS EXCHANGE_RATE_PCNT,
  TRACKING_NBR AS TRACKING_NBR,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_ORDER_LN_2"""

df_3 = spark.sql(query_3)

df_3.createOrReplaceTempView("SQ_Shortcut_to_OMS_ORDER_LN_3")

# COMMAND ----------
# DBTITLE 1, Ftr_OrderLn_Flag_4


query_4 = f"""SELECT
  OMS_ORDER_ID AS OMS_ORDER_ID,
  UNIT_MONETARY_VALUE_AMT AS UNIT_MONETARY_VALUE_AMT,
  TOTAL_MONETARY_VALUE_AMT AS TOTAL_MONETARY_VALUE_AMT,
  RETURN_CODE_DESC AS RETURN_CODE_DESC,
  ORDER_QTY AS ORDER_QTY,
  PRODUCT_ID AS PRODUCT_ID,
  DELETED_FLG AS DELETED_FLG,
  CANCELLED_FLG AS CANCELLED_FLG,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_ORDER_LN_3
WHERE
  DELETED_FLG = 0
  and CANCELLED_FLG = 0"""

df_4 = spark.sql(query_4)

df_4.createOrReplaceTempView("Ftr_OrderLn_Flag_4")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_ORDER1_5


query_5 = f"""SELECT
  OMS_ORDER_ID AS OMS_ORDER_ID,
  OMS_ORDER_NBR AS OMS_ORDER_NBR,
  ORDER_NBR AS ORDER_NBR,
  OMS_PARENT_ORDER_ID AS OMS_PARENT_ORDER_ID,
  OMS_ORDER_DT AS OMS_ORDER_DT,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  CREATION_TYPE AS CREATION_TYPE,
  CREATION_DEVICE_TYPE AS CREATION_DEVICE_TYPE,
  CREATION_DEVICE_WIDTH AS CREATION_DEVICE_WIDTH,
  CHANNEL_TYPE_ID AS CHANNEL_TYPE_ID,
  CHANNEL_ID AS CHANNEL_ID,
  OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  OMS_ORDER_TYPE_ID AS OMS_ORDER_TYPE_ID,
  ORDER_CATEGORY_ID AS ORDER_CATEGORY_ID,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  CUSTOMER_PICKUP_FLG AS CUSTOMER_PICKUP_FLG,
  OMS_ORDER_STATUS_ID AS OMS_ORDER_STATUS_ID,
  REASON_ID AS REASON_ID,
  REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  ORDER_RECEIVED_FLG AS ORDER_RECEIVED_FLG,
  PARTIALLY_PLANNED_FLG AS PARTIALLY_PLANNED_FLG,
  READY_TO_SHIP_FLG AS READY_TO_SHIP_FLG,
  CLOSED_FLG AS CLOSED_FLG,
  ON_HOLD AS ON_HOLD,
  CANCELLED_FLG AS CANCELLED_FLG,
  CANCELLED_TSTMP AS CANCELLED_TSTMP,
  OMS_CANCELLED_TYPE_ID AS OMS_CANCELLED_TYPE_ID,
  CANCEL_REASON_DESC AS CANCEL_REASON_DESC,
  DECLINE_REASON_ID AS DECLINE_REASON_ID,
  OMS_COMPANY_ID AS OMS_COMPANY_ID,
  BILL_OF_LADING_NBR AS BILL_OF_LADING_NBR,
  RETURN_REFERENCE_NBR AS RETURN_REFERENCE_NBR,
  COMMODITY_CD AS COMMODITY_CD,
  CARRIER_ID AS CARRIER_ID,
  PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  ENTRY_CODE AS ENTRY_CODE,
  FULFILL_MODE AS FULFILL_MODE,
  IMPORTED_FLG AS IMPORTED_FLG,
  ALERTS_FLG AS ALERTS_FLG,
  TRANS_RESP_CD AS TRANS_RESP_CD,
  ORIG_LOCATION_NBR AS ORIG_LOCATION_NBR,
  ORIG_LOCATION_ID AS ORIG_LOCATION_ID,
  ORIG_SHIP_VIA_LOCATION_ID AS ORIG_SHIP_VIA_LOCATION_ID,
  DEST_LOCATION_NBR AS DEST_LOCATION_NBR,
  DEST_LOCATION_ID AS DEST_LOCATION_ID,
  DEST_SHIP_VIA_LOCATION_ID AS DEST_SHIP_VIA_LOCATION_ID,
  BILL_LOCATION_NBR AS BILL_LOCATION_NBR,
  BILL_LOCATION_ID AS BILL_LOCATION_ID,
  RELEASE_DT AS RELEASE_DT,
  FIRST_RCPT_DT AS FIRST_RCPT_DT,
  LAST_RCPT_DT AS LAST_RCPT_DT,
  DUE_DT AS DUE_DT,
  PICKUP_START_DT AS PICKUP_START_DT,
  PICKUP_END_DT AS PICKUP_END_DT,
  PICKUP_TZ AS PICKUP_TZ,
  REQUESTED_DLVR_DT AS REQUESTED_DLVR_DT,
  PROMISED_DLVR_DT AS PROMISED_DLVR_DT,
  MUST_DLVR_DT AS MUST_DLVR_DT,
  DELIVERY_START_DT AS DELIVERY_START_DT,
  DELIVERY_END_DT AS DELIVERY_END_DT,
  DELIVERY_TZ AS DELIVERY_TZ,
  CUSTOMER_CD AS CUSTOMER_CD,
  CUSTOMER_FIRST_NAME AS CUSTOMER_FIRST_NAME,
  CUSTOMER_LAST_NAME AS CUSTOMER_LAST_NAME,
  CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  CUSTOMER_PHONE AS CUSTOMER_PHONE,
  BILL_FIRST_NAME AS BILL_FIRST_NAME,
  BILL_LAST_NAME AS BILL_LAST_NAME,
  BILL_ADDRESS AS BILL_ADDRESS,
  BILL_CITY AS BILL_CITY,
  BILL_STATE_CD AS BILL_STATE_CD,
  BILL_POSTAL_CD AS BILL_POSTAL_CD,
  BILL_COUNTRY_CD AS BILL_COUNTRY_CD,
  BILL_PHONE AS BILL_PHONE,
  BILL_EMAIL AS BILL_EMAIL,
  AFTERPAY_FLG AS AFTERPAY_FLG,
  FREIGHT_REVENUE_AMT AS FREIGHT_REVENUE_AMT,
  MONETARY_VALUE_AMT AS MONETARY_VALUE_AMT,
  ORIG_BUDG_COST_AMT AS ORIG_BUDG_COST_AMT,
  BUDG_COST_AMT AS BUDG_COST_AMT,
  TAX_AMT AS TAX_AMT,
  TAX_CHARGES_AMT AS TAX_CHARGES_AMT,
  MISC_CHARGES_AMT AS MISC_CHARGES_AMT,
  GRAND_TOTAL_AMT AS GRAND_TOTAL_AMT,
  PAYMENT_STATUS AS PAYMENT_STATUS,
  PAYMENT_MODE AS PAYMENT_MODE,
  BUDG_COST_CURRENCY_CD AS BUDG_COST_CURRENCY_CD,
  MV_CURRENCY_CD AS MV_CURRENCY_CD,
  CURRENCY_CD AS CURRENCY_CD,
  EXCHANGE_RATE_PCNT AS EXCHANGE_RATE_PCNT,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_TSTMP AS CREATED_TSTMP,
  LAST_UPDATED_TSTMP AS LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_ORDER"""

df_5 = spark.sql(query_5)

df_5.createOrReplaceTempView("Shortcut_to_OMS_ORDER1_5")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_ORDER1_6


query_6 = f"""SELECT
  OMS_ORDER_ID AS OMS_ORDER_ID,
  OMS_ORDER_NBR AS OMS_ORDER_NBR,
  ORDER_NBR AS ORDER_NBR,
  OMS_PARENT_ORDER_ID AS OMS_PARENT_ORDER_ID,
  OMS_ORDER_DT AS OMS_ORDER_DT,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  CREATION_TYPE AS CREATION_TYPE,
  CREATION_DEVICE_TYPE AS CREATION_DEVICE_TYPE,
  CREATION_DEVICE_WIDTH AS CREATION_DEVICE_WIDTH,
  CHANNEL_TYPE_ID AS CHANNEL_TYPE_ID,
  CHANNEL_ID AS CHANNEL_ID,
  OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  OMS_ORDER_TYPE_ID AS OMS_ORDER_TYPE_ID,
  ORDER_CATEGORY_ID AS ORDER_CATEGORY_ID,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  CUSTOMER_PICKUP_FLG AS CUSTOMER_PICKUP_FLG,
  OMS_ORDER_STATUS_ID AS OMS_ORDER_STATUS_ID,
  REASON_ID AS REASON_ID,
  REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  ORDER_RECEIVED_FLG AS ORDER_RECEIVED_FLG,
  PARTIALLY_PLANNED_FLG AS PARTIALLY_PLANNED_FLG,
  READY_TO_SHIP_FLG AS READY_TO_SHIP_FLG,
  CLOSED_FLG AS CLOSED_FLG,
  ON_HOLD AS ON_HOLD,
  CANCELLED_FLG AS CANCELLED_FLG,
  CANCELLED_TSTMP AS CANCELLED_TSTMP,
  OMS_CANCELLED_TYPE_ID AS OMS_CANCELLED_TYPE_ID,
  CANCEL_REASON_DESC AS CANCEL_REASON_DESC,
  DECLINE_REASON_ID AS DECLINE_REASON_ID,
  OMS_COMPANY_ID AS OMS_COMPANY_ID,
  BILL_OF_LADING_NBR AS BILL_OF_LADING_NBR,
  RETURN_REFERENCE_NBR AS RETURN_REFERENCE_NBR,
  COMMODITY_CD AS COMMODITY_CD,
  CARRIER_ID AS CARRIER_ID,
  PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  ENTRY_CODE AS ENTRY_CODE,
  FULFILL_MODE AS FULFILL_MODE,
  IMPORTED_FLG AS IMPORTED_FLG,
  ALERTS_FLG AS ALERTS_FLG,
  TRANS_RESP_CD AS TRANS_RESP_CD,
  ORIG_LOCATION_NBR AS ORIG_LOCATION_NBR,
  ORIG_LOCATION_ID AS ORIG_LOCATION_ID,
  ORIG_SHIP_VIA_LOCATION_ID AS ORIG_SHIP_VIA_LOCATION_ID,
  DEST_LOCATION_NBR AS DEST_LOCATION_NBR,
  DEST_LOCATION_ID AS DEST_LOCATION_ID,
  DEST_SHIP_VIA_LOCATION_ID AS DEST_SHIP_VIA_LOCATION_ID,
  BILL_LOCATION_NBR AS BILL_LOCATION_NBR,
  BILL_LOCATION_ID AS BILL_LOCATION_ID,
  RELEASE_DT AS RELEASE_DT,
  FIRST_RCPT_DT AS FIRST_RCPT_DT,
  LAST_RCPT_DT AS LAST_RCPT_DT,
  DUE_DT AS DUE_DT,
  PICKUP_START_DT AS PICKUP_START_DT,
  PICKUP_END_DT AS PICKUP_END_DT,
  PICKUP_TZ AS PICKUP_TZ,
  REQUESTED_DLVR_DT AS REQUESTED_DLVR_DT,
  PROMISED_DLVR_DT AS PROMISED_DLVR_DT,
  MUST_DLVR_DT AS MUST_DLVR_DT,
  DELIVERY_START_DT AS DELIVERY_START_DT,
  DELIVERY_END_DT AS DELIVERY_END_DT,
  DELIVERY_TZ AS DELIVERY_TZ,
  CUSTOMER_CD AS CUSTOMER_CD,
  CUSTOMER_FIRST_NAME AS CUSTOMER_FIRST_NAME,
  CUSTOMER_LAST_NAME AS CUSTOMER_LAST_NAME,
  CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  CUSTOMER_PHONE AS CUSTOMER_PHONE,
  BILL_FIRST_NAME AS BILL_FIRST_NAME,
  BILL_LAST_NAME AS BILL_LAST_NAME,
  BILL_ADDRESS AS BILL_ADDRESS,
  BILL_CITY AS BILL_CITY,
  BILL_STATE_CD AS BILL_STATE_CD,
  BILL_POSTAL_CD AS BILL_POSTAL_CD,
  BILL_COUNTRY_CD AS BILL_COUNTRY_CD,
  BILL_PHONE AS BILL_PHONE,
  BILL_EMAIL AS BILL_EMAIL,
  FREIGHT_REVENUE_AMT AS FREIGHT_REVENUE_AMT,
  MONETARY_VALUE_AMT AS MONETARY_VALUE_AMT,
  ORIG_BUDG_COST_AMT AS ORIG_BUDG_COST_AMT,
  BUDG_COST_AMT AS BUDG_COST_AMT,
  TAX_AMT AS TAX_AMT,
  TAX_CHARGES_AMT AS TAX_CHARGES_AMT,
  MISC_CHARGES_AMT AS MISC_CHARGES_AMT,
  GRAND_TOTAL_AMT AS GRAND_TOTAL_AMT,
  PAYMENT_STATUS AS PAYMENT_STATUS,
  PAYMENT_MODE AS PAYMENT_MODE,
  BUDG_COST_CURRENCY_CD AS BUDG_COST_CURRENCY_CD,
  MV_CURRENCY_CD AS MV_CURRENCY_CD,
  CURRENCY_CD AS CURRENCY_CD,
  EXCHANGE_RATE_PCNT AS EXCHANGE_RATE_PCNT,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_TSTMP AS CREATED_TSTMP,
  LAST_UPDATED_TSTMP AS LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_ORDER1_5"""

df_6 = spark.sql(query_6)

df_6.createOrReplaceTempView("SQ_Shortcut_to_OMS_ORDER1_6")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_ORDER_7


query_7 = f"""SELECT
  OMS_ORDER_ID AS OMS_ORDER_ID,
  OMS_ORDER_NBR AS OMS_ORDER_NBR,
  ORDER_NBR AS ORDER_NBR,
  OMS_PARENT_ORDER_ID AS OMS_PARENT_ORDER_ID,
  OMS_ORDER_DT AS OMS_ORDER_DT,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  CREATION_TYPE AS CREATION_TYPE,
  CREATION_DEVICE_TYPE AS CREATION_DEVICE_TYPE,
  CREATION_DEVICE_WIDTH AS CREATION_DEVICE_WIDTH,
  CHANNEL_TYPE_ID AS CHANNEL_TYPE_ID,
  CHANNEL_ID AS CHANNEL_ID,
  OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  OMS_ORDER_TYPE_ID AS OMS_ORDER_TYPE_ID,
  ORDER_CATEGORY_ID AS ORDER_CATEGORY_ID,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  CUSTOMER_PICKUP_FLG AS CUSTOMER_PICKUP_FLG,
  OMS_ORDER_STATUS_ID AS OMS_ORDER_STATUS_ID,
  REASON_ID AS REASON_ID,
  REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  ORDER_RECEIVED_FLG AS ORDER_RECEIVED_FLG,
  PARTIALLY_PLANNED_FLG AS PARTIALLY_PLANNED_FLG,
  READY_TO_SHIP_FLG AS READY_TO_SHIP_FLG,
  CLOSED_FLG AS CLOSED_FLG,
  ON_HOLD AS ON_HOLD,
  CANCELLED_FLG AS CANCELLED_FLG,
  CANCELLED_TSTMP AS CANCELLED_TSTMP,
  OMS_CANCELLED_TYPE_ID AS OMS_CANCELLED_TYPE_ID,
  CANCEL_REASON_DESC AS CANCEL_REASON_DESC,
  DECLINE_REASON_ID AS DECLINE_REASON_ID,
  OMS_COMPANY_ID AS OMS_COMPANY_ID,
  BILL_OF_LADING_NBR AS BILL_OF_LADING_NBR,
  RETURN_REFERENCE_NBR AS RETURN_REFERENCE_NBR,
  COMMODITY_CD AS COMMODITY_CD,
  CARRIER_ID AS CARRIER_ID,
  PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  ENTRY_CODE AS ENTRY_CODE,
  FULFILL_MODE AS FULFILL_MODE,
  IMPORTED_FLG AS IMPORTED_FLG,
  ALERTS_FLG AS ALERTS_FLG,
  TRANS_RESP_CD AS TRANS_RESP_CD,
  ORIG_LOCATION_NBR AS ORIG_LOCATION_NBR,
  ORIG_LOCATION_ID AS ORIG_LOCATION_ID,
  ORIG_SHIP_VIA_LOCATION_ID AS ORIG_SHIP_VIA_LOCATION_ID,
  DEST_LOCATION_NBR AS DEST_LOCATION_NBR,
  DEST_LOCATION_ID AS DEST_LOCATION_ID,
  DEST_SHIP_VIA_LOCATION_ID AS DEST_SHIP_VIA_LOCATION_ID,
  BILL_LOCATION_NBR AS BILL_LOCATION_NBR,
  BILL_LOCATION_ID AS BILL_LOCATION_ID,
  RELEASE_DT AS RELEASE_DT,
  FIRST_RCPT_DT AS FIRST_RCPT_DT,
  LAST_RCPT_DT AS LAST_RCPT_DT,
  DUE_DT AS DUE_DT,
  PICKUP_START_DT AS PICKUP_START_DT,
  PICKUP_END_DT AS PICKUP_END_DT,
  PICKUP_TZ AS PICKUP_TZ,
  REQUESTED_DLVR_DT AS REQUESTED_DLVR_DT,
  PROMISED_DLVR_DT AS PROMISED_DLVR_DT,
  MUST_DLVR_DT AS MUST_DLVR_DT,
  DELIVERY_START_DT AS DELIVERY_START_DT,
  DELIVERY_END_DT AS DELIVERY_END_DT,
  DELIVERY_TZ AS DELIVERY_TZ,
  CUSTOMER_CD AS CUSTOMER_CD,
  CUSTOMER_FIRST_NAME AS CUSTOMER_FIRST_NAME,
  CUSTOMER_LAST_NAME AS CUSTOMER_LAST_NAME,
  CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  CUSTOMER_PHONE AS CUSTOMER_PHONE,
  BILL_FIRST_NAME AS BILL_FIRST_NAME,
  BILL_LAST_NAME AS BILL_LAST_NAME,
  BILL_ADDRESS AS BILL_ADDRESS,
  BILL_CITY AS BILL_CITY,
  BILL_STATE_CD AS BILL_STATE_CD,
  BILL_POSTAL_CD AS BILL_POSTAL_CD,
  BILL_COUNTRY_CD AS BILL_COUNTRY_CD,
  BILL_PHONE AS BILL_PHONE,
  BILL_EMAIL AS BILL_EMAIL,
  AFTERPAY_FLG AS AFTERPAY_FLG,
  FREIGHT_REVENUE_AMT AS FREIGHT_REVENUE_AMT,
  MONETARY_VALUE_AMT AS MONETARY_VALUE_AMT,
  ORIG_BUDG_COST_AMT AS ORIG_BUDG_COST_AMT,
  BUDG_COST_AMT AS BUDG_COST_AMT,
  TAX_AMT AS TAX_AMT,
  TAX_CHARGES_AMT AS TAX_CHARGES_AMT,
  MISC_CHARGES_AMT AS MISC_CHARGES_AMT,
  GRAND_TOTAL_AMT AS GRAND_TOTAL_AMT,
  PAYMENT_STATUS AS PAYMENT_STATUS,
  PAYMENT_MODE AS PAYMENT_MODE,
  BUDG_COST_CURRENCY_CD AS BUDG_COST_CURRENCY_CD,
  MV_CURRENCY_CD AS MV_CURRENCY_CD,
  CURRENCY_CD AS CURRENCY_CD,
  EXCHANGE_RATE_PCNT AS EXCHANGE_RATE_PCNT,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_TSTMP AS CREATED_TSTMP,
  LAST_UPDATED_TSTMP AS LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP
FROM
  OMS_ORDER"""

df_7 = spark.sql(query_7)

df_7.createOrReplaceTempView("Shortcut_to_OMS_ORDER_7")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_OMS_ORDER_8


query_8 = f"""SELECT
  OMS_ORDER_ID AS OMS_ORDER_ID,
  OMS_ORDER_NBR AS OMS_ORDER_NBR,
  ORDER_NBR AS ORDER_NBR,
  OMS_PARENT_ORDER_ID AS OMS_PARENT_ORDER_ID,
  OMS_ORDER_DT AS OMS_ORDER_DT,
  ORDER_CREATION_CHANNEL AS ORDER_CREATION_CHANNEL,
  CREATION_TYPE AS CREATION_TYPE,
  CREATION_DEVICE_TYPE AS CREATION_DEVICE_TYPE,
  CREATION_DEVICE_WIDTH AS CREATION_DEVICE_WIDTH,
  CHANNEL_TYPE_ID AS CHANNEL_TYPE_ID,
  CHANNEL_ID AS CHANNEL_ID,
  OMS_ORDER_TYPE AS OMS_ORDER_TYPE,
  OMS_ORDER_TYPE_ID AS OMS_ORDER_TYPE_ID,
  ORDER_CATEGORY_ID AS ORDER_CATEGORY_ID,
  SCHED_DELIVERY_FLG AS SCHED_DELIVERY_FLG,
  SUBSCRIPTION_ORDER_FLG AS SUBSCRIPTION_ORDER_FLG,
  CUSTOMER_PICKUP_FLG AS CUSTOMER_PICKUP_FLG,
  OMS_ORDER_STATUS_ID AS OMS_ORDER_STATUS_ID,
  REASON_ID AS REASON_ID,
  REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  ORDER_RECEIVED_FLG AS ORDER_RECEIVED_FLG,
  PARTIALLY_PLANNED_FLG AS PARTIALLY_PLANNED_FLG,
  READY_TO_SHIP_FLG AS READY_TO_SHIP_FLG,
  CLOSED_FLG AS CLOSED_FLG,
  ON_HOLD AS ON_HOLD,
  CANCELLED_FLG AS CANCELLED_FLG,
  CANCELLED_TSTMP AS CANCELLED_TSTMP,
  OMS_CANCELLED_TYPE_ID AS OMS_CANCELLED_TYPE_ID,
  CANCEL_REASON_DESC AS CANCEL_REASON_DESC,
  DECLINE_REASON_ID AS DECLINE_REASON_ID,
  OMS_COMPANY_ID AS OMS_COMPANY_ID,
  BILL_OF_LADING_NBR AS BILL_OF_LADING_NBR,
  RETURN_REFERENCE_NBR AS RETURN_REFERENCE_NBR,
  COMMODITY_CD AS COMMODITY_CD,
  CARRIER_ID AS CARRIER_ID,
  PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  ENTRY_CODE AS ENTRY_CODE,
  FULFILL_MODE AS FULFILL_MODE,
  IMPORTED_FLG AS IMPORTED_FLG,
  ALERTS_FLG AS ALERTS_FLG,
  TRANS_RESP_CD AS TRANS_RESP_CD,
  ORIG_LOCATION_NBR AS ORIG_LOCATION_NBR,
  ORIG_LOCATION_ID AS ORIG_LOCATION_ID,
  ORIG_SHIP_VIA_LOCATION_ID AS ORIG_SHIP_VIA_LOCATION_ID,
  DEST_LOCATION_NBR AS DEST_LOCATION_NBR,
  DEST_LOCATION_ID AS DEST_LOCATION_ID,
  DEST_SHIP_VIA_LOCATION_ID AS DEST_SHIP_VIA_LOCATION_ID,
  BILL_LOCATION_NBR AS BILL_LOCATION_NBR,
  BILL_LOCATION_ID AS BILL_LOCATION_ID,
  RELEASE_DT AS RELEASE_DT,
  FIRST_RCPT_DT AS FIRST_RCPT_DT,
  LAST_RCPT_DT AS LAST_RCPT_DT,
  DUE_DT AS DUE_DT,
  PICKUP_START_DT AS PICKUP_START_DT,
  PICKUP_END_DT AS PICKUP_END_DT,
  PICKUP_TZ AS PICKUP_TZ,
  REQUESTED_DLVR_DT AS REQUESTED_DLVR_DT,
  PROMISED_DLVR_DT AS PROMISED_DLVR_DT,
  MUST_DLVR_DT AS MUST_DLVR_DT,
  DELIVERY_START_DT AS DELIVERY_START_DT,
  DELIVERY_END_DT AS DELIVERY_END_DT,
  DELIVERY_TZ AS DELIVERY_TZ,
  CUSTOMER_CD AS CUSTOMER_CD,
  CUSTOMER_FIRST_NAME AS CUSTOMER_FIRST_NAME,
  CUSTOMER_LAST_NAME AS CUSTOMER_LAST_NAME,
  CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  CUSTOMER_PHONE AS CUSTOMER_PHONE,
  BILL_FIRST_NAME AS BILL_FIRST_NAME,
  BILL_LAST_NAME AS BILL_LAST_NAME,
  BILL_ADDRESS AS BILL_ADDRESS,
  BILL_CITY AS BILL_CITY,
  BILL_STATE_CD AS BILL_STATE_CD,
  BILL_POSTAL_CD AS BILL_POSTAL_CD,
  BILL_COUNTRY_CD AS BILL_COUNTRY_CD,
  BILL_PHONE AS BILL_PHONE,
  BILL_EMAIL AS BILL_EMAIL,
  FREIGHT_REVENUE_AMT AS FREIGHT_REVENUE_AMT,
  MONETARY_VALUE_AMT AS MONETARY_VALUE_AMT,
  ORIG_BUDG_COST_AMT AS ORIG_BUDG_COST_AMT,
  BUDG_COST_AMT AS BUDG_COST_AMT,
  TAX_AMT AS TAX_AMT,
  TAX_CHARGES_AMT AS TAX_CHARGES_AMT,
  MISC_CHARGES_AMT AS MISC_CHARGES_AMT,
  GRAND_TOTAL_AMT AS GRAND_TOTAL_AMT,
  PAYMENT_STATUS AS PAYMENT_STATUS,
  PAYMENT_MODE AS PAYMENT_MODE,
  BUDG_COST_CURRENCY_CD AS BUDG_COST_CURRENCY_CD,
  MV_CURRENCY_CD AS MV_CURRENCY_CD,
  CURRENCY_CD AS CURRENCY_CD,
  EXCHANGE_RATE_PCNT AS EXCHANGE_RATE_PCNT,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_TSTMP AS CREATED_TSTMP,
  LAST_UPDATED_TSTMP AS LAST_UPDATED_TSTMP,
  UPDATE_TSTMP AS UPDATE_TSTMP,
  LOAD_TSTMP AS LOAD_TSTMP,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_ORDER_7
WHERE
  $$Load_Filter"""

df_8 = spark.sql(query_8)

df_8.createOrReplaceTempView("SQ_Shortcut_to_OMS_ORDER_8")

# COMMAND ----------
# DBTITLE 1, Jnr_Order_OrderLn_9


query_9 = f"""SELECT
  DETAIL.OMS_ORDER_ID AS OMS_ORDER_ID,
  DETAIL.OMS_ORDER_DT AS REFUND_DATE,
  DETAIL.OMS_PARENT_ORDER_ID AS OMS_PARENT_ORDER_ID,
  MASTER.OMS_ORDER_ID AS ORDER_LN_OMS_ORDER_ID,
  MASTER.UNIT_MONETARY_VALUE_AMT AS UNIT_MONETARY_VALUE_AMT,
  MASTER.TOTAL_MONETARY_VALUE_AMT AS TOTAL_MONETARY_VALUE_AMT,
  MASTER.RETURN_CODE_DESC AS RETURN_CODE_DESC,
  MASTER.ORDER_QTY AS ORDER_QTY,
  MASTER.PRODUCT_ID AS PRODUCT_ID,
  MASTER.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  Ftr_OrderLn_Flag_4 MASTER
  INNER JOIN SQ_Shortcut_to_OMS_ORDER_8 DETAIL ON MASTER.OMS_ORDER_ID = DETAIL.OMS_ORDER_ID"""

df_9 = spark.sql(query_9)

df_9.createOrReplaceTempView("Jnr_Order_OrderLn_9")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_SKU_PROFILE_RPT_10


query_10 = f"""SELECT
  PRODUCT_ID AS PRODUCT_ID,
  SKU_NBR AS SKU_NBR,
  SKU_TYPE AS SKU_TYPE,
  PRIMARY_UPC_ID AS PRIMARY_UPC_ID,
  STATUS_ID AS STATUS_ID,
  STATUS_NAME AS STATUS_NAME,
  SUBS_HIST_FLAG AS SUBS_HIST_FLAG,
  SUBS_CURR_FLAG AS SUBS_CURR_FLAG,
  SKU_DESC AS SKU_DESC,
  ALT_DESC AS ALT_DESC,
  SAP_CATEGORY_ID AS SAP_CATEGORY_ID,
  SAP_CATEGORY_DESC AS SAP_CATEGORY_DESC,
  GL_CATEGORY_CD AS GL_CATEGORY_CD,
  GL_CATEGORY_DESC AS GL_CATEGORY_DESC,
  BUS_UNIT_ID AS BUS_UNIT_ID,
  BUS_UNIT_DESC AS BUS_UNIT_DESC,
  SVP_ID AS SVP_ID,
  SVP_DESC AS SVP_DESC,
  VP_ID AS VP_ID,
  VP_NM AS VP_NM,
  VP_DESC AS VP_DESC,
  CATEGORY_BUYER_ID AS CATEGORY_BUYER_ID,
  CATEGORY_BUYER_NM AS CATEGORY_BUYER_NM,
  CA_BUYER_ID AS CA_BUYER_ID,
  CA_BUYER_NM AS CA_BUYER_NM,
  DIRECTOR_ID AS DIRECTOR_ID,
  DIRECTOR_DESC AS DIRECTOR_DESC,
  CA_DIRECTOR_ID AS CA_DIRECTOR_ID,
  CA_DIRECTOR_DESC AS CA_DIRECTOR_DESC,
  PRICING_ROLE_ID AS PRICING_ROLE_ID,
  PRICING_ROLE_DESC AS PRICING_ROLE_DESC,
  SAP_CLASS_ID AS SAP_CLASS_ID,
  SAP_CLASS_DESC AS SAP_CLASS_DESC,
  SAP_DEPT_ID AS SAP_DEPT_ID,
  SAP_DEPT_DESC AS SAP_DEPT_DESC,
  CONSUM_ID AS CONSUM_ID,
  CONSUM_DESC AS CONSUM_DESC,
  SEGMENT_ID AS SEGMENT_ID,
  SEGMENT_DESC AS SEGMENT_DESC,
  SAP_DIVISION_ID AS SAP_DIVISION_ID,
  SAP_DIVISION_DESC AS SAP_DIVISION_DESC,
  PRIMARY_VENDOR_ID AS PRIMARY_VENDOR_ID,
  PRIMARY_VENDOR_NAME AS PRIMARY_VENDOR_NAME,
  VENDOR_SUBRANGE_CD AS VENDOR_SUBRANGE_CD,
  PURCH_GROUP_ID AS PURCH_GROUP_ID,
  PURCH_GROUP_NAME AS PURCH_GROUP_NAME,
  PARENT_VENDOR_ID AS PARENT_VENDOR_ID,
  PARENT_VENDOR_NAME AS PARENT_VENDOR_NAME,
  COUNTRY_CD AS COUNTRY_CD,
  COUNTRY_NAME AS COUNTRY_NAME,
  IMPORT_FLAG AS IMPORT_FLAG,
  IMPORT_DESC AS IMPORT_DESC,
  HTS_CODE_ID AS HTS_CODE_ID,
  HTS_CODE_DESC AS HTS_CODE_DESC,
  CONTENTS AS CONTENTS,
  CONTENTS_UNITS AS CONTENTS_UNITS,
  WEIGHT_NET_AMT AS WEIGHT_NET_AMT,
  WEIGHT_UOM_CD AS WEIGHT_UOM_CD,
  SIZE_DESC AS SIZE_DESC,
  BUM_QTY AS BUM_QTY,
  UOM_CD AS UOM_CD,
  UNIT_NUMERATOR AS UNIT_NUMERATOR,
  UNIT_DENOMINATOR AS UNIT_DENOMINATOR,
  BUYER_ID AS BUYER_ID,
  BUYER_NAME AS BUYER_NAME,
  PURCH_COST_AMT AS PURCH_COST_AMT,
  NAT_PRICE_US_AMT AS NAT_PRICE_US_AMT,
  TAX_CLASS_ID AS TAX_CLASS_ID,
  TAX_CLASS_DESC AS TAX_CLASS_DESC,
  VALUATION_CLASS_CD AS VALUATION_CLASS_CD,
  VALUATION_CLASS_DESC AS VALUATION_CLASS_DESC,
  BRAND_CD AS BRAND_CD,
  BRAND_NAME AS BRAND_NAME,
  BRAND_CLASSIFICATION_ID AS BRAND_CLASSIFICATION_ID,
  BRAND_CLASSIFICATION_NAME AS BRAND_CLASSIFICATION_NAME,
  OWNBRAND_FLAG AS OWNBRAND_FLAG,
  OWNBRAND_DESC AS OWNBRAND_DESC,
  STATELINE_FLAG AS STATELINE_FLAG,
  SIGN_TYPE_CD AS SIGN_TYPE_CD,
  SIGN_TYPE_DESC AS SIGN_TYPE_DESC,
  OLD_ARTICLE_NBR AS OLD_ARTICLE_NBR,
  VENDOR_ARTICLE_NBR AS VENDOR_ARTICLE_NBR,
  INIT_MKDN_DT AS INIT_MKDN_DT,
  DISC_START_DT AS DISC_START_DT,
  ADD_DT AS ADD_DT,
  DELETE_DT AS DELETE_DT,
  FIRST_SALE_DT AS FIRST_SALE_DT,
  LAST_SALE_DT AS LAST_SALE_DT,
  FIRST_INV_DT AS FIRST_INV_DT,
  LAST_INV_DT AS LAST_INV_DT,
  BASE_NBR AS BASE_NBR,
  BP_COLOR_ID AS BP_COLOR_ID,
  BP_SIZE_ID AS BP_SIZE_ID,
  BP_BREED_ID AS BP_BREED_ID,
  BP_ITEM_CONCATENATED AS BP_ITEM_CONCATENATED,
  CANADIAN_HTS_CD AS CANADIAN_HTS_CD,
  NAT_PRICE_CA_AMT AS NAT_PRICE_CA_AMT,
  NAT_PRICE_PR_AMT AS NAT_PRICE_PR_AMT,
  RTV_DEPT_CD AS RTV_DEPT_CD,
  RTV_DESC AS RTV_DESC,
  HAZ_FLAG AS HAZ_FLAG,
  AEROSOL_FLAG AS AEROSOL_FLAG,
  GL_ACCT_NBR AS GL_ACCT_NBR,
  ARTICLE_CATEGORY_ID AS ARTICLE_CATEGORY_ID,
  ARTICLE_CATEGORY_DESC AS ARTICLE_CATEGORY_DESC,
  ARTICLE_CATEGORY_CD AS ARTICLE_CATEGORY_CD,
  COMPONENT_FLAG AS COMPONENT_FLAG,
  ZDISCO_SCHED_TYPE_ID AS ZDISCO_SCHED_TYPE_ID,
  ZDISCO_SCHED_TYPE_DESC AS ZDISCO_SCHED_TYPE_DESC,
  ZDISCO_MKDN_SCHED_ID AS ZDISCO_MKDN_SCHED_ID,
  ZDISCO_MKDN_SCHED_DESC AS ZDISCO_MKDN_SCHED_DESC,
  ZDISCO_PID_DT AS ZDISCO_PID_DT,
  ZDISCO_START_DT AS ZDISCO_START_DT,
  ZDISCO_INIT_MKDN_DT AS ZDISCO_INIT_MKDN_DT,
  ZDISCO_DC_DT AS ZDISCO_DC_DT,
  ZDISCO_STR_DT AS ZDISCO_STR_DT,
  ZDISCO_STR_OWNRSHP_DT AS ZDISCO_STR_OWNRSHP_DT,
  ZDISCO_STR_WRT_OFF_DT AS ZDISCO_STR_WRT_OFF_DT,
  OPT_DEMAND_GROUP AS OPT_DEMAND_GROUP,
  OPT_PRODUCT_LINE AS OPT_PRODUCT_LINE,
  OPT_PRICE_FAMILY AS OPT_PRICE_FAMILY,
  OPT_EFFECTIVE_SIZE AS OPT_EFFECTIVE_SIZE,
  OPT_SELL_UNITS AS OPT_SELL_UNITS,
  OPT_UNIT_PRICE AS OPT_UNIT_PRICE,
  OPT_MOD_PRICE AS OPT_MOD_PRICE,
  OPT_MOD_COST AS OPT_MOD_COST,
  OPT_IS_NEW AS OPT_IS_NEW,
  OPT_ERROR_CODE AS OPT_ERROR_CODE,
  OPT_RELATIONSHIP AS OPT_RELATIONSHIP,
  OPT_METRIC AS OPT_METRIC,
  OPT_DIFF AS OPT_DIFF,
  OPT_ASSOC_PROD AS OPT_ASSOC_PROD,
  OPT_DELETE_OPTION AS OPT_DELETE_OPTION,
  DISC_SKU_NBR AS DISC_SKU_NBR,
  AVG_SALES AS AVG_SALES,
  COPY_SKU_NBR AS COPY_SKU_NBR,
  COPY_SKU_PCT AS COPY_SKU_PCT,
  PROCUREMENT_RULE_CD AS PROCUREMENT_RULE_CD,
  PROCUREMENT_RULE_DESC AS PROCUREMENT_RULE_DESC,
  CATEGORY_ANALYST_ID AS CATEGORY_ANALYST_ID,
  CATEGORY_ANALYST_NM AS CATEGORY_ANALYST_NM,
  CATEGORY_REPLENISHMENT_MGR_ID AS CATEGORY_REPLENISHMENT_MGR_ID,
  CATEGORY_REPLENISHMENT_MGR_NM AS CATEGORY_REPLENISHMENT_MGR_NM,
  CREATED_BY AS CREATED_BY,
  SHELF_LIFE_REM_CNT AS SHELF_LIFE_REM_CNT,
  TEMP_SKU AS TEMP_SKU,
  CONTENTS_METRICS AS CONTENTS_METRICS,
  CONTENTS_UNITS_METRICS AS CONTENTS_UNITS_METRICS,
  FLAVOR_CD AS FLAVOR_CD,
  FLAVOR_DESC AS FLAVOR_DESC,
  BASIC_MATERIAL AS BASIC_MATERIAL,
  CONTAINER_CD AS CONTAINER_CD,
  CONTAINER_DESC AS CONTAINER_DESC,
  RX_FLAG AS RX_FLAG,
  UPDATE_DT AS UPDATE_DT,
  LOAD_DT AS LOAD_DT
FROM
  SKU_PROFILE_RPT"""

df_10 = spark.sql(query_10)

df_10.createOrReplaceTempView("Shortcut_to_SKU_PROFILE_RPT_10")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_SKU_PROFILE_RPT_11


query_11 = f"""SELECT
  PRODUCT_ID AS PRODUCT_ID,
  SKU_NBR AS SKU_NBR,
  SKU_TYPE AS SKU_TYPE,
  PRIMARY_UPC_ID AS PRIMARY_UPC_ID,
  STATUS_ID AS STATUS_ID,
  STATUS_NAME AS STATUS_NAME,
  SUBS_HIST_FLAG AS SUBS_HIST_FLAG,
  SUBS_CURR_FLAG AS SUBS_CURR_FLAG,
  SKU_DESC AS SKU_DESC,
  ALT_DESC AS ALT_DESC,
  SAP_CATEGORY_ID AS SAP_CATEGORY_ID,
  SAP_CATEGORY_DESC AS SAP_CATEGORY_DESC,
  GL_CATEGORY_CD AS GL_CATEGORY_CD,
  GL_CATEGORY_DESC AS GL_CATEGORY_DESC,
  BUS_UNIT_ID AS BUS_UNIT_ID,
  BUS_UNIT_DESC AS BUS_UNIT_DESC,
  SVP_ID AS SVP_ID,
  SVP_DESC AS SVP_DESC,
  VP_ID AS VP_ID,
  VP_NM AS VP_NM,
  VP_DESC AS VP_DESC,
  CATEGORY_BUYER_ID AS CATEGORY_BUYER_ID,
  CATEGORY_BUYER_NM AS CATEGORY_BUYER_NM,
  CA_BUYER_ID AS CA_BUYER_ID,
  CA_BUYER_NM AS CA_BUYER_NM,
  DIRECTOR_ID AS DIRECTOR_ID,
  DIRECTOR_DESC AS DIRECTOR_DESC,
  CA_DIRECTOR_ID AS CA_DIRECTOR_ID,
  CA_DIRECTOR_DESC AS CA_DIRECTOR_DESC,
  PRICING_ROLE_ID AS PRICING_ROLE_ID,
  PRICING_ROLE_DESC AS PRICING_ROLE_DESC,
  SAP_CLASS_ID AS SAP_CLASS_ID,
  SAP_CLASS_DESC AS SAP_CLASS_DESC,
  SAP_DEPT_ID AS SAP_DEPT_ID,
  SAP_DEPT_DESC AS SAP_DEPT_DESC,
  CONSUM_ID AS CONSUM_ID,
  CONSUM_DESC AS CONSUM_DESC,
  SEGMENT_ID AS SEGMENT_ID,
  SEGMENT_DESC AS SEGMENT_DESC,
  SAP_DIVISION_ID AS SAP_DIVISION_ID,
  SAP_DIVISION_DESC AS SAP_DIVISION_DESC,
  PRIMARY_VENDOR_ID AS PRIMARY_VENDOR_ID,
  PRIMARY_VENDOR_NAME AS PRIMARY_VENDOR_NAME,
  VENDOR_SUBRANGE_CD AS VENDOR_SUBRANGE_CD,
  PURCH_GROUP_ID AS PURCH_GROUP_ID,
  PURCH_GROUP_NAME AS PURCH_GROUP_NAME,
  PARENT_VENDOR_ID AS PARENT_VENDOR_ID,
  PARENT_VENDOR_NAME AS PARENT_VENDOR_NAME,
  COUNTRY_CD AS COUNTRY_CD,
  COUNTRY_NAME AS COUNTRY_NAME,
  IMPORT_FLAG AS IMPORT_FLAG,
  IMPORT_DESC AS IMPORT_DESC,
  HTS_CODE_ID AS HTS_CODE_ID,
  HTS_CODE_DESC AS HTS_CODE_DESC,
  CONTENTS AS CONTENTS,
  CONTENTS_UNITS AS CONTENTS_UNITS,
  WEIGHT_NET_AMT AS WEIGHT_NET_AMT,
  WEIGHT_UOM_CD AS WEIGHT_UOM_CD,
  SIZE_DESC AS SIZE_DESC,
  BUM_QTY AS BUM_QTY,
  UOM_CD AS UOM_CD,
  UNIT_NUMERATOR AS UNIT_NUMERATOR,
  UNIT_DENOMINATOR AS UNIT_DENOMINATOR,
  BUYER_ID AS BUYER_ID,
  BUYER_NAME AS BUYER_NAME,
  PURCH_COST_AMT AS PURCH_COST_AMT,
  NAT_PRICE_US_AMT AS NAT_PRICE_US_AMT,
  TAX_CLASS_ID AS TAX_CLASS_ID,
  TAX_CLASS_DESC AS TAX_CLASS_DESC,
  VALUATION_CLASS_CD AS VALUATION_CLASS_CD,
  VALUATION_CLASS_DESC AS VALUATION_CLASS_DESC,
  BRAND_CD AS BRAND_CD,
  BRAND_NAME AS BRAND_NAME,
  BRAND_CLASSIFICATION_ID AS BRAND_CLASSIFICATION_ID,
  BRAND_CLASSIFICATION_NAME AS BRAND_CLASSIFICATION_NAME,
  OWNBRAND_FLAG AS OWNBRAND_FLAG,
  OWNBRAND_DESC AS OWNBRAND_DESC,
  STATELINE_FLAG AS STATELINE_FLAG,
  SIGN_TYPE_CD AS SIGN_TYPE_CD,
  SIGN_TYPE_DESC AS SIGN_TYPE_DESC,
  OLD_ARTICLE_NBR AS OLD_ARTICLE_NBR,
  VENDOR_ARTICLE_NBR AS VENDOR_ARTICLE_NBR,
  INIT_MKDN_DT AS INIT_MKDN_DT,
  DISC_START_DT AS DISC_START_DT,
  ADD_DT AS ADD_DT,
  DELETE_DT AS DELETE_DT,
  FIRST_SALE_DT AS FIRST_SALE_DT,
  LAST_SALE_DT AS LAST_SALE_DT,
  FIRST_INV_DT AS FIRST_INV_DT,
  LAST_INV_DT AS LAST_INV_DT,
  BASE_NBR AS BASE_NBR,
  BP_COLOR_ID AS BP_COLOR_ID,
  BP_SIZE_ID AS BP_SIZE_ID,
  BP_BREED_ID AS BP_BREED_ID,
  BP_ITEM_CONCATENATED AS BP_ITEM_CONCATENATED,
  CANADIAN_HTS_CD AS CANADIAN_HTS_CD,
  NAT_PRICE_CA_AMT AS NAT_PRICE_CA_AMT,
  NAT_PRICE_PR_AMT AS NAT_PRICE_PR_AMT,
  RTV_DEPT_CD AS RTV_DEPT_CD,
  RTV_DESC AS RTV_DESC,
  HAZ_FLAG AS HAZ_FLAG,
  AEROSOL_FLAG AS AEROSOL_FLAG,
  GL_ACCT_NBR AS GL_ACCT_NBR,
  ARTICLE_CATEGORY_ID AS ARTICLE_CATEGORY_ID,
  ARTICLE_CATEGORY_DESC AS ARTICLE_CATEGORY_DESC,
  ARTICLE_CATEGORY_CD AS ARTICLE_CATEGORY_CD,
  COMPONENT_FLAG AS COMPONENT_FLAG,
  ZDISCO_SCHED_TYPE_ID AS ZDISCO_SCHED_TYPE_ID,
  ZDISCO_SCHED_TYPE_DESC AS ZDISCO_SCHED_TYPE_DESC,
  ZDISCO_MKDN_SCHED_ID AS ZDISCO_MKDN_SCHED_ID,
  ZDISCO_MKDN_SCHED_DESC AS ZDISCO_MKDN_SCHED_DESC,
  ZDISCO_PID_DT AS ZDISCO_PID_DT,
  ZDISCO_START_DT AS ZDISCO_START_DT,
  ZDISCO_INIT_MKDN_DT AS ZDISCO_INIT_MKDN_DT,
  ZDISCO_DC_DT AS ZDISCO_DC_DT,
  ZDISCO_STR_DT AS ZDISCO_STR_DT,
  ZDISCO_STR_OWNRSHP_DT AS ZDISCO_STR_OWNRSHP_DT,
  ZDISCO_STR_WRT_OFF_DT AS ZDISCO_STR_WRT_OFF_DT,
  OPT_DEMAND_GROUP AS OPT_DEMAND_GROUP,
  OPT_PRODUCT_LINE AS OPT_PRODUCT_LINE,
  OPT_PRICE_FAMILY AS OPT_PRICE_FAMILY,
  OPT_EFFECTIVE_SIZE AS OPT_EFFECTIVE_SIZE,
  OPT_SELL_UNITS AS OPT_SELL_UNITS,
  OPT_UNIT_PRICE AS OPT_UNIT_PRICE,
  OPT_MOD_PRICE AS OPT_MOD_PRICE,
  OPT_MOD_COST AS OPT_MOD_COST,
  OPT_IS_NEW AS OPT_IS_NEW,
  OPT_ERROR_CODE AS OPT_ERROR_CODE,
  OPT_RELATIONSHIP AS OPT_RELATIONSHIP,
  OPT_METRIC AS OPT_METRIC,
  OPT_DIFF AS OPT_DIFF,
  OPT_ASSOC_PROD AS OPT_ASSOC_PROD,
  OPT_DELETE_OPTION AS OPT_DELETE_OPTION,
  DISC_SKU_NBR AS DISC_SKU_NBR,
  AVG_SALES AS AVG_SALES,
  COPY_SKU_NBR AS COPY_SKU_NBR,
  COPY_SKU_PCT AS COPY_SKU_PCT,
  PROCUREMENT_RULE_CD AS PROCUREMENT_RULE_CD,
  PROCUREMENT_RULE_DESC AS PROCUREMENT_RULE_DESC,
  CATEGORY_ANALYST_ID AS CATEGORY_ANALYST_ID,
  CATEGORY_ANALYST_NM AS CATEGORY_ANALYST_NM,
  CATEGORY_REPLENISHMENT_MGR_ID AS CATEGORY_REPLENISHMENT_MGR_ID,
  CATEGORY_REPLENISHMENT_MGR_NM AS CATEGORY_REPLENISHMENT_MGR_NM,
  CREATED_BY AS CREATED_BY,
  SHELF_LIFE_REM_CNT AS SHELF_LIFE_REM_CNT,
  TEMP_SKU AS TEMP_SKU,
  CONTENTS_METRICS AS CONTENTS_METRICS,
  CONTENTS_UNITS_METRICS AS CONTENTS_UNITS_METRICS,
  FLAVOR_CD AS FLAVOR_CD,
  FLAVOR_DESC AS FLAVOR_DESC,
  BASIC_MATERIAL AS BASIC_MATERIAL,
  CONTAINER_CD AS CONTAINER_CD,
  CONTAINER_DESC AS CONTAINER_DESC,
  RX_FLAG AS RX_FLAG,
  UPDATE_DT AS UPDATE_DT,
  LOAD_DT AS LOAD_DT,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_SKU_PROFILE_RPT_10"""

df_11 = spark.sql(query_11)

df_11.createOrReplaceTempView("SQ_Shortcut_to_SKU_PROFILE_RPT_11")

# COMMAND ----------
# DBTITLE 1, Ftr_SKU_SapClassID_12


query_12 = f"""SELECT
  SKU_NBR AS SKU_PROFILE_RPT_SKU_NBR,
  PRODUCT_ID AS SKU_PROFILE_RPT_PRODUCT_ID,
  SAP_CLASS_ID AS SAP_CLASS_ID,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_SKU_PROFILE_RPT_11
WHERE
  SAP_CLASS_ID = 481"""

df_12 = spark.sql(query_12)

df_12.createOrReplaceTempView("Ftr_SKU_SapClassID_12")

# COMMAND ----------
# DBTITLE 1, Jnr_SKU_Profile_RPT_13


query_13 = f"""SELECT
  DETAIL.OMS_ORDER_ID AS OMS_ORDER_ID,
  DETAIL.REFUND_DATE AS REFUND_DATE,
  DETAIL.ORDER_LN_OMS_ORDER_ID AS ORDER_LN_OMS_ORDER_ID,
  DETAIL.OMS_PARENT_ORDER_ID AS OMS_PARENT_ORDER_ID,
  DETAIL.UNIT_MONETARY_VALUE_AMT AS UNIT_MONETARY_VALUE_AMT,
  DETAIL.TOTAL_MONETARY_VALUE_AMT AS TOTAL_MONETARY_VALUE_AMT,
  DETAIL.RETURN_CODE_DESC AS RETURN_CODE_DESC,
  DETAIL.ORDER_QTY AS ORDER_QTY,
  DETAIL.PRODUCT_ID AS PRODUCT_ID,
  MASTER.SKU_PROFILE_RPT_SKU_NBR AS SKU_PROFILE_RPT_SKU_NBR,
  MASTER.SKU_PROFILE_RPT_PRODUCT_ID AS SKU_PROFILE_RPT_PRODUCT_ID,
  MASTER.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  Ftr_SKU_SapClassID_12 MASTER
  INNER JOIN Jnr_Order_OrderLn_9 DETAIL ON MASTER.SKU_PROFILE_RPT_PRODUCT_ID = DETAIL.PRODUCT_ID"""

df_13 = spark.sql(query_13)

df_13.createOrReplaceTempView("Jnr_SKU_Profile_RPT_13")

# COMMAND ----------
# DBTITLE 1, Jnr_OMSOrder_14


query_14 = f"""SELECT
  MASTER.OMS_ORDER_ID AS OMS_ORDER_ID,
  MASTER.OMS_ORDER_NBR AS PETSMART_ORIGINAL_ORDER,
  DETAIL.OMS_ORDER_ID AS OMS_ORDER_ID1,
  DETAIL.REFUND_DATE AS REFUND_DATE,
  DETAIL.ORDER_LN_OMS_ORDER_ID AS ORDER_LN_OMS_ORDER_ID,
  DETAIL.OMS_PARENT_ORDER_ID AS OMS_PARENT_ORDER_ID,
  DETAIL.UNIT_MONETARY_VALUE_AMT AS UNIT_MONETARY_VALUE_AMT,
  DETAIL.TOTAL_MONETARY_VALUE_AMT AS TOTAL_MONETARY_VALUE_AMT,
  DETAIL.RETURN_CODE_DESC AS RETURN_CODE_DESC,
  DETAIL.ORDER_QTY AS ORDER_QTY,
  DETAIL.PRODUCT_ID AS PRODUCT_ID,
  DETAIL.SKU_PROFILE_RPT_SKU_NBR AS SKU_PROFILE_RPT_SKU_NBR,
  DETAIL.SKU_PROFILE_RPT_PRODUCT_ID AS SKU_PROFILE_RPT_PRODUCT_ID,
  MASTER.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_OMS_ORDER1_6 MASTER
  INNER JOIN Jnr_SKU_Profile_RPT_13 DETAIL ON MASTER.OMS_ORDER_ID = DETAIL.OMS_PARENT_ORDER_ID"""

df_14 = spark.sql(query_14)

df_14.createOrReplaceTempView("Jnr_OMSOrder_14")

# COMMAND ----------
# DBTITLE 1, Jnr_Allivet_Invoice_15


query_15 = f"""SELECT
  MASTER.ALLIVET_ORDER_NBR AS ALLIVET_ORDER_NBR,
  MASTER.ALLIVET_SKU_NBR AS ALLIVET_SKU_NBR,
  MASTER.PETSMART_ORDER_NBR AS PETSMART_ORDER_NBR,
  MASTER.PETSMART_SKU_NBR AS PETSMART_SKU_NBR,
  DETAIL.OMS_ORDER_ID AS OMS_ORDER_ID,
  DETAIL.PETSMART_ORIGINAL_ORDER AS PETSMART_ORIGINAL_ORDER,
  DETAIL.OMS_ORDER_ID1 AS OMS_ORDER_ID1,
  DETAIL.REFUND_DATE AS REFUND_DATE,
  DETAIL.ORDER_LN_OMS_ORDER_ID AS ORDER_LN_OMS_ORDER_ID,
  DETAIL.OMS_PARENT_ORDER_ID AS OMS_PARENT_ORDER_ID,
  DETAIL.UNIT_MONETARY_VALUE_AMT AS UNIT_MONETARY_VALUE_AMT,
  DETAIL.TOTAL_MONETARY_VALUE_AMT AS TOTAL_MONETARY_VALUE_AMT,
  DETAIL.RETURN_CODE_DESC AS RETURN_CODE_DESC,
  DETAIL.ORDER_QTY AS ORDER_QTY,
  DETAIL.PRODUCT_ID AS PRODUCT_ID,
  DETAIL.SKU_PROFILE_RPT_SKU_NBR AS SKU_PROFILE_RPT_SKU_NBR,
  DETAIL.Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_ALLIVET_INVOICE_DAY_1 MASTER
  RIGHT JOIN Jnr_OMSOrder_14 DETAIL ON MASTER.PETSMART_ORDER_NBR = DETAIL.PETSMART_ORIGINAL_ORDER
  AND MASTER.PETSMART_SKU_NBR = DETAIL.SKU_PROFILE_RPT_SKU_NBR"""

df_15 = spark.sql(query_15)

df_15.createOrReplaceTempView("Jnr_Allivet_Invoice_15")

# COMMAND ----------
# DBTITLE 1, ALLIVET_REFUNDS_FF


spark.sql("""INSERT INTO
  ALLIVET_REFUNDS_FF
SELECT
  REFUND_DATE AS REFUND_DATE,
  ALLIVET_ORDER_NBR AS ALLIVET_ORDER,
  ALLIVET_SKU_NBR AS ALLIVET_SKU,
  PETSMART_ORIGINAL_ORDER AS PETSMART_ORDER,
  SKU_PROFILE_RPT_SKU_NBR AS PETSMART_SKU,
  ORDER_QTY AS SKU_QUANTITY,
  UNIT_MONETARY_VALUE_AMT AS UNIT_RETAIL_PRICE,
  TOTAL_MONETARY_VALUE_AMT AS TOTAL_RETAIL_PRICE,
  RETURN_CODE_DESC AS REFUND_REASON
FROM
  Jnr_Allivet_Invoice_15""")

# COMMAND ----------
#Post session variable updation
updateVariable(postVariableAssignment, variablesTableName, mainWorkflowId, parentName, "m_Allivet_Refunds_Monthly_FF")

# COMMAND ----------
#Update Mapping Variables in database.
persistVariables(variablesTableName, "m_Allivet_Refunds_Monthly_FF", mainWorkflowId, parentName)
