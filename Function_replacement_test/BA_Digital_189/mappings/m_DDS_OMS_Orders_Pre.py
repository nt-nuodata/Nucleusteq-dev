# Databricks notebook source
# MAGIC %run "./udf_informatica"

# COMMAND ----------


from pyspark.sql.types import *

spark.sql("use DELTA_TRAINING")
spark.sql("set spark.sql.legacy.timeParserPolicy = LEGACY")

# COMMAND ----------
%run ../WorkflowUtility

# COMMAND ----------
mainWorkflowId = dbutils.widgets.get("mainWorkflowId")
mainWorkflowRunId = dbutils.widgets.get("mainWorkflowRunId")
parentName = dbutils.widgets.get("parentName")
preVariableAssignment = dbutils.widgets.get("preVariableAssignment")
postVariableAssignment = dbutils.widgets.get("postVariableAssignment")
truncTargetTableOptions = dbutils.widgets.get("truncTargetTableOptions")
variablesTableName = dbutils.widgets.get("variablesTableName")

# COMMAND ----------
#Truncate Target Tables
truncateTargetTables(truncTargetTableOptions)

# COMMAND ----------
#Pre presession variable updation
updateVariable(preVariableAssignment, variablesTableName, mainWorkflowId, parentName, "m_DDS_OMS_Orders_Pre")

# COMMAND ----------
fetchAndCreateVariables(parentName,"m_DDS_OMS_Orders_Pre", variablesTableName, mainWorkflowId)

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_ORDER_LOAD_CTRL_0


query_0 = f"""SELECT
  ORDER_ID AS ORDER_ID,
  PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID
FROM
  OMS_ORDER_LOAD_CTRL"""

df_0 = spark.sql(query_0)

df_0.createOrReplaceTempView("Shortcut_to_OMS_ORDER_LOAD_CTRL_0")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_ORDERS_1


query_1 = f"""SELECT
  ORDER_ID AS ORDER_ID,
  TC_ORDER_ID AS TC_ORDER_ID,
  TC_ORDER_ID_U AS TC_ORDER_ID_U,
  TC_COMPANY_ID AS TC_COMPANY_ID,
  CREATION_TYPE AS CREATION_TYPE,
  BUSINESS_PARTNER_ID AS BUSINESS_PARTNER_ID,
  PARENT_ORDER_ID AS PARENT_ORDER_ID,
  EXT_PURCHASE_ORDER AS EXT_PURCHASE_ORDER,
  CONS_RUN_ID AS CONS_RUN_ID,
  O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  O_FACILITY_ID AS O_FACILITY_ID,
  O_DOCK_ID AS O_DOCK_ID,
  O_ADDRESS_1 AS O_ADDRESS_1,
  O_ADDRESS_2 AS O_ADDRESS_2,
  O_ADDRESS_3 AS O_ADDRESS_3,
  O_CITY AS O_CITY,
  O_STATE_PROV AS O_STATE_PROV,
  O_POSTAL_CODE AS O_POSTAL_CODE,
  O_COUNTY AS O_COUNTY,
  O_COUNTRY_CODE AS O_COUNTRY_CODE,
  D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  D_FACILITY_ID AS D_FACILITY_ID,
  D_DOCK_ID AS D_DOCK_ID,
  D_ADDRESS_1 AS D_ADDRESS_1,
  D_ADDRESS_2 AS D_ADDRESS_2,
  D_ADDRESS_3 AS D_ADDRESS_3,
  D_CITY AS D_CITY,
  D_STATE_PROV AS D_STATE_PROV,
  D_POSTAL_CODE AS D_POSTAL_CODE,
  D_COUNTY AS D_COUNTY,
  D_COUNTRY_CODE AS D_COUNTRY_CODE,
  BILL_TO_NAME AS BILL_TO_NAME,
  BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  BILL_FACILITY_ID AS BILL_FACILITY_ID,
  BILL_TO_ADDRESS_1 AS BILL_TO_ADDRESS_1,
  BILL_TO_ADDRESS_2 AS BILL_TO_ADDRESS_2,
  BILL_TO_ADDRESS_3 AS BILL_TO_ADDRESS_3,
  BILL_TO_CITY AS BILL_TO_CITY,
  BILL_TO_STATE_PROV AS BILL_TO_STATE_PROV,
  BILL_TO_COUNTY AS BILL_TO_COUNTY,
  BILL_TO_POSTAL_CODE AS BILL_TO_POSTAL_CODE,
  BILL_TO_COUNTRY_CODE AS BILL_TO_COUNTRY_CODE,
  BILL_TO_PHONE_NUMBER AS BILL_TO_PHONE_NUMBER,
  BILL_TO_FAX_NUMBER AS BILL_TO_FAX_NUMBER,
  BILL_TO_EMAIL AS BILL_TO_EMAIL,
  PLAN_O_FACILITY_ID AS PLAN_O_FACILITY_ID,
  PLAN_D_FACILITY_ID AS PLAN_D_FACILITY_ID,
  PLAN_O_FACILITY_ALIAS_ID AS PLAN_O_FACILITY_ALIAS_ID,
  PLAN_D_FACILITY_ALIAS_ID AS PLAN_D_FACILITY_ALIAS_ID,
  PLAN_LEG_D_ALIAS_ID AS PLAN_LEG_D_ALIAS_ID,
  PLAN_LEG_O_ALIAS_ID AS PLAN_LEG_O_ALIAS_ID,
  INCOTERM_FACILITY_ID AS INCOTERM_FACILITY_ID,
  INCOTERM_FACILITY_ALIAS_ID AS INCOTERM_FACILITY_ALIAS_ID,
  INCOTERM_LOC_AVA_DTTM AS INCOTERM_LOC_AVA_DTTM,
  INCOTERM_LOC_AVA_TIME_ZONE_ID AS INCOTERM_LOC_AVA_TIME_ZONE_ID,
  PICKUP_TZ AS PICKUP_TZ,
  DELIVERY_TZ AS DELIVERY_TZ,
  PICKUP_START_DTTM AS PICKUP_START_DTTM,
  PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  ORDER_DATE_DTTM AS ORDER_DATE_DTTM,
  ORDER_RECON_DTTM AS ORDER_RECON_DTTM,
  INBOUND_REGION_ID AS INBOUND_REGION_ID,
  OUTBOUND_REGION_ID AS OUTBOUND_REGION_ID,
  DSG_SERVICE_LEVEL_ID AS DSG_SERVICE_LEVEL_ID,
  DSG_CARRIER_ID AS DSG_CARRIER_ID,
  DSG_EQUIPMENT_ID AS DSG_EQUIPMENT_ID,
  DSG_TRACTOR_EQUIPMENT_ID AS DSG_TRACTOR_EQUIPMENT_ID,
  DSG_MOT_ID AS DSG_MOT_ID,
  BASELINE_MOT_ID AS BASELINE_MOT_ID,
  BASELINE_SERVICE_LEVEL_ID AS BASELINE_SERVICE_LEVEL_ID,
  PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  MERCHANDIZING_DEPARTMENT_ID AS MERCHANDIZING_DEPARTMENT_ID,
  WAVE_ID AS WAVE_ID,
  WAVE_OPTION_ID AS WAVE_OPTION_ID,
  PATH_ID AS PATH_ID,
  PATH_SET_ID AS PATH_SET_ID,
  DRIVER_TYPE_ID AS DRIVER_TYPE_ID,
  UN_NUMBER_ID AS UN_NUMBER_ID,
  BLOCK_AUTO_CREATE AS BLOCK_AUTO_CREATE,
  BLOCK_AUTO_CONSOLIDATE AS BLOCK_AUTO_CONSOLIDATE,
  HAS_ALERTS AS HAS_ALERTS,
  HAS_EM_NOTIFY_FLAG AS HAS_EM_NOTIFY_FLAG,
  HAS_IMPORT_ERROR AS HAS_IMPORT_ERROR,
  HAS_NOTES AS HAS_NOTES,
  HAS_SOFT_CHECK_ERRORS AS HAS_SOFT_CHECK_ERRORS,
  HAS_SPLIT AS HAS_SPLIT,
  IS_BOOKING_REQUIRED AS IS_BOOKING_REQUIRED,
  IS_CANCELLED AS IS_CANCELLED,
  IS_HAZMAT AS IS_HAZMAT,
  IS_IMPORTED AS IS_IMPORTED,
  IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  IS_PERISHABLE AS IS_PERISHABLE,
  IS_SUSPENDED AS IS_SUSPENDED,
  NORMALIZED_BASELINE_COST AS NORMALIZED_BASELINE_COST,
  BASELINE_COST_CURRENCY_CODE AS BASELINE_COST_CURRENCY_CODE,
  ORIG_BUDG_COST AS ORIG_BUDG_COST,
  BUDG_COST AS BUDG_COST,
  ACTUAL_COST AS ACTUAL_COST,
  BASELINE_COST AS BASELINE_COST,
  TRANS_RESP_CODE AS TRANS_RESP_CODE,
  BILLING_METHOD AS BILLING_METHOD,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  MOVEMENT_OPTION AS MOVEMENT_OPTION,
  PRIORITY AS PRIORITY,
  MOVE_TYPE AS MOVE_TYPE,
  SCHED_DOW AS SCHED_DOW,
  EQUIPMENT_TYPE AS EQUIPMENT_TYPE,
  DELIVERY_REQ AS DELIVERY_REQ,
  MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  MONETARY_VALUE AS MONETARY_VALUE,
  COMPARTMENT_NO AS COMPARTMENT_NO,
  PACKAGING AS PACKAGING,
  ORDER_LOADING_SEQ AS ORDER_LOADING_SEQ,
  REF_FIELD_1 AS REF_FIELD_1,
  REF_FIELD_2 AS REF_FIELD_2,
  REF_FIELD_3 AS REF_FIELD_3,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_DTTM AS CREATED_DTTM,
  LAST_UPDATED_SOURCE_TYPE AS LAST_UPDATED_SOURCE_TYPE,
  LAST_UPDATED_SOURCE AS LAST_UPDATED_SOURCE,
  LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  HIBERNATE_VERSION AS HIBERNATE_VERSION,
  ACTUAL_COST_CURRENCY_CODE AS ACTUAL_COST_CURRENCY_CODE,
  BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  SHIPMENT_ID AS SHIPMENT_ID,
  BILL_TO_TITLE AS BILL_TO_TITLE,
  ORDER_STATUS AS ORDER_STATUS,
  ADDR_CODE AS ADDR_CODE,
  ADDR_VALID AS ADDR_VALID,
  ADVT_DATE AS ADVT_DATE,
  CHUTE_ID AS CHUTE_ID,
  COD_FUNDS AS COD_FUNDS,
  DC_CTR_NBR AS DC_CTR_NBR,
  DO_STATUS AS DO_STATUS,
  DO_TYPE AS DO_TYPE,
  DOCS_ONLY_SHPMT AS DOCS_ONLY_SHPMT,
  DUTY_AND_TAX AS DUTY_AND_TAX,
  DUTY_TAX_ACCT_NBR AS DUTY_TAX_ACCT_NBR,
  DUTY_TAX_PAYMENT_TYPE AS DUTY_TAX_PAYMENT_TYPE,
  EST_LPN AS EST_LPN,
  EST_LPN_BRIDGED AS EST_LPN_BRIDGED,
  FTSR_NBR AS FTSR_NBR,
  IS_BACK_ORDERED AS IS_BACK_ORDERED,
  LPN_CUBING_INDIC AS LPN_CUBING_INDIC,
  O_PHONE_NUMBER AS O_PHONE_NUMBER,
  ORDER_PRINT_DTTM AS ORDER_PRINT_DTTM,
  PALLET_CUBING_INDIC AS PALLET_CUBING_INDIC,
  PRE_PACK_FLAG AS PRE_PACK_FLAG,
  RTE_TYPE_1 AS RTE_TYPE_1,
  RTE_TYPE_2 AS RTE_TYPE_2,
  SHIP_GROUP_SEQUENCE AS SHIP_GROUP_SEQUENCE,
  SHPNG_CHRG AS SHPNG_CHRG,
  STAGE_INDIC AS STAGE_INDIC,
  STORE_NBR AS STORE_NBR,
  TOTAL_NBR_OF_LPN AS TOTAL_NBR_OF_LPN,
  TOTAL_NBR_OF_PLT AS TOTAL_NBR_OF_PLT,
  WM_ORDER_STATUS AS WM_ORDER_STATUS,
  D_NAME AS D_NAME,
  O_CONTACT AS O_CONTACT,
  SECONDARY_MAXI_ADDR_NBR AS SECONDARY_MAXI_ADDR_NBR,
  D_CONTACT AS D_CONTACT,
  AES_ITN AS AES_ITN,
  BATCH_ID AS BATCH_ID,
  ORIGIN_SHIP_THRU_FACILITY_ID AS ORIGIN_SHIP_THRU_FACILITY_ID,
  ORIGIN_SHIP_THRU_FAC_ALIAS_ID AS ORIGIN_SHIP_THRU_FAC_ALIAS_ID,
  DEST_SHIP_THRU_FACILITY_ID AS DEST_SHIP_THRU_FACILITY_ID,
  DEST_SHIP_THRU_FAC_ALIAS_ID AS DEST_SHIP_THRU_FAC_ALIAS_ID,
  ACTUAL_SHIPPED_DTTM AS ACTUAL_SHIPPED_DTTM,
  BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  BOL_BREAK_ATTR AS BOL_BREAK_ATTR,
  D_EMAIL AS D_EMAIL,
  D_FAX_NUMBER AS D_FAX_NUMBER,
  D_PHONE_NUMBER AS D_PHONE_NUMBER,
  DYNAMIC_ROUTING_REQD AS DYNAMIC_ROUTING_REQD,
  INTL_GOODS_DESC AS INTL_GOODS_DESC,
  MAJOR_ORDER_GRP_ATTR AS MAJOR_ORDER_GRP_ATTR,
  ORDER_CONSOL_PROFILE AS ORDER_CONSOL_PROFILE,
  PACK_SLIP_PRT_CNT AS PACK_SLIP_PRT_CNT,
  PROD_SCHED_REF_NUMBER AS PROD_SCHED_REF_NUMBER,
  MUST_RELEASE_BY_DTTM AS MUST_RELEASE_BY_DTTM,
  CANCEL_DTTM AS CANCEL_DTTM,
  ASSIGNED_STATIC_ROUTE_ID AS ASSIGNED_STATIC_ROUTE_ID,
  DSG_STATIC_ROUTE_ID AS DSG_STATIC_ROUTE_ID,
  O_FACILITY_NAME AS O_FACILITY_NAME,
  O_DOCK_DOOR_ID AS O_DOCK_DOOR_ID,
  O_FAX_NUMBER AS O_FAX_NUMBER,
  O_EMAIL AS O_EMAIL,
  D_FACILITY_NAME AS D_FACILITY_NAME,
  D_DOCK_DOOR_ID AS D_DOCK_DOOR_ID,
  PURCHASE_ORDER_NUMBER AS PURCHASE_ORDER_NUMBER,
  CUSTOMER_ID AS CUSTOMER_ID,
  REPL_WAVE_NBR AS REPL_WAVE_NBR,
  CUBING_STATUS AS CUBING_STATUS,
  SCHED_PICKUP_DTTM AS SCHED_PICKUP_DTTM,
  SCHED_DELIVERY_DTTM AS SCHED_DELIVERY_DTTM,
  ZONE_SKIP_HUB_LOCATION_ID AS ZONE_SKIP_HUB_LOCATION_ID,
  BILL_TO_FACILITY_NAME AS BILL_TO_FACILITY_NAME,
  FREIGHT_CLASS AS FREIGHT_CLASS,
  NON_MACHINEABLE AS NON_MACHINEABLE,
  ASSIGNED_MOT_ID AS ASSIGNED_MOT_ID,
  ASSIGNED_CARRIER_ID AS ASSIGNED_CARRIER_ID,
  ASSIGNED_SERVICE_LEVEL_ID AS ASSIGNED_SERVICE_LEVEL_ID,
  ASSIGNED_EQUIPMENT_ID AS ASSIGNED_EQUIPMENT_ID,
  DYNAMIC_REQUEST_SENT AS DYNAMIC_REQUEST_SENT,
  COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  TC_SHIPMENT_ID AS TC_SHIPMENT_ID,
  IN_TRANSIT_ALLOCATION AS IN_TRANSIT_ALLOCATION,
  RELEASE_DESTINATION AS RELEASE_DESTINATION,
  TEMPLATE_ID AS TEMPLATE_ID,
  COD_AMOUNT AS COD_AMOUNT,
  BILL_TO_CONTACT_NAME AS BILL_TO_CONTACT_NAME,
  SHIP_GROUP_ID AS SHIP_GROUP_ID,
  PURCHASE_ORDER_ID AS PURCHASE_ORDER_ID,
  DSG_HUB_LOCATION_ID AS DSG_HUB_LOCATION_ID,
  OVERRIDE_BILLING_METHOD AS OVERRIDE_BILLING_METHOD,
  PARENT_TYPE AS PARENT_TYPE,
  ACCT_RCVBL_CODE AS ACCT_RCVBL_CODE,
  ADVT_CODE AS ADVT_CODE,
  IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  IS_DIRECT_ALLOWED AS IS_DIRECT_ALLOWED,
  RTE_ATTR AS RTE_ATTR,
  LAST_RUN_ID AS LAST_RUN_ID,
  PLAN_DUE_DTTM AS PLAN_DUE_DTTM,
  IS_ORDER_RECONCILED AS IS_ORDER_RECONCILED,
  PRTL_SHIP_CONF_FLAG AS PRTL_SHIP_CONF_FLAG,
  PRTL_SHIP_CONF_STATUS AS PRTL_SHIP_CONF_STATUS,
  ALLOW_PRE_BILLING AS ALLOW_PRE_BILLING,
  LANE_NAME AS LANE_NAME,
  DECLARED_VALUE AS DECLARED_VALUE,
  DV_CURRENCY_CODE AS DV_CURRENCY_CODE,
  COD_CURRENCY_CODE AS COD_CURRENCY_CODE,
  WEIGHT_UOM_ID_BASE AS WEIGHT_UOM_ID_BASE,
  LINE_HAUL_SHIP_VIA AS LINE_HAUL_SHIP_VIA,
  ORIGINAL_ASSIGNED_SHIP_VIA AS ORIGINAL_ASSIGNED_SHIP_VIA,
  DISTRIBUTION_SHIP_VIA AS DISTRIBUTION_SHIP_VIA,
  DSG_SHIP_VIA AS DSG_SHIP_VIA,
  TAX_ID AS TAX_ID,
  ORDER_RECEIVED AS ORDER_RECEIVED,
  IS_ORIGINAL_ORDER AS IS_ORIGINAL_ORDER,
  FREIGHT_FORWARDER_ACCT_NBR AS FREIGHT_FORWARDER_ACCT_NBR,
  GLOBAL_LOCN_NBR AS GLOBAL_LOCN_NBR,
  IMPORTER_DEFN AS IMPORTER_DEFN,
  LANG_ID AS LANG_ID,
  MAJOR_MINOR_ORDER AS MAJOR_MINOR_ORDER,
  MAJOR_ORDER_CTRL_NBR AS MAJOR_ORDER_CTRL_NBR,
  MHE_FLAG AS MHE_FLAG,
  MHE_ORD_STATE AS MHE_ORD_STATE,
  ORDER_CONSOL_LOCN_ID AS ORDER_CONSOL_LOCN_ID,
  ORDER_TYPE AS ORDER_TYPE,
  PACK_WAVE_NBR AS PACK_WAVE_NBR,
  PARTIAL_LPN_OPTION AS PARTIAL_LPN_OPTION,
  PARTIES_RELATED AS PARTIES_RELATED,
  PNH_FLAG AS PNH_FLAG,
  PRE_STICKER_CODE AS PRE_STICKER_CODE,
  PRIMARY_MAXI_ADDR_NBR AS PRIMARY_MAXI_ADDR_NBR,
  RTE_SWC_NBR AS RTE_SWC_NBR,
  RTE_TO AS RTE_TO,
  RTE_WAVE_NBR AS RTE_WAVE_NBR,
  BASELINE_CARRIER_ID AS BASELINE_CARRIER_ID,
  COD_RETURN_COMPANY_NAME AS COD_RETURN_COMPANY_NAME,
  BILL_ACCT_NBR AS BILL_ACCT_NBR,
  CUST_BROKER_ACCT_NBR AS CUST_BROKER_ACCT_NBR,
  MANIFEST_NBR AS MANIFEST_NBR,
  DESTINATION_ACTION AS DESTINATION_ACTION,
  TRANS_PLAN_OWNER AS TRANS_PLAN_OWNER,
  MARK_FOR AS MARK_FOR,
  DELIVERY_OPTIONS AS DELIVERY_OPTIONS,
  PRE_BILL_STATUS AS PRE_BILL_STATUS,
  CONTNT_LABEL_TYPE AS CONTNT_LABEL_TYPE,
  NBR_OF_CONTNT_LABEL AS NBR_OF_CONTNT_LABEL,
  NBR_OF_LABEL AS NBR_OF_LABEL,
  NBR_OF_PAKNG_SLIPS AS NBR_OF_PAKNG_SLIPS,
  PALLET_CONTENT_LABEL_TYPE AS PALLET_CONTENT_LABEL_TYPE,
  LPN_LABEL_TYPE AS LPN_LABEL_TYPE,
  PACK_SLIP_TYPE AS PACK_SLIP_TYPE,
  BOL_TYPE AS BOL_TYPE,
  MANIF_TYPE AS MANIF_TYPE,
  PRINT_CANADIAN_CUST_INVC_FLAG AS PRINT_CANADIAN_CUST_INVC_FLAG,
  PRINT_COO AS PRINT_COO,
  PRINT_DOCK_RCPT_FLAG AS PRINT_DOCK_RCPT_FLAG,
  PRINT_INV AS PRINT_INV,
  PRINT_NAFTA_COO_FLAG AS PRINT_NAFTA_COO_FLAG,
  PRINT_OCEAN_BOL_FLAG AS PRINT_OCEAN_BOL_FLAG,
  PRINT_SED AS PRINT_SED,
  PRINT_SHPR_LTR_OF_INSTR_FLAG AS PRINT_SHPR_LTR_OF_INSTR_FLAG,
  PRINT_PKG_LIST_FLAG AS PRINT_PKG_LIST_FLAG,
  FREIGHT_REVENUE_CURRENCY_CODE AS FREIGHT_REVENUE_CURRENCY_CODE,
  FREIGHT_REVENUE AS FREIGHT_REVENUE,
  TRANS_PLAN_DIRECTION AS TRANS_PLAN_DIRECTION,
  DSG_VOYAGE_FLIGHT AS DSG_VOYAGE_FLIGHT,
  IS_D_POBOX AS IS_D_POBOX,
  REF_SHIPMENT_NBR AS REF_SHIPMENT_NBR,
  REF_STOP_SEQ AS REF_STOP_SEQ,
  HAZ_OFFEROR_NAME AS HAZ_OFFEROR_NAME,
  DISTRO_NUMBER AS DISTRO_NUMBER,
  INCOTERM_ID AS INCOTERM_ID,
  DIRECTION AS DIRECTION,
  ORDER_SHIPMENT_SEQ AS ORDER_SHIPMENT_SEQ,
  MOVEMENT_TYPE AS MOVEMENT_TYPE,
  ACCT_RCVBL_ACCT_NBR AS ACCT_RCVBL_ACCT_NBR,
  REF_FIELD_4 AS REF_FIELD_4,
  REF_FIELD_5 AS REF_FIELD_5,
  REF_FIELD_6 AS REF_FIELD_6,
  REF_FIELD_7 AS REF_FIELD_7,
  REF_FIELD_8 AS REF_FIELD_8,
  REF_FIELD_9 AS REF_FIELD_9,
  REF_FIELD_10 AS REF_FIELD_10,
  FIRST_ZONE AS FIRST_ZONE,
  LAST_ZONE AS LAST_ZONE,
  NBR_OF_ZONES AS NBR_OF_ZONES,
  REF_NUM1 AS REF_NUM1,
  REF_NUM2 AS REF_NUM2,
  REF_NUM3 AS REF_NUM3,
  REF_NUM4 AS REF_NUM4,
  REF_NUM5 AS REF_NUM5,
  SPL_INSTR_CODE_1 AS SPL_INSTR_CODE_1,
  SPL_INSTR_CODE_2 AS SPL_INSTR_CODE_2,
  SPL_INSTR_CODE_3 AS SPL_INSTR_CODE_3,
  SPL_INSTR_CODE_4 AS SPL_INSTR_CODE_4,
  SPL_INSTR_CODE_5 AS SPL_INSTR_CODE_5,
  SPL_INSTR_CODE_6 AS SPL_INSTR_CODE_6,
  SPL_INSTR_CODE_7 AS SPL_INSTR_CODE_7,
  SPL_INSTR_CODE_8 AS SPL_INSTR_CODE_8,
  SPL_INSTR_CODE_9 AS SPL_INSTR_CODE_9,
  SPL_INSTR_CODE_10 AS SPL_INSTR_CODE_10,
  SINGLE_UNIT_FLAG AS SINGLE_UNIT_FLAG,
  TOTAL_NBR_OF_UNITS AS TOTAL_NBR_OF_UNITS,
  IS_ROUTED AS IS_ROUTED,
  DSG_TRAILER_NUMBER AS DSG_TRAILER_NUMBER,
  STAGING_LOCN_ID AS STAGING_LOCN_ID,
  UPSMI_COST_CENTER AS UPSMI_COST_CENTER,
  EST_PALLET_BRIDGED AS EST_PALLET_BRIDGED,
  EST_PALLET AS EST_PALLET,
  PICKLIST_ID AS PICKLIST_ID,
  EFFECTIVE_RANK AS EFFECTIVE_RANK,
  CHASE_ELIGIBLE AS CHASE_ELIGIBLE,
  SHIPPING_CHANNEL AS SHIPPING_CHANNEL,
  IS_GUARANTEED_DELIVERY AS IS_GUARANTEED_DELIVERY,
  FAILED_GUARANTEED_DELIVERY AS FAILED_GUARANTEED_DELIVERY,
  APPLY_LPNTYPE_FOR_ORDER AS APPLY_LPNTYPE_FOR_ORDER,
  PO_TYPE_ATTR AS PO_TYPE_ATTR
FROM
  ORDERS"""

df_1 = spark.sql(query_1)

df_1.createOrReplaceTempView("Shortcut_to_ORDERS_1")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_ORDERS_2


query_2 = f"""SELECT
  Shortcut_to_ORDERS_1.ORDER_ID AS ORDER_ID,
  Shortcut_to_ORDERS_1.TC_ORDER_ID AS TC_ORDER_ID,
  Shortcut_to_ORDERS_1.TC_COMPANY_ID AS TC_COMPANY_ID,
  Shortcut_to_ORDERS_1.CREATION_TYPE AS CREATION_TYPE,
  Shortcut_to_ORDERS_1.EXT_PURCHASE_ORDER AS EXT_PURCHASE_ORDER,
  Shortcut_to_ORDERS_1.O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  Shortcut_to_ORDERS_1.O_FACILITY_ID AS O_FACILITY_ID,
  Shortcut_to_ORDERS_1.D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  Shortcut_to_ORDERS_1.D_FACILITY_ID AS D_FACILITY_ID,
  Shortcut_to_ORDERS_1.BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  Shortcut_to_ORDERS_1.BILL_FACILITY_ID AS BILL_FACILITY_ID,
  Shortcut_to_ORDERS_1.PICKUP_TZ AS PICKUP_TZ,
  Shortcut_to_ORDERS_1.DELIVERY_TZ AS DELIVERY_TZ,
  Shortcut_to_ORDERS_1.PICKUP_START_DTTM AS PICKUP_START_DTTM,
  Shortcut_to_ORDERS_1.PICKUP_END_DTTM AS PICKUP_END_DTTM,
  Shortcut_to_ORDERS_1.DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  Shortcut_to_ORDERS_1.DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  Shortcut_to_ORDERS_1.ORDER_DATE_DTTM AS ORDER_DATE_DTTM,
  Shortcut_to_ORDERS_1.ORDER_RECON_DTTM AS ORDER_RECON_DTTM,
  Shortcut_to_ORDERS_1.INBOUND_REGION_ID AS INBOUND_REGION_ID,
  Shortcut_to_ORDERS_1.OUTBOUND_REGION_ID AS OUTBOUND_REGION_ID,
  Shortcut_to_ORDERS_1.HAS_ALERTS AS HAS_ALERTS,
  Shortcut_to_ORDERS_1.HAS_SPLIT AS HAS_SPLIT,
  Shortcut_to_ORDERS_1.IS_CANCELLED AS IS_CANCELLED,
  Shortcut_to_ORDERS_1.IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  Shortcut_to_ORDERS_1.ACTUAL_COST AS ACTUAL_COST,
  Shortcut_to_ORDERS_1.BASELINE_COST AS BASELINE_COST,
  Shortcut_to_ORDERS_1.BILLING_METHOD AS BILLING_METHOD,
  Shortcut_to_ORDERS_1.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  Shortcut_to_ORDERS_1.MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  Shortcut_to_ORDERS_1.MONETARY_VALUE AS MONETARY_VALUE,
  Shortcut_to_ORDERS_1.CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  Shortcut_to_ORDERS_1.CREATED_SOURCE AS CREATED_SOURCE,
  Shortcut_to_ORDERS_1.CREATED_DTTM AS CREATED_DTTM,
  Shortcut_to_ORDERS_1.LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  Shortcut_to_ORDERS_1.SHIPMENT_ID AS SHIPMENT_ID,
  Shortcut_to_ORDERS_1.ORDER_STATUS AS ORDER_STATUS,
  Shortcut_to_ORDERS_1.ADDR_VALID AS ADDR_VALID,
  Shortcut_to_ORDERS_1.DO_STATUS AS DO_STATUS,
  Shortcut_to_ORDERS_1.DO_TYPE AS DO_TYPE,
  Shortcut_to_ORDERS_1.IS_BACK_ORDERED AS IS_BACK_ORDERED,
  Shortcut_to_ORDERS_1.D_DOCK_DOOR_ID AS D_DOCK_DOOR_ID,
  Shortcut_to_ORDERS_1.PURCHASE_ORDER_NUMBER AS PURCHASE_ORDER_NUMBER,
  Shortcut_to_ORDERS_1.CUSTOMER_ID AS CUSTOMER_ID,
  Shortcut_to_ORDERS_1.SCHED_PICKUP_DTTM AS SCHED_PICKUP_DTTM,
  Shortcut_to_ORDERS_1.SCHED_DELIVERY_DTTM AS SCHED_DELIVERY_DTTM,
  Shortcut_to_ORDERS_1.PURCHASE_ORDER_ID AS PURCHASE_ORDER_ID,
  Shortcut_to_ORDERS_1.IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  Shortcut_to_ORDERS_1.ORDER_TYPE AS ORDER_TYPE,
  Shortcut_to_ORDERS_1.DELIVERY_OPTIONS AS DELIVERY_OPTIONS,
  Shortcut_to_ORDERS_1.REF_NUM1 AS REF_NUM1,
  Shortcut_to_ORDERS_1.TOTAL_NBR_OF_UNITS AS TOTAL_NBR_OF_UNITS,
  Shortcut_to_OMS_ORDER_LOAD_CTRL_0.ORDER_ID AS ORDER_ID1,
  Shortcut_to_ORDERS_1.PRTL_SHIP_CONF_FLAG AS PRTL_SHIP_CONF_FLAG,
  Shortcut_to_ORDERS_1.PRTL_SHIP_CONF_STATUS AS PRTL_SHIP_CONF_STATUS,
  Shortcut_to_ORDERS_1.ACTUAL_SHIPPED_DTTM AS ACTUAL_SHIPPED_DTTM,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_ORDERS_1,
  Shortcut_to_OMS_ORDER_LOAD_CTRL_0
WHERE
  Shortcut_to_OMS_ORDER_LOAD_CTRL_0.ORDER_ID = Shortcut_to_ORDERS_1.ORDER_ID"""

df_2 = spark.sql(query_2)

df_2.createOrReplaceTempView("SQ_Shortcut_to_ORDERS_2")

# COMMAND ----------
# DBTITLE 1, EXP_TRANS_3


query_3 = f"""SELECT
  ORDER_ID AS ORDER_ID,
  TC_ORDER_ID AS TC_ORDER_ID,
  TC_COMPANY_ID AS TC_COMPANY_ID,
  CREATION_TYPE AS CREATION_TYPE,
  EXT_PURCHASE_ORDER AS EXT_PURCHASE_ORDER,
  O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  O_FACILITY_ID AS O_FACILITY_ID,
  D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  D_FACILITY_ID AS D_FACILITY_ID,
  BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  BILL_FACILITY_ID AS BILL_FACILITY_ID,
  PICKUP_TZ AS PICKUP_TZ,
  DELIVERY_TZ AS DELIVERY_TZ,
  PICKUP_START_DTTM AS PICKUP_START_DTTM,
  PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  ORDER_DATE_DTTM AS ORDER_DATE_DTTM,
  ORDER_RECON_DTTM AS ORDER_RECON_DTTM,
  INBOUND_REGION_ID AS INBOUND_REGION_ID,
  OUTBOUND_REGION_ID AS OUTBOUND_REGION_ID,
  HAS_ALERTS AS HAS_ALERTS,
  HAS_SPLIT AS HAS_SPLIT,
  IS_CANCELLED AS IS_CANCELLED,
  IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  ACTUAL_COST AS ACTUAL_COST,
  BASELINE_COST AS BASELINE_COST,
  BILLING_METHOD AS BILLING_METHOD,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  MONETARY_VALUE AS MONETARY_VALUE,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_DTTM AS CREATED_DTTM,
  LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  SHIPMENT_ID AS SHIPMENT_ID,
  ORDER_STATUS AS ORDER_STATUS,
  ADDR_VALID AS ADDR_VALID,
  DO_STATUS AS DO_STATUS,
  DO_TYPE AS DO_TYPE,
  IS_BACK_ORDERED AS IS_BACK_ORDERED,
  D_DOCK_DOOR_ID AS D_DOCK_DOOR_ID,
  PURCHASE_ORDER_NUMBER AS PURCHASE_ORDER_NUMBER,
  CUSTOMER_ID AS CUSTOMER_ID,
  SCHED_PICKUP_DTTM AS SCHED_PICKUP_DTTM,
  SCHED_DELIVERY_DTTM AS SCHED_DELIVERY_DTTM,
  PURCHASE_ORDER_ID AS PURCHASE_ORDER_ID,
  IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  ORDER_TYPE AS ORDER_TYPE,
  DELIVERY_OPTIONS AS DELIVERY_OPTIONS,
  REF_NUM1 AS REF_NUM1,
  TOTAL_NBR_OF_UNITS AS TOTAL_NBR_OF_UNITS,
  now() AS LOAD_TSTMP_exp,
  PRTL_SHIP_CONF_FLAG AS PRTL_SHIP_CONF_FLAG,
  PRTL_SHIP_CONF_STATUS AS PRTL_SHIP_CONF_STATUS,
  ACTUAL_SHIPPED_DTTM AS ACTUAL_SHIPPED_DTTM,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_ORDERS_2"""

df_3 = spark.sql(query_3)

df_3.createOrReplaceTempView("EXP_TRANS_3")

# COMMAND ----------
# DBTITLE 1, OMS_ORDERS_PRE


spark.sql("""INSERT INTO
  OMS_ORDERS_PRE
SELECT
  ORDER_ID AS ORDER_ID,
  TC_ORDER_ID AS TC_ORDER_ID,
  TC_COMPANY_ID AS TC_COMPANY_ID,
  CREATION_TYPE AS CREATION_TYPE,
  EXT_PURCHASE_ORDER AS EXT_PURCHASE_ORDER,
  O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  O_FACILITY_ID AS O_FACILITY_ID,
  D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  D_FACILITY_ID AS D_FACILITY_ID,
  BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  BILL_FACILITY_ID AS BILL_FACILITY_ID,
  PICKUP_TZ AS PICKUP_TZ,
  DELIVERY_TZ AS DELIVERY_TZ,
  PICKUP_START_DTTM AS PICKUP_START_DTTM,
  PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  ORDER_DATE_DTTM AS ORDER_DATE_DTTM,
  ORDER_RECON_DTTM AS ORDER_RECON_DTTM,
  INBOUND_REGION_ID AS INBOUND_REGION_ID,
  OUTBOUND_REGION_ID AS OUTBOUND_REGION_ID,
  HAS_ALERTS AS HAS_ALERTS,
  HAS_SPLIT AS HAS_SPLIT,
  IS_CANCELLED AS IS_CANCELLED,
  IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  ACTUAL_COST AS ACTUAL_COST,
  BASELINE_COST AS BASELINE_COST,
  BILLING_METHOD AS BILLING_METHOD,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  MONETARY_VALUE AS MONETARY_VALUE,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_DTTM AS CREATED_DTTM,
  LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  SHIPMENT_ID AS SHIPMENT_ID,
  ORDER_STATUS AS ORDER_STATUS,
  ADDR_VALID AS ADDR_VALID,
  DO_STATUS AS DO_STATUS,
  DO_TYPE AS DO_TYPE,
  IS_BACK_ORDERED AS IS_BACK_ORDERED,
  ACTUAL_SHIPPED_DTTM AS ACTUAL_SHIPPED_DTTM,
  D_DOCK_DOOR_ID AS D_DOCK_DOOR_ID,
  PURCHASE_ORDER_NUMBER AS PURCHASE_ORDER_NUMBER,
  CUSTOMER_ID AS CUSTOMER_ID,
  SCHED_PICKUP_DTTM AS SCHED_PICKUP_DTTM,
  SCHED_DELIVERY_DTTM AS SCHED_DELIVERY_DTTM,
  PURCHASE_ORDER_ID AS PURCHASE_ORDER_ID,
  IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  PRTL_SHIP_CONF_FLAG AS PRTL_SHIP_CONF_FLAG,
  PRTL_SHIP_CONF_STATUS AS PRTL_SHIP_CONF_STATUS,
  ORDER_TYPE AS ORDER_TYPE,
  DELIVERY_OPTIONS AS DELIVERY_OPTIONS,
  REF_NUM1 AS REF_NUM1,
  TOTAL_NBR_OF_UNITS AS TOTAL_NBR_OF_UNITS,
  LOAD_TSTMP_exp AS LOAD_TSTMP
FROM
  EXP_TRANS_3""")

# COMMAND ----------
#Post session variable updation
updateVariable(postVariableAssignment, variablesTableName, mainWorkflowId, parentName, "m_DDS_OMS_Orders_Pre")

# COMMAND ----------
#Update Mapping Variables in database.
persistVariables(variablesTableName, "m_DDS_OMS_Orders_Pre", mainWorkflowId, parentName)
