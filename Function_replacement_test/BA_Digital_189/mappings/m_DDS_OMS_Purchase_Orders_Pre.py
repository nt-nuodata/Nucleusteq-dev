# Databricks notebook source
# MAGIC %run "./udf_informatica"

# COMMAND ----------


from pyspark.sql.types import *

spark.sql("use DELTA_TRAINING")
spark.sql("set spark.sql.legacy.timeParserPolicy = LEGACY")

# COMMAND ----------
%run ../WorkflowUtility

# COMMAND ----------
mainWorkflowId = dbutils.widgets.get("mainWorkflowId")
mainWorkflowRunId = dbutils.widgets.get("mainWorkflowRunId")
parentName = dbutils.widgets.get("parentName")
preVariableAssignment = dbutils.widgets.get("preVariableAssignment")
postVariableAssignment = dbutils.widgets.get("postVariableAssignment")
truncTargetTableOptions = dbutils.widgets.get("truncTargetTableOptions")
variablesTableName = dbutils.widgets.get("variablesTableName")

# COMMAND ----------
#Truncate Target Tables
truncateTargetTables(truncTargetTableOptions)

# COMMAND ----------
#Pre presession variable updation
updateVariable(preVariableAssignment, variablesTableName, mainWorkflowId, parentName, "m_DDS_OMS_Purchase_Orders_Pre")

# COMMAND ----------
fetchAndCreateVariables(parentName,"m_DDS_OMS_Purchase_Orders_Pre", variablesTableName, mainWorkflowId)

# COMMAND ----------
# DBTITLE 1, Shortcut_to_OMS_PURCH_ORDER_LOAD_CTRL_0


query_0 = f"""SELECT
  PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID
FROM
  OMS_PURCH_ORDER_LOAD_CTRL"""

df_0 = spark.sql(query_0)

df_0.createOrReplaceTempView("Shortcut_to_OMS_PURCH_ORDER_LOAD_CTRL_0")

# COMMAND ----------
# DBTITLE 1, Shortcut_to_PURCHASE_ORDERS_1


query_1 = f"""SELECT
  PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  TC_COMPANY_ID AS TC_COMPANY_ID,
  BUSINESS_PARTNER_ID AS BUSINESS_PARTNER_ID,
  CREATION_TYPE AS CREATION_TYPE,
  PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  TC_PURCHASE_ORDERS_ID_U AS TC_PURCHASE_ORDERS_ID_U,
  PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  MO_AUTO_CREATE_METHOD AS MO_AUTO_CREATE_METHOD,
  O_FACILITY_ID AS O_FACILITY_ID,
  O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  O_DOCK_ID AS O_DOCK_ID,
  O_NAME AS O_NAME,
  O_ADDRESS_1 AS O_ADDRESS_1,
  O_ADDRESS_2 AS O_ADDRESS_2,
  O_ADDRESS_3 AS O_ADDRESS_3,
  O_CITY AS O_CITY,
  O_STATE_PROV AS O_STATE_PROV,
  O_POSTAL_CODE AS O_POSTAL_CODE,
  O_COUNTY AS O_COUNTY,
  O_COUNTRY_CODE AS O_COUNTRY_CODE,
  D_FACILITY_ID AS D_FACILITY_ID,
  D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  D_DOCK_ID AS D_DOCK_ID,
  D_NAME AS D_NAME,
  D_LAST_NAME AS D_LAST_NAME,
  D_ADDRESS_1 AS D_ADDRESS_1,
  D_ADDRESS_2 AS D_ADDRESS_2,
  D_ADDRESS_3 AS D_ADDRESS_3,
  D_CITY AS D_CITY,
  D_STATE_PROV AS D_STATE_PROV,
  D_POSTAL_CODE AS D_POSTAL_CODE,
  D_COUNTY AS D_COUNTY,
  D_COUNTRY_CODE AS D_COUNTRY_CODE,
  D_PHONE_NUMBER AS D_PHONE_NUMBER,
  D_FAX_NUMBER AS D_FAX_NUMBER,
  D_EMAIL AS D_EMAIL,
  BILL_FACILITY_ID AS BILL_FACILITY_ID,
  BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  BILL_TO_WHSE AS BILL_TO_WHSE,
  BILL_TO_NAME AS BILL_TO_NAME,
  BILL_TO_LAST_NAME AS BILL_TO_LAST_NAME,
  BILL_TO_ADDRESS_1 AS BILL_TO_ADDRESS_1,
  BILL_TO_ADDRESS_2 AS BILL_TO_ADDRESS_2,
  BILL_TO_ADDRESS_3 AS BILL_TO_ADDRESS_3,
  BILL_TO_CITY AS BILL_TO_CITY,
  BILL_TO_STATE_PROV AS BILL_TO_STATE_PROV,
  BILL_TO_COUNTY AS BILL_TO_COUNTY,
  BILL_TO_POSTAL_CODE AS BILL_TO_POSTAL_CODE,
  BILL_TO_COUNTRY_CODE AS BILL_TO_COUNTRY_CODE,
  BILL_TO_PHONE_NUMBER AS BILL_TO_PHONE_NUMBER,
  BILL_TO_FAX_NUMBER AS BILL_TO_FAX_NUMBER,
  BILL_TO_EMAIL AS BILL_TO_EMAIL,
  BILL_ACCOUNT_NBR AS BILL_ACCOUNT_NBR,
  ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  ORG_SHIP_VIA_FACILITY_ID AS ORG_SHIP_VIA_FACILITY_ID,
  DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  DES_SHIP_VIA_FACILITY_ID AS DES_SHIP_VIA_FACILITY_ID,
  PICKUP_TZ AS PICKUP_TZ,
  DELIVERY_TZ AS DELIVERY_TZ,
  PICKUP_START_DTTM AS PICKUP_START_DTTM,
  PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  REQUESTED_DLVR_DTTM AS REQUESTED_DLVR_DTTM,
  MUST_DLVR_DTTM AS MUST_DLVR_DTTM,
  PROMISED_DLVR_DTTM AS PROMISED_DLVR_DTTM,
  DUE_DT AS DUE_DT,
  CANCEL_DT AS CANCEL_DT,
  PURCHASE_ORDERS_DATE_DTTM AS PURCHASE_ORDERS_DATE_DTTM,
  RELEASE_DTTM AS RELEASE_DTTM,
  FIRST_RCPT_DTTM AS FIRST_RCPT_DTTM,
  LAST_RCPT_DTTM AS LAST_RCPT_DTTM,
  BILLING_METHOD AS BILLING_METHOD,
  PAYMENT_MODE AS PAYMENT_MODE,
  MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  MONETARY_VALUE AS MONETARY_VALUE,
  CURRENCY_CODE AS CURRENCY_CODE,
  ORIG_BUDG_COST AS ORIG_BUDG_COST,
  BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  BUDG_COST AS BUDG_COST,
  TAX_CHARGES AS TAX_CHARGES,
  MISC_CHARGES AS MISC_CHARGES,
  INCOTERM_FACILITY_ID AS INCOTERM_FACILITY_ID,
  INCOTERM_FACILITY_ALIAS_ID AS INCOTERM_FACILITY_ALIAS_ID,
  INCOTERM_LOC_AVA_DTTM AS INCOTERM_LOC_AVA_DTTM,
  INCOTERM_LOC_AVA_TIME_ZONE_ID AS INCOTERM_LOC_AVA_TIME_ZONE_ID,
  IS_CANCELLED AS IS_CANCELLED,
  IS_IMPORTED AS IS_IMPORTED,
  UPDATE_SENT AS UPDATE_SENT,
  IS_HAZMAT AS IS_HAZMAT,
  IS_PERISHABLE AS IS_PERISHABLE,
  IS_INFO_ONLY AS IS_INFO_ONLY,
  HAS_IMPORT_ERROR AS HAS_IMPORT_ERROR,
  HAS_SOFT_CHECK_ERRORS AS HAS_SOFT_CHECK_ERRORS,
  HAS_NOTES AS HAS_NOTES,
  HAS_ALERTS AS HAS_ALERTS,
  IS_PURCHASE_ORDERS_RECONCILED AS IS_PURCHASE_ORDERS_RECONCILED,
  DELIVERY_REQ AS DELIVERY_REQ,
  IS_ACCEPTANCE_REQUIRED AS IS_ACCEPTANCE_REQUIRED,
  ARE_LEGAL_TERMS_REQUIRED AS ARE_LEGAL_TERMS_REQUIRED,
  IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  IS_DIRECT_ALLOWED AS IS_DIRECT_ALLOWED,
  IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  IS_PL_MANUALLY_SET AS IS_PL_MANUALLY_SET,
  IS_LOCKED AS IS_LOCKED,
  IS_PURCHASE_ORDERS_CONFIRMED AS IS_PURCHASE_ORDERS_CONFIRMED,
  HAS_ROUTING_REQUEST AS HAS_ROUTING_REQUEST,
  HAS_EM_NOTIFY_FLAG AS HAS_EM_NOTIFY_FLAG,
  IS_PUTAWAY AS IS_PUTAWAY,
  ALLOW_PARTIAL_SHIPPING AS ALLOW_PARTIAL_SHIPPING,
  ALLOW_ZONE_SKIPPING AS ALLOW_ZONE_SKIPPING,
  SNGL_UNIT_FLAG AS SNGL_UNIT_FLAG,
  PRE_PACK_FLAG AS PRE_PACK_FLAG,
  PNH_FLAG AS PNH_FLAG,
  ON_HOLD AS ON_HOLD,
  QUAL_CHK_HOLD_UPON_RCPT AS QUAL_CHK_HOLD_UPON_RCPT,
  UN_NUMBER_ID AS UN_NUMBER_ID,
  BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  TRANS_RESP_CODE AS TRANS_RESP_CODE,
  PRIORITY_TYPE AS PRIORITY_TYPE,
  PURCHASE_ORDERS_WEIGHT AS PURCHASE_ORDERS_WEIGHT,
  PRO_NUMBER AS PRO_NUMBER,
  PRIORITY AS PRIORITY,
  EVENT_IND_TYPEID AS EVENT_IND_TYPEID,
  COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  CARRIER_ID AS CARRIER_ID,
  PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DSG_CARRIER_ID AS DSG_CARRIER_ID,
  DSG_MOT_ID AS DSG_MOT_ID,
  DSG_SERVICE_LEVEL_ID AS DSG_SERVICE_LEVEL_ID,
  DECLINE_REASON_ID AS DECLINE_REASON_ID,
  CHANNEL_TYPE AS CHANNEL_TYPE,
  PRIMARY_CONTACT_NUMBER AS PRIMARY_CONTACT_NUMBER,
  MERCHANDIZING_DEPARTMENT_ID AS MERCHANDIZING_DEPARTMENT_ID,
  BUYER_CODE AS BUYER_CODE,
  REP_NAME AS REP_NAME,
  REGION_ID AS REGION_ID,
  INBOUND_REGION_ID AS INBOUND_REGION_ID,
  OUTBOUND_REGION_ID AS OUTBOUND_REGION_ID,
  PLAN_SHPMT_NBR AS PLAN_SHPMT_NBR,
  MISC_INSTR_CODE_1 AS MISC_INSTR_CODE_1,
  MISC_INSTR_CODE_2 AS MISC_INSTR_CODE_2,
  ASN_SHPMT_TYPE AS ASN_SHPMT_TYPE,
  PROD_SCHED_REF_NUMBER AS PROD_SCHED_REF_NUMBER,
  DELAY_TYPE AS DELAY_TYPE,
  CUSTOMER_CODE AS CUSTOMER_CODE,
  CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  CUSTOMER_ID AS CUSTOMER_ID,
  EST_OUTBD_LPN AS EST_OUTBD_LPN,
  EST_PALLET_BRIDGED AS EST_PALLET_BRIDGED,
  MAJOR_PKT_GRP_ATTR AS MAJOR_PKT_GRP_ATTR,
  MARK_FOR AS MARK_FOR,
  ONHOLD_EVENT_ID AS ONHOLD_EVENT_ID,
  UNHOLD_EVENT_ID AS UNHOLD_EVENT_ID,
  OUTBD_LPN_EPC_TYPE AS OUTBD_LPN_EPC_TYPE,
  PACK_SLIP_PRT_CNT AS PACK_SLIP_PRT_CNT,
  PKT_CONSOL_PROF AS PKT_CONSOL_PROF,
  PKT_PROFILE_ID AS PKT_PROFILE_ID,
  PLT_CONTNT_LABEL_TYPE AS PLT_CONTNT_LABEL_TYPE,
  PLT_CUBNG_INDIC AS PLT_CUBNG_INDIC,
  PRE_STIKR_CODE AS PRE_STIKR_CODE,
  STORE_NBR AS STORE_NBR,
  STORE_TYPE AS STORE_TYPE,
  SWC_NBR_SEQ AS SWC_NBR_SEQ,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_DTTM AS CREATED_DTTM,
  LAST_UPDATED_SOURCE_TYPE AS LAST_UPDATED_SOURCE_TYPE,
  LAST_UPDATED_SOURCE AS LAST_UPDATED_SOURCE,
  LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  BATCH_ID AS BATCH_ID,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  IS_CLOSED AS IS_CLOSED,
  MFG_PLNT AS MFG_PLNT,
  ORG_SHIP_FACILITY_ID AS ORG_SHIP_FACILITY_ID,
  OUTBD_LPN_ASN_REQD AS OUTBD_LPN_ASN_REQD,
  OUTBD_LPN_CUBNG_INDIC AS OUTBD_LPN_CUBNG_INDIC,
  OUTBD_LPN_LABEL_TYPE AS OUTBD_LPN_LABEL_TYPE,
  PACKAGING AS PACKAGING,
  RTN_MISC_NBR AS RTN_MISC_NBR,
  COMMIMTED_DLVR_DTTM AS COMMIMTED_DLVR_DTTM,
  GRAND_TOTAL AS GRAND_TOTAL,
  DSG_CARRIER_CODE AS DSG_CARRIER_CODE,
  TOTAL_DLRS_DISC AS TOTAL_DLRS_DISC,
  FRT_CLASS AS FRT_CLASS,
  PLAN_ID AS PLAN_ID,
  WORK_ORD_NBR AS WORK_ORD_NBR,
  MANUFACTURING_ORDER_NBR AS MANUFACTURING_ORDER_NBR,
  DC_ORDER_NUMBER AS DC_ORDER_NUMBER,
  CUT_NBR AS CUT_NBR,
  EXT_PURCHASE_ORDERS_ID AS EXT_PURCHASE_ORDERS_ID,
  HIBERNATE_VERSION AS HIBERNATE_VERSION,
  ORDER_CATEGORY AS ORDER_CATEGORY,
  DELIVERY_CHANNEL_ID AS DELIVERY_CHANNEL_ID,
  D_CONTACT_NAME AS D_CONTACT_NAME,
  BILL_TO_CONTACT_NAME AS BILL_TO_CONTACT_NAME,
  CHANNEL_ID AS CHANNEL_ID,
  DEPARTMENT_ID AS DEPARTMENT_ID,
  DOM_STORE_TYPE AS DOM_STORE_TYPE,
  FULFILL_MODE AS FULFILL_MODE,
  CONS_RUN_ID AS CONS_RUN_ID,
  LAST_RUN_ID AS LAST_RUN_ID,
  ACCEPTED_DTTM AS ACCEPTED_DTTM,
  IS_DO_CREATED AS IS_DO_CREATED,
  WEIGHT_UOM_ID_BASE AS WEIGHT_UOM_ID_BASE,
  ENTERED_BY AS ENTERED_BY,
  ENTRY_TYPE AS ENTRY_TYPE,
  ENTRY_CODE AS ENTRY_CODE,
  CUSTOMER_USER_ID AS CUSTOMER_USER_ID,
  CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  CUSTOMER_PHONE AS CUSTOMER_PHONE,
  CUSTOMER_TYPE AS CUSTOMER_TYPE,
  PAYMENT_STATUS AS PAYMENT_STATUS,
  REASON_ID AS REASON_ID,
  ADDR_VALID AS ADDR_VALID,
  ORG_APPT_EXISTS AS ORG_APPT_EXISTS,
  DEST_APPT_EXISTS AS DEST_APPT_EXISTS,
  MINIMIZE_SHIPMENTS AS MINIMIZE_SHIPMENTS,
  ORDER_RECEIVED AS ORDER_RECEIVED,
  REF_FIELD_1 AS REF_FIELD_1,
  REF_FIELD_2 AS REF_FIELD_2,
  REF_FIELD_3 AS REF_FIELD_3,
  CONTNT_LABEL_TYPE AS CONTNT_LABEL_TYPE,
  NBR_OF_CONTNT_LABEL AS NBR_OF_CONTNT_LABEL,
  NBR_OF_LABEL AS NBR_OF_LABEL,
  NBR_OF_PAKNG_SLIPS AS NBR_OF_PAKNG_SLIPS,
  PALLET_CONTENT_LABEL_TYPE AS PALLET_CONTENT_LABEL_TYPE,
  LPN_LABEL_TYPE AS LPN_LABEL_TYPE,
  PACK_SLIP_TYPE AS PACK_SLIP_TYPE,
  BOL_TYPE AS BOL_TYPE,
  MANIF_TYPE AS MANIF_TYPE,
  PRINT_CANADIAN_CUST_INVC_FLAG AS PRINT_CANADIAN_CUST_INVC_FLAG,
  PRINT_COO AS PRINT_COO,
  PRINT_DOCK_RCPT_FLAG AS PRINT_DOCK_RCPT_FLAG,
  PRINT_INV AS PRINT_INV,
  PRINT_NAFTA_COO_FLAG AS PRINT_NAFTA_COO_FLAG,
  PRINT_OCEAN_BOL_FLAG AS PRINT_OCEAN_BOL_FLAG,
  PRINT_SED AS PRINT_SED,
  PRINT_SHPR_LTR_OF_INSTR_FLAG AS PRINT_SHPR_LTR_OF_INSTR_FLAG,
  PRINT_PKG_LIST_FLAG AS PRINT_PKG_LIST_FLAG,
  FREIGHT_REVENUE_CURRENCY_CODE AS FREIGHT_REVENUE_CURRENCY_CODE,
  FREIGHT_REVENUE AS FREIGHT_REVENUE,
  TRANS_PLAN_DIRECTION AS TRANS_PLAN_DIRECTION,
  DSG_VOYAGE_FLIGHT AS DSG_VOYAGE_FLIGHT,
  REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  COMPLETED_EXTERNALLY AS COMPLETED_EXTERNALLY,
  INCOTERM_ID AS INCOTERM_ID,
  DIRECTION AS DIRECTION,
  ENTRY_CODE_FACILITY_ID AS ENTRY_CODE_FACILITY_ID,
  RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  ORDER_CONFIRMATION_DATE AS ORDER_CONFIRMATION_DATE,
  RMA_STATUS AS RMA_STATUS,
  O_PHONE_NUMBER AS O_PHONE_NUMBER,
  O_EMAIL AS O_EMAIL,
  O_FAX_NUMBER AS O_FAX_NUMBER,
  TAX_ID AS TAX_ID,
  SHIPPING_CHANNEL AS SHIPPING_CHANNEL,
  SHIP_GROUP_ID AS SHIP_GROUP_ID
FROM
  PURCHASE_ORDERS"""

df_1 = spark.sql(query_1)

df_1.createOrReplaceTempView("Shortcut_to_PURCHASE_ORDERS_1")

# COMMAND ----------
# DBTITLE 1, SQ_Shortcut_to_PURCHASE_ORDERS_2


query_2 = f"""SELECT
  Shortcut_to_PURCHASE_ORDERS_1.PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  Shortcut_to_PURCHASE_ORDERS_1.TC_COMPANY_ID AS TC_COMPANY_ID,
  Shortcut_to_PURCHASE_ORDERS_1.CREATION_TYPE AS CREATION_TYPE,
  Shortcut_to_PURCHASE_ORDERS_1.PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  Shortcut_to_PURCHASE_ORDERS_1.PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  Shortcut_to_PURCHASE_ORDERS_1.TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  Shortcut_to_PURCHASE_ORDERS_1.PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  Shortcut_to_PURCHASE_ORDERS_1.O_FACILITY_ID AS O_FACILITY_ID,
  Shortcut_to_PURCHASE_ORDERS_1.O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  Shortcut_to_PURCHASE_ORDERS_1.O_DOCK_ID AS O_DOCK_ID,
  Shortcut_to_PURCHASE_ORDERS_1.D_FACILITY_ID AS D_FACILITY_ID,
  Shortcut_to_PURCHASE_ORDERS_1.D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  Shortcut_to_PURCHASE_ORDERS_1.BILL_FACILITY_ID AS BILL_FACILITY_ID,
  Shortcut_to_PURCHASE_ORDERS_1.BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  Shortcut_to_PURCHASE_ORDERS_1.ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  Shortcut_to_PURCHASE_ORDERS_1.ORG_SHIP_VIA_FACILITY_ID AS ORG_SHIP_VIA_FACILITY_ID,
  Shortcut_to_PURCHASE_ORDERS_1.DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  Shortcut_to_PURCHASE_ORDERS_1.DES_SHIP_VIA_FACILITY_ID AS DES_SHIP_VIA_FACILITY_ID,
  Shortcut_to_PURCHASE_ORDERS_1.PICKUP_TZ AS PICKUP_TZ,
  Shortcut_to_PURCHASE_ORDERS_1.DELIVERY_TZ AS DELIVERY_TZ,
  Shortcut_to_PURCHASE_ORDERS_1.PICKUP_START_DTTM AS PICKUP_START_DTTM,
  Shortcut_to_PURCHASE_ORDERS_1.PICKUP_END_DTTM AS PICKUP_END_DTTM,
  Shortcut_to_PURCHASE_ORDERS_1.DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  Shortcut_to_PURCHASE_ORDERS_1.DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  Shortcut_to_PURCHASE_ORDERS_1.REQUESTED_DLVR_DTTM AS REQUESTED_DLVR_DTTM,
  Shortcut_to_PURCHASE_ORDERS_1.MUST_DLVR_DTTM AS MUST_DLVR_DTTM,
  Shortcut_to_PURCHASE_ORDERS_1.PROMISED_DLVR_DTTM AS PROMISED_DLVR_DTTM,
  Shortcut_to_PURCHASE_ORDERS_1.DUE_DT AS DUE_DT,
  Shortcut_to_PURCHASE_ORDERS_1.CANCEL_DT AS CANCEL_DT,
  Shortcut_to_PURCHASE_ORDERS_1.PURCHASE_ORDERS_DATE_DTTM AS PURCHASE_ORDERS_DATE_DTTM,
  Shortcut_to_PURCHASE_ORDERS_1.RELEASE_DTTM AS RELEASE_DTTM,
  Shortcut_to_PURCHASE_ORDERS_1.FIRST_RCPT_DTTM AS FIRST_RCPT_DTTM,
  Shortcut_to_PURCHASE_ORDERS_1.LAST_RCPT_DTTM AS LAST_RCPT_DTTM,
  Shortcut_to_PURCHASE_ORDERS_1.PAYMENT_MODE AS PAYMENT_MODE,
  Shortcut_to_PURCHASE_ORDERS_1.MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  Shortcut_to_PURCHASE_ORDERS_1.MONETARY_VALUE AS MONETARY_VALUE,
  Shortcut_to_PURCHASE_ORDERS_1.CURRENCY_CODE AS CURRENCY_CODE,
  Shortcut_to_PURCHASE_ORDERS_1.ORIG_BUDG_COST AS ORIG_BUDG_COST,
  Shortcut_to_PURCHASE_ORDERS_1.BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  Shortcut_to_PURCHASE_ORDERS_1.BUDG_COST AS BUDG_COST,
  Shortcut_to_PURCHASE_ORDERS_1.TAX_CHARGES AS TAX_CHARGES,
  Shortcut_to_PURCHASE_ORDERS_1.MISC_CHARGES AS MISC_CHARGES,
  Shortcut_to_PURCHASE_ORDERS_1.IS_CANCELLED AS IS_CANCELLED,
  Shortcut_to_PURCHASE_ORDERS_1.IS_IMPORTED AS IS_IMPORTED,
  Shortcut_to_PURCHASE_ORDERS_1.IS_PURCHASE_ORDERS_RECONCILED AS IS_PURCHASE_ORDERS_RECONCILED,
  Shortcut_to_PURCHASE_ORDERS_1.IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  Shortcut_to_PURCHASE_ORDERS_1.IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  Shortcut_to_PURCHASE_ORDERS_1.IS_DIRECT_ALLOWED AS IS_DIRECT_ALLOWED,
  Shortcut_to_PURCHASE_ORDERS_1.IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  Shortcut_to_PURCHASE_ORDERS_1.ON_HOLD AS ON_HOLD,
  Shortcut_to_PURCHASE_ORDERS_1.BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  Shortcut_to_PURCHASE_ORDERS_1.TRANS_RESP_CODE AS TRANS_RESP_CODE,
  Shortcut_to_PURCHASE_ORDERS_1.COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  Shortcut_to_PURCHASE_ORDERS_1.CARRIER_ID AS CARRIER_ID,
  Shortcut_to_PURCHASE_ORDERS_1.PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  Shortcut_to_PURCHASE_ORDERS_1.PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  Shortcut_to_PURCHASE_ORDERS_1.DECLINE_REASON_ID AS DECLINE_REASON_ID,
  Shortcut_to_PURCHASE_ORDERS_1.CHANNEL_TYPE AS CHANNEL_TYPE,
  Shortcut_to_PURCHASE_ORDERS_1.CUSTOMER_CODE AS CUSTOMER_CODE,
  Shortcut_to_PURCHASE_ORDERS_1.CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  Shortcut_to_PURCHASE_ORDERS_1.CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  Shortcut_to_PURCHASE_ORDERS_1.CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  Shortcut_to_PURCHASE_ORDERS_1.CREATED_SOURCE AS CREATED_SOURCE,
  Shortcut_to_PURCHASE_ORDERS_1.CREATED_DTTM AS CREATED_DTTM,
  Shortcut_to_PURCHASE_ORDERS_1.LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  Shortcut_to_PURCHASE_ORDERS_1.DROPOFF_PICKUP AS DROPOFF_PICKUP,
  Shortcut_to_PURCHASE_ORDERS_1.IS_CLOSED AS IS_CLOSED,
  Shortcut_to_PURCHASE_ORDERS_1.GRAND_TOTAL AS GRAND_TOTAL,
  Shortcut_to_PURCHASE_ORDERS_1.EXT_PURCHASE_ORDERS_ID AS EXT_PURCHASE_ORDERS_ID,
  Shortcut_to_PURCHASE_ORDERS_1.ORDER_CATEGORY AS ORDER_CATEGORY,
  Shortcut_to_PURCHASE_ORDERS_1.CHANNEL_ID AS CHANNEL_ID,
  Shortcut_to_PURCHASE_ORDERS_1.FULFILL_MODE AS FULFILL_MODE,
  Shortcut_to_PURCHASE_ORDERS_1.ENTERED_BY AS ENTERED_BY,
  Shortcut_to_PURCHASE_ORDERS_1.ENTRY_CODE AS ENTRY_CODE,
  Shortcut_to_PURCHASE_ORDERS_1.CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  Shortcut_to_PURCHASE_ORDERS_1.CUSTOMER_PHONE AS CUSTOMER_PHONE,
  Shortcut_to_PURCHASE_ORDERS_1.PAYMENT_STATUS AS PAYMENT_STATUS,
  Shortcut_to_PURCHASE_ORDERS_1.REASON_ID AS REASON_ID,
  Shortcut_to_PURCHASE_ORDERS_1.ORDER_RECEIVED AS ORDER_RECEIVED,
  Shortcut_to_PURCHASE_ORDERS_1.FREIGHT_REVENUE_CURRENCY_CODE AS FREIGHT_REVENUE_CURRENCY_CODE,
  Shortcut_to_PURCHASE_ORDERS_1.FREIGHT_REVENUE AS FREIGHT_REVENUE,
  Shortcut_to_PURCHASE_ORDERS_1.REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  Shortcut_to_PURCHASE_ORDERS_1.RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  Shortcut_to_OMS_PURCH_ORDER_LOAD_CTRL_0.PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID1,
  Shortcut_to_PURCHASE_ORDERS_1.HAS_ALERTS AS HAS_ALERTS,
  monotonically_increasing_id() AS Monotonically_Increasing_Id
FROM
  Shortcut_to_OMS_PURCH_ORDER_LOAD_CTRL_0,
  Shortcut_to_PURCHASE_ORDERS_1
WHERE
  Shortcut_to_OMS_PURCH_ORDER_LOAD_CTRL_0.PURCHASE_ORDERS_ID = Shortcut_to_PURCHASE_ORDERS_1.PURCHASE_ORDERS_ID"""

df_2 = spark.sql(query_2)

df_2.createOrReplaceTempView("SQ_Shortcut_to_PURCHASE_ORDERS_2")

# COMMAND ----------
# DBTITLE 1, EXP_LOAD_TSTMP_3


query_3 = f"""SELECT
  PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  TC_COMPANY_ID AS TC_COMPANY_ID,
  CREATION_TYPE AS CREATION_TYPE,
  PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  O_FACILITY_ID AS O_FACILITY_ID,
  O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  O_DOCK_ID AS O_DOCK_ID,
  D_FACILITY_ID AS D_FACILITY_ID,
  D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  BILL_FACILITY_ID AS BILL_FACILITY_ID,
  BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  ORG_SHIP_VIA_FACILITY_ID AS ORG_SHIP_VIA_FACILITY_ID,
  DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  DES_SHIP_VIA_FACILITY_ID AS DES_SHIP_VIA_FACILITY_ID,
  PICKUP_TZ AS PICKUP_TZ,
  DELIVERY_TZ AS DELIVERY_TZ,
  PICKUP_START_DTTM AS PICKUP_START_DTTM,
  PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  REQUESTED_DLVR_DTTM AS REQUESTED_DLVR_DTTM,
  MUST_DLVR_DTTM AS MUST_DLVR_DTTM,
  PROMISED_DLVR_DTTM AS PROMISED_DLVR_DTTM,
  DUE_DT AS DUE_DT,
  CANCEL_DT AS CANCEL_DT,
  PURCHASE_ORDERS_DATE_DTTM AS PURCHASE_ORDERS_DATE_DTTM,
  RELEASE_DTTM AS RELEASE_DTTM,
  FIRST_RCPT_DTTM AS FIRST_RCPT_DTTM,
  LAST_RCPT_DTTM AS LAST_RCPT_DTTM,
  PAYMENT_MODE AS PAYMENT_MODE,
  MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  MONETARY_VALUE AS MONETARY_VALUE,
  CURRENCY_CODE AS CURRENCY_CODE,
  ORIG_BUDG_COST AS ORIG_BUDG_COST,
  BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  BUDG_COST AS BUDG_COST,
  TAX_CHARGES AS TAX_CHARGES,
  MISC_CHARGES AS MISC_CHARGES,
  IS_CANCELLED AS IS_CANCELLED,
  IS_IMPORTED AS IS_IMPORTED,
  IS_PURCHASE_ORDERS_RECONCILED AS IS_PURCHASE_ORDERS_RECONCILED,
  IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  IS_DIRECT_ALLOWED AS IS_DIRECT_ALLOWED,
  IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  ON_HOLD AS ON_HOLD,
  BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  TRANS_RESP_CODE AS TRANS_RESP_CODE,
  COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  CARRIER_ID AS CARRIER_ID,
  PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DECLINE_REASON_ID AS DECLINE_REASON_ID,
  CHANNEL_TYPE AS CHANNEL_TYPE,
  CUSTOMER_CODE AS CUSTOMER_CODE,
  CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_DTTM AS CREATED_DTTM,
  LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  IS_CLOSED AS IS_CLOSED,
  GRAND_TOTAL AS GRAND_TOTAL,
  EXT_PURCHASE_ORDERS_ID AS EXT_PURCHASE_ORDERS_ID,
  ORDER_CATEGORY AS ORDER_CATEGORY,
  CHANNEL_ID AS CHANNEL_ID,
  FULFILL_MODE AS FULFILL_MODE,
  ENTERED_BY AS ENTERED_BY,
  ENTRY_CODE AS ENTRY_CODE,
  CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  CUSTOMER_PHONE AS CUSTOMER_PHONE,
  PAYMENT_STATUS AS PAYMENT_STATUS,
  REASON_ID AS REASON_ID,
  ORDER_RECEIVED AS ORDER_RECEIVED,
  FREIGHT_REVENUE AS FREIGHT_REVENUE,
  REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  now() AS o_LOAD_TSTMP,
  HAS_ALERTS AS HAS_ALERTS,
  Monotonically_Increasing_Id AS Monotonically_Increasing_Id
FROM
  SQ_Shortcut_to_PURCHASE_ORDERS_2"""

df_3 = spark.sql(query_3)

df_3.createOrReplaceTempView("EXP_LOAD_TSTMP_3")

# COMMAND ----------
# DBTITLE 1, OMS_PURCHASE_ORDERS_PRE


spark.sql("""INSERT INTO
  OMS_PURCHASE_ORDERS_PRE
SELECT
  PURCHASE_ORDERS_ID AS PURCHASE_ORDERS_ID,
  TC_COMPANY_ID AS TC_COMPANY_ID,
  CREATION_TYPE AS CREATION_TYPE,
  PURCHASE_ORDERS_TYPE AS PURCHASE_ORDERS_TYPE,
  PURCHASE_ORDERS_STATUS AS PURCHASE_ORDERS_STATUS,
  TC_PURCHASE_ORDERS_ID AS TC_PURCHASE_ORDERS_ID,
  PARENT_PURCHASE_ORDERS_ID AS PARENT_PURCHASE_ORDERS_ID,
  O_FACILITY_ID AS O_FACILITY_ID,
  O_FACILITY_ALIAS_ID AS O_FACILITY_ALIAS_ID,
  O_DOCK_ID AS O_DOCK_ID,
  D_FACILITY_ID AS D_FACILITY_ID,
  D_FACILITY_ALIAS_ID AS D_FACILITY_ALIAS_ID,
  BILL_FACILITY_ID AS BILL_FACILITY_ID,
  BILL_FACILITY_ALIAS_ID AS BILL_FACILITY_ALIAS_ID,
  ORG_SHIP_VIA_FACILITY_ALIAS_ID AS ORG_SHIP_VIA_FACILITY_ALIAS_ID,
  ORG_SHIP_VIA_FACILITY_ID AS ORG_SHIP_VIA_FACILITY_ID,
  DES_SHIP_VIA_FACILITY_ALIAS_ID AS DES_SHIP_VIA_FACILITY_ALIAS_ID,
  DES_SHIP_VIA_FACILITY_ID AS DES_SHIP_VIA_FACILITY_ID,
  PICKUP_TZ AS PICKUP_TZ,
  DELIVERY_TZ AS DELIVERY_TZ,
  PICKUP_START_DTTM AS PICKUP_START_DTTM,
  PICKUP_END_DTTM AS PICKUP_END_DTTM,
  DELIVERY_START_DTTM AS DELIVERY_START_DTTM,
  DELIVERY_END_DTTM AS DELIVERY_END_DTTM,
  REQUESTED_DLVR_DTTM AS REQUESTED_DLVR_DTTM,
  MUST_DLVR_DTTM AS MUST_DLVR_DTTM,
  PROMISED_DLVR_DTTM AS PROMISED_DLVR_DTTM,
  DUE_DT AS DUE_DT,
  CANCEL_DT AS CANCEL_DT,
  PURCHASE_ORDERS_DATE_DTTM AS PURCHASE_ORDERS_DATE_DTTM,
  RELEASE_DTTM AS RELEASE_DTTM,
  FIRST_RCPT_DTTM AS FIRST_RCPT_DTTM,
  LAST_RCPT_DTTM AS LAST_RCPT_DTTM,
  PAYMENT_MODE AS PAYMENT_MODE,
  MV_CURRENCY_CODE AS MV_CURRENCY_CODE,
  MONETARY_VALUE AS MONETARY_VALUE,
  CURRENCY_CODE AS CURRENCY_CODE,
  ORIG_BUDG_COST AS ORIG_BUDG_COST,
  BUDG_COST_CURRENCY_CODE AS BUDG_COST_CURRENCY_CODE,
  BUDG_COST AS BUDG_COST,
  TAX_CHARGES AS TAX_CHARGES,
  MISC_CHARGES AS MISC_CHARGES,
  IS_CANCELLED AS IS_CANCELLED,
  IS_IMPORTED AS IS_IMPORTED,
  HAS_ALERTS AS HAS_ALERTS,
  IS_PURCHASE_ORDERS_RECONCILED AS IS_PURCHASE_ORDERS_RECONCILED,
  IS_READY_TO_SHIP AS IS_READY_TO_SHIP,
  IS_CUSTOMER_PICKUP AS IS_CUSTOMER_PICKUP,
  IS_DIRECT_ALLOWED AS IS_DIRECT_ALLOWED,
  IS_PARTIALLY_PLANNED AS IS_PARTIALLY_PLANNED,
  ON_HOLD AS ON_HOLD,
  BILL_OF_LADING_NUMBER AS BILL_OF_LADING_NUMBER,
  TRANS_RESP_CODE AS TRANS_RESP_CODE,
  COMMODITY_CODE_ID AS COMMODITY_CODE_ID,
  CARRIER_ID AS CARRIER_ID,
  PRODUCT_CLASS_ID AS PRODUCT_CLASS_ID,
  PROTECTION_LEVEL_ID AS PROTECTION_LEVEL_ID,
  DECLINE_REASON_ID AS DECLINE_REASON_ID,
  CHANNEL_TYPE AS CHANNEL_TYPE,
  CUSTOMER_CODE AS CUSTOMER_CODE,
  CUSTOMER_FIRSTNAME AS CUSTOMER_FIRSTNAME,
  CUSTOMER_LASTNAME AS CUSTOMER_LASTNAME,
  CREATED_SOURCE_TYPE AS CREATED_SOURCE_TYPE,
  CREATED_SOURCE AS CREATED_SOURCE,
  CREATED_DTTM AS CREATED_DTTM,
  LAST_UPDATED_DTTM AS LAST_UPDATED_DTTM,
  DROPOFF_PICKUP AS DROPOFF_PICKUP,
  IS_CLOSED AS IS_CLOSED,
  GRAND_TOTAL AS GRAND_TOTAL,
  EXT_PURCHASE_ORDERS_ID AS EXT_PURCHASE_ORDERS_ID,
  ORDER_CATEGORY AS ORDER_CATEGORY,
  CHANNEL_ID AS CHANNEL_ID,
  FULFILL_MODE AS FULFILL_MODE,
  ENTERED_BY AS ENTERED_BY,
  ENTRY_CODE AS ENTRY_CODE,
  CUSTOMER_EMAIL AS CUSTOMER_EMAIL,
  CUSTOMER_PHONE AS CUSTOMER_PHONE,
  PAYMENT_STATUS AS PAYMENT_STATUS,
  REASON_ID AS REASON_ID,
  ORDER_RECEIVED AS ORDER_RECEIVED,
  FREIGHT_REVENUE AS FREIGHT_REVENUE,
  REASON_CODES_GROUP_ID AS REASON_CODES_GROUP_ID,
  RETURN_REFERENCE_NUMBER AS RETURN_REFERENCE_NUMBER,
  o_LOAD_TSTMP AS LOAD_TSTMP
FROM
  EXP_LOAD_TSTMP_3""")

# COMMAND ----------
#Post session variable updation
updateVariable(postVariableAssignment, variablesTableName, mainWorkflowId, parentName, "m_DDS_OMS_Purchase_Orders_Pre")

# COMMAND ----------
#Update Mapping Variables in database.
persistVariables(variablesTableName, "m_DDS_OMS_Purchase_Orders_Pre", mainWorkflowId, parentName)
